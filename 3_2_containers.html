<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js rust">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>é›†åˆå®¹å™¨ - Anatomy In First Rust Programming Class ğŸ¦€</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="ä»¥rustç¼–ç¨‹ç¬¬ä¸€è¯¾çš„ä»£ç ä¸ºä¾‹è¿›è¡ŒåŸºç¡€ä»£ç åˆ†æ">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="md-favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/pagetoc/pagetoc_style.css">
        <link rel="stylesheet" href="assets/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<!-- Provide site root to javascript -->
<script type="text/javascript">
    var path_to_root = "";
    var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
</script>

<!-- Work around some values being stored in localStorage wrapped in quotes -->
<script type="text/javascript">
    try {
        var theme = localStorage.getItem('mdbook-theme');
        var sidebar = localStorage.getItem('mdbook-sidebar');

        if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
        }

        if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
        }
    } catch (e) {
    }
</script>

<!-- Set the theme before any content is loaded, prevents flash -->
<script type="text/javascript">
    var theme;
    try {
        theme = localStorage.getItem('mdbook-theme');
    } catch (e) {
    }
    if (theme === null || theme === undefined) {
        theme = default_theme;
    }
    var html = document.querySelector('html');
    html.classList.remove('no-js')
    html.classList.remove('rust')
    html.classList.add(theme);
    html.classList.add('js');
</script>

<!-- Hide / unhide sidebar before it is displayed -->
<script type="text/javascript">
    var html = document.querySelector('html');
    var sidebar = 'hidden';
    if (document.body.clientWidth >= 1080) {
        try {
            sidebar = localStorage.getItem('mdbook-sidebar');
        } catch (e) {
        }
        sidebar = sidebar || 'visible';
    }
    html.classList.remove('sidebar-visible');
    html.classList.add("sidebar-" + sidebar);
</script>

<nav id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar-scrollbox">
        <ol class="chapter"><li class="chapter-item expanded "><a href="anatomy_logic.html"><strong aria-hidden="true">1.</strong> æºç é˜…è¯»é€»è¾‘</a></li><li class="chapter-item expanded "><a href="intro_gdb_lldb.html"><strong aria-hidden="true">2.</strong> gdb/lldbè°ƒè¯•æˆ–æŸ¥çœ‹å†…å­˜ç»“æ„</a></li><li class="chapter-item expanded "><a href="get_hands_dirty.html"><strong aria-hidden="true">3.</strong> get hands dirty</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="httpie.html"><strong aria-hidden="true">3.1.</strong> httpie</a></li><li class="chapter-item expanded "><a href="rgrep.html"><strong aria-hidden="true">3.2.</strong> rgrep</a></li><li class="chapter-item expanded "><a href="thumbor.html"><strong aria-hidden="true">3.3.</strong> thumbor</a></li><li class="chapter-item expanded "><a href="queryer.html"><strong aria-hidden="true">3.4.</strong> queryer</a></li></ol></li><li class="chapter-item expanded "><a href="rust_cores.html"><strong aria-hidden="true">4.</strong> Rustæ ¸å¿ƒæ·±å…¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1_stack_heap_ownership_lifetime_memory.html"><strong aria-hidden="true">4.1.</strong> I. ä»æ ˆå †ã€æ‰€æœ‰æƒã€ç”Ÿå‘½å‘¨æœŸå¼€å§‹å†…å­˜ç®¡ç†</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="1_1_stack_heap.html"><strong aria-hidden="true">4.1.1.</strong> ä»å †æ ˆå¼€å§‹</a></li><li class="chapter-item "><a href="1_2_programming_basic_concepts.html"><strong aria-hidden="true">4.1.2.</strong> å››å¤§ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ</a></li><li class="chapter-item "><a href="1_3_ownership.html"><strong aria-hidden="true">4.1.3.</strong> æ‰€æœ‰æƒ</a></li><li class="chapter-item "><a href="1_4_lifetime.html"><strong aria-hidden="true">4.1.4.</strong> ç”Ÿå‘½å‘¨æœŸ</a></li><li class="chapter-item "><a href="1_5_go_through.html"><strong aria-hidden="true">4.1.5.</strong> ä»åˆ›å»ºåˆ°æ¶ˆäº¡</a></li></ol></li><li class="chapter-item expanded "><a href="2_type_system.html"><strong aria-hidden="true">4.2.</strong> II. ç±»å‹ç³»ç»Ÿ</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="2_1_type_details.html"><strong aria-hidden="true">4.2.1.</strong> ç±»å‹ç³»ç»Ÿç‰¹ç‚¹</a></li><li class="chapter-item "><a href="2_2_generic.html"><strong aria-hidden="true">4.2.2.</strong> æ³›å‹</a></li><li class="chapter-item "><a href="2_3_trait.html"><strong aria-hidden="true">4.2.3.</strong> trait</a></li></ol></li><li class="chapter-item expanded "><a href="3_data_structure.html"><strong aria-hidden="true">4.3.</strong> III. æ•°æ®ç»“æ„</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="3_1_smart_pointer.html"><strong aria-hidden="true">4.3.1.</strong> æ™ºèƒ½æŒ‡é’ˆ</a></li><li class="chapter-item expanded "><a href="3_2_containers.html" class="active"><strong aria-hidden="true">4.3.2.</strong> é›†åˆå®¹å™¨</a></li><li class="chapter-item "><a href="3_3_error_handling.html"><strong aria-hidden="true">4.3.3.</strong> é”™è¯¯å¤„ç†</a></li><li class="chapter-item "><a href="3_4_closure.html"><strong aria-hidden="true">4.3.4.</strong> é—­åŒ…</a></li></ol></li><li class="chapter-item expanded "><a href="4_macros.html"><strong aria-hidden="true">4.4.</strong> IV. å®ç¼–ç¨‹</a></li><li class="chapter-item expanded "><a href="5_concurrency_async.html"><strong aria-hidden="true">4.5.</strong> V. å¹¶å‘ä¸å¼‚æ­¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="5_1_concurrency_primitives.html"><strong aria-hidden="true">4.5.1.</strong> å¹¶å‘åŸè¯­(Concurrency Primitives)</a></li><li class="chapter-item "><a href="5_2_future_async_await.html"><strong aria-hidden="true">4.5.2.</strong> å¼‚æ­¥ï¼šFuture/Async/Await</a></li><li class="chapter-item "><a href="5_3_deepin_async_await.html"><strong aria-hidden="true">4.5.3.</strong> æ·±å…¥async/await</a></li></ol></li><li class="chapter-item expanded "><a href="6_unsafe_ffi.html"><strong aria-hidden="true">4.6.</strong> VI. æ··åˆç¼–ç¨‹</a></li></ol></li><li class="chapter-item expanded "><a href="kv_server_design.html"><strong aria-hidden="true">5.</strong> kv serverè®¾è®¡ä¸å®ç°</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="kv1_basic.html"><strong aria-hidden="true">5.1.</strong> åŸºæœ¬æµç¨‹</a></li><li class="chapter-item expanded "><a href="kv2_protocols.html"><strong aria-hidden="true">5.2.</strong> å®ç°å¹¶éªŒè¯åè®®å±‚</a></li><li class="chapter-item expanded "><a href="kv3_advanced_traits.html"><strong aria-hidden="true">5.3.</strong> é«˜çº§traitæ”¹é€ </a></li><li class="chapter-item expanded "><a href="kv4_network.html"><strong aria-hidden="true">5.4.</strong> ç½‘ç»œå¤„ç†</a></li><li class="chapter-item expanded "><a href="kv5_network_security.html"><strong aria-hidden="true">5.5.</strong> ç½‘ç»œå®‰å…¨</a></li><li class="chapter-item expanded "><a href="kv6_async_refactor.html"><strong aria-hidden="true">5.6.</strong> å¼‚æ­¥æ”¹é€ </a></li><li class="chapter-item expanded "><a href="kv7_big_refactor.html"><strong aria-hidden="true">5.7.</strong> é‡å¤§é‡æ„</a></li><li class="chapter-item expanded "><a href="kv8_config_ci_cd.html"><strong aria-hidden="true">5.8.</strong> é…ç½®ã€æµ‹è¯•ã€ç›‘æ§ã€CI/CD</a></li></ol></li><li class="chapter-item expanded "><a href="custom_axum_async_web_framework.html"><strong aria-hidden="true">6.</strong> æ„å»ºè‡ªå·±çš„ç±»axumå¼‚æ­¥Webæ¡†æ¶</a></li><li class="chapter-item expanded affix "><a href="checklist.html">Checklist</a></li></ol>
    </div>
    <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
</nav>

<div id="page-wrapper" class="page-wrapper">

    <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
        <div id="menu-bar" class="menu-bar sticky bordered">
            <div class="left-buttons">
                <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </button>
                <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                    <i class="fa fa-paint-brush"></i>
                </button>
                <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                    <li role="none">
                        <button role="menuitem" class="theme" id="light">Light</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="rust">Rust (default)</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="coal">Coal</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="navy">Navy</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="ayu">Ayu</button>
                    </li>
                </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
            </div>

            <h1 class="menu-title">Anatomy In First Rust Programming Class ğŸ¦€</h1>
            <h4 class="menu-bar"><a href="https://kuanhsiaokuo.github.io/think-tool-kit/">ä¿æŒæ‰¹åˆ¤ï¼Œæœ‰æ‰€å–èˆï¼ŒçŸ¥è¡Œåˆä¸€, æ–¹è§çœŸæˆ‘</a> -- ç»ƒæ­¦ä¸ç»ƒåŠŸ
                åˆ°å¤´ä¸€åœºç©º -- ã€Šèµ›åšè‹±é›„ä¼ ã€‹ </h4>
            <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/KuanHsiaoKuo/geektime-tyr-rust.git" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-rust"></i>
                    </a>
            </div>
        </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                           placeholder="Search this book ..." aria-controls="searchresults-outer"
                           aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

        <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
        <script type="text/javascript">
            document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
            document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
            Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
            });
        </script>

        <div id="content" class="content">
            <main>

                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <h1 id="äºŒé›†åˆå®¹å™¨"><a class="header" href="#äºŒé›†åˆå®¹å™¨">äºŒã€é›†åˆå®¹å™¨</a></h1>
<!--ts-->
<ul>
<li><a href="#%E4%BA%8C%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8">äºŒã€é›†åˆå®¹å™¨</a>
<ul>
<li><a href="#%E5%AF%B9%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%AE%9A%E4%B9%89">å¯¹å®¹å™¨è¿›è¡Œå®šä¹‰</a></li>
<li><a href="#%E5%AF%B9%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%AE%9A%E4%B9%89">å¯¹é›†åˆå®¹å™¨è¿›è¡Œå®šä¹‰</a></li>
<li><a href="#%E5%88%87%E7%89%87">åˆ‡ç‰‡</a>
<ul>
<li><a href="#array-vs-vector">array vs vector</a></li>
<li>[Vec å’Œ &amp;[T]](#vec-å’Œ-t)</li>
<li><a href="#%E8%A7%A3%E5%BC%95%E7%94%A8">è§£å¼•ç”¨</a></li>
<li><a href="#%E5%88%87%E7%89%87%E5%92%8C%E8%BF%AD%E4%BB%A3%E5%99%A8-iterator">åˆ‡ç‰‡å’Œè¿­ä»£å™¨ Iterator</a></li>
<li><a href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E5%88%87%E7%89%87str">ç‰¹æ®Šçš„åˆ‡ç‰‡ï¼š&amp;str</a></li>
<li>[Box&lt;[T]&gt;](#boxt)</li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%88%87%E7%89%87%E5%AF%B9%E6%AF%94%E5%9B%BE">å¸¸ç”¨åˆ‡ç‰‡å¯¹æ¯”å›¾</a></li>
</ul>
</li>
<li><a href="#%E5%93%88%E5%B8%8C%E8%A1%A8">å“ˆå¸Œè¡¨</a>
<ul>
<li><a href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E8%BF%98%E6%98%AF%E5%88%97%E8%A1%A8">å“ˆå¸Œè¡¨è¿˜æ˜¯åˆ—è¡¨</a></li>
<li><a href="#rust-%E7%9A%84%E5%93%88%E5%B8%8C%E8%A1%A8">Rust çš„å“ˆå¸Œè¡¨</a></li>
</ul>
</li>
<li><a href="#-1"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882967.jpg"><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882967.jpg" alt="17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ" style="max-width: 100%;"></a>
</a>
<ul>
<li><a href="#hashmap-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">HashMap çš„æ•°æ®ç»“æ„</a></li>
<li><a href="#hashmap-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">HashMap çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</a></li>
<li><a href="#hashmap-%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80">HashMap çš„å†…å­˜å¸ƒå±€</a></li>
<li><a href="#ctrl-%E8%A1%A8">ctrl è¡¨</a></li>
<li><a href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E9%87%8D%E6%96%B0%E5%88%86%E9%85%8D%E4%B8%8E%E5%A2%9E%E9%95%BF">å“ˆå¸Œè¡¨é‡æ–°åˆ†é…ä¸å¢é•¿</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E5%80%BC">åˆ é™¤ä¸€ä¸ªå€¼</a></li>
<li><a href="#%E8%AE%A9%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%81%9A-hash-key">è®©è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„åš Hash key</a></li>
<li><a href="#hashset--btreemap--btreeset">HashSet / BTreeMap / BTreeSet</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-rust-%E7%9A%84-hashmap-%E8%A6%81%E7%BC%BA%E7%9C%81%E9%87%87%E7%94%A8%E5%8A%A0%E5%AF%86%E5%AE%89%E5%85%A8%E7%9A%84%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95">ä¸ºä»€ä¹ˆ Rust çš„ HashMap è¦ç¼ºçœé‡‡ç”¨åŠ å¯†å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Ÿ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Wed Oct 12 02:34:48 UTC 2022 -->
<!--te-->
<h2 id="å¯¹å®¹å™¨è¿›è¡Œå®šä¹‰"><a class="header" href="#å¯¹å®¹å™¨è¿›è¡Œå®šä¹‰">å¯¹å®¹å™¨è¿›è¡Œå®šä¹‰</a></h2>
<details id="admonition-å®¹å™¨æ•°æ®ç»“æ„å¦‚ä½•ç†è§£" class="admonition tip">
<summary class="admonition-title">
<p>å®¹å™¨æ•°æ®ç»“æ„å¦‚ä½•ç†è§£</p>
<p><a class="admonition-anchor-link" href="#admonition-å®¹å™¨æ•°æ®ç»“æ„å¦‚ä½•ç†è§£"></a></p>
</summary>
<div>
<p>æåˆ°å®¹å™¨ï¼Œå¾ˆå¯èƒ½ä½ é¦–å…ˆä¼šæƒ³åˆ°çš„å°±æ˜¯æ•°ç»„ã€åˆ—è¡¨è¿™äº›å¯ä»¥éå†çš„å®¹å™¨ï¼Œä½†å…¶å®åªè¦æŠŠæŸ ç§ç‰¹å®šçš„æ•°æ®å°è£…åœ¨æŸä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„å°±æ˜¯ä¸€ä¸ªå®¹å™¨ã€‚æ¯”å¦‚ Option<T>ï¼Œå®ƒ æ˜¯ä¸€ä¸ªåŒ…è£¹äº† T å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„å®¹å™¨ï¼Œè€Œ Cow æ˜¯ä¸€ä¸ªå°è£…äº†å†…éƒ¨æ•°æ® B æˆ–è¢«å€Ÿç”¨æˆ–æ‹¥æœ‰ æ‰€æœ‰æƒçš„å®¹å™¨ã€‚</p>
</div>
</details>
<h2 id="å¯¹é›†åˆå®¹å™¨è¿›è¡Œå®šä¹‰"><a class="header" href="#å¯¹é›†åˆå®¹å™¨è¿›è¡Œå®šä¹‰">å¯¹é›†åˆå®¹å™¨è¿›è¡Œå®šä¹‰</a></h2>
<details id="admonition-æŠŠæ‹¥æœ‰ç›¸åŒç±»å‹å¯¹æ•°æ®æ”¾åœ¨ä¸€èµ·ç»Ÿä¸€å¤„ç†" class="admonition tip">
<summary class="admonition-title">
<p>æŠŠæ‹¥æœ‰ç›¸åŒç±»å‹å¯¹æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œç»Ÿä¸€å¤„ç†</p>
<p><a class="admonition-anchor-link" href="#admonition-æŠŠæ‹¥æœ‰ç›¸åŒç±»å‹å¯¹æ•°æ®æ”¾åœ¨ä¸€èµ·ç»Ÿä¸€å¤„ç†"></a></p>
</summary>
<div>
<p>é›†åˆå®¹å™¨ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŠŠä¸€ç³»åˆ—æ‹¥æœ‰ç›¸åŒç±»å‹çš„æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>
<p>æˆ‘ä»¬ç†Ÿæ‚‰çš„å­—ç¬¦ä¸² Stringã€æ•°ç»„ [T; n]ã€åˆ—è¡¨ Vec<T> å’Œå“ˆå¸Œè¡¨ HashMap&lt;K, V&gt; ç­‰ï¼›</p>
</li>
<li>
<p>è™½ç„¶åˆ°å¤„åœ¨ä½¿ç”¨ï¼Œä½†è¿˜å¹¶ä¸ç†Ÿæ‚‰çš„åˆ‡ç‰‡ sliceï¼›</p>
</li>
<li>
<p>åœ¨å…¶ä»–è¯­è¨€ä¸­ä½¿ç”¨è¿‡ï¼Œä½†åœ¨ Rust ä¸­è¿˜æ²¡æœ‰ç”¨è¿‡çš„å¾ªç¯ç¼“å†²åŒº VecDeque<T>ã€åŒå‘åˆ— è¡¨ LinkedList<T> ç­‰ã€‚</p>
</li>
</ol>
<blockquote>
<p>è¿™äº›é›†åˆå®¹å™¨æœ‰å¾ˆå¤šå…±æ€§ï¼Œæ¯”å¦‚å¯ä»¥è¢«éå†ã€å¯ä»¥è¿›è¡Œ map-reduce æ“ä½œã€å¯ä»¥ä»ä¸€ç§ç±» å‹è½¬æ¢æˆå¦ä¸€ç§ç±»å‹ç­‰ç­‰ã€‚</p>
</blockquote>
</div>
</details>
<h2 id="åˆ‡ç‰‡"><a class="header" href="#åˆ‡ç‰‡">åˆ‡ç‰‡</a></h2>
<details id="admonition-åˆ‡ç‰‡åˆ°åº•æ˜¯ä»€ä¹ˆ" class="admonition tip">
<summary class="admonition-title">
<p>åˆ‡ç‰‡åˆ°åº•æ˜¯ä»€ä¹ˆ</p>
<p><a class="admonition-anchor-link" href="#admonition-åˆ‡ç‰‡åˆ°åº•æ˜¯ä»€ä¹ˆ"></a></p>
</summary>
<div>
<p>åœ¨ Rust é‡Œï¼Œåˆ‡ç‰‡æ˜¯æè¿°ä¸€ç»„å±äºåŒä¸€ç±»å‹ã€é•¿åº¦ä¸ç¡®å®šçš„ã€åœ¨å†…å­˜ä¸­è¿ç»­å­˜æ”¾çš„æ•°æ®ç»“ æ„ï¼Œç”¨ [T] æ¥è¡¨è¿°ã€‚å› ä¸ºé•¿åº¦ä¸ç¡®å®šï¼Œæ‰€ä»¥åˆ‡ç‰‡æ˜¯ä¸ª DSTï¼ˆDynamically Sized Typeï¼‰ã€‚</p>
<p>åˆ‡ç‰‡ä¸€èˆ¬åªå‡ºç°åœ¨æ•°æ®ç»“æ„çš„å®šä¹‰ä¸­ï¼Œä¸èƒ½ç›´æ¥è®¿é—®ï¼Œåœ¨ä½¿ç”¨ä¸­ä¸»è¦ç”¨ä»¥ä¸‹å½¢å¼ï¼š</p>
<ul>
<li>
<p>&amp;[T]ï¼šè¡¨ç¤ºä¸€ä¸ªåªè¯»çš„åˆ‡ç‰‡å¼•ç”¨ã€‚</p>
</li>
<li>
<p>&amp;mut [T]ï¼šè¡¨ç¤ºä¸€ä¸ªå¯å†™çš„åˆ‡ç‰‡å¼•ç”¨ã€‚</p>
</li>
<li>
<p>Box&lt;[T]&gt;ï¼šä¸€ä¸ªåœ¨å †ä¸Šåˆ†é…çš„åˆ‡ç‰‡ã€‚</p>
</li>
</ul>
</div>
</details>
<details id="admonition-åˆ‡ç‰‡ä¸æ•°æ®çš„å…³ç³»" class="admonition tip">
<summary class="admonition-title">
<p>åˆ‡ç‰‡ä¸æ•°æ®çš„å…³ç³»</p>
<p><a class="admonition-anchor-link" href="#admonition-åˆ‡ç‰‡ä¸æ•°æ®çš„å…³ç³»"></a></p>
</summary>
<div>
<h2 id="æ€ä¹ˆç†è§£åˆ‡ç‰‡å‘¢æˆ‘æ‰“ä¸ªæ¯”æ–¹åˆ‡ç‰‡ä¹‹äºå…·ä½“çš„æ•°æ®ç»“æ„å°±åƒæ•°æ®åº“ä¸­çš„è§†å›¾ä¹‹äºè¡¨-ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ç§å·¥å…·è®©æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€è®¿é—®è¡Œä¸ºç›¸åŒç»“æ„ç±»ä¼¼ä½†æœ‰äº›è®¸å·®å¼‚çš„ç±»-å‹"><a class="header" href="#æ€ä¹ˆç†è§£åˆ‡ç‰‡å‘¢æˆ‘æ‰“ä¸ªæ¯”æ–¹åˆ‡ç‰‡ä¹‹äºå…·ä½“çš„æ•°æ®ç»“æ„å°±åƒæ•°æ®åº“ä¸­çš„è§†å›¾ä¹‹äºè¡¨-ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ç§å·¥å…·è®©æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€è®¿é—®è¡Œä¸ºç›¸åŒç»“æ„ç±»ä¼¼ä½†æœ‰äº›è®¸å·®å¼‚çš„ç±»-å‹">æ€ä¹ˆç†è§£åˆ‡ç‰‡å‘¢ï¼Ÿæˆ‘æ‰“ä¸ªæ¯”æ–¹ï¼Œåˆ‡ç‰‡ä¹‹äºå…·ä½“çš„æ•°æ®ç»“æ„ï¼Œå°±åƒæ•°æ®åº“ä¸­çš„è§†å›¾ä¹‹äºè¡¨ã€‚ ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ç§å·¥å…·ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€è®¿é—®è¡Œä¸ºç›¸åŒã€ç»“æ„ç±»ä¼¼ä½†æœ‰äº›è®¸å·®å¼‚çš„ç±» å‹ã€‚</a></h2>
<pre><pre class="playground"><code class="language-rust  editable">fn main() {
    let arr = [1, 2, 3, 4, 5];
    let vec = vec![1, 2, 3, 4, 5];
    let s1 = &amp;arr[1..3];
    let s2 = &amp;vec[1..3];
    println!(&quot;s1: {:?}, s2: {:?}&quot;, s1, s2);

    // &amp;[T] å’Œ &amp;[T] æ˜¯å¦ç›¸ç­‰å–å†³äºé•¿åº¦å’Œå†…å®¹æ˜¯å¦ç›¸ç­‰
    assert_eq!(s1, s2);
    // &amp;[T] å¯ä»¥å’Œ Vec&lt;T&gt;/[T;n] æ¯”è¾ƒï¼Œä¹Ÿä¼šçœ‹é•¿åº¦å’Œå†…å®¹
    assert_eq!(&amp;arr[..], vec);
    assert_eq!(&amp;vec[..], arr);
}
</code></pre></pre>
<ol>
<li>å¯¹äº array å’Œ vectorï¼Œè™½ç„¶æ˜¯ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä¸€ä¸ªæ”¾åœ¨æ ˆä¸Šï¼Œä¸€ä¸ªæ”¾åœ¨å †ä¸Šï¼Œä½†å®ƒä»¬çš„ åˆ‡ç‰‡æ˜¯ç±»ä¼¼çš„ï¼›</li>
<li>è€Œä¸”å¯¹äºç›¸åŒå†…å®¹æ•°æ®çš„ç›¸åŒåˆ‡ç‰‡ï¼Œæ¯”å¦‚ &amp;arr[1â€¦3] å’Œ &amp;vec[1â€¦3]ï¼Œè¿™ ä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼Œåˆ‡ç‰‡å’Œå¯¹åº”çš„æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç›´æ¥æ¯”è¾ƒï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬ä¹‹é—´å® ç°äº† PartialEq trait
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/16%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9AVecT%E3%80%81%5BT%5D%E3%80%81Box%5BT%5D%20%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E4%B9%88%EF%BC%9F-4785008.jpg" alt="åˆ‡ç‰‡ä¸å…·ä½“æ•°æ®çš„å…³ç³»" /></li>
</ol>
</div>
</details>
<h3 id="array-vs-vector"><a class="header" href="#array-vs-vector">array vs vector</a></h3>
<details id="admonition-arrayå’Œvectorçš„åŒºåˆ«ä¸è”ç³»" class="admonition info">
<summary class="admonition-title">
<p>arrayå’Œvectorçš„åŒºåˆ«ä¸è”ç³»</p>
<p><a class="admonition-anchor-link" href="#admonition-arrayå’Œvectorçš„åŒºåˆ«ä¸è”ç³»"></a></p>
</summary>
<div>
<p>å¯¹äº array å’Œ vectorï¼Œè™½ç„¶æ˜¯ä¸åŒçš„æ•°æ®ç»“æ„ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ”¾åœ¨æ ˆä¸Š</li>
<li>ä¸€ä¸ªæ”¾åœ¨å †ä¸Š</li>
</ul>
<blockquote>
<p>ä½†å®ƒä»¬çš„åˆ‡ç‰‡æ˜¯ç±»ä¼¼çš„, è€Œä¸”å¯¹äºç›¸åŒå†…å®¹æ•°æ®çš„ç›¸åŒåˆ‡ç‰‡</p>
</blockquote>
<ul>
<li>æ¯”å¦‚ &amp;arr[1â€¦3] å’Œ &amp;vec[1â€¦3]ï¼Œè¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼Œåˆ‡ç‰‡å’Œå¯¹åº”çš„æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç›´æ¥æ¯”è¾ƒï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬ä¹‹é—´å®ç°äº† PartialEq traitï¼ˆæºç å‚è€ƒèµ„æ–™ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>ä¸‹å›¾æ¯”è¾ƒæ¸…æ™°åœ°å‘ˆç°äº†åˆ‡ç‰‡å’Œæ•°æ®ä¹‹é—´çš„å…³ç³»ï¼š
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/16%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9AVecT%E3%80%81%5BT%5D%E3%80%81Box%5BT%5D%20%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E4%B9%88%EF%BC%9F-4866674.jpg" alt="åˆ‡ç‰‡å’Œæ•°æ®ä¹‹é—´çš„å…³ç³»" /></p>
</blockquote>
</div>
</details>
<h3 id="vec-å’Œ-t"><a class="header" href="#vec-å’Œ-t">Vec<T> å’Œ &amp;[T]</a></h3>
<details id="admonition-tä¸vectå…³ç³»" class="admonition tip">
<summary class="admonition-title">
<p>&amp;[T]ä¸&amp;Vec[T]å…³ç³»</p>
<p><a class="admonition-anchor-link" href="#admonition-tä¸vectå…³ç³»"></a></p>
</summary>
<div>
<p>![&amp;[T]å’Œ&amp;Vec[T]](https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/16%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9AVecT%E3%80%81%5BT%5D%E3%80%81Box%5BT%5D%20%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E4%B9%88%EF%BC%9F-4785147.jpg)</p>
</div>
</details>
<h3 id="è§£å¼•ç”¨"><a class="header" href="#è§£å¼•ç”¨">è§£å¼•ç”¨</a></h3>
<details id="admonition-æ”¯æŒåˆ‡ç‰‡çš„å…·ä½“æ•°æ®ç±»å‹å¯ä»¥æ ¹æ®éœ€è¦è§£å¼•ç”¨è½¬æ¢æˆåˆ‡ç‰‡ç±»å‹" class="admonition info">
<summary class="admonition-title">
<p>æ”¯æŒåˆ‡ç‰‡çš„å…·ä½“æ•°æ®ç±»å‹å¯ä»¥æ ¹æ®éœ€è¦è§£å¼•ç”¨è½¬æ¢æˆåˆ‡ç‰‡ç±»å‹</p>
<p><a class="admonition-anchor-link" href="#admonition-æ”¯æŒåˆ‡ç‰‡çš„å…·ä½“æ•°æ®ç±»å‹å¯ä»¥æ ¹æ®éœ€è¦è§£å¼•ç”¨è½¬æ¢æˆåˆ‡ç‰‡ç±»å‹"></a></p>
</summary>
<div>
<p>åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæ”¯æŒåˆ‡ç‰‡çš„å…·ä½“æ•°æ®ç±»å‹ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè§£å¼•ç”¨è½¬æ¢æˆåˆ‡ç‰‡ç±»å‹ã€‚</p>
<ul>
<li>æ¯”å¦‚ Vec<T> å’Œ [T; n] ä¼šè½¬åŒ–æˆä¸º &amp;[T]ï¼Œè¿™æ˜¯å› ä¸º Vec<T> å®ç°äº† Deref traitï¼Œè€Œ array å†…å»ºäº†åˆ° &amp;[T] çš„è§£å¼•ç”¨ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥å†™ä¸€æ®µä»£ç éªŒè¯è¿™ä¸€è¡Œä¸ºï¼ˆä»£ç ï¼‰ï¼š</li>
</ul>
<hr />
<pre><pre class="playground"><code class="language-rust  editable">
use std::fmt;
fn main() {
    let v = vec![1, 2, 3, 4];

    // Vec å®ç°äº† Derefï¼Œ&amp;Vec&lt;T&gt; ä¼šè¢«è‡ªåŠ¨è§£å¼•ç”¨ä¸º &amp;[T]ï¼Œç¬¦åˆæ¥å£å®šä¹‰
    print_slice(&amp;v);
    // ç›´æ¥æ˜¯ &amp;[T]ï¼Œç¬¦åˆæ¥å£å®šä¹‰
    print_slice(&amp;v[..]);

    // &amp;Vec&lt;T&gt; æ”¯æŒ AsRef&lt;[T]&gt;
    print_slice1(&amp;v);
    // &amp;[T] æ”¯æŒ AsRef&lt;[T]&gt;
    print_slice1(&amp;v[..]);
    // Vec&lt;T&gt; ä¹Ÿæ”¯æŒ AsRef&lt;[T]&gt;
    print_slice1(v);

    let arr = [1, 2, 3, 4];
    // æ•°ç»„è™½æ²¡æœ‰å®ç° Derefï¼Œä½†å®ƒçš„è§£å¼•ç”¨å°±æ˜¯ &amp;[T]
    print_slice(&amp;arr);
    print_slice(&amp;arr[..]);
    print_slice1(&amp;arr);
    print_slice1(&amp;arr[..]);
    print_slice1(arr);
}

// æ³¨æ„ä¸‹é¢çš„æ³›å‹å‡½æ•°çš„ä½¿ç”¨
fn print_slice&lt;T: fmt::Debug&gt;(s: &amp;[T]) {
    println!(&quot;{:?}&quot;, s);
}

fn print_slice1&lt;T, U&gt;(s: T)
where
    T: AsRef&lt;[U]&gt;,
    U: fmt::Debug,
{
    println!(&quot;{:?}&quot;, s.as_ref());
}
</code></pre></pre>
<hr />
<blockquote>
<p>è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œé€šè¿‡è§£å¼•ç”¨ï¼Œè¿™å‡ ä¸ªå’Œåˆ‡ç‰‡æœ‰å…³çš„æ•°æ®ç»“æ„éƒ½ä¼šè·å¾—åˆ‡ç‰‡çš„æ‰€æœ‰èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼šbinary_searchã€chunksã€concatã€containsã€start_withã€end_withã€group_byã€iterã€joinã€sortã€splitã€swap ç­‰ä¸€ç³»åˆ—ä¸°å¯Œçš„åŠŸèƒ½ï¼Œ</p>
</blockquote>
</div>
</details>
<h3 id="åˆ‡ç‰‡å’Œè¿­ä»£å™¨-iterator"><a class="header" href="#åˆ‡ç‰‡å’Œè¿­ä»£å™¨-iterator">åˆ‡ç‰‡å’Œè¿­ä»£å™¨ Iterator</a></h3>
<details id="admonition-è¿­ä»£å™¨å¯ä»¥è¯´æ˜¯åˆ‡ç‰‡çš„å­ªç”Ÿå…„å¼Ÿ" class="admonition info">
<summary class="admonition-title">
<p>è¿­ä»£å™¨å¯ä»¥è¯´æ˜¯åˆ‡ç‰‡çš„å­ªç”Ÿå…„å¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-è¿­ä»£å™¨å¯ä»¥è¯´æ˜¯åˆ‡ç‰‡çš„å­ªç”Ÿå…„å¼Ÿ"></a></p>
</summary>
<div>
<p>è¿­ä»£å™¨å¯ä»¥è¯´æ˜¯åˆ‡ç‰‡çš„å­ªç”Ÿå…„å¼Ÿã€‚åˆ‡ç‰‡æ˜¯é›†åˆæ•°æ®çš„è§†å›¾ï¼Œè€Œè¿­ä»£å™¨å®šä¹‰äº†å¯¹é›†åˆæ•°æ®çš„å„ç§å„æ ·çš„è®¿é—®æ“ä½œã€‚</p>
<p>Iterator trait æœ‰å¤§é‡çš„æ–¹æ³•ï¼Œä½†ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªéœ€è¦å®šä¹‰å®ƒçš„å…³è”ç±»å‹ Item å’Œ next() æ–¹æ³•ã€‚</p>
<ul>
<li>Item å®šä¹‰äº†æ¯æ¬¡æˆ‘ä»¬ä»è¿­ä»£å™¨ä¸­å–å‡ºçš„æ•°æ®ç±»å‹ï¼›</li>
<li>next() æ˜¯ä»è¿­ä»£å™¨é‡Œå–ä¸‹ä¸€ä¸ªå€¼çš„æ–¹æ³•ã€‚å½“ä¸€ä¸ªè¿­ä»£å™¨çš„ next() æ–¹æ³•è¿”å› None æ—¶ï¼Œè¡¨æ˜è¿­ä»£å™¨ä¸­æ²¡æœ‰æ•°æ®äº†ã€‚</li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span>
<span class="boring">fn main() {
</span>#[must_use = &quot;iterators are lazy and do nothing unless consumed&quot;]
pub trait Iterator {
    type Item;
    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;
    // å¤§é‡ç¼ºçœçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ size_hint, count, chain, zip, map, 
    // filter, for_each, skip, take_while, flat_map, flatten
    // collect, partition ç­‰
    ... 
}
<span class="boring">}
</span></code></pre></pre>
</div>
</details>
<details id="admonition-å¯¹-vec-ä½¿ç”¨-iter-æ–¹æ³•å¹¶è¿›è¡Œå„ç§-map--filter--take-æ“ä½œ" class="admonition info">
<summary class="admonition-title">
<p>å¯¹ Vec<T> ä½¿ç”¨ iter() æ–¹æ³•ï¼Œå¹¶è¿›è¡Œå„ç§ map / filter / take æ“ä½œ</p>
<p><a class="admonition-anchor-link" href="#admonition-å¯¹-vec-ä½¿ç”¨-iter-æ–¹æ³•å¹¶è¿›è¡Œå„ç§-map--filter--take-æ“ä½œ"></a></p>
</summary>
<div>
<p>ä¸€ä¸ªä¾‹å­ï¼šå¯¹ Vec<T> ä½¿ç”¨ iter() æ–¹æ³•ï¼Œå¹¶è¿›è¡Œå„ç§ map / filter / take æ“ä½œã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè¿™æ ·çš„å†™æ³•å¾ˆå¸¸è§ï¼Œä»£ç çš„å¯è¯»æ€§å¾ˆå¼ºã€‚Rust ä¹Ÿæ”¯æŒè¿™ç§å†™æ³•ï¼ˆä»£ç ï¼‰ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
fn main() {
    // è¿™é‡Œ Vec&lt;T&gt; åœ¨è°ƒç”¨ iter() æ—¶è¢«è§£å¼•ç”¨æˆ &amp;[T]ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—® iter()
    let result = vec![1, 2, 3, 4]
        .iter()
        .map(|v| v * v)
        .filter(|v| *v &lt; 16)
        .take(1)
        .collect::&lt;Vec&lt;_&gt;&gt;();

    println!(&quot;{:?}&quot;, result);
}
</code></pre></pre>
</div>
</details>
<details id="admonition-rustçš„è¿­ä»£å™¨æ˜¯ä¸ªæ‡’æ¥å£è¿™æ˜¯å¦‚ä½•å®ç°çš„" class="admonition info">
<summary class="admonition-title">
<p>Rustçš„è¿­ä»£å™¨æ˜¯ä¸ªæ‡’æ¥å£ï¼Œè¿™æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-rustçš„è¿­ä»£å™¨æ˜¯ä¸ªæ‡’æ¥å£è¿™æ˜¯å¦‚ä½•å®ç°çš„"></a></p>
</summary>
<div>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ Rust ä¸‹çš„è¿­ä»£å™¨æ˜¯ä¸ªæ‡’æ¥å£ï¼ˆlazy interfaceï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ®µä»£ç ç›´åˆ°è¿è¡Œåˆ° collect æ—¶æ‰çœŸæ­£å¼€å§‹æ‰§è¡Œï¼Œä¹‹å‰çš„éƒ¨åˆ†ä¸è¿‡æ˜¯åœ¨ä¸æ–­åœ°ç”Ÿæˆæ–°çš„ç»“æ„ï¼Œæ¥ç´¯ç§¯å¤„ç†é€»è¾‘è€Œå·²ã€‚ä½ å¯èƒ½å¥½å¥‡ï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p>
<p>åŸæ¥ï¼ŒIterator å¤§éƒ¨åˆ†æ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªå®ç°äº† Iterator çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·ä¸€è·¯é“¾å¼ä¸‹å»ï¼Œåœ¨ Rust æ ‡å‡†åº“ä¸­ï¼Œè¿™äº›æ•°æ®ç»“æ„è¢«ç§°ä¸º <a href="https://doc.rust-lang.org/src/core/iter/adapters/mod.rs.html">Iterator Adapter</a>ã€‚æ¯”å¦‚ä¸Šé¢çš„ map æ–¹æ³•ï¼Œå®ƒè¿”å› Map ç»“æ„ï¼Œè€Œ Map ç»“æ„å®ç°äº† <a href="https://doc.rust-lang.org/src/core/iter/adapters/map.rs.html#93-133">Iteratorï¼ˆæºç ï¼‰</a>ã€‚
æ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼ˆé“¾æ¥å‡ä¸ºæºç èµ„æ–™ï¼‰ï¼š</p>
<ol>
<li>åœ¨ collect() æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒ<a href="https://doc.rust-lang.org/src/core/iter/traits/iterator.rs.html#1744-1749">å®é™…è¯•å›¾ä½¿ç”¨ FromIterator ä»è¿­ä»£å™¨ä¸­æ„å»ºä¸€ä¸ªé›†åˆç±»å‹</a>ï¼Œè¿™ä¼šä¸æ–­è°ƒç”¨ next() è·å–ä¸‹ä¸€ä¸ªæ•°æ®ï¼›</li>
<li>æ­¤æ—¶çš„ Iterator æ˜¯ Takeï¼ŒTake è°ƒè‡ªå·±çš„ next()ï¼Œä¹Ÿå°±æ˜¯å®ƒä¼š<a href="https://doc.rust-lang.org/src/core/iter/adapters/take.rs.html#34-41">è°ƒç”¨ Filter çš„ next()</a>ï¼›</li>
<li>Filter çš„ next() å®é™…ä¸Š<a href="https://time.geekbang.org/column/article/422975">è°ƒç”¨è‡ªå·±å†…éƒ¨çš„ iter çš„ find()</a>ï¼Œæ­¤æ—¶å†…éƒ¨çš„ iter æ˜¯ Mapï¼Œfind() ä¼šä½¿ç”¨ <a href="https://doc.rust-lang.org/src/core/iter/traits/iterator.rs.html#2312-2325">try_fold()</a>ï¼Œå®ƒä¼š<a href="https://doc.rust-lang.org/src/core/iter/traits/iterator.rs.html#2382-2406">ç»§ç»­è°ƒç”¨ next()</a>ï¼Œä¹Ÿå°±æ˜¯ Map çš„ next()ï¼›</li>
<li>Map çš„ next() ä¼š<a href="https://time.geekbang.org/column/article/422975">è°ƒç”¨å…¶å†…éƒ¨çš„ iter å– next() ç„¶åæ‰§è¡Œ map å‡½æ•°</a>ã€‚è€Œæ­¤æ—¶å†…éƒ¨çš„ iter æ¥è‡ª Vec<i32>ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œåªæœ‰åœ¨ collect() æ—¶ï¼Œæ‰è§¦å‘ä»£ç ä¸€å±‚å±‚è°ƒç”¨ä¸‹å»ï¼Œå¹¶ä¸”è°ƒç”¨ä¼šæ ¹æ®éœ€è¦éšæ—¶ç»“æŸã€‚è¿™æ®µä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº† take(1)ï¼Œæ•´ä¸ªè°ƒç”¨é“¾å¾ªç¯ä¸€æ¬¡ï¼Œå°±èƒ½æ»¡è¶³ take(1) ä»¥åŠæ‰€æœ‰ä¸­é—´è¿‡ç¨‹çš„è¦æ±‚ï¼Œæ‰€ä»¥å®ƒåªä¼šå¾ªç¯ä¸€æ¬¡ã€‚</p>
</div>
</details>
<details id="admonition-rustçš„å‡½æ•°å¼ç¼–ç¨‹å†™æ³•æ€§èƒ½å¦‚ä½•" class="admonition info">
<summary class="admonition-title">
<p>Rustçš„å‡½æ•°å¼ç¼–ç¨‹å†™æ³•æ€§èƒ½å¦‚ä½•ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-rustçš„å‡½æ•°å¼ç¼–ç¨‹å†™æ³•æ€§èƒ½å¦‚ä½•"></a></p>
</summary>
<div>
<p>ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼šè¿™ç§å‡½æ•°å¼ç¼–ç¨‹çš„å†™æ³•ï¼Œä»£ç æ˜¯æ¼‚äº®äº†ï¼Œç„¶è€Œè¿™ä¹ˆå¤šæ— è°“çš„å‡½æ•°è°ƒç”¨ï¼Œæ€§èƒ½è‚¯å®šå¾ˆå·®å§ï¼Ÿæ¯•ç«Ÿï¼Œå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„ä¸€å¤§æ¶åå°±æ˜¯æ€§èƒ½å·®ã€‚</p>
<p>è¿™ä¸ªä½ å®Œå…¨ä¸ç”¨æ‹…å¿ƒï¼Œ Rust å¤§é‡ä½¿ç”¨äº† inline ç­‰ä¼˜åŒ–æŠ€å·§ï¼Œè¿™æ ·éå¸¸æ¸…æ™°å‹å¥½çš„è¡¨è¾¾æ–¹å¼ï¼Œæ€§èƒ½å’Œ C è¯­è¨€çš„ for å¾ªç¯å·®åˆ«ä¸å¤§ã€‚</p>
</div>
</details>
<details id="admonition-rustçš„iteratoré™¤äº†æ ‡å‡†åº“è¿˜æœ‰itertoolsæä¾›æ›´å¤šåŠŸèƒ½" class="admonition info">
<summary class="admonition-title">
<p>Rustçš„iteratoré™¤äº†æ ‡å‡†åº“ï¼Œè¿˜æœ‰itertoolsæä¾›æ›´å¤šåŠŸèƒ½</p>
<p><a class="admonition-anchor-link" href="#admonition-rustçš„iteratoré™¤äº†æ ‡å‡†åº“è¿˜æœ‰itertoolsæä¾›æ›´å¤šåŠŸèƒ½"></a></p>
</summary>
<div>
<p>å¦‚æœæ ‡å‡†åº“ä¸­çš„åŠŸèƒ½è¿˜ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥çœ‹çœ‹ itertoolsï¼Œå®ƒæ˜¯å’Œ Python ä¸‹ itertools åŒåä¸”åŠŸèƒ½ç±»ä¼¼çš„å·¥å…·ï¼Œæä¾›äº†å¤§é‡é¢å¤–çš„ adapterã€‚å¯ä»¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ˆä»£ç ï¼‰ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use itertools::Itertools;

fn main() {
    let err_str = &quot;bad happened&quot;;
    let input = vec![Ok(21), Err(err_str), Ok(7)];
    let it = input
        .into_iter()
        .filter_map_ok(|i| if i &gt; 10 { Some(i * 2) } else { None });
    // ç»“æœåº”è¯¥æ˜¯ï¼švec![Ok(42), Err(err_str)]
    println!(&quot;{:?}&quot;, it.collect::&lt;Vec&lt;_&gt;&gt;());
}
</code></pre></pre>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä»ä¸€ç»„ Future ä¸­æ±‡èšå‡ºä¸€ç»„ç»“æœï¼Œé‡Œé¢æœ‰æˆåŠŸæ‰§è¡Œçš„ç»“æœï¼Œä¹Ÿæœ‰å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœæƒ³å¯¹æˆåŠŸçš„ç»“æœè¿›ä¸€æ­¥åš filter/mapï¼Œé‚£ä¹ˆæ ‡å‡†åº“å°±æ— æ³•å¸®å¿™äº†ï¼Œå°±éœ€è¦ç”¨ itertools é‡Œçš„ filter_map_ok()ã€‚</p>
</div>
</details>
<h3 id="ç‰¹æ®Šçš„åˆ‡ç‰‡str"><a class="header" href="#ç‰¹æ®Šçš„åˆ‡ç‰‡str">ç‰¹æ®Šçš„åˆ‡ç‰‡ï¼š&amp;str</a></h3>
<details id="admonition-stringstringå’Œstrçš„åŒºåˆ«ä¸è”ç³»" class="admonition info">
<summary class="admonition-title">
<p>Stringã€&amp;Stringå’Œ&amp;strçš„åŒºåˆ«ä¸è”ç³»</p>
<p><a class="admonition-anchor-link" href="#admonition-stringstringå’Œstrçš„åŒºåˆ«ä¸è”ç³»"></a></p>
</summary>
<div>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ç§ç‰¹æ®Šçš„åˆ‡ç‰‡ï¼š&amp;strã€‚ä¹‹å‰è®²è¿‡ï¼ŒString æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Vec<u8>ï¼Œæ‰€ä»¥åœ¨ String ä¸Šåšåˆ‡ç‰‡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ &amp;strã€‚</p>
<p>å¯¹äº Stringã€&amp;Stringã€&amp;strï¼Œå¾ˆå¤šäººä¹Ÿç»å¸¸åˆ†ä¸æ¸…å®ƒä»¬çš„åŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„ä¸€ç¯‡åŠ é¤ä¸­ç®€å•èŠäº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ä¸Šä¸€è®²æ™ºèƒ½æŒ‡é’ˆä¸­ï¼Œä¹Ÿå¯¹æ¯”è¿‡ String å’Œ &amp;strã€‚å¯¹äº &amp;String å’Œ &amp;strï¼Œå¦‚æœä½ ç†è§£äº†ä¸Šæ–‡ä¸­ &amp;Vec<T> å’Œ &amp;[T] çš„åŒºåˆ«ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/16%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9AVecT%E3%80%81%5BT%5D%E3%80%81Box%5BT%5D%20%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E4%B9%88%EF%BC%9F-4867212.jpg" alt="&amp;Stringå’Œ&amp;str" /></p>
</div>
</details>
<details id="admonition-stringåœ¨è§£å¼•ç”¨æ—¶ä¼šè½¬æ¢æˆstr" class="admonition info">
<summary class="admonition-title">
<p>Stringåœ¨è§£å¼•ç”¨æ—¶ä¼šè½¬æ¢æˆ&amp;str</p>
<p><a class="admonition-anchor-link" href="#admonition-stringåœ¨è§£å¼•ç”¨æ—¶ä¼šè½¬æ¢æˆstr"></a></p>
</summary>
<div>
<p>String åœ¨è§£å¼•ç”¨æ—¶ï¼Œä¼šè½¬æ¢æˆ &amp;strã€‚å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç éªŒè¯ï¼ˆä»£ç ï¼‰ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use std::fmt;
fn main() {
    let s = String::from(&quot;hello&quot;);
    // &amp;String ä¼šè¢«è§£å¼•ç”¨æˆ &amp;str
    print_slice(&amp;s);
    // &amp;s[..] å’Œ s.as_str() ä¸€æ ·ï¼Œéƒ½ä¼šå¾—åˆ° &amp;str
    print_slice(&amp;s[..]);

    // String æ”¯æŒ AsRef&lt;str&gt;
    print_slice1(&amp;s);
    print_slice1(&amp;s[..]);
    print_slice1(s.clone());

    // String ä¹Ÿå®ç°äº† AsRef&lt;[u8]&gt;ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç æˆç«‹
    // æ‰“å°å‡ºæ¥æ˜¯ [104, 101, 108, 108, 111]
    print_slice2(&amp;s);
    print_slice2(&amp;s[..]);
    print_slice2(s);
}

fn print_slice(s: &amp;str) {
    println!(&quot;{:?}&quot;, s);
}

fn print_slice1&lt;T: AsRef&lt;str&gt;&gt;(s: T) {
    println!(&quot;{:?}&quot;, s.as_ref());
}

fn print_slice2&lt;T, U&gt;(s: T)
where
    T: AsRef&lt;[U]&gt;,
    U: fmt::Debug,
{
    println!(&quot;{:?}&quot;, s.as_ref());
}
</code></pre></pre>
</div>
</details>
<details id="admonition-å­—ç¬¦çš„åˆ—è¡¨å’Œå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«" class="admonition info">
<summary class="admonition-title">
<p>å­—ç¬¦çš„åˆ—è¡¨å’Œå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«</p>
<p><a class="admonition-anchor-link" href="#admonition-å­—ç¬¦çš„åˆ—è¡¨å’Œå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«"></a></p>
</summary>
<div>
<p>é‚£ä¹ˆå­—ç¬¦çš„åˆ—è¡¨å’Œå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«ï¼Ÿæˆ‘ä»¬ç›´æ¥å†™ä¸€æ®µä»£ç æ¥çœ‹çœ‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use std::iter::FromIterator;

fn main() {
    let arr = ['h', 'e', 'l', 'l', 'o'];
    let vec = vec!['h', 'e', 'l', 'l', 'o'];
    let s = String::from(&quot;hello&quot;);
    let s1 = &amp;arr[1..3];
    let s2 = &amp;vec[1..3];
    // &amp;str æœ¬èº«å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ slice
    let s3 = &amp;s[1..3];
    println!(&quot;s1: {:?}, s2: {:?}, s3: {:?}&quot;, s1, s2, s3);

    // &amp;[char] å’Œ &amp;[char] æ˜¯å¦ç›¸ç­‰å–å†³äºé•¿åº¦å’Œå†…å®¹æ˜¯å¦ç›¸ç­‰
    assert_eq!(s1, s2);
    // &amp;[char] å’Œ &amp;str ä¸èƒ½ç›´æ¥å¯¹æ¯”ï¼Œæˆ‘ä»¬æŠŠ s3 å˜æˆ Vec&lt;char&gt;
    assert_eq!(s2, s3.chars().collect::&lt;Vec&lt;_&gt;&gt;());
    // &amp;[char] å¯ä»¥é€šè¿‡è¿­ä»£å™¨è½¬æ¢æˆ Stringï¼ŒString å’Œ &amp;str å¯ä»¥ç›´æ¥å¯¹æ¯”
    assert_eq!(String::from_iter(s2), s3);
}
</code></pre></pre>
<hr />
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå­—ç¬¦åˆ—è¡¨å¯ä»¥é€šè¿‡è¿­ä»£å™¨è½¬æ¢æˆ Stringï¼ŒString ä¹Ÿå¯ä»¥é€šè¿‡ chars() å‡½æ•°è½¬æ¢æˆå­—ç¬¦åˆ—è¡¨ï¼Œå¦‚æœä¸è½¬æ¢ï¼ŒäºŒè€…ä¸èƒ½æ¯”è¾ƒã€‚</p>
</blockquote>
<hr />
<p>ä¸‹å›¾æŠŠæ•°ç»„ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ä»¥åŠå®ƒä»¬çš„åˆ‡ç‰‡æ”¾åœ¨ä¸€èµ·æ¯”è¾ƒï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£å®ƒä»¬çš„åŒºåˆ«ï¼š
<img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/16%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9AVecT%E3%80%81%5BT%5D%E3%80%81Box%5BT%5D%20%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E4%B9%88%EF%BC%9F-4867332.jpg" alt="æ•°ç»„ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²å’Œå„è‡ªçš„åˆ‡ç‰‡" /></p>
</div>
</details>
<h3 id="boxt"><a class="header" href="#boxt">Box&lt;[T]&gt;</a></h3>
<details id="admonition-boxå’Œvectå¯¹æ¯”" class="admonition info">
<summary class="admonition-title">
<p>Box&lt;[T]&gt;å’ŒVec<T>&amp;[T]å¯¹æ¯”</p>
<p><a class="admonition-anchor-link" href="#admonition-boxå’Œvectå¯¹æ¯”"></a></p>
</summary>
<div>
<p>åˆ‡ç‰‡ä¸»è¦æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>åˆ‡ç‰‡çš„åªè¯»å¼•ç”¨ &amp;[T]</li>
<li>åˆ‡ç‰‡çš„å¯å˜å¼•ç”¨ &amp;mut [T]: å’Œ&amp;[T]ç±»ä¼¼</li>
<li>Box&lt;[T]&gt;</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ Box&lt;[T]&gt;ã€‚</p>
<p>Box&lt;[T]&gt; æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å­˜åœ¨ï¼Œå®ƒå’Œ Vec<T> æœ‰ä¸€ç‚¹ç‚¹å·®åˆ«ï¼š</p>
<ul>
<li>Vec<T> æœ‰é¢å¤–çš„ capacityï¼Œå¯ä»¥å¢é•¿ï¼›</li>
<li>è€Œ Box&lt;[T]&gt; ä¸€æ—¦ç”Ÿæˆå°±å›ºå®šä¸‹æ¥ï¼Œæ²¡æœ‰ capacityï¼Œä¹Ÿæ— æ³•å¢é•¿ã€‚</li>
</ul>
<p>Box&lt;[T]&gt; å’Œåˆ‡ç‰‡çš„å¼•ç”¨ &amp;[T] ä¹Ÿå¾ˆç±»ä¼¼ï¼š</p>
<ol>
<li>å®ƒä»¬éƒ½æ˜¯åœ¨æ ˆä¸Šæœ‰ä¸€ä¸ªåŒ…å«é•¿åº¦çš„èƒ–æŒ‡é’ˆï¼ŒæŒ‡å‘å­˜å‚¨æ•°æ®çš„å†…å­˜ä½ç½®ã€‚</li>
<li>åŒºåˆ«æ˜¯ï¼šBox&lt;[T]&gt; åªä¼šæŒ‡å‘å †ï¼Œ&amp;[T] æŒ‡å‘çš„ä½ç½®å¯ä»¥æ˜¯æ ˆä¹Ÿå¯ä»¥æ˜¯å †ï¼›</li>
<li>æ­¤å¤–ï¼ŒBox&lt;[T]&gt; å¯¹æ•°æ®å…·æœ‰æ‰€æœ‰æƒï¼Œè€Œ &amp;[T] åªæ˜¯ä¸€ä¸ªå€Ÿç”¨ã€‚</li>
</ol>
<hr />
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/16%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9AVecT%E3%80%81%5BT%5D%E3%80%81Box%5BT%5D%20%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E4%B9%88%EF%BC%9F-4867436.jpg" alt="" /></p>
</div>
</details>
<details id="admonition-é‚£ä¹ˆå¦‚ä½•äº§ç”Ÿ-box-å‘¢" class="admonition info">
<summary class="admonition-title">
<p>é‚£ä¹ˆå¦‚ä½•äº§ç”Ÿ Box&lt;[T]&gt; å‘¢ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-é‚£ä¹ˆå¦‚ä½•äº§ç”Ÿ-box-å‘¢"></a></p>
</summary>
<div>
<p>é‚£ä¹ˆå¦‚ä½•äº§ç”Ÿ Box&lt;[T]&gt; å‘¢ï¼Ÿ
ç›®å‰å¯ç”¨çš„æ¥å£å°±åªæœ‰ä¸€ä¸ªï¼šä»å·²æœ‰çš„ Vec<T> ä¸­è½¬æ¢ã€‚æˆ‘ä»¬çœ‹ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use std::ops::Deref;

fn main() {
    let mut v1 = vec![1, 2, 3, 4];
    v1.push(5);
    println!(&quot;cap should be 8: {}&quot;, v1.capacity());

    // ä» Vec&lt;T&gt; è½¬æ¢æˆ Box&lt;[T]&gt;ï¼Œæ­¤æ—¶ä¼šä¸¢å¼ƒå¤šä½™çš„ capacity
    let b1 = v1.into_boxed_slice();
    let mut b2 = b1.clone();

    let v2 = b1.into_vec();
    println!(&quot;cap should be exactly 5: {}&quot;, v2.capacity());

    assert!(b2.deref() == v2);

    // Box&lt;[T]&gt; å¯ä»¥æ›´æ”¹å…¶å†…éƒ¨æ•°æ®ï¼Œä½†æ— æ³• push
    b2[0] = 2;
    // b2.push(6);
    println!(&quot;b2: {:?}&quot;, b2);

    // æ³¨æ„ Box&lt;[T]&gt; å’Œ Box&lt;[T; n]&gt; å¹¶ä¸ç›¸åŒ
    let b3 = Box::new([2, 2, 3, 4, 5]);
    println!(&quot;b3: {:?}&quot;, b3);

    // b2 å’Œ b3 ç›¸ç­‰ï¼Œä½† b3.deref() å’Œ v2 æ— æ³•æ¯”è¾ƒ
    assert!(b2 == b3);
    // assert!(b3.deref() == v2);
}
</code></pre></pre>
<hr />
<p>è¿è¡Œä»£ç å¯ä»¥çœ‹åˆ°:</p>
<ol>
<li>Vec<T> å¯ä»¥é€šè¿‡ into_boxed_slice() è½¬æ¢æˆ Box&lt;[T]&gt;</li>
<li>Box&lt;[T]&gt; ä¹Ÿå¯ä»¥é€šè¿‡ into_vec() è½¬æ¢å› Vec<T>ã€‚</li>
</ol>
<p>è¿™ä¸¤ä¸ªè½¬æ¢éƒ½æ˜¯å¾ˆè½»é‡çš„è½¬æ¢ï¼Œåªæ˜¯å˜æ¢ä¸€ä¸‹ç»“æ„ï¼Œä¸æ¶‰åŠæ•°æ®çš„æ‹·è´ã€‚</p>
<p>åŒºåˆ«æ˜¯:</p>
<ol>
<li>å½“ Vec<T> è½¬æ¢æˆ Box&lt;[T]&gt; æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„å®¹é‡å°±ä¼šè¢«ä¸¢å¼ƒï¼Œæ‰€ä»¥æ•´ä½“å ç”¨çš„å†…å­˜å¯èƒ½ä¼šé™ä½ã€‚</li>
<li>è€Œä¸” Box&lt;[T]&gt; æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§æ˜¯ï¼Œä¸åƒ Box&lt;[T;n]&gt; é‚£æ ·åœ¨ç¼–è¯‘æ—¶å°±è¦ç¡®å®šå¤§å°ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸç”Ÿæˆï¼Œä»¥åå¤§å°ä¸ä¼šå†æ”¹å˜ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨å †ä¸Šåˆ›å»ºå›ºå®šå¤§å°çš„é›†åˆæ•°æ®ï¼Œä¸”ä¸å¸Œæœ›è‡ªåŠ¨å¢é•¿ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥å…ˆåˆ›å»º Vec<T>ï¼Œå†è½¬æ¢æˆ Box&lt;[T]&gt;ã€‚</p>
<blockquote>
<p>tokio åœ¨æä¾› broadcast channel æ—¶ï¼Œå°±ä½¿ç”¨äº† Box&lt;[T]&gt; è¿™ä¸ªç‰¹æ€§ï¼Œä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è‡ªå·±çœ‹çœ‹<a href="https://github.com/tokio-rs/tokio/blob/master/tokio/src/sync/broadcast.rs#L447">æºç </a>ã€‚</p>
</blockquote>
</div>
</details>
<h3 id="å¸¸ç”¨åˆ‡ç‰‡å¯¹æ¯”å›¾"><a class="header" href="#å¸¸ç”¨åˆ‡ç‰‡å¯¹æ¯”å›¾">å¸¸ç”¨åˆ‡ç‰‡å¯¹æ¯”å›¾</a></h3>
<div id="admonition-strtnvectmuttçš„åŒºåˆ«ä¸è”ç³»å›¾" class="admonition info">
<div class="admonition-title">
<p>&amp;strã€[T;n]ã€Vec<T>ã€&amp;[T]ã€&amp;mut[T]çš„åŒºåˆ«ä¸è”ç³»å›¾ </p>
<p><a class="admonition-anchor-link" href="#admonition-strtnvectmuttçš„åŒºåˆ«ä¸è”ç³»å›¾"></a></p>
</div>
<div>
<p>ä¸‹å›¾æè¿°äº†åˆ‡ç‰‡å’Œæ•°ç»„ [T;n]ã€åˆ—è¡¨ Vec<T>ã€åˆ‡ç‰‡å¼•ç”¨ &amp;[T] /&amp;mut [T]ï¼Œä»¥åŠåœ¨å †ä¸Šåˆ†é…çš„åˆ‡ç‰‡ Box&lt;[T]&gt; ä¹‹é—´çš„å…³ç³»ã€‚</p>
<blockquote>
<p>å»ºè®®èŠ±äº›æ—¶é—´ç†è§£è¿™å¼ å›¾ï¼Œä¹Ÿå¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼å»æ€»ç»“å­¦åˆ°çš„å…¶ä»–æœ‰å…³è”çš„æ•°æ®ç»“æ„ã€‚</p>
</blockquote>
<hr />
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/16%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9AVecT%E3%80%81%5BT%5D%E3%80%81Box%5BT%5D%20%EF%BC%8C%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%9B%86%E5%90%88%E5%AE%B9%E5%99%A8%E4%B9%88%EF%BC%9F-4867546.jpg" alt="" /></p>
</div>
</div>
<h2 id="å“ˆå¸Œè¡¨"><a class="header" href="#å“ˆå¸Œè¡¨">å“ˆå¸Œè¡¨</a></h2>
<h3 id="å“ˆå¸Œè¡¨è¿˜æ˜¯åˆ—è¡¨"><a class="header" href="#å“ˆå¸Œè¡¨è¿˜æ˜¯åˆ—è¡¨">å“ˆå¸Œè¡¨è¿˜æ˜¯åˆ—è¡¨</a></h3>
<details id="admonition-å“ˆå¸Œè¡¨å’Œåˆ—è¡¨çš„é€‰æ‹©" class="admonition info">
<summary class="admonition-title">
<p>å“ˆå¸Œè¡¨å’Œåˆ—è¡¨çš„é€‰æ‹©</p>
<p><a class="admonition-anchor-link" href="#admonition-å“ˆå¸Œè¡¨å’Œåˆ—è¡¨çš„é€‰æ‹©"></a></p>
</summary>
<div>
<h2 id="æˆ‘ä»¬çŸ¥é“å“ˆå¸Œè¡¨å’Œåˆ—è¡¨ç±»ä¼¼éƒ½ç”¨äºå¤„ç†éœ€è¦éšæœºè®¿é—®çš„æ•°æ®ç»“æ„å¦‚æœæ•°æ®ç»“æ„çš„è¾“å…¥å’Œè¾“å‡ºèƒ½ä¸€ä¸€å¯¹åº”é‚£ä¹ˆå¯ä»¥ä½¿ç”¨åˆ—è¡¨å¦‚æœæ— æ³•ä¸€ä¸€å¯¹åº”é‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨å“ˆå¸Œè¡¨"><a class="header" href="#æˆ‘ä»¬çŸ¥é“å“ˆå¸Œè¡¨å’Œåˆ—è¡¨ç±»ä¼¼éƒ½ç”¨äºå¤„ç†éœ€è¦éšæœºè®¿é—®çš„æ•°æ®ç»“æ„å¦‚æœæ•°æ®ç»“æ„çš„è¾“å…¥å’Œè¾“å‡ºèƒ½ä¸€ä¸€å¯¹åº”é‚£ä¹ˆå¯ä»¥ä½¿ç”¨åˆ—è¡¨å¦‚æœæ— æ³•ä¸€ä¸€å¯¹åº”é‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨å“ˆå¸Œè¡¨">æˆ‘ä»¬çŸ¥é“ï¼Œå“ˆå¸Œè¡¨å’Œåˆ—è¡¨ç±»ä¼¼ï¼Œéƒ½ç”¨äºå¤„ç†éœ€è¦éšæœºè®¿é—®çš„æ•°æ®ç»“æ„ã€‚å¦‚æœæ•°æ®ç»“æ„çš„è¾“å…¥å’Œè¾“å‡ºèƒ½ä¸€ä¸€å¯¹åº”ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åˆ—è¡¨ï¼Œå¦‚æœæ— æ³•ä¸€ä¸€å¯¹åº”ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨å“ˆå¸Œè¡¨ã€‚</a></h2>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882989.jpg" alt="17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ" /></p>
</div>
</details>
<h3 id="rust-çš„å“ˆå¸Œè¡¨"><a class="header" href="#rust-çš„å“ˆå¸Œè¡¨">Rust çš„å“ˆå¸Œè¡¨</a></h3>
<details id="admonition-å“ˆå¸Œè¡¨çš„æ ¸å¿ƒç‰¹ç‚¹ä¸è§£å†³" class="admonition info">
<summary class="admonition-title">
<p>å“ˆå¸Œè¡¨çš„æ ¸å¿ƒç‰¹ç‚¹ä¸è§£å†³</p>
<p><a class="admonition-anchor-link" href="#admonition-å“ˆå¸Œè¡¨çš„æ ¸å¿ƒç‰¹ç‚¹ä¸è§£å†³"></a></p>
</summary>
<div>
<p>å“ˆå¸Œè¡¨æœ€æ ¸å¿ƒçš„ç‰¹ç‚¹å°±æ˜¯ï¼šå·¨é‡çš„å¯èƒ½è¾“å…¥å’Œæœ‰é™çš„å“ˆå¸Œè¡¨å®¹é‡ã€‚è¿™å°±ä¼šå¼•å‘å“ˆå¸Œå†²çªï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªæˆ–è€…å¤šä¸ªè¾“å…¥çš„å“ˆå¸Œè¢«æ˜ å°„åˆ°äº†åŒä¸€ä¸ªä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦èƒ½å¤Ÿå¤„ç†å“ˆå¸Œå†²çªã€‚</p>
<p>è¦è§£å†³å†²çªï¼Œé¦–å…ˆå¯ä»¥é€šè¿‡æ›´å¥½çš„ã€åˆ†å¸ƒæ›´å‡åŒ€çš„å“ˆå¸Œå‡½æ•°ï¼Œä»¥åŠä½¿ç”¨æ›´å¤§çš„å“ˆå¸Œè¡¨æ¥ç¼“è§£å†²çªï¼Œä½†æ— æ³•å®Œå…¨è§£å†³ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨å†²çªè§£å†³æœºåˆ¶ã€‚</p>
</div>
</details>
<p>å¦‚ä½•è§£å†³å†²çªï¼Ÿ</p>
<p>ç†è®ºä¸Šï¼Œä¸»è¦çš„å†²çªè§£å†³æœºåˆ¶æœ‰é“¾åœ°å€æ³•ï¼ˆchainingï¼‰å’Œå¼€æ”¾å¯»å€æ³•ï¼ˆopen addressingï¼‰ã€‚</p>
<ul>
<li>é“¾åœ°å€æ³•ï¼Œæˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå°±æ˜¯æŠŠè½åœ¨åŒä¸€ä¸ªå“ˆå¸Œä¸Šçš„æ•°æ®ç”¨å•é“¾è¡¨æˆ–è€…åŒé“¾è¡¨è¿æ¥èµ·æ¥ã€‚è¿™æ ·åœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå…ˆæ‰¾åˆ°å¯¹åº”çš„å“ˆå¸Œæ¡¶ï¼ˆhash bucketï¼‰ï¼Œç„¶åå†åœ¨å†²çªé“¾ä¸ŠæŒ¨ä¸ªæ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„é¡¹ã€‚</li>
</ul>
<blockquote>
<p>å†²çªé“¾å¤„ç†å“ˆå¸Œå†²çªéå¸¸ç›´è§‚ï¼Œå¾ˆå®¹æ˜“ç†è§£å’Œæ’°å†™ä»£ç ï¼Œä½†ç¼ºç‚¹æ˜¯å“ˆå¸Œè¡¨å’Œå†²çªé“¾ä½¿ç”¨äº†ä¸åŒçš„å†…å­˜ï¼Œå¯¹ç¼“å­˜ä¸å‹å¥½ã€‚</p>
</blockquote>
<hr />
<h2 id=""><a class="header" href="#"><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882976.jpg" alt="17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ" /></a></h2>
<ul>
<li>
<p>å¼€æ”¾å¯»å€æ³•æŠŠæ•´ä¸ªå“ˆå¸Œè¡¨çœ‹åšä¸€ä¸ªå¤§æ•°ç»„ï¼Œä¸å¼•å…¥é¢å¤–çš„å†…å­˜ï¼Œå½“å†²çªäº§ç”Ÿæ—¶ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠŠæ•°æ®æ’å…¥åˆ°å…¶å®ƒç©ºé—²çš„ä½ç½®ã€‚æ¯”å¦‚çº¿æ€§æ¢å¯»ï¼ˆlinear probingï¼‰åœ¨å‡ºç°å“ˆå¸Œå†²çªæ—¶ï¼Œä¸æ–­å¾€åæ¢å¯»ï¼Œç›´åˆ°æ‰¾åˆ°ç©ºé—²çš„ä½ç½®æ’å…¥ã€‚</p>
</li>
<li>
<p>è€ŒäºŒæ¬¡æ¢æŸ¥ï¼Œç†è®ºä¸Šæ˜¯åœ¨å†²çªå‘ç”Ÿæ—¶ï¼Œä¸æ–­æ¢å¯»å“ˆå¸Œä½ç½®åŠ å‡ n çš„äºŒæ¬¡æ–¹ï¼Œæ‰¾åˆ°ç©ºé—²çš„ä½ç½®æ’å…¥ï¼Œæˆ‘ä»¬çœ‹å›¾ï¼Œæ›´å®¹æ˜“ç†è§£ï¼š</p>
</li>
</ul>
<hr />
<h2 id="-1"><a class="header" href="#-1"><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882967.jpg" alt="17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ" /></a></h2>
<blockquote>
<p>å›¾ä¸­ç¤ºæ„æ˜¯ç†è®ºä¸Šçš„å¤„ç†æ–¹æ³•ï¼Œå®é™…ä¸ºäº†æ€§èƒ½ä¼šæœ‰å¾ˆå¤šä¸åŒçš„å¤„ç†ã€‚</p>
</blockquote>
<h3 id="hashmap-çš„æ•°æ®ç»“æ„"><a class="header" href="#hashmap-çš„æ•°æ®ç»“æ„">HashMap çš„æ•°æ®ç»“æ„</a></h3>
<details id="admonition-æ·±å…¥rustå“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„hashmap-hashbrown-rawtable" class="admonition info">
<summary class="admonition-title">
<p>æ·±å…¥Rustå“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„ï¼šHashMap-&gt;hashbrown-&gt;RawTable</p>
<p><a class="admonition-anchor-link" href="#admonition-æ·±å…¥rustå“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„hashmap-hashbrown-rawtable"></a></p>
</summary>
<div>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ Rust å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œæ‰“å¼€æ ‡å‡†åº“çš„ <a href="https://doc.rust-lang.org/src/std/collections/hash/map.rs.html#206-208">æºä»£ç </a>ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use hashbrown::hash_map as base;

#[derive(Clone)]
pub struct RandomState {
    k0: u64,
    k1: u64,
}

pub struct HashMap&lt;K, V, S = RandomState&gt; {
    base: base::HashMap&lt;K, V, S&gt;,
}
</code></pre></pre>
<hr />
<p>å¯ä»¥çœ‹åˆ°ï¼ŒHashMap æœ‰ä¸‰ä¸ªæ³›å‹å‚æ•°:</p>
<ol>
<li>K å’Œ V ä»£è¡¨ key / value çš„ç±»å‹</li>
<li>S æ˜¯å“ˆå¸Œç®—æ³•çš„çŠ¶æ€ï¼Œå®ƒé»˜è®¤æ˜¯ RandomStateï¼Œå ä¸¤ä¸ª u64ã€‚</li>
</ol>
<blockquote>
<p>RandomState ä½¿ç”¨ SipHash ä½œä¸ºç¼ºçœçš„å“ˆå¸Œç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŠ å¯†å®‰å…¨çš„å“ˆå¸Œå‡½æ•°ï¼ˆcryptographically secure hashingï¼‰ã€‚</p>
</blockquote>
<p>ä»å®šä¹‰ä¸­è¿˜èƒ½çœ‹åˆ°ï¼ŒRust çš„ HashMap å¤ç”¨äº† hashbrown çš„ HashMap: 
hashbrown æ˜¯ Rust ä¸‹å¯¹ <a href="https://abseil.io/blog/20180927-swisstables">Google Swiss Table</a> çš„ä¸€ä¸ªæ”¹è¿›ç‰ˆå®ç°ï¼Œæˆ‘ä»¬<a href="https://docs.rs/hashbrown/0.11.2/src/hashbrown/map.rs.html#192-195">æ‰“å¼€ hashbrown çš„ä»£ç </a>ï¼Œçœ‹å®ƒçš„ç»“æ„ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">pub struct HashMap&lt;K, V, S = DefaultHashBuilder, A: Allocator + Clone = Global&gt; {
    pub(crate) hash_builder: S,
    pub(crate) table: RawTable&lt;(K, V), A&gt;,
}
</code></pre></pre>
<hr />
<p>å¯ä»¥çœ‹åˆ°ï¼ŒHashMap é‡Œæœ‰ä¸¤ä¸ªåŸŸ:</p>
<ol>
<li>ä¸€ä¸ªæ˜¯ hash_builderï¼Œç±»å‹æ˜¯åˆšæ‰æˆ‘ä»¬æåˆ°çš„æ ‡å‡†åº“ä½¿ç”¨çš„ RandomState</li>
<li>è¿˜æœ‰ä¸€ä¸ªæ˜¯å…·ä½“çš„ RawTableï¼š</li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">
pub struct RawTable&lt;T, A: Allocator + Clone = Global&gt; {
    table: RawTableInner&lt;A&gt;,
    // Tell dropck that we own instances of T.
    marker: PhantomData&lt;T&gt;,
}

struct RawTableInner&lt;A&gt; {
    // Mask to get an index from a hash value. The value is one less than the
    // number of buckets in the table.
    bucket_mask: usize,

    // [Padding], T1, T2, ..., Tlast, C1, C2, ...
    //                                ^ points here
    ctrl: NonNull&lt;u8&gt;,

    // Number of elements that can be inserted before we need to grow the table
    growth_left: usize,

    // Number of elements in the table, only really used by len()
    items: usize,

    alloc: A,
}
</code></pre></pre>
<p>RawTable ä¸­ï¼Œå®é™…ä¸Šæœ‰æ„ä¹‰çš„æ•°æ®ç»“æ„æ˜¯ RawTableInner:</p>
<blockquote>
<p>å‰å››ä¸ªå­—æ®µå¾ˆé‡è¦ï¼š</p>
</blockquote>
<ol>
<li>usize çš„ bucket_maskï¼Œæ˜¯å“ˆå¸Œè¡¨ä¸­å“ˆå¸Œæ¡¶çš„æ•°é‡å‡ä¸€ï¼›</li>
<li>åå­—å« ctrl çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å“ˆå¸Œè¡¨å †å†…å­˜æœ«ç«¯çš„ ctrl åŒºï¼›</li>
<li>usize çš„å­—æ®µ growth_leftï¼ŒæŒ‡å“ˆå¸Œè¡¨åœ¨ä¸‹æ¬¡è‡ªåŠ¨å¢é•¿å‰è¿˜èƒ½å­˜å‚¨å¤šå°‘æ•°æ®ï¼›</li>
<li>Usize çš„ itemsï¼Œè¡¨æ˜å“ˆå¸Œè¡¨ç°åœ¨æœ‰å¤šå°‘æ•°æ®ã€‚</li>
</ol>
<blockquote>
<p>è¿™é‡Œæœ€åçš„ alloc å­—æ®µï¼Œå’Œ RawTable çš„ marker ä¸€æ ·ï¼Œåªæ˜¯ä¸€ä¸ªç”¨æ¥å ä½çš„ç±»å‹ï¼Œå®ƒç”¨æ¥åˆ†é…åœ¨å †ä¸Šçš„å†…å­˜ã€‚</p>
</blockquote>
</div>
</details>
<h3 id="hashmap-çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•"><a class="header" href="#hashmap-çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•">HashMap çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•</a></h3>
<details id="admonition-hashmapåŸºæœ¬ä½¿ç”¨æ–¹æ³•" class="admonition info">
<summary class="admonition-title">
<p>HashMapåŸºæœ¬ä½¿ç”¨æ–¹æ³•</p>
<p><a class="admonition-anchor-link" href="#admonition-hashmapåŸºæœ¬ä½¿ç”¨æ–¹æ³•"></a></p>
</summary>
<div>
<p>æ•°æ®ç»“æ„ææ¸…æ¥šï¼Œæˆ‘ä»¬å†çœ‹å…·ä½“ä½¿ç”¨æ–¹æ³•ã€‚Rust å“ˆå¸Œè¡¨çš„ä½¿ç”¨å¾ˆç®€å•ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å¾ˆæ–¹ä¾¿çš„æ–¹æ³•ï¼Œä½¿ç”¨èµ·æ¥å’Œå…¶å®ƒè¯­è¨€éå¸¸ç±»ä¼¼ï¼Œä½ åªè¦çœ‹çœ‹æ–‡æ¡£ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬æ¥å†™æ®µä»£ç ï¼Œå°è¯•ä¸€ä¸‹ï¼ˆä»£ç ï¼‰ï¼š</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">
use std::collections::HashMap;

fn main() {
    let mut map = HashMap::new();
    explain(&quot;empty&quot;, &amp;map);

    map.insert('a', 1);
    explain(&quot;added 1&quot;, &amp;map);

    map.insert('b', 2);
    map.insert('c', 3);
    explain(&quot;added 3&quot;, &amp;map);

    map.insert('d', 4);
    explain(&quot;added 4&quot;, &amp;map);

    // get æ—¶éœ€è¦ä½¿ç”¨å¼•ç”¨ï¼Œå¹¶ä¸”ä¹Ÿè¿”å›å¼•ç”¨
    assert_eq!(map.get(&amp;'a'), Some(&amp;1));
    assert_eq!(map.get_key_value(&amp;'b'), Some((&amp;'b', &amp;2)));

    map.remove(&amp;'a');
    // åˆ é™¤åå°±æ‰¾ä¸åˆ°äº†
    assert_eq!(map.contains_key(&amp;'a'), false);
    assert_eq!(map.get(&amp;'a'), None);
    explain(&quot;removed&quot;, &amp;map);
    // shrink åå“ˆå¸Œè¡¨å˜å°
    map.shrink_to_fit();
    explain(&quot;shrinked&quot;, &amp;map);
}

fn explain&lt;K, V&gt;(name: &amp;str, map: &amp;HashMap&lt;K, V&gt;) {
    println!(&quot;{}: len: {}, cap: {}&quot;, name, map.len(), map.capacity());
}
</code></pre></pre>
<hr />
<ol>
<li>å¯ä»¥çœ‹åˆ°ï¼Œå½“ HashMap::new() æ—¶ï¼Œå®ƒå¹¶æ²¡æœ‰åˆ†é…ç©ºé—´ï¼Œå®¹é‡ä¸ºé›¶</li>
<li>éšç€å“ˆå¸Œè¡¨ä¸æ–­æ’å…¥æ•°æ®ï¼Œå®ƒä¼šä»¥ 2 çš„å¹‚å‡ä¸€çš„æ–¹å¼å¢é•¿ï¼Œæœ€å°æ˜¯ 3ã€‚</li>
<li>å½“åˆ é™¤è¡¨ä¸­çš„æ•°æ®æ—¶ï¼ŒåŸæœ‰çš„è¡¨å¤§å°ä¸å˜ï¼Œåªæœ‰æ˜¾å¼åœ°è°ƒç”¨ shrink_to_fitï¼Œæ‰ä¼šè®©å“ˆå¸Œè¡¨å˜å°ã€‚</li>
</ol>
</div>
</details>
<h3 id="hashmap-çš„å†…å­˜å¸ƒå±€"><a class="header" href="#hashmap-çš„å†…å­˜å¸ƒå±€">HashMap çš„å†…å­˜å¸ƒå±€</a></h3>
<details id="admonition-ctrlè¡¨çš„å˜åŒ–å€ŸåŠ©stdmemtransmuteæŸ¥çœ‹å†…å­˜å¸ƒå±€" class="admonition info">
<summary class="admonition-title">
<p>ctrlè¡¨çš„å˜åŒ–ï¼šå€ŸåŠ©std::mem::transmuteæŸ¥çœ‹å†…å­˜å¸ƒå±€</p>
<p><a class="admonition-anchor-link" href="#admonition-ctrlè¡¨çš„å˜åŒ–å€ŸåŠ©stdmemtransmuteæŸ¥çœ‹å†…å­˜å¸ƒå±€"></a></p>
</summary>
<div>
<p>é€šè¿‡ HashMap çš„å…¬å¼€æ¥å£æ— æ³•çœ‹åˆ° HashMap åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å¸ƒå±€ï¼Œè¿˜æ˜¯éœ€è¦å€ŸåŠ© std::mem::transmute æ–¹æ³•ï¼Œæ¥æŠŠæ•°æ®ç»“æ„æ‰“å‡ºæ¥ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬æŠŠåˆšæ‰çš„ä»£ç æ”¹ä¸€æ”¹ï¼ˆä»£ç ï¼‰ï¼š</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">
use std::collections::HashMap;

fn main() {
    let map = HashMap::new();
    let mut map = explain(&quot;empty&quot;, map);

    map.insert('a', 1);
    let mut map = explain(&quot;added 1&quot;, map);
    map.insert('b', 2);
    map.insert('c', 3);

    let mut map = explain(&quot;added 3&quot;, map);

    map.insert('d', 4);

    let mut map = explain(&quot;added 4&quot;, map);

    map.remove(&amp;'a');

    explain(&quot;final&quot;, map);
}

// HashMap ç»“æ„æœ‰ä¸¤ä¸ª u64 çš„ RandomStateï¼Œç„¶åæ˜¯å››ä¸ª usizeï¼Œ
// åˆ†åˆ«æ˜¯ bucket_mask, ctrl, growth_left å’Œ items
// æˆ‘ä»¬ transmute æ‰“å°ä¹‹åï¼Œå† transmute å›å»
fn explain&lt;K, V&gt;(name: &amp;str, map: HashMap&lt;K, V&gt;) -&gt; HashMap&lt;K, V&gt; {
    let arr: [usize; 6] = unsafe { std::mem::transmute(map) };
    println!(
        &quot;{}: bucket_mask 0x{:x}, ctrl 0x{:x}, growth_left: {}, items: {}&quot;,
        name, arr[2], arr[3], arr[4], arr[5]
    );
    unsafe { std::mem::transmute(arr) }
}
</code></pre></pre>
<hr />
<p>è¿è¡Œä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<pre><code class="language-shell">empty: bucket_mask 0x0, ctrl 0x1056df820, growth_left: 0, items: 0

added 1: bucket_mask 0x3, ctrl 0x7fa0d1405e30, growth_left: 2, items: 1

added 3: bucket_mask 0x3, ctrl 0x7fa0d1405e30, growth_left: 0, items: 3

added 4: bucket_mask 0x7, ctrl 0x7fa0d1405e90, growth_left: 3, items: 4

final: bucket_mask 0x7, ctrl 0x7fa0d1405e90, growth_left: 4, items: 3
</code></pre>
<blockquote>
<p>å‘ç°åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œctrl å¯¹åº”çš„å †åœ°å€å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
</blockquote>
<ul>
<li>åœ¨æˆ‘çš„ OS X ä¸‹ï¼Œä¸€å¼€å§‹å“ˆå¸Œè¡¨ä¸ºç©ºï¼Œctrl åœ°å€çœ‹ä¸Šå»æ˜¯ä¸€ä¸ª TEXT/RODATA æ®µçš„åœ°å€ï¼Œåº”è¯¥æ˜¯æŒ‡å‘äº†ä¸€ä¸ªé»˜è®¤çš„ç©ºè¡¨åœ°å€ï¼›</li>
<li>æ’å…¥ç¬¬ä¸€ä¸ªæ•°æ®åï¼Œå“ˆå¸Œè¡¨åˆ†é…äº† 4 ä¸ª bucketï¼Œctrl åœ°å€å‘ç”Ÿæ”¹å˜ï¼›</li>
<li>åœ¨æ’å…¥ä¸‰ä¸ªæ•°æ®åï¼Œgrowth_left ä¸ºé›¶</li>
<li>å†æ’å…¥æ—¶ï¼Œå“ˆå¸Œè¡¨é‡æ–°åˆ†é…ï¼Œctrl åœ°å€ç»§ç»­æ”¹å˜ã€‚</li>
</ul>
<blockquote>
<p>åœ¨æ¢ç´¢ HashMap æ•°æ®ç»“æ„æ—¶ï¼Œè¯´è¿‡ ctrl æ˜¯ä¸€ä¸ªæŒ‡å‘å“ˆå¸Œè¡¨å †åœ°å€æœ«ç«¯ ctrl åŒºçš„åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€ï¼Œè®¡ç®—å‡ºå“ˆå¸Œè¡¨å †åœ°å€çš„èµ·å§‹åœ°å€ã€‚</p>
</blockquote>
<p>å› ä¸ºå“ˆå¸Œè¡¨æœ‰ 8 ä¸ª bucketï¼ˆ0x7 + 1ï¼‰ï¼Œæ¯ä¸ª bucket å¤§å°æ˜¯ keyï¼ˆcharï¼‰ + valueï¼ˆi32ï¼‰ çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¸€å…±æ˜¯ 64 ä¸ªå­—èŠ‚ã€‚
å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œé€šè¿‡ ctrl åœ°å€å‡å» 64ï¼Œå°±å¯ä»¥å¾—åˆ°å“ˆå¸Œè¡¨çš„å †å†…å­˜èµ·å§‹åœ°å€ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ rust-gdb / rust-lldb æ¥æ‰“å°è¿™ä¸ªå†…å­˜ã€‚</p>
<blockquote>
<p>å¯ä»¥ç”¨ Linux ä¸‹çš„ rust-gdb è®¾ç½®æ–­ç‚¹ï¼Œä¾æ¬¡æŸ¥çœ‹å“ˆå¸Œè¡¨æœ‰ä¸€ä¸ªã€ä¸‰ä¸ªã€å››ä¸ªå€¼ï¼Œä»¥åŠåˆ é™¤ä¸€ä¸ªå€¼çš„çŠ¶æ€ï¼š</p>
</blockquote>
<pre><code class="language-shell">
â¯ rust-gdb ~/.target/debug/hashmap2
GNU gdb (Ubuntu 9.2-0ubuntu2) 9.2
...
(gdb) b hashmap2.rs:32
Breakpoint 1 at 0xa43e: file src/hashmap2.rs, line 32.
(gdb) r
Starting program: /home/tchen/.target/debug/hashmap2
...
# æœ€åˆçš„çŠ¶æ€ï¼Œå“ˆå¸Œè¡¨ä¸ºç©º
empty: bucket_mask 0x0, ctrl 0x555555597be0, growth_left: 0, items: 0

Breakpoint 1, hashmap2::explain (name=..., map=...) at src/hashmap2.rs:32
32      unsafe { std::mem::transmute(arr) }
(gdb) c
Continuing.
# æ’å…¥äº†ä¸€ä¸ªå…ƒç´ åï¼Œbucket æœ‰ 4 ä¸ªï¼ˆ0x3+1ï¼‰ï¼Œå †åœ°å€èµ·å§‹ä½ç½® 0x5555555a7af0 - 4*8(0x20)
added 1: bucket_mask 0x3, ctrl 0x5555555a7af0, growth_left: 2, items: 1

Breakpoint 1, hashmap2::explain (name=..., map=...) at src/hashmap2.rs:32
32      unsafe { std::mem::transmute(arr) }
(gdb) x /12x 0x5555555a7ad0
0x5555555a7ad0:  0x00000061  0x00000001  0x00000000  0x00000000
0x5555555a7ae0:  0x00000000  0x00000000  0x00000000  0x00000000
0x5555555a7af0:  0x0affffff  0xffffffff  0xffffffff  0xffffffff
(gdb) c
Continuing.
# æ’å…¥äº†ä¸‰ä¸ªå…ƒç´ åï¼Œå“ˆå¸Œè¡¨æ²¡æœ‰å‰©ä½™ç©ºé—´ï¼Œå †åœ°å€èµ·å§‹ä½ç½®ä¸å˜ 0x5555555a7af0 - 4*8(0x20)
added 3: bucket_mask 0x3, ctrl 0x5555555a7af0, growth_left: 0, items: 3

Breakpoint 1, hashmap2::explain (name=..., map=...) at src/hashmap2.rs:32
32      unsafe { std::mem::transmute(arr) }
(gdb) x /12x 0x5555555a7ad0
0x5555555a7ad0:  0x00000061  0x00000001  0x00000062  0x00000002
0x5555555a7ae0:  0x00000000  0x00000000  0x00000063  0x00000003
0x5555555a7af0:  0x0a72ff02  0xffffffff  0xffffffff  0xffffffff
(gdb) c
Continuing.
# æ’å…¥ç¬¬å››ä¸ªå…ƒç´ åï¼Œå“ˆå¸Œè¡¨æ‰©å®¹ï¼Œå †åœ°å€èµ·å§‹ä½ç½®å˜ä¸º 0x5555555a7b50 - 8*8(0x40)
added 4: bucket_mask 0x7, ctrl 0x5555555a7b50, growth_left: 3, items: 4

Breakpoint 1, hashmap2::explain (name=..., map=...) at src/hashmap2.rs:32
32      unsafe { std::mem::transmute(arr) }
(gdb) x /20x 0x5555555a7b10
0x5555555a7b10:  0x00000061  0x00000001  0x00000000  0x00000000
0x5555555a7b20:  0x00000064  0x00000004  0x00000063  0x00000003
0x5555555a7b30:  0x00000000  0x00000000  0x00000062  0x00000002
0x5555555a7b40:  0x00000000  0x00000000  0x00000000  0x00000000
0x5555555a7b50:  0xff72ffff  0x0aff6502  0xffffffff  0xffffffff
(gdb) c
Continuing.
# åˆ é™¤ a åï¼Œå‰©ä½™ 4 ä¸ªä½ç½®ã€‚æ³¨æ„ ctrl bit çš„å˜åŒ–ï¼Œä»¥åŠ 0x61 0x1 å¹¶æ²¡æœ‰è¢«æ¸…é™¤
final: bucket_mask 0x7, ctrl 0x5555555a7b50, growth_left: 4, items: 3

Breakpoint 1, hashmap2::explain (name=..., map=...) at src/hashmap2.rs:32
32      unsafe { std::mem::transmute(arr) }
(gdb) x /20x 0x5555555a7b10
0x5555555a7b10:  0x00000061  0x00000001  0x00000000  0x00000000
0x5555555a7b20:  0x00000064  0x00000004  0x00000063  0x00000003
0x5555555a7b30:  0x00000000  0x00000000  0x00000062  0x00000002
0x5555555a7b40:  0x00000000  0x00000000  0x00000000  0x00000000
0x5555555a7b50:  0xff72ffff  0xffff6502  0xffffffff  0xffffffff
</code></pre>
<hr />
<p>è¿™æ®µè¾“å‡ºè•´è—äº†å¾ˆå¤šä¿¡æ¯ï¼Œç»“åˆç¤ºæ„å›¾æ¥ä»”ç»†æ¢³ç†ã€‚</p>
<ol>
<li>é¦–å…ˆï¼Œæ’å…¥ç¬¬ä¸€ä¸ªå…ƒç´  â€˜aâ€™: 1 åï¼Œå“ˆå¸Œè¡¨çš„å†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š</li>
</ol>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882958.jpg" alt="17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ" /></p>
<ul>
<li>key â€˜aâ€™ çš„ hash å’Œ bucket_mask 0x3 è¿ç®—åå¾—åˆ°ç¬¬ 0 ä¸ªä½ç½®æ’å…¥ã€‚</li>
<li>åŒæ—¶ï¼Œè¿™ä¸ª hash çš„å¤´ 7 ä½å–å‡ºæ¥ï¼Œåœ¨ ctrl è¡¨ä¸­å¯¹åº”çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 0 ä¸ªå­—èŠ‚ï¼ŒæŠŠè¿™ä¸ªå€¼å†™å…¥ã€‚</li>
</ul>
<p>è¦ç†è§£è¿™ä¸ªæ­¥éª¤ï¼Œå…³é”®å°±æ˜¯è¦ææ¸…æ¥šè¿™ä¸ª ctrl è¡¨æ˜¯ä»€ä¹ˆã€‚</p>
</div>
</details>
<h3 id="ctrl-è¡¨"><a class="header" href="#ctrl-è¡¨">ctrl è¡¨</a></h3>
<details id="admonition-ctrl-è¡¨çš„ä¸»è¦ç›®çš„ä¸è®¾è®¡" class="admonition info">
<summary class="admonition-title">
<p>ctrl è¡¨çš„ä¸»è¦ç›®çš„ä¸è®¾è®¡</p>
<p><a class="admonition-anchor-link" href="#admonition-ctrl-è¡¨çš„ä¸»è¦ç›®çš„ä¸è®¾è®¡"></a></p>
</summary>
<div>
<p>ctrl è¡¨çš„ä¸»è¦ç›®çš„æ˜¯å¿«é€ŸæŸ¥æ‰¾ã€‚å®ƒçš„è®¾è®¡éå¸¸ä¼˜é›…ï¼Œå€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚</p>
<p>ä¸€å¼  ctrl è¡¨é‡Œ:</p>
<ul>
<li>æœ‰è‹¥å¹²ä¸ª 128bit æˆ–è€…è¯´ 16 ä¸ªå­—èŠ‚çš„åˆ†ç»„ï¼ˆgroupï¼‰</li>
<li>group é‡Œçš„æ¯ä¸ªå­—èŠ‚å« ctrl byteï¼Œå¯¹åº”ä¸€ä¸ª bucketï¼Œé‚£ä¹ˆä¸€ä¸ª group å¯¹åº” 16 ä¸ª bucketã€‚</li>
<li>å¦‚æœä¸€ä¸ª bucket å¯¹åº”çš„ ctrl byte é¦–ä½ä¸ä¸º 1ï¼Œå°±è¡¨ç¤ºè¿™ä¸ª ctrl byte è¢«ä½¿ç”¨ï¼›</li>
<li>å¦‚æœæ‰€æœ‰ä½éƒ½æ˜¯ 1ï¼Œæˆ–è€…è¯´è¿™ä¸ªå­—èŠ‚æ˜¯ 0xffï¼Œé‚£ä¹ˆå®ƒæ˜¯ç©ºé—²çš„ã€‚</li>
</ul>
<blockquote>
<p>ä¸€ç»„ control byte çš„æ•´ä¸ª 128 bit çš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä¸€æ¡æŒ‡ä»¤è¢«åŠ è½½è¿›æ¥ï¼Œç„¶åå’ŒæŸä¸ªå€¼è¿›è¡Œ maskï¼Œæ‰¾åˆ°å®ƒæ‰€åœ¨çš„ä½ç½®ã€‚è¿™å°±æ˜¯HashMapçš„ SIMD æŸ¥è¡¨ã€‚</p>
</blockquote>
<blockquote>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œç°ä»£ CPU éƒ½æ”¯æŒå•æŒ‡ä»¤å¤šæ•°æ®é›†çš„æ“ä½œï¼Œè€Œ Rust å……åˆ†åˆ©ç”¨äº† CPU è¿™ç§èƒ½åŠ›ï¼Œä¸€æ¡æŒ‡ä»¤å¯ä»¥è®©å¤šä¸ªç›¸å…³çš„æ•°æ®è½½å…¥åˆ°ç¼“å­˜ä¸­å¤„ç†ï¼Œå¤§å¤§åŠ å¿«æŸ¥è¡¨çš„é€Ÿåº¦ã€‚æ‰€ä»¥ï¼ŒRust çš„å“ˆå¸Œè¡¨æŸ¥è¯¢çš„æ•ˆç‡éå¸¸é«˜ã€‚</p>
</blockquote>
<p>å…·ä½“æ€ä¹ˆæ“ä½œï¼Œæˆ‘ä»¬æ¥çœ‹ HashMap æ˜¯å¦‚ä½•é€šè¿‡ ctrl è¡¨æ¥è¿›è¡Œæ•°æ®æŸ¥è¯¢çš„ã€‚</p>
<blockquote>
<p>å‡è®¾è¿™å¼ è¡¨é‡Œå·²ç»æ·»åŠ äº†ä¸€äº›æ•°æ®ï¼Œæˆ‘ä»¬ç°åœ¨è¦æŸ¥æ‰¾ key ä¸º â€˜câ€™ çš„æ•°æ®ï¼š</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882948.jpg" alt="17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ" /></p>
<ol>
<li>æŠŠ h è·Ÿ bucket_mask åšä¸ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œå›¾ä¸­æ˜¯ 139ï¼›</li>
<li>æ‹¿ç€è¿™ä¸ª 139ï¼Œæ‰¾åˆ°å¯¹åº”çš„ ctrl group çš„èµ·å§‹ä½ç½®ï¼Œå› ä¸º ctrl group ä»¥ 16 ä¸ºä¸€ç»„ï¼Œæ‰€ä»¥è¿™é‡Œæ‰¾åˆ° 128ï¼›</li>
<li>ç”¨ SIMD æŒ‡ä»¤åŠ è½½ä» 128 å¯¹åº”åœ°å€å¼€å§‹çš„ 16 ä¸ªå­—èŠ‚ï¼›</li>
<li>å¯¹ hash å–å¤´ 7 ä¸ª bitï¼Œç„¶åå’Œåˆšåˆšå–å‡ºçš„ 16 ä¸ªå­—èŠ‚ä¸€èµ·åšä¸ï¼Œæ‰¾åˆ°å¯¹åº”çš„åŒ¹é…ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå®ƒï¼ˆä»¬ï¼‰å¾ˆå¤§æ¦‚ç‡æ˜¯è¦æ‰¾çš„å€¼ï¼›</li>
<li>å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆä»¥äºŒæ¬¡æ¢æŸ¥ï¼ˆä»¥ 16 çš„å€æ•°ä¸æ–­ç´¯ç§¯ï¼‰çš„æ–¹å¼å¾€åæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚</li>
</ol>
<blockquote>
<p>æ‰€ä»¥ï¼Œå½“ HashMap æ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œä»¥åŠå› æ­¤å¯¼è‡´é‡æ–°åˆ†é…çš„æ—¶å€™ï¼Œä¸»è¦å·¥ä½œå°±æ˜¯åœ¨ç»´æŠ¤è¿™å¼  ctrl è¡¨å’Œæ•°æ®çš„å¯¹åº”ã€‚</p>
</blockquote>
<blockquote>
<p>å› ä¸º ctrl è¡¨æ˜¯æ‰€æœ‰æ“ä½œæœ€å…ˆè§¦åŠçš„å†…å­˜ï¼Œæ‰€ä»¥ï¼Œåœ¨ HashMap çš„ç»“æ„ä¸­ï¼Œå †å†…å­˜çš„æŒ‡é’ˆç›´æ¥æŒ‡å‘ ctrl è¡¨ï¼Œè€Œä¸æ˜¯æŒ‡å‘å †å†…å­˜çš„èµ·å§‹ä½ç½®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸€æ¬¡å†…å­˜çš„è®¿é—®ã€‚</p>
</blockquote>
</div>
</details>
<h3 id="å“ˆå¸Œè¡¨é‡æ–°åˆ†é…ä¸å¢é•¿"><a class="header" href="#å“ˆå¸Œè¡¨é‡æ–°åˆ†é…ä¸å¢é•¿">å“ˆå¸Œè¡¨é‡æ–°åˆ†é…ä¸å¢é•¿</a></h3>
<details id="admonition-æ’å…¥ä¸‰ä¸ªå…ƒç´ åæ²¡æœ‰å‰©ä½™ç©ºé—´çš„å“ˆå¸Œè¡¨åœ¨åŠ å…¥-d-4-æ—¶hash-mapæ˜¯å¦‚ä½•å¢é•¿çš„" class="admonition info">
<summary class="admonition-title">
<p>æ’å…¥ä¸‰ä¸ªå…ƒç´ åæ²¡æœ‰å‰©ä½™ç©ºé—´çš„å“ˆå¸Œè¡¨ï¼Œåœ¨åŠ å…¥ â€˜dâ€™: 4 æ—¶ï¼Œhash mapæ˜¯å¦‚ä½•å¢é•¿çš„</p>
<p><a class="admonition-anchor-link" href="#admonition-æ’å…¥ä¸‰ä¸ªå…ƒç´ åæ²¡æœ‰å‰©ä½™ç©ºé—´çš„å“ˆå¸Œè¡¨åœ¨åŠ å…¥-d-4-æ—¶hash-mapæ˜¯å¦‚ä½•å¢é•¿çš„"></a></p>
</summary>
<div>
<p>åœ¨æ’å…¥ç¬¬ä¸€æ¡æ•°æ®åï¼Œå“ˆå¸Œè¡¨åªæœ‰ 4 ä¸ª bucketï¼Œæ‰€ä»¥åªæœ‰å¤´ 4 ä¸ªå­—èŠ‚çš„ ctrl è¡¨æœ‰ç”¨ã€‚éšç€å“ˆå¸Œè¡¨çš„å¢é•¿ï¼Œbucket ä¸å¤Ÿï¼Œå°±ä¼šå¯¼è‡´é‡æ–°åˆ†é…ã€‚ç”±äº bucket_mask æ°¸è¿œæ¯” bucket æ•°é‡å°‘ 1ï¼Œæ‰€ä»¥æ’å…¥ä¸‰ä¸ªå…ƒç´ åå°±ä¼šé‡æ–°åˆ†é…ã€‚</p>
<p>æ ¹æ® rust-gdb ä¸­å¾—åˆ°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬çœ‹æ’å…¥ä¸‰ä¸ªå…ƒç´ åæ²¡æœ‰å‰©ä½™ç©ºé—´çš„å“ˆå¸Œè¡¨ï¼Œåœ¨åŠ å…¥ â€˜dâ€™: 4 æ—¶ï¼Œæ˜¯å¦‚ä½•å¢é•¿çš„: </p>
<ol>
<li>é¦–å…ˆï¼Œå“ˆå¸Œè¡¨ä¼šæŒ‰å¹‚æ‰©å®¹ï¼Œä» 4 ä¸ª bucket æ‰©å±•åˆ° 8 ä¸ª bucketã€‚</li>
</ol>
<p>è¿™ä¼šå¯¼è‡´åˆ†é…æ–°çš„å †å†…å­˜ï¼Œç„¶ååŸæ¥çš„ ctrl table å’Œå¯¹åº”çš„ kv æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°æ–°çš„å†…å­˜ä¸­ã€‚</p>
<ul>
<li>è¿™ä¸ªä¾‹å­é‡Œå› ä¸º char å’Œ i32 å®ç°äº† Copy traitï¼Œæ‰€ä»¥æ˜¯æ‹·è´ï¼›</li>
<li>å¦‚æœ key çš„ç±»å‹æ˜¯ Stringï¼Œé‚£ä¹ˆåªæœ‰ String çš„ 24 ä¸ªå­—èŠ‚ (ptr|cap|len) çš„ç»“æ„è¢«ç§»åŠ¨ï¼ŒString çš„å®é™…å†…å­˜ä¸éœ€è¦å˜åŠ¨ã€‚</li>
<li>åœ¨ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ¶‰åŠå“ˆå¸Œçš„é‡åˆ†é…ã€‚</li>
<li>ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°ï¼Œâ€˜aâ€™ / â€˜câ€™ çš„ç›¸å¯¹ä½ç½®å’Œå®ƒä»¬çš„ ctrl byte æ²¡æœ‰å˜åŒ–ï¼Œä½†é‡æ–°åš hash åï¼Œâ€˜bâ€™ çš„ ctrl byte å’Œä½ç½®éƒ½å‘ç”Ÿäº†å˜åŒ–ï¼š</li>
</ul>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882903-4882936.jpg" alt="" /></p>
</div>
</details>
<h3 id="åˆ é™¤ä¸€ä¸ªå€¼"><a class="header" href="#åˆ é™¤ä¸€ä¸ªå€¼">åˆ é™¤ä¸€ä¸ªå€¼</a></h3>
<details id="admonition-å“ˆå¸Œè¡¨åˆ é™¤æ—¶å†…å­˜å¦‚ä½•é‡Šæ”¾" class="admonition info">
<summary class="admonition-title">
<p>å“ˆå¸Œè¡¨åˆ é™¤æ—¶å†…å­˜å¦‚ä½•é‡Šæ”¾ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-å“ˆå¸Œè¡¨åˆ é™¤æ—¶å†…å­˜å¦‚ä½•é‡Šæ”¾"></a></p>
</summary>
<div>
<p>æ˜ç™½äº†å“ˆå¸Œè¡¨æ˜¯å¦‚ä½•å¢é•¿çš„ï¼Œæˆ‘ä»¬å†æ¥çœ‹åˆ é™¤çš„æ—¶å€™ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<p>å½“è¦åœ¨å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¸€ä¸ªå€¼æ—¶ï¼Œæ•´ä¸ªè¿‡ç¨‹å’ŒæŸ¥æ‰¾ç±»ä¼¼:</p>
<ol>
<li>å…ˆè¦æ‰¾åˆ°è¦è¢«åˆ é™¤çš„ key æ‰€åœ¨çš„ä½ç½®ã€‚</li>
<li>åœ¨æ‰¾åˆ°å…·ä½“ä½ç½®åï¼Œå¹¶ä¸éœ€è¦å®é™…æ¸…é™¤å†…å­˜ï¼Œåªéœ€è¦å°†å®ƒçš„ ctrl byte è®¾å› 0xffï¼ˆæˆ–è€…æ ‡è®°æˆåˆ é™¤çŠ¶æ€ï¼‰ã€‚è¿™æ ·ï¼Œè¿™ä¸ª bucket å°±å¯ä»¥è¢«å†æ¬¡ä½¿ç”¨äº†</li>
</ol>
<blockquote>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“ key/value æœ‰é¢å¤–çš„å†…å­˜æ—¶ï¼Œæ¯”å¦‚ Stringï¼Œå®ƒçš„å†…å­˜ä¸ä¼šç«‹å³å›æ”¶ï¼Œåªæœ‰åœ¨ä¸‹ä¸€æ¬¡å¯¹åº”çš„ bucket è¢«ä½¿ç”¨æ—¶ï¼Œè®© HashMap ä¸å†æ‹¥æœ‰è¿™ä¸ª String çš„æ‰€æœ‰æƒä¹‹åï¼Œè¿™ä¸ª String çš„å†…å­˜æ‰è¢«å›æ”¶ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ç¤ºæ„å›¾ï¼š</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/17%EF%BD%9C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%9A%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83%E9%83%A8%E4%BB%B6%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%8C%E5%86%85%E5%AD%98%E5%A6%82%E4%BD%95%E5%B8%83%E5%B1%80%EF%BC%9F-4882903.jpg" alt="17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ" /></p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè¿™å¹¶ä¸ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Œé¡¶å¤šæ˜¯å†…å­˜å ç”¨ç‡ç¨é«˜ä¸€äº›ã€‚ä½†æŸäº›æç«¯æƒ…å†µä¸‹ï¼Œæ¯”å¦‚åœ¨å“ˆå¸Œè¡¨ä¸­æ·»åŠ å¤§é‡å†…å®¹ï¼Œåˆåˆ é™¤å¤§é‡å†…å®¹åè¿è¡Œï¼Œè¿™æ—¶ä½ å¯ä»¥é€šè¿‡ shrink_to_fit / shrink_to é‡Šæ”¾æ‰ä¸éœ€è¦çš„å†…å­˜ã€‚</p>
</div>
</details>
<h3 id="è®©è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„åš-hash-key"><a class="header" href="#è®©è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„åš-hash-key">è®©è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„åš Hash key</a></h3>
<details id="admonition-è‡ªå®šä¹‰æ•°æ®ç»“æ„éœ€è¦å®ç°hashpartialeqeqè¿™ä¸‰ä¸ªtrait" class="admonition info">
<summary class="admonition-title">
<p>è‡ªå®šä¹‰æ•°æ®ç»“æ„éœ€è¦å®ç°Hashã€PartialEqã€Eqè¿™ä¸‰ä¸ªtrait</p>
<p><a class="admonition-anchor-link" href="#admonition-è‡ªå®šä¹‰æ•°æ®ç»“æ„éœ€è¦å®ç°hashpartialeqeqè¿™ä¸‰ä¸ªtrait"></a></p>
</summary>
<div>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®©è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„æˆä¸º HashMap çš„ keyã€‚æ­¤æ—¶ï¼Œè¦ä½¿ç”¨åˆ°ä¸‰ä¸ª traitï¼š<a href="https://doc.rust-lang.org/std/hash/trait.Hash.html">Hash</a>ã€<a href="https://doc.rust-lang.org/std/cmp/trait.PartialEq.html">PartialEq</a>ã€<a href="https://doc.rust-lang.org/std/cmp/trait.Eq.html">Eq</a>ï¼Œä¸è¿‡è¿™ä¸‰ä¸ª trait éƒ½å¯ä»¥é€šè¿‡æ´¾ç”Ÿå®è‡ªåŠ¨ç”Ÿæˆã€‚å…¶ä¸­ï¼š</p>
<ol>
<li>å®ç°äº† Hash ï¼Œå¯ä»¥è®©æ•°æ®ç»“æ„è®¡ç®—å“ˆå¸Œï¼›</li>
<li>å®ç°äº† PartialEq/Eqï¼Œå¯ä»¥è®©æ•°æ®ç»“æ„è¿›è¡Œç›¸ç­‰å’Œä¸ç›¸ç­‰çš„æ¯”è¾ƒã€‚</li>
<li>Eq å®ç°äº†æ¯”è¾ƒçš„è‡ªåæ€§ï¼ˆa == aï¼‰ã€å¯¹ç§°æ€§ï¼ˆa == b åˆ™ b == aï¼‰ä»¥åŠä¼ é€’æ€§ï¼ˆa == bï¼Œb == cï¼Œåˆ™ a == cï¼‰</li>
<li>PartialEq æ²¡æœ‰å®ç°è‡ªåæ€§ã€‚</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥å†™ä¸ªä¾‹å­ï¼Œçœ‹çœ‹è‡ªå®šä¹‰æ•°æ®ç»“æ„å¦‚ä½•æ”¯æŒ HashMapï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use std::{
    collections::{hash_map::DefaultHasher, HashMap},
    hash::{Hash, Hasher},
};

// å¦‚æœè¦æ”¯æŒ Hashï¼Œå¯ä»¥ç”¨ #[derive(Hash)]ï¼Œå‰ææ˜¯æ¯ä¸ªå­—æ®µéƒ½å®ç°äº† Hash
// å¦‚æœè¦èƒ½ä½œä¸º HashMap çš„ keyï¼Œè¿˜éœ€è¦ PartialEq å’Œ Eq
#[derive(Debug, Hash, PartialEq, Eq)]
struct Student&lt;'a&gt; {
    name: &amp;'a str,
    age: u8,
}

impl&lt;'a&gt; Student&lt;'a&gt; {
    pub fn new(name: &amp;'a str, age: u8) -&gt; Self {
        Self { name, age }
    }
}
fn main() {
    let mut hasher = DefaultHasher::new();
    let student = Student::new(&quot;Tyr&quot;, 18);
    // å®ç°äº† Hash çš„æ•°æ®ç»“æ„å¯ä»¥ç›´æ¥è°ƒç”¨ hash æ–¹æ³•
    student.hash(&amp;mut hasher);
    let mut map = HashMap::new();
    // å®ç°äº† Hash / PartialEq / Eq çš„æ•°æ®ç»“æ„å¯ä»¥ä½œä¸º HashMap çš„ key
    map.insert(student, vec![&quot;Math&quot;, &quot;Writing&quot;]);
    println!(&quot;hash: 0x{:x}, map: {:?}&quot;, hasher.finish(), map);
}
</code></pre></pre>
</div>
</details>
<h3 id="hashset--btreemap--btreeset"><a class="header" href="#hashset--btreemap--btreeset">HashSet / BTreeMap / BTreeSet</a></h3>
<details id="admonition-hashsetåªç”¨äºç¡®è®¤å­˜åœ¨å­˜æ”¾æ— åºé›†åˆ" class="admonition info">
<summary class="admonition-title">
<p>HashSetåªç”¨äºç¡®è®¤å­˜åœ¨ï¼Œå­˜æ”¾æ— åºé›†åˆ</p>
<p><a class="admonition-anchor-link" href="#admonition-hashsetåªç”¨äºç¡®è®¤å­˜åœ¨å­˜æ”¾æ— åºé›†åˆ"></a></p>
</summary>
<div>
<p>æœ‰æ—¶æˆ‘ä»¬åªéœ€è¦ç®€å•ç¡®è®¤å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œå¦‚æœç”¨ HashMap å°±æœ‰äº›æµªè´¹ç©ºé—´äº†ã€‚è¿™æ—¶å¯ä»¥ç”¨ HashSetï¼Œå®ƒå°±æ˜¯ç®€åŒ–çš„ HashMapï¼Œå¯ä»¥ç”¨æ¥å­˜æ”¾æ— åºçš„é›†åˆï¼Œå®šä¹‰ç›´æ¥æ˜¯ HashMap&lt;K, ()&gt;ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use hashbrown::hash_set as base;

pub struct HashSet&lt;T, S = RandomState&gt; {
    base: base::HashSet&lt;T, S&gt;,
}

pub struct HashSet&lt;T, S = DefaultHashBuilder, A: Allocator + Clone = Global&gt; {
    pub(crate) map: HashMap&lt;T, (), S, A&gt;,
}
</code></pre></pre>
<blockquote>
<p>ä½¿ç”¨ HashSet æŸ¥çœ‹ä¸€ä¸ªå…ƒç´ æ˜¯å¦å±äºé›†åˆçš„æ•ˆç‡éå¸¸é«˜ã€‚</p>
</blockquote>
</div>
</details>
<details id="admonition-btreemapå’Œbtreesetéƒ½æ˜¯ç”¨äºæŸ¥æ‰¾å­˜æ”¾æœ‰åºé›†åˆ" class="admonition info">
<summary class="admonition-title">
<p>BTreeMapå’ŒBTreeSetéƒ½æ˜¯ç”¨äºæŸ¥æ‰¾ï¼Œå­˜æ”¾æœ‰åºé›†åˆ</p>
<p><a class="admonition-anchor-link" href="#admonition-btreemapå’Œbtreesetéƒ½æ˜¯ç”¨äºæŸ¥æ‰¾å­˜æ”¾æœ‰åºé›†åˆ"></a></p>
</summary>
<div>
<p>BTreeMap æ˜¯å†…éƒ¨ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/B-tree">B-tree</a> æ¥ç»„ç»‡å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„ã€‚å¦å¤– BTreeSet å’Œ HashSet ç±»ä¼¼ï¼Œæ˜¯ BTreeMap çš„ç®€åŒ–ç‰ˆï¼Œå¯ä»¥ç”¨æ¥å­˜æ”¾æœ‰åºé›†åˆã€‚
æˆ‘ä»¬è¿™é‡Œé‡ç‚¹çœ‹ä¸‹ BTreeMapï¼Œå®ƒçš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
pub struct BTreeMap&lt;K, V&gt; {
    root: Option&lt;Root&lt;K, V&gt;&gt;,
    length: usize,
}

pub type Root&lt;K, V&gt; = NodeRef&lt;marker::Owned, K, V, marker::LeafOrInternal&gt;;

pub struct NodeRef&lt;BorrowType, K, V, Type&gt; {
    height: usize,
    node: NonNull&lt;LeafNode&lt;K, V&gt;&gt;,
    _marker: PhantomData&lt;(BorrowType, Type)&gt;,
}

struct LeafNode&lt;K, V&gt; {
    parent: Option&lt;NonNull&lt;InternalNode&lt;K, V&gt;&gt;&gt;,
    parent_idx: MaybeUninit&lt;u16&gt;,
    len: u16,
    keys: [MaybeUninit&lt;K&gt;; CAPACITY],
    vals: [MaybeUninit&lt;V&gt;; CAPACITY],
}

struct InternalNode&lt;K, V&gt; {
    data: LeafNode&lt;K, V&gt;,
    edges: [MaybeUninit&lt;BoxedNode&lt;K, V&gt;&gt;; 2 * B],
}
</code></pre></pre>
<blockquote>
<p>å’Œ HashMap ä¸åŒçš„æ˜¯ï¼ŒBTreeMap æ˜¯æœ‰åºçš„ã€‚æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼ˆä»£ç ï¼‰:</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">
use std::collections::BTreeMap;

fn main() {
    let map = BTreeMap::new();
    let mut map = explain(&quot;empty&quot;, map);

    for i in 0..16usize {
        map.insert(format!(&quot;Tyr {}&quot;, i), i);
    }

    let mut map = explain(&quot;added&quot;, map);

    map.remove(&quot;Tyr 1&quot;);

    let map = explain(&quot;remove 1&quot;, map);

    for item in map.iter() {
        println!(&quot;{:?}&quot;, item);
    }
}

// BTreeMap ç»“æ„æœ‰ heightï¼Œnode å’Œ length
// æˆ‘ä»¬ transmute æ‰“å°ä¹‹åï¼Œå† transmute å›å»
fn explain&lt;K, V&gt;(name: &amp;str, map: BTreeMap&lt;K, V&gt;) -&gt; BTreeMap&lt;K, V&gt; {
    let arr: [usize; 3] = unsafe { std::mem::transmute(map) };
    println!(
        &quot;{}: height: {}, root node: 0x{:x}, len: 0x{:x}&quot;,
        name, arr[0], arr[1], arr[2]
    );
    unsafe { std::mem::transmute(arr) }
}
</code></pre></pre>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨éå†æ—¶ï¼ŒBTreeMap ä¼šæŒ‰ç…§ key çš„é¡ºåºæŠŠå€¼æ‰“å°å‡ºæ¥ã€‚å¦‚æœä½ æƒ³è®©è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„å¯ä»¥ä½œä¸º BTreeMap çš„ keyï¼Œé‚£ä¹ˆéœ€è¦å®ç° PartialOrd å’Œ Ordï¼Œè¿™ä¸¤è€…çš„å…³ç³»å’Œ PartialEq / Eq ç±»ä¼¼ï¼ŒPartialOrd ä¹Ÿæ²¡æœ‰å®ç°è‡ªåæ€§ã€‚åŒæ ·çš„ï¼ŒPartialOrd å’Œ Ord ä¹Ÿå¯ä»¥é€šè¿‡æ´¾ç”Ÿå®æ¥å®ç°ã€‚</p>
</blockquote>
</div>
</details>
<h3 id="ä¸ºä»€ä¹ˆ-rust-çš„-hashmap-è¦ç¼ºçœé‡‡ç”¨åŠ å¯†å®‰å…¨çš„å“ˆå¸Œç®—æ³•"><a class="header" href="#ä¸ºä»€ä¹ˆ-rust-çš„-hashmap-è¦ç¼ºçœé‡‡ç”¨åŠ å¯†å®‰å…¨çš„å“ˆå¸Œç®—æ³•">ä¸ºä»€ä¹ˆ Rust çš„ HashMap è¦ç¼ºçœé‡‡ç”¨åŠ å¯†å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Ÿ</a></h3>
<details id="admonition-ä¸ºä»€ä¹ˆ-rust-çš„-hashmap-è¦ç¼ºçœé‡‡ç”¨åŠ å¯†å®‰å…¨çš„å“ˆå¸Œç®—æ³•" class="admonition info">
<summary class="admonition-title">
<p>ä¸ºä»€ä¹ˆ Rust çš„ HashMap è¦ç¼ºçœé‡‡ç”¨åŠ å¯†å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸ºä»€ä¹ˆ-rust-çš„-hashmap-è¦ç¼ºçœé‡‡ç”¨åŠ å¯†å®‰å…¨çš„å“ˆå¸Œç®—æ³•"></a></p>
</summary>
<div>
<p>æˆ‘ä»¬çŸ¥é“å“ˆå¸Œè¡¨åœ¨è½¯ä»¶ç³»ç»Ÿä¸­çš„é‡è¦åœ°ä½ï¼Œä½†å“ˆå¸Œè¡¨åœ¨æœ€åæƒ…å†µä¸‹ï¼Œå¦‚æœç»å¤§å¤šæ•° key çš„ hash éƒ½ç¢°æ’åœ¨ä¸€èµ·ï¼Œæ€§èƒ½ä¼šåˆ° O(n)ï¼Œè¿™ä¼šæå¤§æ‹–ç´¯ç³»ç»Ÿçš„æ•ˆç‡ã€‚</p>
<p>æ¯”å¦‚ 1M å¤§å°çš„ session è¡¨ï¼Œæ­£å¸¸æƒ…å†µä¸‹æŸ¥è¡¨é€Ÿåº¦æ˜¯ O(1)ï¼Œä½†æç«¯æƒ…å†µä¸‹ï¼Œéœ€è¦æ¯”è¾ƒ 1M ä¸ªæ•°æ®åæ‰èƒ½æ‰¾åˆ°ï¼Œè¿™æ ·çš„ç³»ç»Ÿå°±å®¹æ˜“è¢« DoS æ”»å‡»ã€‚æ‰€ä»¥å¦‚æœä¸æ˜¯åŠ å¯†å®‰å…¨çš„å“ˆå¸Œå‡½æ•°ï¼Œåªè¦é»‘å®¢çŸ¥é“å“ˆå¸Œç®—æ³•ï¼Œå°±å¯ä»¥æ„é€ å‡ºå¤§é‡çš„ key äº§ç”Ÿè¶³å¤Ÿå¤šçš„å“ˆå¸Œç¢°æ’ï¼Œé€ æˆç›®æ ‡ç³»ç»Ÿ DoSã€‚</p>
<p>SipHash å°±æ˜¯ä¸ºäº†å›åº” DoS æ”»å‡»è€Œåˆ›å»ºçš„å“ˆå¸Œç®—æ³•ï¼Œè™½ç„¶å’Œ sha2 è¿™æ ·çš„åŠ å¯†å“ˆå¸Œä¸åŒï¼ˆä¸è¦å°† SipHash ç”¨äºåŠ å¯†ï¼ï¼‰ï¼Œä½†å®ƒå¯ä»¥æä¾›ç±»ä¼¼ç­‰çº§çš„å®‰å…¨æ€§ã€‚æŠŠ SipHash ä½œä¸º HashMap çš„ç¼ºçœçš„å“ˆå¸Œç®—æ³•ï¼ŒRust å¯ä»¥é¿å…å¼€å‘è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢« DoSï¼Œå°±åƒæ›¾ç»åœ¨ Web ä¸–ç•Œå‘ç”Ÿçš„é‚£æ ·ã€‚
å½“ç„¶ï¼Œè¿™ä¸€åˆ‡çš„ä»£ä»·æ˜¯æ€§èƒ½æŸè€—ï¼Œè™½ç„¶ SipHash éå¸¸å¿«ï¼Œä½†å®ƒæ¯” hashbrown ç¼ºçœä½¿ç”¨çš„ Ahash æ…¢äº†ä¸å°‘ã€‚å¦‚æœä½ ç¡®å®šä½¿ç”¨çš„ HashMap ä¸éœ€è¦ DoS é˜²æŠ¤ï¼ˆæ¯”å¦‚ä¸€ä¸ªå®Œå…¨å†…éƒ¨ä½¿ç”¨çš„ HashMapï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ Ahash æ¥æ›¿æ¢ã€‚ä½ åªéœ€è¦ä½¿ç”¨ Ahash æä¾›çš„ RandomState å³å¯ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use ahash::{AHasher, RandomState};
use std::collections::HashMap;
let mut map: HashMap&lt;char, i32, RandomState&gt; = HashMap::default();
map.insert('a', 1);
</code></pre></pre>
</div>
</details>

            </main>

            <!--            <script src="https://utteranc.es/client.js"-->
            <!--                    repo="RustMagazine/rust_magazine_2022"-->
            <!--                    issue-term="title"-->
            <!--                    theme="github-light"-->
            <!--                    crossorigin="anonymous"-->
            <!--                    async></script>-->

            <nav class="nav-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->
                    <a rel="prev" href="3_1_smart_pointer.html" class="mobile-nav-chapters previous"
                       title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="3_3_error_handling.html" class="mobile-nav-chapters next"
                       title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                <div style="clear: both"></div>
            </nav>
        </div>
    </div>

    <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="3_1_smart_pointer.html" class="nav-chapters previous" title="Previous chapter"
               aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="3_3_error_handling.html" class="nav-chapters next" title="Next chapter"
               aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
    </nav>

</div>



    <script type="text/javascript">
        window.playground_line_numbers = true;
    </script>

    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

<script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="highlight.js" type="text/javascript" charset="utf-8"></script>
<script src="book.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JS scripts -->
    <script type="text/javascript" src="assets/mermaid/mermaid.min.js"></script>
    <script type="text/javascript" src="assets/mermaid/mermaid-init.js"></script>
    <script type="text/javascript" src="assets/smart-anchor.js"></script>
    <script type="text/javascript" src="assets/pagetoc/sidebar.js"></script>

</body>
</html>
