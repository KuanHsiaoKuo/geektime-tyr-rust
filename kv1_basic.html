<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js rust">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>åŸºæœ¬æµç¨‹ - Anatomy In First Rust Programming Class ğŸ¦€</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="ä»¥rustç¼–ç¨‹ç¬¬ä¸€è¯¾çš„ä»£ç ä¸ºä¾‹è¿›è¡ŒåŸºç¡€ä»£ç åˆ†æ">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="md-favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/pagetoc/pagetoc_style.css">
        <link rel="stylesheet" href="assets/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<!-- Provide site root to javascript -->
<script type="text/javascript">
    var path_to_root = "";
    var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
</script>

<!-- Work around some values being stored in localStorage wrapped in quotes -->
<script type="text/javascript">
    try {
        var theme = localStorage.getItem('mdbook-theme');
        var sidebar = localStorage.getItem('mdbook-sidebar');

        if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
        }

        if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
        }
    } catch (e) {
    }
</script>

<!-- Set the theme before any content is loaded, prevents flash -->
<script type="text/javascript">
    var theme;
    try {
        theme = localStorage.getItem('mdbook-theme');
    } catch (e) {
    }
    if (theme === null || theme === undefined) {
        theme = default_theme;
    }
    var html = document.querySelector('html');
    html.classList.remove('no-js')
    html.classList.remove('rust')
    html.classList.add(theme);
    html.classList.add('js');
</script>

<!-- Hide / unhide sidebar before it is displayed -->
<script type="text/javascript">
    var html = document.querySelector('html');
    var sidebar = 'hidden';
    if (document.body.clientWidth >= 1080) {
        try {
            sidebar = localStorage.getItem('mdbook-sidebar');
        } catch (e) {
        }
        sidebar = sidebar || 'visible';
    }
    html.classList.remove('sidebar-visible');
    html.classList.add("sidebar-" + sidebar);
</script>

<nav id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar-scrollbox">
        <ol class="chapter"><li class="chapter-item expanded "><a href="anatomy_logic.html"><strong aria-hidden="true">1.</strong> æºç é˜…è¯»é€»è¾‘</a></li><li class="chapter-item expanded "><a href="intro_gdb_lldb.html"><strong aria-hidden="true">2.</strong> gdb/lldbè°ƒè¯•æˆ–æŸ¥çœ‹å†…å­˜ç»“æ„</a></li><li class="chapter-item expanded "><a href="get_hands_dirty.html"><strong aria-hidden="true">3.</strong> get hands dirty</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="httpie.html"><strong aria-hidden="true">3.1.</strong> httpie</a></li><li class="chapter-item expanded "><a href="rgrep.html"><strong aria-hidden="true">3.2.</strong> rgrep</a></li><li class="chapter-item expanded "><a href="thumbor.html"><strong aria-hidden="true">3.3.</strong> thumbor</a></li><li class="chapter-item expanded "><a href="queryer.html"><strong aria-hidden="true">3.4.</strong> queryer</a></li></ol></li><li class="chapter-item expanded "><a href="rust_cores.html"><strong aria-hidden="true">4.</strong> Rustæ ¸å¿ƒæ·±å…¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1_stack_heap_ownership_lifetime_memory.html"><strong aria-hidden="true">4.1.</strong> I. ä»æ ˆå †ã€æ‰€æœ‰æƒã€ç”Ÿå‘½å‘¨æœŸå¼€å§‹å†…å­˜ç®¡ç†</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1_1_stack_heap.html"><strong aria-hidden="true">4.1.1.</strong> ä»å †æ ˆå¼€å§‹</a></li><li class="chapter-item expanded "><a href="1_2_programming_basic_concepts.html"><strong aria-hidden="true">4.1.2.</strong> å››å¤§ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ</a></li><li class="chapter-item expanded "><a href="1_3_ownership.html"><strong aria-hidden="true">4.1.3.</strong> æ‰€æœ‰æƒ</a></li><li class="chapter-item expanded "><a href="1_4_lifetime.html"><strong aria-hidden="true">4.1.4.</strong> ç”Ÿå‘½å‘¨æœŸ</a></li><li class="chapter-item expanded "><a href="1_5_go_through.html"><strong aria-hidden="true">4.1.5.</strong> ä»åˆ›å»ºåˆ°æ¶ˆäº¡</a></li></ol></li><li class="chapter-item expanded "><a href="2_type_system.html"><strong aria-hidden="true">4.2.</strong> II. ç±»å‹ç³»ç»Ÿ</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="2_1_type_details.html"><strong aria-hidden="true">4.2.1.</strong> ç±»å‹ç³»ç»Ÿç‰¹ç‚¹</a></li><li class="chapter-item expanded "><a href="2_2_generic.html"><strong aria-hidden="true">4.2.2.</strong> æ³›å‹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="2_2_1_generic_basic.html"><strong aria-hidden="true">4.2.2.1.</strong> æ³›å‹å°±åƒå‡½æ•°</a></li><li class="chapter-item "><a href="2_2_2_generic_data_structure.html"><strong aria-hidden="true">4.2.2.2.</strong> æ³›å‹æ•°æ®ç»“æ„</a></li><li class="chapter-item "><a href="2_2_3_generic_args.html"><strong aria-hidden="true">4.2.2.3.</strong> æ³›å‹å‚æ•°</a></li><li class="chapter-item "><a href="2_2_4_generic_fn.html"><strong aria-hidden="true">4.2.2.4.</strong> æ³›å‹å‡½æ•°</a></li></ol></li><li class="chapter-item expanded "><a href="2_3_trait.html"><strong aria-hidden="true">4.2.3.</strong> trait</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="2_3_0_trait_overview.html"><strong aria-hidden="true">4.2.3.1.</strong> traitæ¦‚è§ˆ</a></li><li class="chapter-item "><a href="2_3_1_trait_impl.html"><strong aria-hidden="true">4.2.3.2.</strong> Trait Impl</a></li><li class="chapter-item "><a href="2_3_2_trait_object.html"><strong aria-hidden="true">4.2.3.3.</strong> Trait Object</a></li><li class="chapter-item "><a href="2_3_3_trait_frequently.html"><strong aria-hidden="true">4.2.3.4.</strong> å¸¸ç”¨trait</a></li><li class="chapter-item "><a href="2_3_4_trait_design.html"><strong aria-hidden="true">4.2.3.5.</strong> Traitè®¾è®¡</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="3_data_structure.html"><strong aria-hidden="true">4.3.</strong> III. æ•°æ®ç»“æ„</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="3_1_smart_pointer.html"><strong aria-hidden="true">4.3.1.</strong> æ™ºèƒ½æŒ‡é’ˆ</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="3_1_1_box.html"><strong aria-hidden="true">4.3.1.1.</strong> Box</a></li><li class="chapter-item "><a href="3_1_2_cow.html"><strong aria-hidden="true">4.3.1.2.</strong> Cow&lt;'a, B&gt;</a></li><li class="chapter-item "><a href="3_1_3_mutex_guard.html"><strong aria-hidden="true">4.3.1.3.</strong> MutexGuard&lt;'_, T&gt;</a></li></ol></li><li class="chapter-item expanded "><a href="3_2_containers.html"><strong aria-hidden="true">4.3.2.</strong> é›†åˆå®¹å™¨</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="3_2_1_slice.html"><strong aria-hidden="true">4.3.2.1.</strong> åˆ‡ç‰‡</a></li><li class="chapter-item "><a href="3_2_2_hashmap.html"><strong aria-hidden="true">4.3.2.2.</strong> å“ˆå¸Œè¡¨</a></li></ol></li><li class="chapter-item expanded "><a href="3_3_error_handling.html"><strong aria-hidden="true">4.3.3.</strong> é”™è¯¯å¤„ç†</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="3_3_1_error_content.html"><strong aria-hidden="true">4.3.3.1.</strong> é”™è¯¯å¤„ç†å†…å®¹å’Œä¸»æµæ–¹æ³•</a></li><li class="chapter-item "><a href="3_3_2_rust_error_handling.html"><strong aria-hidden="true">4.3.3.2.</strong> Rustå¦‚ä½•å¤„ç†é”™è¯¯</a></li></ol></li><li class="chapter-item expanded "><a href="3_4_closure.html"><strong aria-hidden="true">4.3.4.</strong> é—­åŒ…</a></li></ol></li><li class="chapter-item expanded "><a href="4_macros.html"><strong aria-hidden="true">4.4.</strong> IV. å®ç¼–ç¨‹</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="4_1_macros_classify.html"><strong aria-hidden="true">4.4.1.</strong> å®åˆ†ç±»</a></li><li class="chapter-item expanded "><a href="4_2_declarative_macros.html"><strong aria-hidden="true">4.4.2.</strong> å£°æ˜å®</a></li><li class="chapter-item expanded "><a href="4_3_procedural_macros.html"><strong aria-hidden="true">4.4.3.</strong> è¿‡ç¨‹å®</a></li></ol></li><li class="chapter-item expanded "><a href="5_concurrency_async.html"><strong aria-hidden="true">4.5.</strong> V. å¹¶å‘ä¸å¼‚æ­¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="5_1_concurrency_primitives.html"><strong aria-hidden="true">4.5.1.</strong> å¹¶å‘åŸè¯­(Concurrency Primitives)</a></li><li class="chapter-item expanded "><a href="5_2_future_async_await.html"><strong aria-hidden="true">4.5.2.</strong> å¼‚æ­¥ï¼šFuture/Async/Await</a></li><li class="chapter-item expanded "><a href="5_3_deepin_async_await.html"><strong aria-hidden="true">4.5.3.</strong> æ·±å…¥async/await</a></li></ol></li><li class="chapter-item expanded "><a href="6_unsafe_ffi.html"><strong aria-hidden="true">4.6.</strong> VI. æ··åˆç¼–ç¨‹</a></li></ol></li><li class="chapter-item expanded "><a href="kv_server_design.html"><strong aria-hidden="true">5.</strong> kv serverè®¾è®¡ä¸å®ç°</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="kv1_basic.html" class="active"><strong aria-hidden="true">5.1.</strong> åŸºæœ¬æµç¨‹</a></li><li class="chapter-item expanded "><a href="kv2_protocols.html"><strong aria-hidden="true">5.2.</strong> å®ç°å¹¶éªŒè¯åè®®å±‚</a></li><li class="chapter-item expanded "><a href="kv3_advanced_traits.html"><strong aria-hidden="true">5.3.</strong> é«˜çº§traitæ”¹é€ </a></li><li class="chapter-item expanded "><a href="kv4_network.html"><strong aria-hidden="true">5.4.</strong> ç½‘ç»œå¤„ç†</a></li><li class="chapter-item expanded "><a href="kv5_network_security.html"><strong aria-hidden="true">5.5.</strong> ç½‘ç»œå®‰å…¨</a></li><li class="chapter-item expanded "><a href="kv6_async_refactor.html"><strong aria-hidden="true">5.6.</strong> å¼‚æ­¥æ”¹é€ </a></li><li class="chapter-item expanded "><a href="kv7_big_refactor.html"><strong aria-hidden="true">5.7.</strong> é‡å¤§é‡æ„</a></li><li class="chapter-item expanded "><a href="kv8_config_ci_cd.html"><strong aria-hidden="true">5.8.</strong> é…ç½®ã€æµ‹è¯•ã€ç›‘æ§ã€CI/CD</a></li></ol></li><li class="chapter-item expanded "><a href="custom_axum_async_web_framework.html"><strong aria-hidden="true">6.</strong> æ„å»ºè‡ªå·±çš„ç±»axumå¼‚æ­¥Webæ¡†æ¶</a></li><li class="chapter-item expanded affix "><a href="checklist.html">Checklist</a></li></ol>
    </div>
    <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
</nav>

<div id="page-wrapper" class="page-wrapper">

    <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
        <div id="menu-bar" class="menu-bar sticky bordered">
            <div class="left-buttons">
                <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </button>
                <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                    <i class="fa fa-paint-brush"></i>
                </button>
                <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                    <li role="none">
                        <button role="menuitem" class="theme" id="light">Light</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="rust">Rust (default)</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="coal">Coal</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="navy">Navy</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="ayu">Ayu</button>
                    </li>
                </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
            </div>

            <h1 class="menu-title">Anatomy In First Rust Programming Class ğŸ¦€</h1>
            <h4 class="menu-bar"><a href="https://kuanhsiaokuo.github.io/think-tool-kit/">ä¿æŒæ‰¹åˆ¤ï¼Œæœ‰æ‰€å–èˆï¼ŒçŸ¥è¡Œåˆä¸€, æ–¹è§çœŸæˆ‘</a> -- ç»ƒæ­¦ä¸ç»ƒåŠŸ
                åˆ°å¤´ä¸€åœºç©º -- ã€Šèµ›åšè‹±é›„ä¼ ã€‹ </h4>
            <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/KuanHsiaoKuo/geektime-tyr-rust.git" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-rust"></i>
                    </a>
            </div>
        </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                           placeholder="Search this book ..." aria-controls="searchresults-outer"
                           aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

        <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
        <script type="text/javascript">
            document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
            document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
            Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
            });
        </script>

        <div id="content" class="content">
            <main>

                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <h1 id="ä¸€åŸºæœ¬æµç¨‹"><a class="header" href="#ä¸€åŸºæœ¬æµç¨‹">ä¸€ã€åŸºæœ¬æµç¨‹</a></h1>
<!--ts-->
<ul>
<li><a href="#%E4%B8%80%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B">ä¸€ã€åŸºæœ¬æµç¨‹</a>
<ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89-kv-server-%E6%9D%A5%E5%AE%9E%E6%93%8D%E5%91%A2">ä¸ºä»€ä¹ˆé€‰ KV server æ¥å®æ“å‘¢ï¼Ÿ</a></li>
<li><a href="#%E5%85%88%E6%9D%A5%E4%B8%80%E4%B8%AA%E7%9F%AD%E5%B9%B3%E7%B3%99%E7%9A%84%E5%AE%9E%E7%8E%B0">å…ˆæ¥ä¸€ä¸ªçŸ­å¹³ç³™çš„å®ç°</a></li>
<li><a href="#%E6%9E%B6%E6%9E%84%E5%92%8C%E8%AE%BE%E8%AE%A1">æ¶æ„å’Œè®¾è®¡</a>
<ul>
<li><a href="#%E4%B8%BB%E4%BD%93%E4%BA%A4%E4%BA%92%E6%8E%A5%E5%8F%A3">ä¸»ä½“äº¤äº’æ¥å£</a></li>
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%97%B4%E7%9A%84%E5%8D%8F%E8%AE%AE">å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´çš„åè®®</a>
<ul>
<li><a href="#commandservice-trait">CommandService trait</a></li>
</ul>
</li>
<li><a href="#storage-trait">Storage trait</a></li>
<li><a href="#trait%E7%9A%84%E5%A5%BD%E5%A4%84">traitçš„å¥½å¤„</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Thu Oct 20 09:34:43 UTC 2022 -->
<!--te-->
<h2 id="ä¸ºä»€ä¹ˆé€‰-kv-server-æ¥å®æ“å‘¢"><a class="header" href="#ä¸ºä»€ä¹ˆé€‰-kv-server-æ¥å®æ“å‘¢">ä¸ºä»€ä¹ˆé€‰ KV server æ¥å®æ“å‘¢ï¼Ÿ</a></h2>
<p>å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªè¶³å¤Ÿç®€å•åˆè¶³å¤Ÿå¤æ‚çš„æœåŠ¡ã€‚</p>
<details id="admonition-åŸºç¡€éœ€æ±‚æ¢³ç†" class="admonition info">
<summary class="admonition-title">
<p>åŸºç¡€éœ€æ±‚æ¢³ç† </p>
<p><a class="admonition-anchor-link" href="#admonition-åŸºç¡€éœ€æ±‚æ¢³ç†"></a></p>
</summary>
<div>
<p>å‚è€ƒå·¥ä½œä¸­ç”¨åˆ°çš„ Redis / Memcached ç­‰æœåŠ¡ï¼Œæ¥æ¢³ç†å®ƒçš„éœ€æ±‚:</p>
<ol>
<li>
<p>æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯æ ¹æ®ä¸åŒçš„å‘½ä»¤è¿›è¡Œè¯¸å¦‚æ•°æ®å­˜è´®ã€è¯»å–ã€ç›‘å¬ç­‰æ“ä½œï¼›</p>
</li>
<li>
<p>è€Œå®¢æˆ·ç«¯è¦èƒ½é€šè¿‡ç½‘ç»œè®¿é—® KV serverï¼Œå‘é€åŒ…å«å‘½ä»¤çš„è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœï¼›</p>
</li>
<li>
<p>æ•°æ®è¦èƒ½æ ¹æ®éœ€è¦ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­æˆ–è€…æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šã€‚</p>
</li>
</ol>
</div>
</details>
<h2 id="å…ˆæ¥ä¸€ä¸ªçŸ­å¹³ç³™çš„å®ç°"><a class="header" href="#å…ˆæ¥ä¸€ä¸ªçŸ­å¹³ç³™çš„å®ç°">å…ˆæ¥ä¸€ä¸ªçŸ­å¹³ç³™çš„å®ç°</a></h2>
<p>å¦‚æœæ˜¯ä¸ºäº†å®Œæˆä»»åŠ¡æ„å»º KV serverï¼Œå…¶å®æœ€åˆçš„ç‰ˆæœ¬ä¸¤ä¸‰ç™¾è¡Œä»£ç å°±å¯ä»¥æå®šï¼Œä½†æ˜¯è¿™æ ·çš„ä»£ç ä»¥åç»´æŠ¤èµ·æ¥å°±æ˜¯ç¾éš¾ã€‚</p>
<details id="admonition-ä¾‹å­--ä¸€ä¸ªè¿‡ç¨‹å¼çš„æ„å¤§åˆ©ç‰ˆæœ¬" class="admonition example">
<summary class="admonition-title">
<p>ä¾‹å­:  ä¸€ä¸ªè¿‡ç¨‹å¼çš„æ„å¤§åˆ©ç‰ˆæœ¬ </p>
<p><a class="admonition-anchor-link" href="#admonition-ä¾‹å­--ä¸€ä¸ªè¿‡ç¨‹å¼çš„æ„å¤§åˆ©ç‰ˆæœ¬"></a></p>
</summary>
<div>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸ªçœå´äº†ä¸å°‘ç»†èŠ‚çš„æ„å¤§åˆ©é¢æ¡å¼çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥éšç€æˆ‘çš„æ³¨é‡Šé‡ç‚¹çœ‹æµç¨‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
use anyhow::Result;
use async_prost::AsyncProstStream;
use dashmap::DashMap;
use futures::prelude::*;
use kv::{
    command_request::RequestData, CommandRequest, CommandResponse, Hset, KvError, Kvpair, Value,
};
use std::sync::Arc;
use tokio::net::TcpListener;
use tracing::info;

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
    // åˆå§‹åŒ–æ—¥å¿—
    tracing_subscriber::fmt::init();

    let addr = &quot;127.0.0.1:9527&quot;;
    let listener = TcpListener::bind(addr).await?;
    info!(&quot;Start listening on {}&quot;, addr);

    // ä½¿ç”¨ DashMap åˆ›å»ºæ”¾åœ¨å†…å­˜ä¸­çš„ kv store
    let table: Arc&lt;DashMap&lt;String, Value&gt;&gt; = Arc::new(DashMap::new());

    loop {
        // å¾—åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚
        let (stream, addr) = listener.accept().await?;
        info!(&quot;Client {:?} connected&quot;, addr);

        // å¤åˆ¶ dbï¼Œè®©å®ƒåœ¨ tokio ä»»åŠ¡ä¸­å¯ä»¥ä½¿ç”¨
        let db = table.clone();

        // åˆ›å»ºä¸€ä¸ª tokio ä»»åŠ¡å¤„ç†è¿™ä¸ªå®¢æˆ·ç«¯
        tokio::spawn(async move {
            // ä½¿ç”¨ AsyncProstStream æ¥å¤„ç† TCP Frame
            // Frame: ä¸¤å­—èŠ‚ frame é•¿åº¦ï¼Œåé¢æ˜¯ protobuf äºŒè¿›åˆ¶
            let mut stream =
                AsyncProstStream::&lt;_, CommandRequest, CommandResponse, _&gt;::from(stream).for_async();

            // ä» stream é‡Œå–ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼ˆæ‹¿å‡ºæ¥åå·²ç»è‡ªåŠ¨ decode äº†ï¼‰
            while let Some(Ok(msg)) = stream.next().await {
                info!(&quot;Got a new command: {:?}&quot;, msg);
                let resp: CommandResponse = match msg.request_data {
                    // ä¸ºæ¼”ç¤ºæˆ‘ä»¬å°±å¤„ç† HSET
                    Some(RequestData::Hset(cmd)) =&gt; hset(cmd, &amp;db),
                    // å…¶å®ƒæš‚ä¸å¤„ç†
                    _ =&gt; unimplemented!(),
                };

                info!(&quot;Got response: {:?}&quot;, resp);
                // æŠŠ CommandResponse å‘é€ç»™å®¢æˆ·ç«¯
                stream.send(resp).await.unwrap();
            }
        });
    }
}

// å¤„ç† hset å‘½ä»¤
fn hset(cmd: Hset, db: &amp;DashMap&lt;String, Value&gt;) -&gt; CommandResponse {
    match cmd.pair {
        Some(Kvpair {
            key,
            value: Some(v),
        }) =&gt; {
            // å¾€ db é‡Œå†™å…¥
            let old = db.insert(key, v).unwrap_or_default();
            // æŠŠ value è½¬æ¢æˆ CommandResponse
            old.into()
        }
        v =&gt; KvError::InvalidCommand(format!(&quot;hset: {:?}&quot;, v)).into(),
    }
}
</code></pre></pre>
<blockquote>
<p>è¿™æ®µä»£ç éå¸¸åœ°å¹³é“ºç›´å™ï¼Œä»è¾“å…¥åˆ°è¾“å‡ºï¼Œä¸€è¹´è€Œå°±ï¼Œå¦‚æœè¿™æ ·å†™ï¼Œä»»åŠ¡ç¡®å®èƒ½å¾ˆå¿«å®Œæˆï¼Œä½†æ˜¯å®ƒæœ‰ç§â€œå®Œæˆä¹‹åï¼Œå“ªç®¡æ´ªæ°´æ»”å¤©â€çš„æ„Ÿè§‰ã€‚</p>
</blockquote>
<p>ä½ å¤åˆ¶ä»£ç åï¼Œæ‰“å¼€ä¸¤ä¸ªçª—å£ï¼Œåˆ†åˆ«è¿è¡Œ </p>
<pre><code class="language-shell">cargo run --example naive_server
</code></pre>
<p>å’Œ </p>
<pre><code class="language-shell">cargo run --example client
</code></pre>
<p>å°±å¯ä»¥çœ‹åˆ°è¿è¡Œ server çš„çª—å£æœ‰å¦‚ä¸‹æ‰“å°ï¼š</p>
<pre><code class="language-shell">
Sep 19 22:25:34.016  INFO naive_server: Start listening on 127.0.0.1:9527
Sep 19 22:25:38.401  INFO naive_server: Client 127.0.0.1:51650 connected
Sep 19 22:25:38.401  INFO naive_server: Got a new command: CommandRequest { request_data: Some(Hset(Hset { table: &quot;table1&quot;, pair: Some(Kvpair { key: &quot;hello&quot;, value: Some(Value { value: Some(String(&quot;world&quot;)) }) }) })) }
Sep 19 22:25:38.401  INFO naive_server: Got response: CommandResponse { status: 200, message: &quot;&quot;, values: [Value { value: None }], pairs: [] }
</code></pre>
</div>
</details>
<details id="admonition-è­¦å‘Š-è€¦åˆä¸¥é‡" class="admonition warning">
<summary class="admonition-title">
<p>è­¦å‘Šâš ï¸ï¼š è€¦åˆä¸¥é‡ </p>
<p><a class="admonition-anchor-link" href="#admonition-è­¦å‘Š-è€¦åˆä¸¥é‡"></a></p>
</summary>
<div>
<p>è™½ç„¶æ•´ä½“åŠŸèƒ½ç®—æ˜¯æå®šäº†ï¼Œä¸è¿‡ä»¥åæƒ³ç»§ç»­ä¸ºè¿™ä¸ª KV server å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œå°±éœ€è¦æ¥æ¥å›å›æ”¹è¿™æ®µä»£ç ã€‚</p>
<p>æ­¤å¤–ï¼Œä¹Ÿä¸å¥½åšå•å…ƒæµ‹è¯•ï¼Œå› ä¸ºæ‰€æœ‰çš„é€»è¾‘éƒ½è¢«å‹ç¼©åœ¨ä¸€èµ·äº†ï¼Œæ²¡æœ‰â€œå•å…ƒâ€å¯è¨€ã€‚è™½ç„¶æœªæ¥å¯ä»¥é€æ­¥æŠŠä¸åŒçš„é€»è¾‘åˆ†ç¦»åˆ°ä¸åŒçš„å‡½æ•°ï¼Œä½¿ä¸»æµç¨‹å°½å¯èƒ½ç®€å•ä¸€äº›ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä¾æ—§æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œå¦‚æœä¸åšå¤§çš„é‡æ„ï¼Œè¿˜æ˜¯è§£å†³ä¸äº†å®è´¨çš„é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥ä¸ç®¡ç”¨ä»€ä¹ˆè¯­è¨€å¼€å‘ï¼Œè¿™æ ·çš„ä»£ç éƒ½æ˜¯æˆ‘ä»¬è¦æåŠ›é¿å…çš„ï¼Œä¸å…‰è‡ªå·±ä¸è¦è¿™ä¹ˆå†™ï¼Œcode review é‡åˆ°åˆ«äººè¿™ä¹ˆå†™ä¹Ÿè¦ä¸¥æ ¼åœ°æªå‡ºæ¥ã€‚</p>
</div>
</details>
<h2 id="æ¶æ„å’Œè®¾è®¡"><a class="header" href="#æ¶æ„å’Œè®¾è®¡">æ¶æ„å’Œè®¾è®¡</a></h2>
<details id="admonition-é‚£ä¹ˆæ€æ ·æ‰ç®—æ˜¯å¥½çš„å®ç°å‘¢" class="admonition success">
<summary class="admonition-title">
<p>é‚£ä¹ˆï¼Œæ€æ ·æ‰ç®—æ˜¯å¥½çš„å®ç°å‘¢ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-é‚£ä¹ˆæ€æ ·æ‰ç®—æ˜¯å¥½çš„å®ç°å‘¢"></a></p>
</summary>
<div>
<p>å¥½çš„å®ç°åº”è¯¥æ˜¯:</p>
<ol>
<li>åœ¨åˆ†æå®Œéœ€æ±‚åï¼Œé¦–å…ˆä»ç³»ç»Ÿçš„ä¸»æµç¨‹å¼€å§‹ï¼Œææ¸…æ¥šä»å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ°æœ€ç»ˆå®¢æˆ·ç«¯æ”¶åˆ°å“åº”ï¼Œéƒ½ä¼šç»è¿‡å“ªäº›ä¸»è¦çš„æ­¥éª¤ï¼›</li>
<li>ç„¶åæ ¹æ®è¿™äº›æ­¥éª¤ï¼Œæ€è€ƒå“ªäº›ä¸œè¥¿éœ€è¦å»¶è¿Ÿç»‘å®šï¼Œæ„å»ºä¸»è¦çš„æ¥å£å’Œ traitï¼›</li>
<li>ç­‰è¿™äº›ä¸œè¥¿æ·±æ€ç†Ÿè™‘ä¹‹åï¼Œæœ€åå†è€ƒè™‘å®ç°ã€‚ä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œè°‹å®šè€ŒååŠ¨â€ã€‚</li>
</ol>
</div>
</details>
<details id="admonition-ä¸»æµç¨‹æ¢³ç†å›¾" class="admonition info">
<summary class="admonition-title">
<p>ä¸»æµç¨‹æ¢³ç†å›¾ </p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸»æµç¨‹æ¢³ç†å›¾"></a></p>
</summary>
<div>
<p>å¼€å¤´å·²ç»åˆ†æ KV server è¿™ä¸ªéœ€æ±‚ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ¢³ç†ä¸»æµç¨‹ã€‚</p>
<p>ä½ å¯ä»¥å…ˆè‡ªå·±æƒ³æƒ³ï¼Œå†å‚è€ƒç¤ºæ„å›¾çœ‹çœ‹æœ‰æ²¡æœ‰ç¼ºæ¼ï¼š</p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/67894066ecedd65897d5644f949b8cdc.jpg" alt="img" /></p>
</div>
</details>
<details id="admonition-ç¬”è®°è¿™ä¸ªæµç¨‹ä¸­æœ‰ä¸€äº›å…³é”®é—®é¢˜éœ€è¦è¿›ä¸€æ­¥æ¢ç´¢" class="admonition note">
<summary class="admonition-title">
<p>ç¬”è®°ï¼šè¿™ä¸ªæµç¨‹ä¸­æœ‰ä¸€äº›å…³é”®é—®é¢˜éœ€è¦è¿›ä¸€æ­¥æ¢ç´¢ </p>
<p><a class="admonition-anchor-link" href="#admonition-ç¬”è®°è¿™ä¸ªæµç¨‹ä¸­æœ‰ä¸€äº›å…³é”®é—®é¢˜éœ€è¦è¿›ä¸€æ­¥æ¢ç´¢"></a></p>
</summary>
<div>
<ol>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç”¨ä»€ä¹ˆåè®®é€šä¿¡ï¼ŸTCPï¼ŸgRPCï¼ŸHTTPï¼Ÿæ”¯æŒä¸€ç§è¿˜æ˜¯å¤šç§ï¼Ÿ</li>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤äº’çš„åº”ç”¨å±‚åè®®å¦‚ä½•å®šä¹‰ï¼Ÿæ€ä¹ˆåšåºåˆ—åŒ– / ååºåˆ—åŒ–ï¼Ÿæ˜¯ç”¨ Protobufã€JSON è¿˜æ˜¯ Redis RESPï¼Ÿæˆ–è€…ä¹Ÿå¯ä»¥æ”¯æŒå¤šç§ï¼Ÿ</li>
<li>å…·ä½“çš„å¤„ç†é€»è¾‘ä¸­ï¼Œéœ€ä¸éœ€è¦åŠ  hookï¼Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­å‘å¸ƒä¸€äº›äº‹ä»¶ï¼Œè®©å…¶ä»–æµç¨‹å¯ä»¥å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œé¢å¤–çš„å¤„ç†ï¼Ÿè¿™äº› hook å¯ä¸å¯ä»¥æå‰ç»ˆæ­¢æ•´ä¸ªæµç¨‹çš„å¤„ç†ï¼Ÿ</li>
<li>å¯¹äºå­˜å‚¨ï¼Œè¦æ”¯æŒä¸åŒçš„å­˜å‚¨å¼•æ“ä¹ˆï¼Ÿæ¯”å¦‚ MemDBï¼ˆå†…å­˜ï¼‰ã€RocksDBï¼ˆç£ç›˜ï¼‰ã€SledDBï¼ˆç£ç›˜ï¼‰ç­‰ã€‚å¯¹äº MemDBï¼Œæˆ‘ä»¬è€ƒè™‘æ”¯æŒ WALï¼ˆWrite-Ahead Logï¼‰ å’Œ snapshot ä¹ˆï¼Ÿ</li>
<li>æ•´ä¸ªç³»ç»Ÿå¯ä»¥é…ç½®ä¹ˆï¼Ÿæ¯”å¦‚æœåŠ¡ä½¿ç”¨å“ªä¸ªç«¯å£ã€å“ªä¸ªå­˜å‚¨å¼•æ“ï¼Ÿ</li>
</ol>
</div>
</details>
<blockquote>
<p>å¦‚æœä½ æƒ³åšå¥½æ¶æ„ï¼Œé‚£ä¹ˆï¼Œé—®å‡ºè¿™äº›é—®é¢˜ï¼Œå¹¶ä¸”æ‰¾åˆ°è¿™äº›é—®é¢˜çš„ç­”æ¡ˆå°±å¾ˆé‡è¦ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œé¢å¾ˆå¤šé—®é¢˜äº§å“ç»ç†å¹¶ä¸èƒ½å¸®ä½ å›ç­”ï¼Œæˆ–è€… TA çš„å›ç­”ä¼šå°†ä½ å¸¦å…¥æ­§è·¯ã€‚ä½œä¸ºä¸€ä¸ªæ¶æ„å¸ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç³»ç»Ÿæœªæ¥å¦‚ä½•åº”å¯¹å˜åŒ–è´Ÿè´£ã€‚</p>
</blockquote>
<details id="admonition-ä¸‹é¢æ˜¯æˆ‘çš„æ€è€ƒä½ å¯ä»¥å‚è€ƒ" class="admonition example">
<summary class="admonition-title">
<p>ä¸‹é¢æ˜¯æˆ‘çš„æ€è€ƒï¼Œä½ å¯ä»¥å‚è€ƒï¼š </p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸‹é¢æ˜¯æˆ‘çš„æ€è€ƒä½ å¯ä»¥å‚è€ƒ"></a></p>
</summary>
<div>
<ol>
<li>
<p>åƒ KV server è¿™æ ·éœ€è¦é«˜æ€§èƒ½çš„åœºæ™¯ï¼Œé€šä¿¡åº”è¯¥ä¼˜å…ˆè€ƒè™‘ TCP åè®®ã€‚æ‰€ä»¥æˆ‘ä»¬æš‚æ—¶åªæ”¯æŒ TCPï¼Œæœªæ¥å¯ä»¥æ ¹æ®éœ€è¦æ”¯æŒæ›´å¤šçš„åè®®ï¼Œå¦‚ HTTP2/gRPCã€‚è¿˜æœ‰ï¼Œæœªæ¥å¯èƒ½å¯¹å®‰å…¨æ€§æœ‰é¢å¤–çš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿è¯ TLS è¿™æ ·çš„å®‰å…¨åè®®å¯ä»¥å³æ’å³ç”¨ã€‚æ€»ä¹‹ï¼Œç½‘ç»œå±‚éœ€è¦çµæ´»ã€‚</p>
</li>
<li>
<p>åº”ç”¨å±‚åè®®æˆ‘ä»¬å¯ä»¥ç”¨ protobuf å®šä¹‰ã€‚protobuf ç›´æ¥è§£å†³äº†åè®®çš„å®šä¹‰ä»¥åŠå¦‚ä½•åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚Redis çš„ RESP å›ºç„¶ä¸é”™ï¼Œä½†å®ƒçš„çŸ­æ¿ä¹Ÿæ˜¾è€Œæ˜“è§ï¼Œå‘½ä»¤éœ€è¦é¢å¤–çš„è§£æï¼Œè€Œä¸”å¤§é‡çš„ \r\n æ¥åˆ†éš”å‘½ä»¤æˆ–è€…æ•°æ®ï¼Œä¹Ÿæœ‰äº›æµªè´¹å¸¦å®½ã€‚ä½¿ç”¨ JSON çš„è¯æ›´åŠ æµªè´¹å¸¦å®½ï¼Œä¸” JSON çš„è§£ææ•ˆç‡ä¸é«˜ï¼Œå°¤å…¶æ˜¯æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ã€‚</p>
</li>
</ol>
<p>protobuf å°±å¾ˆé€‚åˆ KV server è¿™æ ·çš„åœºæ™¯ï¼Œçµæ´»ã€å¯å‘åå…¼å®¹å¼å‡çº§ã€è§£ææ•ˆç‡å¾ˆé«˜ã€ç”Ÿæˆçš„äºŒè¿›åˆ¶éå¸¸çœå¸¦å®½ï¼Œå”¯ä¸€çš„ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–çš„å·¥å…· protoc æ¥ç¼–è¯‘æˆä¸åŒçš„è¯­è¨€ã€‚è™½ç„¶ protobuf æ˜¯é¦–é€‰ï¼Œä½†ä¹Ÿè®¸æœªæ¥ä¸ºäº†å’Œ Redis å®¢æˆ·ç«¯äº’é€šï¼Œè¿˜æ˜¯è¦æ”¯æŒ RESPã€‚</p>
<ol start="3">
<li>
<p>æœåŠ¡å™¨æ”¯æŒçš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥å‚è€ƒRedis çš„å‘½ä»¤é›†ã€‚ç¬¬ä¸€ç‰ˆå…ˆæ¥æ”¯æŒ HXXX å‘½ä»¤ï¼Œæ¯”å¦‚ HSETã€HMSETã€HGETã€HMGET ç­‰ã€‚ä»å‘½ä»¤åˆ°å‘½ä»¤çš„å“åº”ï¼Œå¯ä»¥åšä¸ª trait æ¥æŠ½è±¡ã€‚</p>
</li>
<li>
<p>å¤„ç†æµç¨‹ä¸­è®¡åˆ’åŠ è¿™äº› hookï¼šæ”¶åˆ°å®¢æˆ·ç«¯çš„å‘½ä»¤å OnRequestReceivedã€å¤„ç†å®Œå®¢æˆ·ç«¯çš„å‘½ä»¤å OnRequestExecutedã€å‘é€å“åº”ä¹‹å‰ BeforeResponseSendã€å‘é€å“åº”ä¹‹å AfterResponseSendã€‚è¿™æ ·ï¼Œå¤„ç†è¿‡ç¨‹ä¸­çš„ä¸»è¦æ­¥éª¤éƒ½æœ‰äº‹ä»¶æš´éœ²å‡ºå»ï¼Œè®©æˆ‘ä»¬çš„ KV server å¯ä»¥éå¸¸çµæ´»ï¼Œæ–¹ä¾¿è°ƒç”¨è€…åœ¨åˆå§‹åŒ–æœåŠ¡çš„æ—¶å€™æ³¨å…¥é¢å¤–çš„å¤„ç†é€»è¾‘ã€‚</p>
</li>
<li>
<p>å­˜å‚¨å¿…ç„¶éœ€è¦è¶³å¤Ÿçµæ´»ã€‚å¯ä»¥å¯¹å­˜å‚¨åšä¸ª trait æ¥æŠ½è±¡å…¶åŸºæœ¬çš„è¡Œä¸ºï¼Œä¸€å¼€å§‹å¯ä»¥å°±åªåš MemDBï¼Œæœªæ¥è‚¯å®šéœ€è¦æœ‰æ”¯æŒæŒä¹…åŒ–çš„å­˜å‚¨ã€‚</p>
</li>
<li>
<p>éœ€è¦æ”¯æŒé…ç½®ï¼Œä½†ä¼˜å…ˆçº§ä¸é«˜ã€‚ç­‰åŸºæœ¬æµç¨‹æå®šï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°è¶³å¤Ÿçš„ç—›ç‚¹ï¼Œå°±å¯ä»¥è€ƒè™‘é…ç½®æ–‡ä»¶å¦‚ä½•å¤„ç†äº†ã€‚</p>
</li>
</ol>
<p>å½“è¿™äº›é—®é¢˜éƒ½æ•²å®šä¸‹æ¥ï¼Œç³»ç»Ÿçš„åŸºæœ¬æ€è·¯å°±æœ‰äº†ã€‚</p>
</div>
</details>
<h3 id="ä¸»ä½“äº¤äº’æ¥å£"><a class="header" href="#ä¸»ä½“äº¤äº’æ¥å£">ä¸»ä½“äº¤äº’æ¥å£</a></h3>
<p>æˆ‘ä»¬å¯ä»¥å…ˆæŠŠå‡ ä¸ªé‡è¦çš„æ¥å£å®šä¹‰å‡ºæ¥ï¼Œç„¶åä»”ç»†å®¡è§†è¿™äº›æ¥å£ã€‚</p>
<details id="admonition-ç¬”è®°æœ€é‡è¦çš„å‡ ä¸ªæ¥å£å°±æ˜¯ä¸‰ä¸ªä¸»ä½“äº¤äº’çš„æ¥å£" class="admonition note">
<summary class="admonition-title">
<p>ç¬”è®°ï¼šæœ€é‡è¦çš„å‡ ä¸ªæ¥å£å°±æ˜¯ä¸‰ä¸ªä¸»ä½“äº¤äº’çš„æ¥å£</p>
<p><a class="admonition-anchor-link" href="#admonition-ç¬”è®°æœ€é‡è¦çš„å‡ ä¸ªæ¥å£å°±æ˜¯ä¸‰ä¸ªä¸»ä½“äº¤äº’çš„æ¥å£"></a></p>
</summary>
<div>
<ul>
<li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ¥å£æˆ–è€…è¯´åè®®</li>
<li>æœåŠ¡å™¨å’Œå‘½ä»¤å¤„ç†æµç¨‹çš„æ¥å£</li>
<li>æœåŠ¡å™¨å’Œå­˜å‚¨çš„æ¥å£ã€‚</li>
</ul>
</div>
</details>
<h3 id="å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´çš„åè®®"><a class="header" href="#å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´çš„åè®®">å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´çš„åè®®</a></h3>
<details id="admonition-é¦–å…ˆæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åè®®" class="admonition note">
<summary class="admonition-title">
<p>é¦–å…ˆæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åè®®ã€‚</p>
<p><a class="admonition-anchor-link" href="#admonition-é¦–å…ˆæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åè®®"></a></p>
</summary>
<div>
<p>æ¥è¯•ç€ç”¨ protobuf å®šä¹‰ä¸€ä¸‹æˆ‘ä»¬ç¬¬ä¸€ç‰ˆæ”¯æŒçš„å®¢æˆ·ç«¯å‘½ä»¤ï¼š</p>
<pre><code class="language-protobuf">
syntax = &quot;proto3&quot;;

package abi;

// æ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚
message CommandRequest {
  oneof request_data {
    Hget hget = 1;
    Hgetall hgetall = 2;
    Hmget hmget = 3;
    Hset hset = 4;
    Hmset hmset = 5;
    Hdel hdel = 6;
    Hmdel hmdel = 7;
    Hexist hexist = 8;
    Hmexist hmexist = 9;
  }
}

// æœåŠ¡å™¨çš„å“åº”
message CommandResponse {
  // çŠ¶æ€ç ï¼›å¤ç”¨ HTTP 2xx/4xx/5xx çŠ¶æ€ç 
  uint32 status = 1;
  // å¦‚æœä¸æ˜¯ 2xxï¼Œmessage é‡ŒåŒ…å«è¯¦ç»†çš„ä¿¡æ¯
  string message = 2;
  // æˆåŠŸè¿”å›çš„ values
  repeated Value values = 3;
  // æˆåŠŸè¿”å›çš„ kv pairs
  repeated Kvpair pairs = 4;
}

// ä» table ä¸­è·å–ä¸€ä¸ª keyï¼Œè¿”å› value
message Hget {
  string table = 1;
  string key = 2;
}

// ä» table ä¸­è·å–æ‰€æœ‰çš„ Kvpair
message Hgetall { string table = 1; }

// ä» table ä¸­è·å–ä¸€ç»„ keyï¼Œè¿”å›å®ƒä»¬çš„ value
message Hmget {
  string table = 1;
  repeated string keys = 2;
}

// è¿”å›çš„å€¼
message Value {
  oneof value {
    string string = 1;
    bytes binary = 2;
    int64 integer = 3;
    double float = 4;
    bool bool = 5;
  }
}

// è¿”å›çš„ kvpair
message Kvpair {
  string key = 1;
  Value value = 2;
}

// å¾€ table é‡Œå­˜ä¸€ä¸ª kvpairï¼Œ
// å¦‚æœ table ä¸å­˜åœ¨å°±åˆ›å»ºè¿™ä¸ª table
message Hset {
  string table = 1;
  Kvpair pair = 2;
}

// å¾€ table ä¸­å­˜ä¸€ç»„ kvpairï¼Œ
// å¦‚æœ table ä¸å­˜åœ¨å°±åˆ›å»ºè¿™ä¸ª table
message Hmset {
  string table = 1;
  repeated Kvpair pairs = 2;
}

// ä» table ä¸­åˆ é™¤ä¸€ä¸ª keyï¼Œè¿”å›å®ƒä¹‹å‰çš„å€¼
message Hdel {
  string table = 1;
  string key = 2;
}

// ä» table ä¸­åˆ é™¤ä¸€ç»„ keyï¼Œè¿”å›å®ƒä»¬ä¹‹å‰çš„å€¼
message Hmdel {
  string table = 1;
  repeated string keys = 2;
}

// æŸ¥çœ‹ key æ˜¯å¦å­˜åœ¨
message Hexist {
  string table = 1;
  string key = 2;
}

// æŸ¥çœ‹ä¸€ç»„ key æ˜¯å¦å­˜åœ¨
message Hmexist {
  string table = 1;
  repeated string keys = 2;
}
</code></pre>
</div>
</details>
<blockquote>
<p>é€šè¿‡ <a href="https://github.com/tokio-rs/prost">prost</a>ï¼Œè¿™ä¸ª protobuf æ–‡ä»¶å¯ä»¥è¢«ç¼–è¯‘æˆ Rust ä»£ç ï¼ˆä¸»è¦æ˜¯ struct å’Œ enumï¼‰ï¼Œä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ä½ åº”è¯¥è¿˜è®°å¾—ï¼Œthumbor
çš„å¼€å‘æ—¶ï¼Œå·²ç»è§è¯†åˆ°äº† prost å¤„ç† protobuf çš„æ–¹å¼äº†ã€‚</p>
</blockquote>
<h4 id="commandservice-trait"><a class="header" href="#commandservice-trait">CommandService trait</a></h4>
<p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é—´çš„åè®®æ•²å®šä¹‹åï¼Œå°±è¦æ€è€ƒå¦‚ä½•å¤„ç†è¯·æ±‚çš„å‘½ä»¤ï¼Œè¿”å›å“åº”ã€‚</p>
<ol>
<li>
<p>æˆ‘ä»¬ç›®å‰æ‰“ç®—æ”¯æŒ 9 ç§å‘½ä»¤ï¼Œæœªæ¥å¯èƒ½æ”¯æŒæ›´å¤šå‘½ä»¤ã€‚æ‰€ä»¥æœ€å¥½å®šä¹‰ä¸€ä¸ª trait æ¥ç»Ÿä¸€å¤„ç†æ‰€æœ‰çš„å‘½ä»¤ï¼Œè¿”å›å¤„ç†ç»“æœã€‚</p>
</li>
<li>
<p>åœ¨å¤„ç†å‘½ä»¤çš„æ—¶å€™ï¼Œéœ€è¦å’Œå­˜å‚¨å‘ç”Ÿå…³ç³»ï¼Œè¿™æ ·æ‰èƒ½æ ¹æ®è¯·æ±‚ä¸­æºå¸¦çš„å‚æ•°è¯»å–æ•°æ®ï¼Œæˆ–è€…æŠŠè¯·æ±‚ä¸­çš„æ•°æ®å­˜å…¥å­˜å‚¨ç³»ç»Ÿä¸­ã€‚</p>
</li>
</ol>
<details id="admonition-3--æ‰€ä»¥è¿™ä¸ª-trait-å¯ä»¥è¿™ä¹ˆå®šä¹‰" class="admonition note">
<summary class="admonition-title">
<ol start="3">
<li>æ‰€ä»¥ï¼Œè¿™ä¸ª trait å¯ä»¥è¿™ä¹ˆå®šä¹‰ï¼š </li>
</ol>
<p><a class="admonition-anchor-link" href="#admonition-3--æ‰€ä»¥è¿™ä¸ª-trait-å¯ä»¥è¿™ä¹ˆå®šä¹‰"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">/// å¯¹ Command çš„å¤„ç†çš„æŠ½è±¡
pub trait CommandService {
    /// å¤„ç† Commandï¼Œè¿”å› Response
    fn execute(self, store: &amp;impl Storage) -&gt; CommandResponse;
}
</code></pre></pre>
<p>æœ‰äº†è¿™ä¸ª traitï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‘½ä»¤éƒ½å®ç°äº†è¿™ä¸ª trait åï¼Œdispatch æ–¹æ³•å°±å¯ä»¥æ˜¯ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
// ä» Request ä¸­å¾—åˆ° Responseï¼Œç›®å‰å¤„ç† HGET/HGETALL/HSET
pub fn dispatch(cmd: CommandRequest, store: &amp;impl Storage) -&gt; CommandResponse {
    match cmd.request_data {
        Some(RequestData::Hget(param)) =&gt; param.execute(store),
        Some(RequestData::Hgetall(param)) =&gt; param.execute(store),
        Some(RequestData::Hset(param)) =&gt; param.execute(store),
        None =&gt; KvError::InvalidCommand(&quot;Request has no data&quot;.into()).into(),
        _ =&gt; KvError::Internal(&quot;Not implemented&quot;.into()).into(),
    }
}
</code></pre></pre>
</div>
</details>
<details id="admonition-æˆåŠŸè¿™æ ·æœªæ¥æˆ‘ä»¬æ”¯æŒæ–°å‘½ä»¤æ—¶åªéœ€è¦åšä¸¤ä»¶äº‹" class="admonition success">
<summary class="admonition-title">
<p>æˆåŠŸï¼šè¿™æ ·ï¼Œæœªæ¥æˆ‘ä»¬æ”¯æŒæ–°å‘½ä»¤æ—¶ï¼Œåªéœ€è¦åšä¸¤ä»¶äº‹</p>
<p><a class="admonition-anchor-link" href="#admonition-æˆåŠŸè¿™æ ·æœªæ¥æˆ‘ä»¬æ”¯æŒæ–°å‘½ä»¤æ—¶åªéœ€è¦åšä¸¤ä»¶äº‹"></a></p>
</summary>
<div>
<ol>
<li>ä¸ºå‘½ä»¤å®ç° CommandService</li>
<li>åœ¨ dispatch æ–¹æ³•ä¸­æ·»åŠ æ–°å‘½ä»¤çš„æ”¯æŒã€‚</li>
</ol>
</div>
</details>
<h3 id="storage-trait"><a class="header" href="#storage-trait">Storage trait</a></h3>
<details id="admonition-å†æ¥çœ‹ä¸ºä¸åŒçš„å­˜å‚¨è€Œè®¾è®¡çš„-storage-traitå®ƒæä¾›-kv-store-çš„ä¸»è¦æ¥å£" class="admonition note">
<summary class="admonition-title">
<p>å†æ¥çœ‹ä¸ºä¸åŒçš„å­˜å‚¨è€Œè®¾è®¡çš„ Storage traitï¼Œå®ƒæä¾› KV store çš„ä¸»è¦æ¥å£ </p>
<p><a class="admonition-anchor-link" href="#admonition-å†æ¥çœ‹ä¸ºä¸åŒçš„å­˜å‚¨è€Œè®¾è®¡çš„-storage-traitå®ƒæä¾›-kv-store-çš„ä¸»è¦æ¥å£"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
/// å¯¹å­˜å‚¨çš„æŠ½è±¡ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒæ•°æ®å­˜åœ¨å“ªå„¿ï¼Œä½†éœ€è¦å®šä¹‰å¤–ç•Œå¦‚ä½•å’Œå­˜å‚¨æ‰“äº¤é“
pub trait Storage {
    /// ä»ä¸€ä¸ª HashTable é‡Œè·å–ä¸€ä¸ª key çš„ value
    fn get(&amp;self, table: &amp;str, key: &amp;str) -&gt; Result&lt;Option&lt;Value&gt;, KvError&gt;;
    /// ä»ä¸€ä¸ª HashTable é‡Œè®¾ç½®ä¸€ä¸ª key çš„ valueï¼Œè¿”å›æ—§çš„ value
    fn set(&amp;self, table: &amp;str, key: String, value: Value) -&gt; Result&lt;Option&lt;Value&gt;, KvError&gt;;
    /// æŸ¥çœ‹ HashTable ä¸­æ˜¯å¦æœ‰ key
    fn contains(&amp;self, table: &amp;str, key: &amp;str) -&gt; Result&lt;bool, KvError&gt;;
    /// ä» HashTable ä¸­åˆ é™¤ä¸€ä¸ª key
    fn del(&amp;self, table: &amp;str, key: &amp;str) -&gt; Result&lt;Option&lt;Value&gt;, KvError&gt;;
    /// éå† HashTableï¼Œè¿”å›æ‰€æœ‰ kv pairï¼ˆè¿™ä¸ªæ¥å£ä¸å¥½ï¼‰
    fn get_all(&amp;self, table: &amp;str) -&gt; Result&lt;Vec&lt;Kvpair&gt;, KvError&gt;;
    /// éå† HashTableï¼Œè¿”å› kv pair çš„ Iterator
    fn get_iter(&amp;self, table: &amp;str) -&gt; Result&lt;Box&lt;dyn Iterator&lt;Item = Kvpair&gt;&gt;, KvError&gt;;
}
</code></pre></pre>
</div>
</details>
<h3 id="traitçš„å¥½å¤„"><a class="header" href="#traitçš„å¥½å¤„">traitçš„å¥½å¤„</a></h3>
<p>åœ¨ CommandService trait ä¸­å·²ç»çœ‹åˆ°ï¼Œåœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œä¸ä¹‹æ‰“äº¤é“çš„æ˜¯ Storage traitï¼Œè€Œéå…·ä½“çš„æŸä¸ª storeã€‚</p>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæœªæ¥æ ¹æ®ä¸šåŠ¡çš„éœ€è¦ï¼Œåœ¨ä¸åŒçš„åœºæ™¯ä¸‹æ·»åŠ ä¸åŒçš„ storeï¼Œåªéœ€è¦ä¸ºå…¶å®ç° Storage trait å³å¯ï¼Œä¸å¿…ä¿®æ”¹ CommandService æœ‰å…³çš„ä»£ç ã€‚</p>
<details id="admonition--æ¯”å¦‚åœ¨-hget-å‘½ä»¤çš„å®ç°æ—¶æˆ‘ä»¬ä½¿ç”¨-storageget-æ–¹æ³•ä»-table-ä¸­è·å–æ•°æ®å®ƒè·ŸæŸä¸ªå…·ä½“çš„å­˜å‚¨æ–¹æ¡ˆæ— å…³" class="admonition note">
<summary class="admonition-title">
<blockquote>
<p>æ¯”å¦‚åœ¨ HGET å‘½ä»¤çš„å®ç°æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ Storage::get æ–¹æ³•ï¼Œä» table ä¸­è·å–æ•°æ®ï¼Œå®ƒè·ŸæŸä¸ªå…·ä½“çš„å­˜å‚¨æ–¹æ¡ˆæ— å…³</p>
</blockquote>
<p><a class="admonition-anchor-link" href="#admonition--æ¯”å¦‚åœ¨-hget-å‘½ä»¤çš„å®ç°æ—¶æˆ‘ä»¬ä½¿ç”¨-storageget-æ–¹æ³•ä»-table-ä¸­è·å–æ•°æ®å®ƒè·ŸæŸä¸ªå…·ä½“çš„å­˜å‚¨æ–¹æ¡ˆæ— å…³"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">impl CommandService for Hget {
    fn execute(self, store: &amp;impl Storage) -&gt; CommandResponse {
        match store.get(&amp;self.table, &amp;self.key) {
            Ok(Some(v)) =&gt; v.into(),
            Ok(None) =&gt; KvError::NotFound(self.table, self.key).into(),
            Err(e) =&gt; e.into(),
        }
    }
}
</code></pre></pre>
</div>
</details>
<details id="admonition-ä¸ºä»€ä¹ˆget_iterè¿”å›box" class="admonition tip">
<summary class="admonition-title">
<p>ä¸ºä»€ä¹ˆget_iterè¿”å›Box<dyn Iterator>?</p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸ºä»€ä¹ˆget_iterè¿”å›box"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">    /// éå† HashTableï¼Œè¿”å› kv pair çš„ Iterator
    fn get_iter(&amp;self, table: &amp;str) -&gt; Result&lt;Box&lt;dyn Iterator&lt;Item = Kvpair&gt;&gt;, KvError&gt;;
</code></pre></pre>
<p>Storage trait é‡Œé¢çš„ç»å¤§å¤šæ•°æ–¹æ³•ç›¸ä¿¡ä½ å¯ä»¥å®šä¹‰å‡ºæ¥ï¼Œä½† get_iter() è¿™ä¸ªæ¥å£å¯èƒ½ä½ ä¼šæ¯”è¾ƒå›°æƒ‘ï¼Œå› ä¸ºå®ƒè¿”å›äº†ä¸€ä¸ª Box<dyn Iterator>ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p>
<p>è¿™æ˜¯ä¸€ä¸ª trait objectã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æƒ³è¿”å›ä¸€ä¸ª iteratorï¼š</p>
<ol>
<li>è°ƒç”¨è€…ä¸å…³å¿ƒå®ƒå…·ä½“æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåªè¦å¯ä»¥ä¸åœåœ°è°ƒç”¨ next() æ–¹æ³•å–åˆ°ä¸‹ä¸€ä¸ªå€¼å°±å¯ä»¥äº†ã€‚</li>
<li>ä¸åŒçš„å®ç°ï¼Œå¯èƒ½è¿”å›ä¸åŒçš„ iteratorï¼Œå¦‚æœè¦ç”¨åŒä¸€ä¸ªæ¥å£æ‰¿è½½ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ trait objectã€‚</li>
<li>åœ¨ä½¿ç”¨ trait object æ—¶ï¼Œå› ä¸º Iterator æ˜¯ä¸ªå¸¦æœ‰å…³è”ç±»å‹çš„ traitï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æŒ‡æ˜å…³è”ç±»å‹ Item æ˜¯ä»€ä¹ˆç±»å‹ï¼Œè¿™æ ·è°ƒç”¨è€…æ‰å¥½æ‹¿åˆ°è¿™ä¸ªç±»å‹è¿›è¡Œå¤„ç†ã€‚</li>
</ol>
<blockquote>
<p>ä½ ä¹Ÿè®¸ä¼šæœ‰ç–‘é—®ï¼Œset / del æ˜æ˜¾æ˜¯ä¸ªä¼šå¯¼è‡´ self ä¿®æ”¹çš„æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆå®ƒçš„æ¥å£ä¾æ—§ä½¿ç”¨çš„æ˜¯ &amp;self å‘¢ï¼Ÿ</p>
</blockquote>
</div>
</details>
<details id="admonition-kv-serverä½¿ç”¨hashmapæ•°æ®ç»“æ„" class="admonition info">
<summary class="admonition-title">
<p>KV Serverä½¿ç”¨HashMapæ•°æ®ç»“æ„ </p>
<p><a class="admonition-anchor-link" href="#admonition-kv-serverä½¿ç”¨hashmapæ•°æ®ç»“æ„"></a></p>
</summary>
<div>
<p>æˆ‘ä»¬æ€è€ƒä¸€ä¸‹å®ƒçš„ç”¨æ³•ã€‚å¯¹äº Storage traitï¼Œæœ€ç®€å•çš„å®ç°æ˜¯ in-memory çš„ HashMapã€‚</p>
<p>ç”±äºæˆ‘ä»¬æ”¯æŒçš„æ˜¯ HSET / HGET è¿™æ ·çš„å‘½ä»¤ï¼Œå®ƒä»¬å¯ä»¥ä»ä¸åŒçš„è¡¨ä¸­è¯»å–æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦åµŒå¥—çš„ HashMapï¼Œç±»ä¼¼ HashMap&lt;String, HashMap&lt;String, Value&gt;&gt;ã€‚</p>
<p>å¦å¤–ï¼Œç”±äºè¦åœ¨å¤šçº¿ç¨‹ / å¼‚æ­¥ç¯å¢ƒä¸‹è¯»å–å’Œæ›´æ–°å†…å­˜ä¸­çš„ HashMapï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç±»ä¼¼è¿™æ ·çš„ç»“æ„ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">Arc&lt;RwLock&lt;HashMap&lt;String, Arc&lt;RwLock&lt;HashMap&lt;String, Value&gt;&gt;&gt;&gt;&gt;&gt;
</code></pre></pre>
<blockquote>
<p>è¿™ä¸ªç»“æ„æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…·æœ‰å†…éƒ¨å¯å˜æ€§çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ get / set çš„æ¥å£æ˜¯ &amp;self å°±è¶³å¤Ÿäº†ã€‚</p>
</blockquote>
</div>
</details>
<details id="admonition-ä¸ºä»€ä¹ˆè¿”å›å€¼éƒ½ç”¨result" class="admonition question">
<summary class="admonition-title">
<p>ä¸ºä»€ä¹ˆè¿”å›å€¼éƒ½ç”¨Result&lt;T, E&gt;? </p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸ºä»€ä¹ˆè¿”å›å€¼éƒ½ç”¨result"></a></p>
</summary>
<div>
<p>æƒ³ä¸€æƒ³ï¼Œå¯¹äº Storage traitï¼Œä¸ºä»€ä¹ˆè¿”å›å€¼éƒ½ç”¨äº† Result&lt;T, E&gt;ï¼Ÿåœ¨å®ç° MemTable çš„æ—¶å€™ï¼Œä¼¼ä¹æ‰€æœ‰è¿”å›éƒ½æ˜¯ Ok(T) å•Šï¼Ÿ</p>
<blockquote>
<p>Storageä½œä¸ºtraitï¼Œéœ€è¦å…³æ³¨IOæ“ä½œå¤±è´¥çš„é”™è¯¯æƒ…å†µï¼Œè€ŒMemTableå®ç°ï¼Œéƒ½æ˜¯å†…å­˜æ“ä½œï¼Œå‡ ä¹ä¸ä¼šå¤±è´¥ï¼Œæ‰€ä»¥è¿”å›Ok(T)å°±å¯ä»¥äº†</p>
</blockquote>
</div>
</details>

            </main>

            <!--            <script src="https://utteranc.es/client.js"-->
            <!--                    repo="RustMagazine/rust_magazine_2022"-->
            <!--                    issue-term="title"-->
            <!--                    theme="github-light"-->
            <!--                    crossorigin="anonymous"-->
            <!--                    async></script>-->

            <nav class="nav-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->
                    <a rel="prev" href="kv_server_design.html" class="mobile-nav-chapters previous"
                       title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="kv2_protocols.html" class="mobile-nav-chapters next"
                       title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                <div style="clear: both"></div>
            </nav>
        </div>
    </div>

    <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="kv_server_design.html" class="nav-chapters previous" title="Previous chapter"
               aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="kv2_protocols.html" class="nav-chapters next" title="Next chapter"
               aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
    </nav>

</div>



    <script type="text/javascript">
        window.playground_line_numbers = true;
    </script>

    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

<script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="highlight.js" type="text/javascript" charset="utf-8"></script>
<script src="book.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JS scripts -->
    <script type="text/javascript" src="assets/mermaid/mermaid.min.js"></script>
    <script type="text/javascript" src="assets/mermaid/mermaid-init.js"></script>
    <script type="text/javascript" src="assets/smart-anchor.js"></script>
    <script type="text/javascript" src="assets/pagetoc/sidebar.js"></script>

</body>
</html>
