<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js rust">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>II. ç±»å‹ç³»ç»Ÿ - Anatomy In First Rust Programming Class ğŸ¦€</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="ä»¥rustç¼–ç¨‹ç¬¬ä¸€è¯¾çš„ä»£ç ä¸ºä¾‹è¿›è¡ŒåŸºç¡€ä»£ç åˆ†æ">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="md-favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/pagetoc/pagetoc_style.css">
        <link rel="stylesheet" href="assets/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<!-- Provide site root to javascript -->
<script type="text/javascript">
    var path_to_root = "";
    var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
</script>

<!-- Work around some values being stored in localStorage wrapped in quotes -->
<script type="text/javascript">
    try {
        var theme = localStorage.getItem('mdbook-theme');
        var sidebar = localStorage.getItem('mdbook-sidebar');

        if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
        }

        if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
        }
    } catch (e) {
    }
</script>

<!-- Set the theme before any content is loaded, prevents flash -->
<script type="text/javascript">
    var theme;
    try {
        theme = localStorage.getItem('mdbook-theme');
    } catch (e) {
    }
    if (theme === null || theme === undefined) {
        theme = default_theme;
    }
    var html = document.querySelector('html');
    html.classList.remove('no-js')
    html.classList.remove('rust')
    html.classList.add(theme);
    html.classList.add('js');
</script>

<!-- Hide / unhide sidebar before it is displayed -->
<script type="text/javascript">
    var html = document.querySelector('html');
    var sidebar = 'hidden';
    if (document.body.clientWidth >= 1080) {
        try {
            sidebar = localStorage.getItem('mdbook-sidebar');
        } catch (e) {
        }
        sidebar = sidebar || 'visible';
    }
    html.classList.remove('sidebar-visible');
    html.classList.add("sidebar-" + sidebar);
</script>

<nav id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar-scrollbox">
        <ol class="chapter"><li class="chapter-item expanded "><a href="anatomy_logic.html"><strong aria-hidden="true">1.</strong> æºç é˜…è¯»é€»è¾‘</a></li><li class="chapter-item expanded "><a href="intro_gdb_lldb.html"><strong aria-hidden="true">2.</strong> gdb/lldbè°ƒè¯•æˆ–æŸ¥çœ‹å†…å­˜ç»“æ„</a></li><li class="chapter-item expanded "><a href="get_hands_dirty.html"><strong aria-hidden="true">3.</strong> get hands dirty</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="httpie.html"><strong aria-hidden="true">3.1.</strong> httpie</a></li><li class="chapter-item expanded "><a href="rgrep.html"><strong aria-hidden="true">3.2.</strong> rgrep</a></li><li class="chapter-item expanded "><a href="thumbor.html"><strong aria-hidden="true">3.3.</strong> thumbor</a></li><li class="chapter-item expanded "><a href="queryer.html"><strong aria-hidden="true">3.4.</strong> queryer</a></li></ol></li><li class="chapter-item expanded "><a href="rust_cores.html"><strong aria-hidden="true">4.</strong> Rustæ ¸å¿ƒæ·±å…¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1_stack_heap_ownership_lifetime_memory.html"><strong aria-hidden="true">4.1.</strong> I. ä»æ ˆå †ã€æ‰€æœ‰æƒã€ç”Ÿå‘½å‘¨æœŸå¼€å§‹å†…å­˜ç®¡ç†</a></li><li class="chapter-item expanded "><a href="2_type_system.html" class="active"><strong aria-hidden="true">4.2.</strong> II. ç±»å‹ç³»ç»Ÿ</a></li><li class="chapter-item expanded "><a href="3_data_structure.html"><strong aria-hidden="true">4.3.</strong> III. æ•°æ®ç»“æ„</a></li><li class="chapter-item expanded "><a href="4_macros.html"><strong aria-hidden="true">4.4.</strong> IV. å®ç¼–ç¨‹</a></li><li class="chapter-item expanded "><a href="5_concurrency_async.html"><strong aria-hidden="true">4.5.</strong> V. å¹¶å‘ä¸å¼‚æ­¥</a></li><li class="chapter-item expanded "><a href="6_unsafe_ffi.html"><strong aria-hidden="true">4.6.</strong> VI. æ··åˆç¼–ç¨‹</a></li></ol></li><li class="chapter-item expanded "><a href="kv_server_design.html"><strong aria-hidden="true">5.</strong> kv serverè®¾è®¡ä¸å®ç°</a></li><li class="chapter-item expanded "><a href="custom_axum_async_web_framework.html"><strong aria-hidden="true">6.</strong> æ„å»ºè‡ªå·±çš„ç±»axumå¼‚æ­¥Webæ¡†æ¶</a></li><li class="chapter-item expanded affix "><a href="checklist.html">Checklist</a></li></ol>
    </div>
    <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
</nav>

<div id="page-wrapper" class="page-wrapper">

    <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
        <div id="menu-bar" class="menu-bar sticky bordered">
            <div class="left-buttons">
                <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </button>
                <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                    <i class="fa fa-paint-brush"></i>
                </button>
                <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                    <li role="none">
                        <button role="menuitem" class="theme" id="light">Light</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="rust">Rust (default)</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="coal">Coal</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="navy">Navy</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="ayu">Ayu</button>
                    </li>
                </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
            </div>

            <h1 class="menu-title">Anatomy In First Rust Programming Class ğŸ¦€</h1>
            <h4 class="menu-bar"><a href="https://kuanhsiaokuo.github.io/think-tool-kit/">ä¿æŒæ‰¹åˆ¤ï¼Œæœ‰æ‰€å–èˆï¼ŒçŸ¥è¡Œåˆä¸€, æ–¹è§çœŸæˆ‘</a> -- ç»ƒæ­¦ä¸ç»ƒåŠŸ
                åˆ°å¤´ä¸€åœºç©º -- ã€Šèµ›åšè‹±é›„ä¼ ã€‹ </h4>
            <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/KuanHsiaoKuo/geektime-tyr-rust.git" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-rust"></i>
                    </a>
            </div>
        </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                           placeholder="Search this book ..." aria-controls="searchresults-outer"
                           aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

        <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
        <script type="text/javascript">
            document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
            document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
            Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
            });
        </script>

        <div id="content" class="content">
            <main>

                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <h1 id="ii-ç±»å‹ç³»ç»Ÿ"><a class="header" href="#ii-ç±»å‹ç³»ç»Ÿ">II. ç±»å‹ç³»ç»Ÿ</a></h1>
<!--ts-->
<ul>
<li><a href="#ii-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F">II. ç±»å‹ç³»ç»Ÿ</a>
<ul>
<li><a href="#%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E5%88%86%E7%B1%BB%E5%9B%BE">ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾</a>
<ul>
<li><a href="#%E4%B8%89%E4%B8%AA%E6%A0%87%E5%87%86">ä¸‰ä¸ªæ ‡å‡†</a></li>
<li><a href="#rust%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E7%89%B9%E7%82%B9">Rustç±»å‹ç³»ç»Ÿç‰¹ç‚¹</a></li>
</ul>
</li>
<li><a href="#%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB">ç±»å‹åˆ†ç±»</a>
<ul>
<li><a href="#%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%9E%8B">åŸç”Ÿç±»å‹</a></li>
<li><a href="#%E7%BB%84%E5%90%88%E7%B1%BB%E5%9E%8B">ç»„åˆç±»å‹</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E5%90%88%E7%B1%BB%E5%9E%8B">è‡ªå®šä¹‰ç»„åˆç±»å‹</a></li>
</ul>
</li>
<li><a href="#%E5%B0%8F%E4%BE%8B%E5%AD%90">å°ä¾‹å­</a>
<ul>
<li><a href="#%E5%B8%B8%E9%87%8F">å¸¸é‡</a></li>
</ul>
</li>
<li><a href="#%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC">ç±»å‹æ¨å¯¼</a></li>
<li><a href="#turbofish">Turbofish</a></li>
</ul>
</li>
<li><a href="#%E6%B3%9B%E5%9E%8B">æ³›å‹</a>
<ul>
<li><a href="#%E6%B3%9B%E5%9E%8B%E5%B0%B1%E5%83%8F%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0">æ³›å‹å°±åƒå®šä¹‰å‡½æ•°</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F">å®ç°æ–¹å¼</a></li>
<li><a href="#%E6%B3%9B%E5%9E%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ³›å‹æ•°æ®ç»“æ„</a>
<ul>
<li><a href="#%E9%80%90%E6%AD%A5%E7%BA%A6%E6%9D%9F%E6%8A%8A%E5%86%B3%E7%AD%96%E4%BA%A4%E7%BB%99%E4%BD%BF%E7%94%A8%E8%80%85">é€æ­¥çº¦æŸï¼šæŠŠå†³ç­–äº¤ç»™ä½¿ç”¨è€…</a></li>
</ul>
</li>
<li><a href="#%E6%B3%9B%E5%9E%8B%E5%8F%82%E6%95%B0">æ³›å‹å‚æ•°</a>
<ul>
<li><a href="#%E5%8F%82%E6%95%B0%E5%A4%9A%E6%80%81">å‚æ•°å¤šæ€</a></li>
<li><a href="#%E4%B8%89%E7%A7%8D%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">ä¸‰ç§ä½¿ç”¨åœºæ™¯</a>
<ul>
<li><a href="#%E5%BB%B6%E8%BF%9F%E7%BB%91%E5%AE%9A">å»¶è¿Ÿç»‘å®š</a></li>
<li><a href="#%E5%BB%B6%E8%BF%9F%E7%BB%91%E5%AE%9A-1">å»¶è¿Ÿç»‘å®š</a></li>
<li><a href="#%E5%A4%9A%E4%B8%AA%E5%AE%9E%E7%8E%B0">å¤šä¸ªå®ç°</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0">æ³›å‹å‡½æ•°</a>
<ul>
<li><a href="#%E5%8D%95%E6%80%81%E5%8C%96">å•æ€åŒ–</a>
<ul>
<li><a href="#%E4%BC%98%E5%8A%A3">ä¼˜åŠ£</a></li>
</ul>
</li>
<li><a href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E6%90%BA%E5%B8%A6%E6%B3%9B%E5%9E%8B%E5%8F%82%E6%95%B0">è¿”å›å€¼æºå¸¦æ³›å‹å‚æ•°</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#trait">Trait</a>
<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%BB%83%E4%B9%A0">åŸºæœ¬ç»ƒä¹ </a>
<ul>
<li><a href="#self%E5%92%8Cself">Selfå’Œself</a></li>
<li><a href="#%E9%80%92%E8%BF%9B%E7%BB%83%E4%B9%A0trait%E4%BD%BF%E7%94%A8">é€’è¿›ç»ƒä¹ traitä½¿ç”¨</a>
<ul>
<li><a href="#%E5%9F%BA%E7%A1%80%E5%AE%9A%E4%B9%89trait">åŸºç¡€å®šä¹‰trait</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E6%B3%9B%E5%9E%8B%E5%8F%82%E6%95%B0%E4%BD%9C%E4%B8%BA%E6%B3%9B%E5%9E%8B%E7%BA%A6%E6%9D%9F">æ·»åŠ æ³›å‹å‚æ•°ä½œä¸ºæ³›å‹çº¦æŸ</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%85%B3%E8%81%94%E7%B1%BB%E5%9E%8B%E6%B7%BB%E5%8A%A0resultt-e">ä½¿ç”¨å…³è”ç±»å‹+æ·»åŠ Result&lt;T, E&gt;</a></li>
</ul>
</li>
<li><a href="#%E6%B3%9B%E5%9E%8B%E7%BA%A6%E6%9D%9F-%E6%94%AF%E6%8C%81%E6%B3%9B%E5%9E%8B%E7%9A%84trait">æ³›å‹çº¦æŸ: æ”¯æŒæ³›å‹çš„trait</a>
<ul>
<li><a href="#%E6%80%9D%E8%80%83%E9%A2%98">æ€è€ƒé¢˜</a></li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">è§£å†³æ–¹æ¡ˆ</a></li>
</ul>
</li>
<li><a href="#%E5%85%B3%E8%81%94%E7%B1%BB%E5%9E%8B">å…³è”ç±»å‹</a></li>
<li><a href="#%E6%94%AF%E6%8C%81%E6%B3%9B%E5%9E%8B">æ”¯æŒæ³›å‹</a></li>
<li><a href="#%E6%94%AF%E6%8C%81%E7%BB%A7%E6%89%BF">æ”¯æŒç»§æ‰¿</a></li>
<li><a href="#%E6%8E%A5%E5%8F%A3%E6%8A%BD%E8%B1%A1-or-%E7%89%B9%E8%AE%BE%E5%A4%9A%E6%80%81">æ¥å£æŠ½è±¡ or ç‰¹è®¾å¤šæ€</a></li>
</ul>
</li>
<li><a href="#trait-object">Trait Object</a>
<ul>
<li><a href="#%E5%AD%90%E7%B1%BB%E5%9E%8B%E5%A4%9A%E6%80%81-%E5%8A%A8%E6%80%81%E5%88%86%E6%B4%BE">å­ç±»å‹å¤šæ€: åŠ¨æ€åˆ†æ´¾</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%9C%BA%E7%90%86ptrvtable">å®ç°æœºç†ï¼šptr+vtable</a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1%E5%AE%89%E5%85%A8">å¯¹è±¡å®‰å…¨</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">ä½¿ç”¨åœºæ™¯</a>
<ul>
<li><a href="#%E5%9C%A8%E5%87%BD%E6%95%B0%E4%B8%AD%E4%BD%BF%E7%94%A8">åœ¨å‡½æ•°ä¸­ä½¿ç”¨</a></li>
<li><a href="#%E5%9C%A8%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E4%B8%AD%E4%BD%BF%E7%94%A8">åœ¨å‡½æ•°è¿”å›å€¼ä¸­ä½¿ç”¨</a>
<ul>
<li><a href="#%E5%9C%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%AD%E4%BD%BF%E7%94%A8">åœ¨æ•°æ®ç»“æ„ä¸­ä½¿ç”¨</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%AD%A4%E5%84%BF%E8%A7%84%E5%88%99">å­¤å„¿è§„åˆ™</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8trait">å¸¸ç”¨trait</a>
<ul>
<li><a href="#%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3">å†…å­˜ç›¸å…³</a>
<ul>
<li><a href="#copy">Copy</a></li>
<li><a href="#drop">Drop</a></li>
</ul>
</li>
<li><a href="#%E6%A0%87%E7%AD%BEtrait">æ ‡ç­¾trait</a>
<ul>
<li><a href="#sized">Sized</a></li>
<li><a href="#sendsync">Send/Sync</a></li>
</ul>
</li>
<li><a href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">ç±»å‹è½¬æ¢</a>
<ul>
<li><a href="#frominto-%E5%80%BC%E5%88%B0%E5%80%BC">From/Into: å€¼åˆ°å€¼</a></li>
<li><a href="#tryfromtryinto-%E5%80%BC%E5%88%B0%E5%80%BC%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF">TryFrom/TryInto: å€¼åˆ°å€¼ï¼Œå¯èƒ½å‡ºç°é”™è¯¯</a></li>
<li><a href="#asrefasmut-%E5%BC%95%E7%94%A8%E5%88%B0%E5%BC%95%E7%94%A8">AsRef/AsMut: å¼•ç”¨åˆ°å¼•ç”¨</a></li>
</ul>
</li>
<li><a href="#%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9B%B8%E5%85%B3-derefderefmut">æ“ä½œç¬¦ç›¸å…³: Deref/DerefMut</a></li>
<li><a href="#%E5%85%B6%E4%BB%96debugdisplaydefault">å…¶ä»–ï¼šDebug/Display/Default</a></li>
</ul>
</li>
<li><a href="#%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84">è®¾è®¡æ¶æ„</a>
<ul>
<li><a href="#%E9%A1%BA%E6%89%8B%E8%87%AA%E7%84%B6">é¡ºæ‰‹è‡ªç„¶</a></li>
<li><a href="#%E6%A1%A5%E6%8E%A5">æ¡¥æ¥</a></li>
<li><a href="#%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC">æ§åˆ¶åè½¬</a></li>
<li><a href="#solid%E5%8E%9F%E5%88%99">SOLIDåŸåˆ™</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Fri Oct  7 02:23:07 UTC 2022 -->
<!--te-->
<h2 id="ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾"><a class="header" href="#ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾">ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾</a></h2>
<div id="admonition-ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾" class="admonition info">
<div class="admonition-title">
<p>ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾</p>
<p><a class="admonition-anchor-link" href="#admonition-ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾"></a></p>
</div>
<div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/12%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9ARust%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E7%89%B9%E7%82%B9%EF%BC%9F.jpg" alt="ç±»å‹ç³»ç»Ÿåˆ†ç±»å›¾" /></p>
</div>
</div>
<h3 id="ä¸‰ä¸ªæ ‡å‡†"><a class="header" href="#ä¸‰ä¸ªæ ‡å‡†">ä¸‰ä¸ªæ ‡å‡†</a></h3>
<ol>
<li>éšå¼è½¬æ¢</li>
<li>æ£€æŸ¥æ—¶æœº</li>
<li>å¤šæ€æ”¯æŒ</li>
</ol>
<h3 id="rustç±»å‹ç³»ç»Ÿç‰¹ç‚¹"><a class="header" href="#rustç±»å‹ç³»ç»Ÿç‰¹ç‚¹">Rustç±»å‹ç³»ç»Ÿç‰¹ç‚¹</a></h3>
<div id="admonition-rustçš„ç±»å‹ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹" class="admonition info">
<div class="admonition-title">
<p>Rustçš„ç±»å‹ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-rustçš„ç±»å‹ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹"></a></p>
</div>
<div>
<h2 id=""><a class="header" href="#"><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/12%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9ARust%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E7%89%B9%E7%82%B9%EF%BC%9F-4257735.jpg" alt="Rustçš„ç±»å‹ç³»ç»Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" /></a></h2>
<p>å¼ºç±»å‹ + é™æ€ç±»å‹ + æ˜¾å¼ç±»å‹</p>
</div>
</div>
<h2 id="ç±»å‹åˆ†ç±»"><a class="header" href="#ç±»å‹åˆ†ç±»">ç±»å‹åˆ†ç±»</a></h2>
<h3 id="åŸç”Ÿç±»å‹"><a class="header" href="#åŸç”Ÿç±»å‹">åŸç”Ÿç±»å‹</a></h3>
<details id="admonition-ruståŸå£°ç±»å‹" class="admonition info">
<summary class="admonition-title">
<p>RuståŸå£°ç±»å‹</p>
<p><a class="admonition-anchor-link" href="#admonition-ruståŸå£°ç±»å‹"></a></p>
</summary>
<div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/12%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9ARust%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E7%89%B9%E7%82%B9%EF%BC%9F-4257523.jpg" alt="RuståŸç”Ÿç±»å‹" /></p>
</div>
</details>
<h3 id="ç»„åˆç±»å‹"><a class="header" href="#ç»„åˆç±»å‹">ç»„åˆç±»å‹</a></h3>
<details id="admonition-rustç»„åˆç±»å‹" class="admonition info">
<summary class="admonition-title">
<p>Rustç»„åˆç±»å‹</p>
<p><a class="admonition-anchor-link" href="#admonition-rustç»„åˆç±»å‹"></a></p>
</summary>
<div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/12%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9ARust%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E7%89%B9%E7%82%B9%EF%BC%9F-4257587.jpg" alt="Rustç»„åˆç±»å‹" /></p>
</div>
</details>
<h3 id="è‡ªå®šä¹‰ç»„åˆç±»å‹"><a class="header" href="#è‡ªå®šä¹‰ç»„åˆç±»å‹">è‡ªå®šä¹‰ç»„åˆç±»å‹</a></h3>
<h2 id="å°ä¾‹å­"><a class="header" href="#å°ä¾‹å­">å°ä¾‹å­</a></h2>
<h3 id="å¸¸é‡"><a class="header" href="#å¸¸é‡">å¸¸é‡</a></h3>
<details id="admonition-å¸¸é‡å®šä¹‰ä½¿ç”¨" class="admonition info">
<summary class="admonition-title">
<p>å¸¸é‡å®šä¹‰ä½¿ç”¨</p>
<p><a class="admonition-anchor-link" href="#admonition-å¸¸é‡å®šä¹‰ä½¿ç”¨"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">const PI: f64 = std::f64::consts::PI;
static E: f32 = std::f32::consts::E;

fn main() {
    const V: u32 = 10;
    static V1: &amp;str = &quot;hello&quot;;
    println!(&quot;PI: {}, E: {}, V {}, V1: {}&quot;, PI, E, V, V1);
}
</code></pre></pre>
</div>
</details>
<h2 id="ç±»å‹æ¨å¯¼"><a class="header" href="#ç±»å‹æ¨å¯¼">ç±»å‹æ¨å¯¼</a></h2>
<details id="admonition-rustç¼–è¯‘å™¨å¯ä»¥ä»ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼ç±»å‹" class="admonition info">
<summary class="admonition-title">
<p>Rustç¼–è¯‘å™¨å¯ä»¥ä»ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼ç±»å‹</p>
<p><a class="admonition-anchor-link" href="#admonition-rustç¼–è¯‘å™¨å¯ä»¥ä»ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼ç±»å‹"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::collections::BTreeMap;

fn main() {
    let mut map = BTreeMap::new();
    // æ²¡æœ‰è¿™ä¸€è¡Œå°±ç¼ºå°‘è‡ªåŠ¨æ¨å¯¼ä¿¡æ¯
    // map.insert(&quot;hello&quot;, &quot;world&quot;);
    println!(&quot;map: {:?}&quot;, map);
}
</code></pre></pre>
<hr />
<p>æŠŠç¬¬ 5 è¡Œè¿™ä¸ªä½œç”¨åŸŸå†…çš„ insert è¯­å¥æ³¨é‡Šå»æ‰ï¼ŒRust ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼šâ€œcannot infer type for type parameter Kâ€ã€‚</p>
</div>
</details>
<details id="admonition-rustç¼–è¯‘å™¨ä¸èƒ½è·å–è¶³å¤Ÿä¸Šä¸‹æ–‡ä¿¡æ¯æ—¶å°±éœ€è¦æ˜ç¡®ç±»å‹" class="admonition info">
<summary class="admonition-title">
<p>Rustç¼–è¯‘å™¨ä¸èƒ½è·å–è¶³å¤Ÿä¸Šä¸‹æ–‡ä¿¡æ¯æ—¶ï¼Œå°±éœ€è¦æ˜ç¡®ç±»å‹</p>
<p><a class="admonition-anchor-link" href="#admonition-rustç¼–è¯‘å™¨ä¸èƒ½è·å–è¶³å¤Ÿä¸Šä¸‹æ–‡ä¿¡æ¯æ—¶å°±éœ€è¦æ˜ç¡®ç±»å‹"></a></p>
</summary>
<div>
<ol>
<li>æ— æ³•è‡ªåŠ¨æ¨å¯¼collectè¿”å›ä»€ä¹ˆç±»å‹</li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">
fn main() {
    let numbers = vec![1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

    let even_numbers = numbers
        .into_iter()
        .filter(|n| n % 2 == 0)
        .collect();

    println!(&quot;{:?}&quot;, even_numbers);
}
</code></pre></pre>
<hr />
<ol start="2">
<li>ç»™even_numbersæ·»åŠ ç±»å‹å£°æ˜å³å¯</li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">
fn main() {
    let numbers = vec![1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

    let even_numbers: Vec&lt;_&gt; = numbers
        .into_iter()
        .filter(|n| n % 2 == 0)
        .collect();

    println!(&quot;{:?}&quot;, even_numbers);
}
</code></pre></pre>
<blockquote>
<p>è¿™é‡Œç¼–è¯‘å™¨åªæ˜¯æ— æ³•æ¨æ–­å‡ºé›†åˆç±»å‹ï¼Œä½†é›†åˆç±»å‹å†…éƒ¨å…ƒç´ çš„ç±»å‹ï¼Œè¿˜æ˜¯å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡å¾—å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å†™æˆ Vec&lt;_&gt;</p>
</blockquote>
<ol start="3">
<li>ä¹Ÿå¯ä»¥è®© collect è¿”å›ä¸€ä¸ªæ˜ç¡®çš„ç±»å‹</li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">
fn main() {
    let numbers = vec![1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

    let even_numbers = numbers
        .into_iter()
        .filter(|n| n % 2 == 0)
        .collect::&lt;Vec&lt;_&gt;&gt;();

    println!(&quot;{:?}&quot;, even_numbers);
}
</code></pre></pre>
<hr />
<blockquote>
<p>è¿™é‡Œåœ¨æ³›å‹å‡½æ•°åä½¿ç”¨ :: æ¥å¼ºåˆ¶ä½¿ç”¨ç±»å‹ Tï¼Œè¿™ç§å†™æ³•è¢«ç§°ä¸º turbofish</p>
</blockquote>
</div>
</details>
<h2 id="turbofish"><a class="header" href="#turbofish">Turbofish</a></h2>
<details id="admonition-ä¸€ä¸ªå¯¹-ip-åœ°å€å’Œç«¯å£è½¬æ¢çš„ä¾‹å­" class="admonition info">
<summary class="admonition-title">
<p>ä¸€ä¸ªå¯¹ IP åœ°å€å’Œç«¯å£è½¬æ¢çš„ä¾‹å­</p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸€ä¸ªå¯¹-ip-åœ°å€å’Œç«¯å£è½¬æ¢çš„ä¾‹å­"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
use std::net::SocketAddr;

fn main() {
    let addr = &quot;127.0.0.1:8080&quot;.parse::&lt;SocketAddr&gt;().unwrap();
    println!(&quot;addr: {:?}, port: {:?}&quot;, addr.ip(), addr.port());
}
</code></pre></pre>
</div>
</details>
<details id="admonition-å¦‚æœç±»å‹åœ¨ä¸Šä¸‹æ–‡æ— æ³•è¢«æ¨å¯¼å‡ºæ¥åˆæ²¡æœ‰-turbofish-çš„å†™æ³•æˆ‘ä»¬å°±ä¸å¾—ä¸å…ˆç»™ä¸€ä¸ªå±€éƒ¨å˜é‡èµ‹å€¼æ—¶å£°æ˜ç±»å‹ç„¶åå†è¿”å›è¿™æ ·ä»£ç å°±å˜å¾—å†—ä½™" class="admonition info">
<summary class="admonition-title">
<p>å¦‚æœç±»å‹åœ¨ä¸Šä¸‹æ–‡æ— æ³•è¢«æ¨å¯¼å‡ºæ¥ï¼Œåˆæ²¡æœ‰ turbofish çš„å†™æ³•ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸å…ˆç»™ä¸€ä¸ªå±€éƒ¨å˜é‡èµ‹å€¼æ—¶å£°æ˜ç±»å‹ï¼Œç„¶åå†è¿”å›ï¼Œè¿™æ ·ä»£ç å°±å˜å¾—å†—ä½™</p>
<p><a class="admonition-anchor-link" href="#admonition-å¦‚æœç±»å‹åœ¨ä¸Šä¸‹æ–‡æ— æ³•è¢«æ¨å¯¼å‡ºæ¥åˆæ²¡æœ‰-turbofish-çš„å†™æ³•æˆ‘ä»¬å°±ä¸å¾—ä¸å…ˆç»™ä¸€ä¸ªå±€éƒ¨å˜é‡èµ‹å€¼æ—¶å£°æ˜ç±»å‹ç„¶åå†è¿”å›è¿™æ ·ä»£ç å°±å˜å¾—å†—ä½™"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>match data {
    Some(s) =&gt; v.parse::&lt;User&gt;()?,
    _ =&gt; return Err(...),
}
<span class="boring">}
</span></code></pre></pre>
</div>
</details>
<h1 id="æ³›å‹"><a class="header" href="#æ³›å‹">æ³›å‹</a></h1>
<h2 id="æ³›å‹å°±åƒå®šä¹‰å‡½æ•°"><a class="header" href="#æ³›å‹å°±åƒå®šä¹‰å‡½æ•°">æ³›å‹å°±åƒå®šä¹‰å‡½æ•°</a></h2>
<ol>
<li>å‡½æ•°ï¼Œæ˜¯æŠŠé‡å¤ä»£ç ä¸­çš„å‚æ•°æŠ½å–å‡ºæ¥ï¼Œä½¿å…¶æ›´åŠ é€šç”¨ï¼Œè°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œæ ¹æ®å‚æ•°çš„ä¸åŒï¼Œæˆ‘ä»¬å¾—åˆ°ä¸åŒçš„ç»“æœï¼›</li>
<li>è€Œæ³›å‹ï¼Œæ˜¯æŠŠé‡å¤æ•°æ®ç»“æ„ä¸­çš„å‚æ•°æŠ½å–å‡ºæ¥ï¼Œåœ¨ä½¿ç”¨æ³›å‹ç±»å‹æ—¶ï¼Œæ ¹æ®ä¸åŒçš„å‚æ•°ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸åŒçš„å…·ä½“ç±»å‹ã€‚</li>
</ol>
<details id="admonition-æ³›å‹ç»“æ„vecä¾‹å­" class="admonition info">
<summary class="admonition-title">
<p>æ³›å‹ç»“æ„Vec<T>ä¾‹å­</p>
<p><a class="admonition-anchor-link" href="#admonition-æ³›å‹ç»“æ„vecä¾‹å­"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub struct Vec&lt;T, A: Allocator = Global&gt; {
    buf: RawVec&lt;T, A&gt;,
    len: usize,
}

pub struct RawVec&lt;T, A: Allocator = Global&gt; {
    ptr: Unique&lt;T&gt;,
    cap: usize,
    alloc: A,
}
</code></pre></pre>
<hr />
<p>Vecæœ‰ä¸¤ä¸ªå‚æ•°:</p>
<ol>
<li>ä¸€ä¸ªæ˜¯ Tï¼Œæ˜¯åˆ—è¡¨é‡Œçš„æ¯ä¸ªæ•°æ®çš„ç±»å‹</li>
<li>å¦ä¸€ä¸ªæ˜¯ Aï¼Œå®ƒæœ‰è¿›ä¸€æ­¥çš„é™åˆ¶ A: Allocator </li>
</ol>
<blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ A éœ€è¦æ»¡è¶³ Allocator traitã€‚
A è¿™ä¸ªå‚æ•°æœ‰é»˜è®¤å€¼ Globalï¼Œå®ƒæ˜¯ Rust é»˜è®¤çš„å…¨å±€åˆ†é…å™¨</p>
</blockquote>
<ol start="3">
<li>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Vec è™½ç„¶æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä½¿ç”¨æ—¶éƒ½åªéœ€è¦ç”¨ Tã€‚</li>
</ol>
</div>
</details>
<details id="admonition-æšä¸¾ç±»å‹cowä¾‹å­" class="admonition info">
<summary class="admonition-title">
<p>æšä¸¾ç±»å‹Cow<T>ä¾‹å­</p>
<p><a class="admonition-anchor-link" href="#admonition-æšä¸¾ç±»å‹cowä¾‹å­"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub enum Cow&lt;'a, B: ?Sized + 'a&gt; where B: ToOwned,
{
    // å€Ÿç”¨çš„æ•°æ®
    Borrowed(&amp;'a B),
    // æ‹¥æœ‰çš„æ•°æ®
    Owned(&lt;B as ToOwned&gt;::Owned),
}
</code></pre></pre>
<p>è¿™é‡Œå¯¹ B çš„ä¸‰ä¸ªçº¦æŸåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>ç”Ÿå‘½å‘¨æœŸ â€™a</li>
<li>é•¿åº¦å¯å˜ ?Sized</li>
<li>ç¬¦åˆ ToOwned trait</li>
</ol>
</div>
</details>
<details id="admonition-cow" class="admonition info">
<summary class="admonition-title">
<p>Cow</p>
<p><a class="admonition-anchor-link" href="#admonition-cow"></a></p>
</summary>
<div>
<p>Cowï¼ˆClone-on-Writeï¼‰æ˜¯ Rust ä¸­ä¸€ä¸ªå¾ˆæœ‰æ„æ€ä¸”å¾ˆé‡è¦çš„æ•°æ®ç»“æ„ã€‚å®ƒå°±åƒ Option ä¸€æ ·ï¼Œåœ¨è¿”å›æ•°æ®çš„æ—¶å€™ï¼Œæä¾›äº†ä¸€ç§å¯èƒ½ï¼šè¦ä¹ˆè¿”å›ä¸€ä¸ªå€Ÿç”¨çš„æ•°æ®ï¼ˆåªè¯»ï¼‰ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªæ‹¥æœ‰æ‰€æœ‰æƒçš„æ•°æ®ï¼ˆå¯å†™ï¼‰ã€‚</p>
</div>
</details>
<details id="admonition-sizedä»£è¡¨å¯å˜å¤§å°" class="admonition info">
<summary class="admonition-title">
<p>?Sizedä»£è¡¨å¯å˜å¤§å°</p>
<p><a class="admonition-anchor-link" href="#admonition-sizedä»£è¡¨å¯å˜å¤§å°"></a></p>
</summary>
<div>
<p>?Sized æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¦æŸå†™æ³•ï¼Œ? ä»£è¡¨å¯ä»¥æ”¾æ¾é—®å·ä¹‹åçš„çº¦æŸã€‚ç”±äº Rust é»˜è®¤çš„æ³›å‹å‚æ•°éƒ½éœ€è¦æ˜¯ Sizedï¼Œä¹Ÿå°±æ˜¯å›ºå®šå¤§å°çš„ç±»å‹ï¼Œæ‰€ä»¥è¿™é‡Œ ?Sized ä»£è¡¨ç”¨å¯å˜å¤§å°çš„ç±»å‹ã€‚</p>
</div>
</details>
<details id="admonition-toowned" class="admonition info">
<summary class="admonition-title">
<p>ToOwned</p>
<p><a class="admonition-anchor-link" href="#admonition-toowned"></a></p>
</summary>
<div>
<p><a href="https://doc.rust-lang.org/std/borrow/trait.ToOwned.html">ToOwned</a> æ˜¯ä¸€ä¸ª traitï¼Œå®ƒå¯ä»¥æŠŠå€Ÿç”¨çš„æ•°æ®å…‹éš†å‡ºä¸€ä¸ªæ‹¥æœ‰æ‰€æœ‰æƒçš„æ•°æ®ã€‚</p>
</div>
</details>
<details id="admonition-owned" class="admonition info">
<summary class="admonition-title">
<p><B as ToOwned>::Owned</p>
<p><a class="admonition-anchor-link" href="#admonition-owned"></a></p>
</summary>
<div>
<h2 id="å®ƒå¯¹-b-åšäº†ä¸€ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢è½¬æˆ-toowned-traitç„¶åè®¿é—®-toowned-trait-å†…éƒ¨çš„-owned-ç±»å‹"><a class="header" href="#å®ƒå¯¹-b-åšäº†ä¸€ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢è½¬æˆ-toowned-traitç„¶åè®¿é—®-toowned-trait-å†…éƒ¨çš„-owned-ç±»å‹">å®ƒå¯¹ B åšäº†ä¸€ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè½¬æˆ ToOwned traitï¼Œç„¶åè®¿é—® ToOwned trait å†…éƒ¨çš„ Owned ç±»å‹</a></h2>
<p>å› ä¸ºåœ¨ Rust é‡Œï¼Œå­ç±»å‹å¯ä»¥å¼ºåˆ¶è½¬æ¢æˆçˆ¶ç±»å‹ï¼ŒB å¯ä»¥ç”¨ ToOwned çº¦æŸï¼Œæ‰€ä»¥å®ƒæ˜¯ ToOwned trait çš„å­ç±»å‹ï¼Œå› è€Œ B å¯ä»¥å®‰å…¨åœ°å¼ºåˆ¶è½¬æ¢æˆ ToOwnedã€‚è¿™é‡Œ B as ToOwned æ˜¯æˆç«‹çš„ã€‚</p>
</div>
</details>
<h2 id="å®ç°æ–¹å¼"><a class="header" href="#å®ç°æ–¹å¼">å®ç°æ–¹å¼</a></h2>
<details id="admonition-ä¸åŒè¯­è¨€å®ç°æ³›å‹çš„æ–¹å¼" class="admonition info">
<summary class="admonition-title">
<p>ä¸åŒè¯­è¨€å®ç°æ³›å‹çš„æ–¹å¼</p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸åŒè¯­è¨€å®ç°æ³›å‹çš„æ–¹å¼"></a></p>
</summary>
<div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/12%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9ARust%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%9C%89%E4%BB%80%E4%B9%88%E7%89%B9%E7%82%B9%EF%BC%9F.png" alt="ä¸åŒè¯­è¨€å®ç°æ³›å‹çš„æ–¹å¼" /></p>
</div>
</details>
<h2 id="æ³›å‹æ•°æ®ç»“æ„"><a class="header" href="#æ³›å‹æ•°æ®ç»“æ„">æ³›å‹æ•°æ®ç»“æ„</a></h2>
<h3 id="é€æ­¥çº¦æŸæŠŠå†³ç­–äº¤ç»™ä½¿ç”¨è€…"><a class="header" href="#é€æ­¥çº¦æŸæŠŠå†³ç­–äº¤ç»™ä½¿ç”¨è€…">é€æ­¥çº¦æŸï¼šæŠŠå†³ç­–äº¤ç»™ä½¿ç”¨è€…</a></h3>
<details id="admonition-åœ¨ä¸åŒçš„å®ç°ä¸‹é€æ­¥æ·»åŠ çº¦æŸ" class="admonition info">
<summary class="admonition-title">
<p>åœ¨ä¸åŒçš„å®ç°ä¸‹é€æ­¥æ·»åŠ çº¦æŸ</p>
<p><a class="admonition-anchor-link" href="#admonition-åœ¨ä¸åŒçš„å®ç°ä¸‹é€æ­¥æ·»åŠ çº¦æŸ"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::fs::File;
use std::io::{BufReader, Read, Result};

struct MyReader&lt;R&gt; {
    reader: R,
    buf: String,
}

impl&lt;R&gt; MyReader&lt;R&gt; {
    pub fn new(reader: R) -&gt; Self {
        Self {
            reader,
            buf: String::with_capacity(1024),
        }
    }
}

impl&lt;R&gt; MyReader&lt;R&gt;
where
    R: Read,
{
    pub fn process(&amp;mut self) -&gt; Result&lt;usize&gt; {
        self.reader.read_to_string(&amp;mut self.buf)
    }
}

fn main() {
    let f = File::open(&quot;/etc/hosts&quot;).unwrap();
    let mut reader = MyReader::new(BufReader::new(f));

    let size = reader.process().unwrap();
    println!(&quot;total size read: {}&quot;, size);
}
</code></pre></pre>
</div>
</details>
<h2 id="æ³›å‹å‚æ•°"><a class="header" href="#æ³›å‹å‚æ•°">æ³›å‹å‚æ•°</a></h2>
<h3 id="å‚æ•°å¤šæ€"><a class="header" href="#å‚æ•°å¤šæ€">å‚æ•°å¤šæ€</a></h3>
<h3 id="ä¸‰ç§ä½¿ç”¨åœºæ™¯"><a class="header" href="#ä¸‰ç§ä½¿ç”¨åœºæ™¯">ä¸‰ç§ä½¿ç”¨åœºæ™¯</a></h3>
<h4 id="å»¶è¿Ÿç»‘å®š"><a class="header" href="#å»¶è¿Ÿç»‘å®š">å»¶è¿Ÿç»‘å®š</a></h4>
<h4 id="å»¶è¿Ÿç»‘å®š-1"><a class="header" href="#å»¶è¿Ÿç»‘å®š-1">å»¶è¿Ÿç»‘å®š</a></h4>
<h4 id="å¤šä¸ªå®ç°"><a class="header" href="#å¤šä¸ªå®ç°">å¤šä¸ªå®ç°</a></h4>
<h2 id="æ³›å‹å‡½æ•°"><a class="header" href="#æ³›å‹å‡½æ•°">æ³›å‹å‡½æ•°</a></h2>
<h3 id="å•æ€åŒ–"><a class="header" href="#å•æ€åŒ–">å•æ€åŒ–</a></h3>
<details id="admonition-ç¼–è¯‘æ—¶å±•å¼€æ³›å‹å‚æ•°å•æ€åŒ–" class="admonition info">
<summary class="admonition-title">
<p>ç¼–è¯‘æ—¶å±•å¼€æ³›å‹å‚æ•°å•æ€åŒ–</p>
<p><a class="admonition-anchor-link" href="#admonition-ç¼–è¯‘æ—¶å±•å¼€æ³›å‹å‚æ•°å•æ€åŒ–"></a></p>
</summary>
<div>
<blockquote>
<p>å¯¹äºæ³›å‹å‡½æ•°ï¼ŒRust ä¼šè¿›è¡Œå•æ€åŒ–ï¼ˆMonomorphizationï¼‰å¤„ç†ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼ŒæŠŠæ‰€æœ‰ç”¨åˆ°çš„æ³›å‹å‡½æ•°çš„æ³›å‹å‚æ•°å±•å¼€ï¼Œç”Ÿæˆè‹¥å¹²ä¸ªå‡½æ•°ã€‚
æ‰€ä»¥ï¼Œä¸‹æ–¹çš„ id() ç¼–è¯‘åä¼šå¾—åˆ° ä¸€ä¸ªå¤„ç†åçš„å¤šä¸ªç‰ˆæœ¬</p>
</blockquote>
<hr />
<pre><pre class="playground"><code class="language-rust  editable">fn id&lt;T&gt;(x: T) -&gt; T {
    x
}

fn main() {
    let int = id(42);
    let string = id(&quot;Tyr&quot;);
    println!(&quot;{}, {}&quot;, int, string);
}
</code></pre></pre>
</div>
</details>
<details id="admonition-å•æ€åŒ–çš„ä¼˜åŠ£" class="admonition info">
<summary class="admonition-title">
<p>å•æ€åŒ–çš„ä¼˜åŠ£</p>
<p><a class="admonition-anchor-link" href="#admonition-å•æ€åŒ–çš„ä¼˜åŠ£"></a></p>
</summary>
<div>
<ol>
<li>å•æ€åŒ–çš„å¥½å¤„æ˜¯:</li>
</ol>
<ul>
<li>æ³›å‹å‡½æ•°çš„è°ƒç”¨æ˜¯é™æ€åˆ†æ´¾ï¼ˆstatic dispatchï¼‰ åœ¨ç¼–è¯‘æ—¶å°±ä¸€ä¸€å¯¹åº”</li>
<li>æ—¢ä¿æœ‰å¤šæ€çš„çµæ´»æ€§ï¼Œåˆæ²¡æœ‰ä»»ä½•æ•ˆç‡çš„æŸå¤±ï¼Œå’Œæ™®é€šå‡½æ•°è°ƒç”¨ä¸€æ ·é«˜æ•ˆã€‚</li>
</ul>
<ol start="2">
<li>åå¤„ï¼šç¼–è¯‘æ…¢ã€æ–‡ä»¶å¤§ã€ä¸¢å¤±æ³›å‹ä¿¡æ¯ã€‚è¿™åè¿‡æ¥åˆæ˜¯åŠ¨æ€åˆ†æ´¾çš„å¥½å¤„</li>
</ol>
<ul>
<li>ä½†æ˜¯å¯¹æ¯”åˆšæ‰ç¼–è¯‘ä¼šå±•å¼€çš„ä»£ç ä¹Ÿèƒ½å¾ˆæ¸…æ¥šçœ‹å‡ºæ¥ï¼Œå•æ€åŒ–æœ‰å¾ˆæ˜æ˜¾çš„åå¤„</li>
<li>å°±æ˜¯ç¼–è¯‘é€Ÿåº¦å¾ˆæ…¢ï¼Œä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œç¼–è¯‘å™¨éœ€è¦æ‰¾åˆ°æ‰€æœ‰ç”¨åˆ°çš„ä¸åŒç±»å‹ï¼Œä¸€ä¸ªä¸ªç¼–è¯‘</li>
<li>æ‰€ä»¥ Rust ç¼–è¯‘ä»£ç çš„é€Ÿåº¦æ€»è¢«äººåæ§½ï¼Œè¿™å’Œå•æ€åŒ–è„±ä¸å¼€å¹²ç³»ï¼ˆå¦ä¸€ä¸ªé‡è¦å› ç´ æ˜¯å®ï¼‰ã€‚</li>
<li>åŒæ—¶ï¼Œè¿™æ ·ç¼–å‡ºæ¥çš„äºŒè¿›åˆ¶ä¼šæ¯”è¾ƒå¤§ï¼Œå› ä¸ºæ³›å‹å‡½æ•°çš„äºŒè¿›åˆ¶ä»£ç å®é™…å­˜åœ¨ N ä»½ã€‚</li>
<li>è¿˜æœ‰ä¸€ä¸ªå¯èƒ½ä½ ä¸æ€ä¹ˆæ³¨æ„çš„é—®é¢˜ï¼šå› ä¸ºå•æ€åŒ–ï¼Œä»£ç ä»¥äºŒè¿›åˆ¶åˆ†å‘ä¼šæŸå¤±æ³›å‹çš„ä¿¡æ¯ã€‚</li>
<li>å¦‚æœæˆ‘å†™äº†ä¸€ä¸ªåº“ï¼Œæä¾›äº†å¦‚ä¸Šçš„ id() å‡½æ•°ï¼Œä½¿ç”¨è¿™ä¸ªåº“çš„å¼€å‘è€…å¦‚æœæ‹¿åˆ°çš„æ˜¯äºŒè¿›åˆ¶</li>
<li>é‚£ä¹ˆè¿™ä¸ªäºŒè¿›åˆ¶ä¸­å¿…é¡»å¸¦æœ‰åŸå§‹çš„æ³›å‹å‡½æ•°ï¼Œæ‰èƒ½æ­£ç¡®è°ƒç”¨ã€‚ä½†å•æ€åŒ–ä¹‹åï¼ŒåŸæœ¬çš„æ³›å‹ä¿¡æ¯å°±è¢«ä¸¢å¼ƒäº†ã€‚</li>
</ul>
</div>
</details>
<h4 id="ä¼˜åŠ£"><a class="header" href="#ä¼˜åŠ£">ä¼˜åŠ£</a></h4>
<h3 id="è¿”å›å€¼æºå¸¦æ³›å‹å‚æ•°"><a class="header" href="#è¿”å›å€¼æºå¸¦æ³›å‹å‚æ•°">è¿”å›å€¼æºå¸¦æ³›å‹å‚æ•°</a></h3>
<h1 id="trait"><a class="header" href="#trait">Trait</a></h1>
<div id="admonition-traitæ¦‚è§ˆå›¾" class="admonition info">
<div class="admonition-title">
<p>traitæ¦‚è§ˆå›¾</p>
<p><a class="admonition-anchor-link" href="#admonition-traitæ¦‚è§ˆå›¾"></a></p>
</div>
<div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/13%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8trait%E6%9D%A5%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3%EF%BC%9F.jpg" alt="traitæ¦‚è§ˆå›¾" /></p>
</div>
</div>
<h2 id="åŸºæœ¬ç»ƒä¹ "><a class="header" href="#åŸºæœ¬ç»ƒä¹ ">åŸºæœ¬ç»ƒä¹ </a></h2>
<h3 id="selfå’Œself"><a class="header" href="#selfå’Œself">Selfå’Œself</a></h3>
<details id="admonition-selfå’ŒselfåŒºåˆ«ä½¿ç”¨-selfå…¶å®å°±æ˜¯é™æ€æ–¹æ³•" class="admonition info">
<summary class="admonition-title">
<p>Selfå’ŒselfåŒºåˆ«ä½¿ç”¨, Selfå…¶å®å°±æ˜¯é™æ€æ–¹æ³•</p>
<p><a class="admonition-anchor-link" href="#admonition-selfå’ŒselfåŒºåˆ«ä½¿ç”¨-selfå…¶å®å°±æ˜¯é™æ€æ–¹æ³•"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::fmt;
use std::io::Write;

struct BufBuilder {
    buf: Vec&lt;u8&gt;,
}

impl BufBuilder {
    pub fn new() -&gt; Self {
        Self {
            buf: Vec::with_capacity(1024),
        }
    }
}

impl fmt::Debug for BufBuilder {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
        write!(f, &quot;{}&quot;, String::from_utf8_lossy(self.buf.as_ref()))
    }
}

impl Write for BufBuilder {
    fn write(&amp;mut self, buf: &amp;[u8]) -&gt; std::io::Result&lt;usize&gt; {
        self.buf.extend_from_slice(buf);
        Ok(buf.len())
    }

    fn flush(&amp;mut self) -&gt; std::io::Result&lt;()&gt; {
        Ok(())
    }
}

fn main() {
    let mut buf = BufBuilder::new();
    buf.write_all(b&quot;Hello world!&quot;).unwrap();
    println!(&quot;{:?}&quot;, buf);
}
</code></pre></pre>
</div>
</details>
<details id="admonition-self-self-å®ä¾‹æ¥è‡ªäºç±»å‹" class="admonition info">
<summary class="admonition-title">
<p>self: Self, å®ä¾‹æ¥è‡ªäºç±»å‹</p>
<p><a class="admonition-anchor-link" href="#admonition-self-self-å®ä¾‹æ¥è‡ªäºç±»å‹"></a></p>
</summary>
<div>
<ol>
<li>Self ä»£è¡¨å½“å‰çš„ç±»å‹ï¼Œæ¯”å¦‚ File ç±»å‹å®ç°äº† Writeï¼Œé‚£ä¹ˆå®ç°è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ Self å°±æŒ‡ä»£ Fileã€‚</li>
<li>self åœ¨ç”¨ä½œæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ—¶ï¼Œå®é™…ä¸Šæ˜¯ self: Self çš„ç®€å†™ï¼Œæ‰€ä»¥ &amp;self æ˜¯ self: &amp;Self, è€Œ &amp;mut self æ˜¯ self: &amp;mut Selfã€‚</li>
</ol>
</div>
</details>
<h3 id="é€’è¿›ç»ƒä¹ traitä½¿ç”¨"><a class="header" href="#é€’è¿›ç»ƒä¹ traitä½¿ç”¨">é€’è¿›ç»ƒä¹ traitä½¿ç”¨</a></h3>
<h4 id="åŸºç¡€å®šä¹‰trait"><a class="header" href="#åŸºç¡€å®šä¹‰trait">åŸºç¡€å®šä¹‰trait</a></h4>
<details id="admonition-å®šä¹‰parse-traitå¹¶å®ç°ä½¿ç”¨" class="admonition info">
<summary class="admonition-title">
<p>å®šä¹‰Parse traitå¹¶å®ç°ä½¿ç”¨</p>
<p><a class="admonition-anchor-link" href="#admonition-å®šä¹‰parse-traitå¹¶å®ç°ä½¿ç”¨"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use regex::Regex;
pub trait Parse {
    fn parse(s: &amp;str) -&gt; Self;
}

impl Parse for u8 {
    fn parse(s: &amp;str) -&gt; Self {
        let re: Regex = Regex::new(r&quot;^[0-9]+&quot;).unwrap();
        if let Some(captures) = re.captures(s) {
            captures
                .get(0)
                .map_or(0, |s| s.as_str().parse().unwrap_or(0))
        } else {
            0
        }
    }
}

#[test]
fn parse_should_work() {
    assert_eq!(u8::parse(&quot;123abcd&quot;), 123);
    assert_eq!(u8::parse(&quot;1234abcd&quot;), 0);
    assert_eq!(u8::parse(&quot;abcd&quot;), 0);
}

fn main() {
    println!(&quot;result: {}&quot;, u8::parse(&quot;255 hello world&quot;));
}
</code></pre></pre>
</div>
</details>
<h4 id="æ·»åŠ æ³›å‹å‚æ•°ä½œä¸ºæ³›å‹çº¦æŸ"><a class="header" href="#æ·»åŠ æ³›å‹å‚æ•°ä½œä¸ºæ³›å‹çº¦æŸ">æ·»åŠ æ³›å‹å‚æ•°ä½œä¸ºæ³›å‹çº¦æŸ</a></h4>
<details id="admonition-impl-parse-for-t" class="admonition info">
<summary class="admonition-title">
<p>impl<T> Parse for T</p>
<p><a class="admonition-anchor-link" href="#admonition-impl-parse-for-t"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::str::FromStr;

use regex::Regex;
pub trait Parse {
    fn parse(s: &amp;str) -&gt; Self;
}

impl&lt;T&gt; Parse for T
where
    T: FromStr + Default,
{
    fn parse(s: &amp;str) -&gt; Self {
        let re: Regex = Regex::new(r&quot;^[0-9]+(\.[0-9]+)?&quot;).unwrap();
        let d = || Default::default();
        if let Some(captures) = re.captures(s) {
            captures
                .get(0)
                .map_or(d(), |s| s.as_str().parse().unwrap_or_else(|_| d()))
        } else {
            d()
        }
    }
}

#[test]
fn parse_should_work() {
    assert_eq!(u32::parse(&quot;123abcd&quot;), 123);
    assert_eq!(u32::parse(&quot;123.45abcd&quot;), 0);
    assert_eq!(f64::parse(&quot;123.45abcd&quot;).to_string(), &quot;123.45&quot;);
    assert_eq!(f64::parse(&quot;abcd&quot;).to_string(), &quot;0&quot;);
}

fn main() {
    println!(&quot;result: {}&quot;, u8::parse(&quot;255 hello world&quot;));
}
</code></pre></pre>
</div>
</details>
<h4 id="ä½¿ç”¨å…³è”ç±»å‹æ·»åŠ resultt-e"><a class="header" href="#ä½¿ç”¨å…³è”ç±»å‹æ·»åŠ resultt-e">ä½¿ç”¨å…³è”ç±»å‹+æ·»åŠ Result&lt;T, E&gt;</a></h4>
<details id="admonition-å…³è”ç±»å‹è‡ªå®šä¹‰error" class="admonition info">
<summary class="admonition-title">
<p>å…³è”ç±»å‹è‡ªå®šä¹‰Error</p>
<p><a class="admonition-anchor-link" href="#admonition-å…³è”ç±»å‹è‡ªå®šä¹‰error"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::str::FromStr;

use regex::Regex;
pub trait Parse {
    type Error;
    fn parse(s: &amp;str) -&gt; Result&lt;Self, Self::Error&gt;
    where
        Self: Sized;
}

impl&lt;T&gt; Parse for T
where
    T: FromStr + Default,
{
    // å®šä¹‰å…³è”ç±»å‹ Error ä¸º String
    type Error = String;
    fn parse(s: &amp;str) -&gt; Result&lt;Self, Self::Error&gt; {
        let re: Regex = Regex::new(r&quot;^[0-9]+(\.[0-9]+)?&quot;).unwrap();
        if let Some(captures) = re.captures(s) {
            // å½“å‡ºé”™æ—¶æˆ‘ä»¬è¿”å› Err(String)
            captures
                .get(0)
                .map_or(Err(&quot;failed to capture&quot;.to_string()), |s| {
                    s.as_str()
                        .parse()
                        .map_err(|_err| &quot;failed to parse captured string&quot;.to_string())
                })
        } else {
            Err(&quot;failed to parse string&quot;.to_string())
        }
    }
}

#[test]
fn parse_should_work() {
    assert_eq!(u32::parse(&quot;123abcd&quot;), Ok(123));
    assert_eq!(
        u32::parse(&quot;123.45abcd&quot;),
        Err(&quot;failed to parse captured string&quot;.into())
    );
    assert_eq!(f64::parse(&quot;123.45abcd&quot;), Ok(123.45));
    assert!(f64::parse(&quot;abcd&quot;).is_err());
}

fn main() {
    println!(&quot;result: {:?}&quot;, u8::parse(&quot;255 hello world&quot;));
}
</code></pre></pre>
</div>
</details>
<h3 id="æ³›å‹çº¦æŸ-æ”¯æŒæ³›å‹çš„trait"><a class="header" href="#æ³›å‹çº¦æŸ-æ”¯æŒæ³›å‹çš„trait">æ³›å‹çº¦æŸ: æ”¯æŒæ³›å‹çš„trait</a></h3>
<h4 id="æ€è€ƒé¢˜"><a class="header" href="#æ€è€ƒé¢˜">æ€è€ƒé¢˜</a></h4>
<details id="admonition-æ³›å‹å‚æ•°implæŠ¥é”™" class="admonition info">
<summary class="admonition-title">
<p>æ³›å‹å‚æ•°implæŠ¥é”™</p>
<p><a class="admonition-anchor-link" href="#admonition-æ³›å‹å‚æ•°implæŠ¥é”™"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::io::{BufWriter, Write};
use std::net::TcpStream;

#[derive(Debug)]
struct MyWriter&lt;W&gt; {
    writer: W,
}

impl&lt;W: Write&gt; MyWriter&lt;W&gt; {
    pub fn new(addr: &amp;str) -&gt; Self {
        let stream = TcpStream::connect(&quot;127.0.0.1:8080&quot;).unwrap();
        Self {
            writer: BufWriter::new(stream),
        }
    }

    pub fn write(&amp;mut self, buf: &amp;str) -&gt; std::io::Result&lt;()&gt; {
        self.writer.write_all(buf.as_bytes())
    }
}

fn main() {
    let writer = MyWriter::new(&quot;127.0.0.1:8080&quot;);
    writer.write(&quot;hello world!&quot;);
}
</code></pre></pre>
</div>
</details>
<div id="admonition-åˆ†æç¼–è¯‘æŠ¥é”™åŸå› " class="admonition tip">
<div class="admonition-title">
<p>åˆ†æç¼–è¯‘æŠ¥é”™åŸå› </p>
<p><a class="admonition-anchor-link" href="#admonition-åˆ†æç¼–è¯‘æŠ¥é”™åŸå› "></a></p>
</div>
<div>
<p>ä¸»è¦åŸå› æ˜¯ï¼Œå®ç° new æ–¹æ³•æ—¶ï¼Œå¯¹æ³›å‹çš„çº¦æŸè¦æ±‚è¦æ»¡è¶³ W: Writeï¼Œè€Œ new çš„å£°æ˜è¿”å›å€¼æ˜¯ Selfï¼Œä¹Ÿå°±æ˜¯è¯´ self.wirter å¿…é¡»æ˜¯ W: Write ç±»å‹(æ³›å‹)ï¼Œä½†å®é™…è¿”å›å€¼æ˜¯ä¸€ä¸ªç¡®å®šçš„ç±»å‹ BufWriter<TcpStream>ï¼Œè¿™ä¸æ»¡è¶³è¦æ±‚ã€‚</p>
</div>
</div>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a class="header" href="#è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</a></h4>
<div id="admonition-è§£å†³æ–¹æ¡ˆæ¢³ç†" class="admonition info">
<div class="admonition-title">
<p>è§£å†³æ–¹æ¡ˆæ¢³ç†</p>
<p><a class="admonition-anchor-link" href="#admonition-è§£å†³æ–¹æ¡ˆæ¢³ç†"></a></p>
</div>
<div>
<ol>
<li>ä¿®æ”¹ new æ–¹æ³•çš„è¿”å›å€¼</li>
<li>å¯¹ç¡®å®šçš„ç±»å‹ MyWriter&lt;BufWriter<TcpStream>&gt;å®ç° new æ–¹æ³•</li>
<li>ä¿®æ”¹ new æ–¹æ³•çš„å®ç°ï¼Œä½¿ç”¨ä¾èµ–æ³¨å…¥</li>
</ol>
</div>
</div>
<details id="admonition-1-ä¿®æ”¹newæ–¹æ³•è¿”å›å€¼" class="admonition info">
<summary class="admonition-title">
<ol>
<li>ä¿®æ”¹newæ–¹æ³•è¿”å›å€¼</li>
</ol>
<p><a class="admonition-anchor-link" href="#admonition-1-ä¿®æ”¹newæ–¹æ³•è¿”å›å€¼"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::io::{BufWriter, Write};
use std::net::TcpStream;

#[derive(Debug)]
struct MyWriter&lt;W&gt; {
    writer: W,
}

impl&lt;W: Write&gt; MyWriter&lt;W&gt; {
    pub fn new(writer: W) -&gt; Self {
        Self { writer }
    }

    pub fn write(&amp;mut self, buf: &amp;str) -&gt; std::io::Result&lt;()&gt; {
        self.writer.write_all(buf.as_bytes())
    }
}

fn main() {
    let stream = TcpStream::connect(&quot;127.0.0.1:8080&quot;).unwrap();

    let mut writer = MyWriter::new(BufWriter::new(stream));
    writer.write(&quot;hello world!&quot;).unwrap();
}
</code></pre></pre>
</div>
</details>
<details id="admonition-2-é’ˆå¯¹å®ç°newæ–¹æ³•" class="admonition info">
<summary class="admonition-title">
<ol start="2">
<li>é’ˆå¯¹å®ç°newæ–¹æ³•</li>
</ol>
<p><a class="admonition-anchor-link" href="#admonition-2-é’ˆå¯¹å®ç°newæ–¹æ³•"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">impl MyWriter&lt;BufWriter&lt;TcpStream&gt;&gt; {
    pub fn new(addr: &amp;str) -&gt; Self {
        let stream = TcpStream::connect(addr).unwrap();
        Self {
            writer: BufWriter::new(stream),
        }
    }
}

fn main() {
    let mut writer = MyWriter::new(&quot;127.0.0.1:8080&quot;);
    writer.write(&quot;hello world!&quot;);
}
</code></pre></pre>
</div>
</details>
<details id="admonition-3-ä½¿ç”¨ä¾èµ–æ³¨å…¥ä¿®æ”¹newæ–¹æ³•å®ç°" class="admonition info">
<summary class="admonition-title">
<ol start="3">
<li>ä½¿ç”¨ä¾èµ–æ³¨å…¥ä¿®æ”¹newæ–¹æ³•å®ç°</li>
</ol>
<p><a class="admonition-anchor-link" href="#admonition-3-ä½¿ç”¨ä¾èµ–æ³¨å…¥ä¿®æ”¹newæ–¹æ³•å®ç°"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">impl&lt;W: Write&gt; MyWriter&lt;W&gt; {
    pub fn new(writer: W) -&gt; Self {
        Self {
            writer,
        }
    }
}

fn main() {
    let stream = TcpStream::connect(&quot;127.0.0.1:8080&quot;).unwrap();
    let mut writer = MyWriter::new(BufWriter::new(stream));
    writer.write(&quot;hello world!&quot;);
}
</code></pre></pre>
</div>
</details>
<h3 id="å…³è”ç±»å‹"><a class="header" href="#å…³è”ç±»å‹">å…³è”ç±»å‹</a></h3>
<h3 id="æ”¯æŒæ³›å‹"><a class="header" href="#æ”¯æŒæ³›å‹">æ”¯æŒæ³›å‹</a></h3>
<details id="admonition-ç‰ˆæœ¬ä¸€æ”¯æŒæ•°å­—ç›¸åŠ " class="admonition info">
<summary class="admonition-title">
<p>ç‰ˆæœ¬ä¸€ï¼šæ”¯æŒæ•°å­—ç›¸åŠ </p>
<p><a class="admonition-anchor-link" href="#admonition-ç‰ˆæœ¬ä¸€æ”¯æŒæ•°å­—ç›¸åŠ "></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::ops::Add;

#[derive(Debug)]
struct Complex {
    real: f64,
    imagine: f64,
}

impl Complex {
    pub fn new(real: f64, imagine: f64) -&gt; Self {
        Self { real, imagine }
    }
}

// å¯¹ Complex ç±»å‹çš„å®ç°
impl Add for Complex {
    type Output = Self;

    // æ³¨æ„ add ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼Œä¼šç§»åŠ¨æ‰€æœ‰æƒ
    fn add(self, rhs: Self) -&gt; Self::Output {
        let real = self.real + rhs.real;
        let imagine = self.imagine + rhs.imagine;
        Self::new(real, imagine)
    }
}


fn main() {
    let c1 = Complex::new(1.0, 1f64);
    let c2 = Complex::new(2 as f64, 3.0);
    println!(&quot;{:?}&quot;, c1 + c2);
    // c1, c2 å·²ç»è¢«ç§»åŠ¨ï¼Œæ‰€ä»¥ä¸‹é¢è¿™å¥æ— æ³•ç¼–è¯‘
    // println!(&quot;{:?}&quot;, c1 + c2);
}
</code></pre></pre>
</div>
</details>
<h3 id="æ”¯æŒç»§æ‰¿"><a class="header" href="#æ”¯æŒç»§æ‰¿">æ”¯æŒç»§æ‰¿</a></h3>
<details id="admonition-trait-ba" class="admonition info">
<summary class="admonition-title">
<p>trait B:A</p>
<p><a class="admonition-anchor-link" href="#admonition-trait-ba"></a></p>
</summary>
<div>
<p>åœ¨ Rust ä¸­ï¼Œä¸€ä¸ª trait å¯ä»¥â€œç»§æ‰¿â€å¦ä¸€ä¸ª trait çš„å…³è”ç±»å‹å’Œå…³è”å‡½æ•°ã€‚æ¯”å¦‚ trait B: A ï¼Œæ˜¯è¯´ä»»ä½•ç±»å‹ Tï¼Œå¦‚æœå®ç°äº† trait Bï¼Œå®ƒä¹Ÿå¿…é¡»å®ç° trait Aï¼Œæ¢å¥è¯è¯´ï¼Œtrait B åœ¨å®šä¹‰æ—¶å¯ä»¥ä½¿ç”¨ trait A ä¸­çš„å…³è”ç±»å‹å’Œæ–¹æ³•ã€‚</p>
<pre><pre class="playground"><code class="language-rust  editable">impl&lt;T: ?Sized&gt; StreamExt for T where T: Stream {}
</code></pre></pre>
<hr />
<p>å¦‚æœä½ å®ç°äº† Stream traitï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ StreamExt é‡Œçš„æ–¹æ³•äº†</p>
</div>
</details>
<h3 id="æ¥å£æŠ½è±¡-or-ç‰¹è®¾å¤šæ€"><a class="header" href="#æ¥å£æŠ½è±¡-or-ç‰¹è®¾å¤šæ€">æ¥å£æŠ½è±¡ or ç‰¹è®¾å¤šæ€</a></h3>
<details id="admonition-å¯¹ä¸åŒç±»å‹ç»Ÿä¸€å®ç°-traitå°†å„ç§æ¥å£å®šä¹‰åœºæ™¯è€ƒè™‘è¿›å»" class="admonition info">
<summary class="admonition-title">
<p>å¯¹ä¸åŒç±»å‹ç»Ÿä¸€å®ç°: traitå°†å„ç§æ¥å£å®šä¹‰åœºæ™¯è€ƒè™‘è¿›å»</p>
<p><a class="admonition-anchor-link" href="#admonition-å¯¹ä¸åŒç±»å‹ç»Ÿä¸€å®ç°-traitå°†å„ç§æ¥å£å®šä¹‰åœºæ™¯è€ƒè™‘è¿›å»"></a></p>
</summary>
<div>
<p>trait ä½œä¸ºå¯¹ä¸åŒæ•°æ®ç»“æ„ä¸­ç›¸åŒè¡Œä¸ºçš„ä¸€ç§æŠ½è±¡ã€‚</p>
<ol>
<li>é™¤äº†åŸºæœ¬ trait ä¹‹å¤–ï¼Œå½“è¡Œä¸ºå’Œå…·ä½“çš„æ•°æ®å…³è”æ—¶ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²è§£ææ—¶å®šä¹‰çš„ Parse traitï¼Œæˆ‘ä»¬å¼•å…¥äº†å¸¦æœ‰å…³è”ç±»å‹çš„ traitï¼ŒæŠŠå’Œè¡Œä¸ºæœ‰å…³çš„æ•°æ®ç±»å‹çš„å®šä¹‰ï¼Œè¿›ä¸€æ­¥å»¶è¿Ÿåˆ° trait å®ç°çš„æ—¶å€™ã€‚</li>
<li>å¯¹äºåŒä¸€ä¸ªç±»å‹çš„åŒä¸€ä¸ª trait è¡Œä¸ºï¼Œå¯ä»¥æœ‰ä¸åŒçš„å®ç°ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰å¤§é‡ä½¿ç”¨çš„ Fromï¼Œæ­¤æ—¶å¯ä»¥ç”¨æ³›å‹ traitã€‚å¯ä»¥è¯´ Rust çš„ trait å°±åƒä¸€æŠŠç‘å£«å†›åˆ€ï¼ŒæŠŠéœ€è¦å®šä¹‰æ¥å£çš„å„ç§åœºæ™¯éƒ½è€ƒè™‘è¿›å»äº†ã€‚</li>
</ol>
</div>
</details>
<details id="admonition-å¯¹ä¸åŒç±»å‹çš„ä¸åŒå®ç°-ç‰¹è®¾å¤šæ€" class="admonition info">
<summary class="admonition-title">
<p>å¯¹ä¸åŒç±»å‹çš„ä¸åŒå®ç°: ç‰¹è®¾å¤šæ€</p>
<p><a class="admonition-anchor-link" href="#admonition-å¯¹ä¸åŒç±»å‹çš„ä¸åŒå®ç°-ç‰¹è®¾å¤šæ€"></a></p>
</summary>
<div>
<p>ç‰¹è®¾å¤šæ€æ˜¯åŒä¸€ç§è¡Œä¸ºçš„ä¸åŒå®ç°ã€‚æ‰€ä»¥å…¶å®ï¼Œé€šè¿‡å®šä¹‰ trait ä»¥åŠä¸ºä¸åŒçš„ç±»å‹å®ç°è¿™ä¸ª traitï¼Œæˆ‘ä»¬å°±å·²ç»å®ç°äº†ç‰¹è®¾å¤šæ€ã€‚</p>
<ol>
<li>Add trait å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ç‰¹è®¾å¤šæ€ï¼ŒåŒæ ·æ˜¯åŠ æ³•æ“ä½œï¼Œæ ¹æ®æ“ä½œæ•°æ®çš„ä¸åŒè¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</li>
<li>Service trait æ˜¯ä¸€ä¸ªä¸é‚£ä¹ˆæ˜æ˜¾çš„ç‰¹è®¾å¤šæ€ï¼ŒåŒæ ·æ˜¯ Web è¯·æ±‚ï¼Œå¯¹äºä¸åŒçš„ URLï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„ä»£ç å»å¤„ç†ã€‚</li>
</ol>
</div>
</details>
<h2 id="trait-object"><a class="header" href="#trait-object">Trait Object</a></h2>
<h3 id="å­ç±»å‹å¤šæ€-åŠ¨æ€åˆ†æ´¾"><a class="header" href="#å­ç±»å‹å¤šæ€-åŠ¨æ€åˆ†æ´¾">å­ç±»å‹å¤šæ€: åŠ¨æ€åˆ†æ´¾</a></h3>
<details id="admonition-åœ¨è¿è¡ŒæœŸå†³å®š" class="admonition info">
<summary class="admonition-title">
<p>åœ¨è¿è¡ŒæœŸå†³å®š</p>
<p><a class="admonition-anchor-link" href="#admonition-åœ¨è¿è¡ŒæœŸå†³å®š"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">pub trait Formatter {
    fn format(&amp;self, input: &amp;mut String) -&gt; bool;
}

struct MarkdownFormatter;
impl Formatter for MarkdownFormatter {
    fn format(&amp;self, input: &amp;mut String) -&gt; bool {
        input.push_str(&quot;\nformatted with Markdown formatter&quot;);
        true
    }
}

struct RustFormatter;
impl Formatter for RustFormatter {
    fn format(&amp;self, input: &amp;mut String) -&gt; bool {
        input.push_str(&quot;\nformatted with Rust formatter&quot;);
        true
    }
}

struct HtmlFormatter;
impl Formatter for HtmlFormatter {
    fn format(&amp;self, input: &amp;mut String) -&gt; bool {
        input.push_str(&quot;\nformatted with HTML formatter&quot;);
        true
    }
}

pub fn format(input: &amp;mut String, formatters: Vec&lt;&amp;dyn Formatter&gt;) {
    for formatter in formatters {
        formatter.format(input);
    }
}

fn main() {
    let mut text = &quot;Hello world!&quot;.to_string();
    let html: &amp;dyn Formatter = &amp;HtmlFormatter;
    let rust: &amp;dyn Formatter = &amp;RustFormatter;
    let formatters = vec![html, rust];
    format(&amp;mut text, formatters);

    println!(&quot;text: {}&quot;, text);
}
</code></pre></pre>
<hr />
<p>è¦æœ‰ä¸€ç§æ‰‹æ®µï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œæ­¤å¤„éœ€è¦å¹¶ä¸”ä»…éœ€è¦ä»»ä½•å®ç°äº† Formatter æ¥å£çš„æ•°æ®ç±»å‹ã€‚åœ¨ Rust é‡Œï¼Œè¿™ç§ç±»å‹å« Trait Objectï¼Œè¡¨ç°ä¸º &amp;dyn Trait æˆ–è€… Boxã€‚</p>
<ol>
<li>è¿™é‡Œç»“æ„ä½“åªæ˜¯å£°æ˜äº†ä¸€ä¸‹ï¼Œå¹¶ä¸å…³æ³¨å…¶åŒ…å«ä»€ä¹ˆå­—æ®µ</li>
</ol>
</div>
</details>
<h3 id="å®ç°æœºç†ptrvtable"><a class="header" href="#å®ç°æœºç†ptrvtable">å®ç°æœºç†ï¼šptr+vtable</a></h3>
<details id="admonition-trait-objectçš„åº•å±‚é€»è¾‘å°±æ˜¯èƒ–æŒ‡é’ˆ" class="admonition info">
<summary class="admonition-title">
<p>Trait Objectçš„åº•å±‚é€»è¾‘å°±æ˜¯èƒ–æŒ‡é’ˆ</p>
<p><a class="admonition-anchor-link" href="#admonition-trait-objectçš„åº•å±‚é€»è¾‘å°±æ˜¯èƒ–æŒ‡é’ˆ"></a></p>
</summary>
<div>
<h2 id="-1"><a class="header" href="#-1"><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/13%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8trait%E6%9D%A5%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3%EF%BC%9F-4258625.jpg" alt="13ï½œç±»å‹ç³»ç»Ÿï¼šå¦‚ä½•ä½¿ç”¨traitæ¥å®šä¹‰æ¥å£ï¼Ÿ" /></a></h2>
<p>HtmlFormatter çš„å¼•ç”¨èµ‹å€¼ç»™ Formatter åï¼Œä¼šç”Ÿæˆä¸€ä¸ª Trait Objectï¼Œåœ¨ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒTrait Object çš„åº•å±‚é€»è¾‘å°±æ˜¯èƒ–æŒ‡é’ˆã€‚</p>
<blockquote>
<p>å…¶ä¸­ï¼Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®æœ¬èº«ï¼Œå¦ä¸€ä¸ªåˆ™æŒ‡å‘è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰ã€‚</p>
</blockquote>
</div>
</details>
<details id="admonition-vtableæ˜¯ä¸€å¼ é™æ€è¡¨" class="admonition info">
<summary class="admonition-title">
<p>vtableæ˜¯ä¸€å¼ é™æ€è¡¨</p>
<p><a class="admonition-anchor-link" href="#admonition-vtableæ˜¯ä¸€å¼ é™æ€è¡¨"></a></p>
</summary>
<div>
<h2 id="-2"><a class="header" href="#-2"><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/13%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8trait%E6%9D%A5%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3%EF%BC%9F-4258661.jpg" alt="13ï½œç±»å‹ç³»ç»Ÿï¼šå¦‚ä½•ä½¿ç”¨traitæ¥å®šä¹‰æ¥å£ï¼Ÿ" /></a></h2>
<ol>
<li>vtable æ˜¯ä¸€å¼ é™æ€çš„è¡¨ï¼ŒRust åœ¨ç¼–è¯‘æ—¶ä¼šä¸ºä½¿ç”¨äº† trait object çš„ç±»å‹çš„ trait å®ç°ç”Ÿæˆä¸€å¼ è¡¨ï¼Œæ”¾åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼ˆä¸€èˆ¬åœ¨ TEXT æˆ– RODATA æ®µï¼‰</li>
</ol>
<blockquote>
<p>åœ¨è¿™å¼ è¡¨é‡Œï¼ŒåŒ…å«å…·ä½“ç±»å‹çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚ sizeã€aligment ä»¥åŠä¸€ç³»åˆ—å‡½æ•°æŒ‡é’ˆ
è¿™ä¸ªæ¥å£æ”¯æŒçš„æ‰€æœ‰çš„æ–¹æ³•ï¼Œæ¯”å¦‚ format() ï¼›å…·ä½“ç±»å‹çš„ drop traitï¼Œå½“ Trait object è¢«é‡Šæ”¾ï¼Œå®ƒç”¨æ¥é‡Šæ”¾å…¶ä½¿ç”¨çš„æ‰€æœ‰èµ„æºã€‚è¿™æ ·ï¼Œå½“åœ¨è¿è¡Œæ—¶æ‰§è¡Œ formatter.format() æ—¶ï¼Œformatter å°±å¯ä»¥ä» vtable é‡Œæ‰¾åˆ°å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œæ‰§è¡Œå…·ä½“çš„æ“ä½œã€‚</p>
</blockquote>
</div>
</details>
<details id="admonition-vtableä¼šä¸ºæ¯ä¸ªç±»å‹çš„æ¯ä¸ªtraitå®ç°ä¸€å¼ è¡¨" class="admonition info">
<summary class="admonition-title">
<p>vtableä¼šä¸ºæ¯ä¸ªç±»å‹çš„æ¯ä¸ªtraitå®ç°ä¸€å¼ è¡¨</p>
<p><a class="admonition-anchor-link" href="#admonition-vtableä¼šä¸ºæ¯ä¸ªç±»å‹çš„æ¯ä¸ªtraitå®ç°ä¸€å¼ è¡¨"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::fmt::{Debug, Display};
use std::mem::transmute;

fn main() {
    let s = String::from(&quot;hello world!&quot;);
    let s1 = String::from(&quot;goodbye world!&quot;);
    // Display / Debug trait object for s
    let w1: &amp;dyn Display = &amp;s;
    let w2: &amp;dyn Debug = &amp;s;

    // Display / Debug trait object for s1
    let w3: &amp;dyn Display = &amp;s1;
    let w4: &amp;dyn Debug = &amp;s1;

    // å¼ºè¡ŒæŠŠ triat object è½¬æ¢æˆä¸¤ä¸ªåœ°å€ (usize, usize)
    // è¿™æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æ˜¯ unsafe
    let (addr1, vtable1): (usize, usize) = unsafe { transmute(w1) };
    let (addr2, vtable2): (usize, usize) = unsafe { transmute(w2) };
    let (addr3, vtable3): (usize, usize) = unsafe { transmute(w3) };
    let (addr4, vtable4): (usize, usize) = unsafe { transmute(w4) };

    // s å’Œ s1 åœ¨æ ˆä¸Šçš„åœ°å€ï¼Œä»¥åŠ main åœ¨ TEXT æ®µçš„åœ°å€
    println!(
        &quot;s: {:p}, s1: {:p}, main(): {:p}&quot;,
        &amp;s, &amp;s1, main as *const ()
    );
    // trait object(s / Display) çš„ ptr åœ°å€å’Œ vtable åœ°å€
    println!(&quot;addr1: 0x{:x}, vtable1: 0x{:x}&quot;, addr1, vtable1);
    // trait object(s / Debug) çš„ ptr åœ°å€å’Œ vtable åœ°å€
    println!(&quot;addr2: 0x{:x}, vtable2: 0x{:x}&quot;, addr2, vtable2);

    // trait object(s1 / Display) çš„ ptr åœ°å€å’Œ vtable åœ°å€
    println!(&quot;addr3: 0x{:x}, vtable3: 0x{:x}&quot;, addr3, vtable3);

    // trait object(s1 / Display) çš„ ptr åœ°å€å’Œ vtable åœ°å€
    println!(&quot;addr4: 0x{:x}, vtable4: 0x{:x}&quot;, addr4, vtable4);

    // æŒ‡å‘åŒä¸€ä¸ªæ•°æ®çš„ trait object å…¶ ptr åœ°å€ç›¸åŒ
    assert_eq!(addr1, addr2);
    assert_eq!(addr3, addr4);

    // æŒ‡å‘åŒä¸€ç§ç±»å‹çš„åŒä¸€ä¸ª trait çš„ vtable åœ°å€ç›¸åŒ
    // è¿™é‡Œéƒ½æ˜¯ String + Display
    assert_eq!(vtable1, vtable3);
    // è¿™é‡Œéƒ½æ˜¯ String + Debug
    assert_eq!(vtable2, vtable4);
}
</code></pre></pre>
</div>
</details>
<h3 id="å¯¹è±¡å®‰å…¨"><a class="header" href="#å¯¹è±¡å®‰å…¨">å¯¹è±¡å®‰å…¨</a></h3>
<details id="admonition-é‚£ä»€ä¹ˆæ ·çš„-trait-ä¸æ˜¯å¯¹è±¡å®‰å…¨çš„å‘¢" class="admonition info">
<summary class="admonition-title">
<p>é‚£ä»€ä¹ˆæ ·çš„ trait ä¸æ˜¯å¯¹è±¡å®‰å…¨çš„å‘¢ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-é‚£ä»€ä¹ˆæ ·çš„-trait-ä¸æ˜¯å¯¹è±¡å®‰å…¨çš„å‘¢"></a></p>
</summary>
<div>
<ol>
<li>å¦‚æœ trait æ‰€æœ‰çš„æ–¹æ³•ï¼Œè¿”å›å€¼æ˜¯ Self æˆ–è€…æºå¸¦æ³›å‹å‚æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ª trait å°±ä¸èƒ½äº§ç”Ÿ trait objectã€‚</li>
<li>ä¸å…è®¸è¿”å› Selfï¼Œæ˜¯å› ä¸º trait object åœ¨äº§ç”Ÿæ—¶ï¼ŒåŸæ¥çš„ç±»å‹ä¼šè¢«æŠ¹å»ï¼Œæ‰€ä»¥ Self ç©¶ç«Ÿæ˜¯è°ä¸çŸ¥é“ã€‚</li>
<li>æ¯”å¦‚ Clone trait åªæœ‰ä¸€ä¸ªæ–¹æ³• clone()ï¼Œè¿”å› Selfï¼Œæ‰€ä»¥å®ƒå°±ä¸èƒ½äº§ç”Ÿ trait objectã€‚</li>
<li>ä¸å…è®¸æºå¸¦æ³›å‹å‚æ•°ï¼Œæ˜¯å› ä¸º Rust é‡Œå¸¦æ³›å‹çš„ç±»å‹åœ¨ç¼–è¯‘æ—¶ä¼šåšå•æ€åŒ–ï¼Œè€Œ trait object æ˜¯è¿è¡Œæ—¶çš„äº§ç‰©ï¼Œä¸¤è€…ä¸èƒ½å…¼å®¹ã€‚</li>
<li>æ¯”å¦‚ Fromtraitï¼Œå› ä¸ºæ•´ä¸ª trait å¸¦äº†æ³›å‹ï¼Œæ¯ä¸ªæ–¹æ³•ä¹Ÿè‡ªç„¶åŒ…å«æ³›å‹ï¼Œå°±ä¸èƒ½äº§ç”Ÿ trait objectã€‚å¦‚æœä¸€ä¸ª trait åªæœ‰éƒ¨åˆ†æ–¹æ³•è¿”å› Self æˆ–è€…ä½¿ç”¨äº†æ³›å‹å‚æ•°ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†æ–¹æ³•åœ¨ trait object ä¸­ä¸èƒ½è°ƒç”¨ã€‚</li>
</ol>
</div>
</details>
<h3 id="ä½¿ç”¨åœºæ™¯"><a class="header" href="#ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</a></h3>
<h4 id="åœ¨å‡½æ•°ä¸­ä½¿ç”¨"><a class="header" href="#åœ¨å‡½æ•°ä¸­ä½¿ç”¨">åœ¨å‡½æ•°ä¸­ä½¿ç”¨</a></h4>
<h4 id="åœ¨å‡½æ•°è¿”å›å€¼ä¸­ä½¿ç”¨"><a class="header" href="#åœ¨å‡½æ•°è¿”å›å€¼ä¸­ä½¿ç”¨">åœ¨å‡½æ•°è¿”å›å€¼ä¸­ä½¿ç”¨</a></h4>
<h5 id="åœ¨æ•°æ®ç»“æ„ä¸­ä½¿ç”¨"><a class="header" href="#åœ¨æ•°æ®ç»“æ„ä¸­ä½¿ç”¨">åœ¨æ•°æ®ç»“æ„ä¸­ä½¿ç”¨</a></h5>
<h2 id="å­¤å„¿è§„åˆ™"><a class="header" href="#å­¤å„¿è§„åˆ™">å­¤å„¿è§„åˆ™</a></h2>
<details id="admonition-å®šä¹‰æˆ–å®ç°è‡³å°‘æœ‰ä¸€ä¸ª" class="admonition info">
<summary class="admonition-title">
<p>å®šä¹‰æˆ–å®ç°ï¼Œè‡³å°‘æœ‰ä¸€ä¸ª</p>
<p><a class="admonition-anchor-link" href="#admonition-å®šä¹‰æˆ–å®ç°è‡³å°‘æœ‰ä¸€ä¸ª"></a></p>
</summary>
<div>
<p>trait å’Œå®ç° trait çš„æ•°æ®ç±»å‹ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªæ˜¯åœ¨å½“å‰ crate ä¸­å®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸èƒ½ä¸ºç¬¬ä¸‰æ–¹çš„ç±»å‹å®ç°ç¬¬ä¸‰æ–¹çš„ traitï¼Œå½“ä½ å°è¯•è¿™ä¹ˆåšæ—¶ï¼ŒRust ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
</div>
</details>
<h2 id="å¸¸ç”¨trait"><a class="header" href="#å¸¸ç”¨trait">å¸¸ç”¨trait</a></h2>
<div id="admonition-å¸¸ç”¨traitåˆ†ç±»æ•´ç†" class="admonition info">
<div class="admonition-title">
<p>å¸¸ç”¨traitåˆ†ç±»æ•´ç†</p>
<p><a class="admonition-anchor-link" href="#admonition-å¸¸ç”¨traitåˆ†ç±»æ•´ç†"></a></p>
</div>
<div>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/14%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9A%E6%9C%89%E5%93%AA%E4%BA%9B%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1%E7%9A%84trait%EF%BC%9F.jpg" alt="14ï½œç±»å‹ç³»ç»Ÿï¼šæœ‰å“ªäº›å¿…é¡»æŒæ¡çš„traitï¼Ÿ" /></p>
</div>
</div>
<h3 id="å†…å­˜ç›¸å…³"><a class="header" href="#å†…å­˜ç›¸å…³">å†…å­˜ç›¸å…³</a></h3>
<details id="admonition-cloneä½¿ç”¨ç¤ºä¾‹" class="admonition info">
<summary class="admonition-title">
<p>Cloneä½¿ç”¨ç¤ºä¾‹</p>
<p><a class="admonition-anchor-link" href="#admonition-cloneä½¿ç”¨ç¤ºä¾‹"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub trait Clone {
  fn clone(&amp;self) -&gt; Self;

  fn clone_from(&amp;mut self, source: &amp;Self) {
    *self = source.clone()
  }
}
</code></pre></pre>
</div>
</details>
<details id="admonition-cloneä¸clone_from" class="admonition info">
<summary class="admonition-title">
<p>clone()ä¸clone_from()</p>
<p><a class="admonition-anchor-link" href="#admonition-cloneä¸clone_from"></a></p>
</summary>
<div>
<p>Clone trait æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œ clone() å’Œ clone_from() ï¼Œåè€…æœ‰ç¼ºçœå®ç°ï¼Œæ‰€ä»¥å¹³æ—¶æˆ‘ä»¬åªéœ€è¦å®ç° clone() æ–¹æ³•å³å¯ã€‚ä½ ä¹Ÿè®¸ä¼šç–‘æƒ‘ï¼Œè¿™ä¸ª clone_from() æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿå› ä¸ºçœ‹èµ·æ¥ a.clone_from(&amp;b) ï¼Œå’Œ a = b.clone() æ˜¯ç­‰ä»·çš„ã€‚å…¶å®ä¸æ˜¯ï¼Œå¦‚æœ a å·²ç»å­˜åœ¨ï¼Œåœ¨ clone è¿‡ç¨‹ä¸­ä¼šåˆ†é…å†…å­˜ï¼Œé‚£ä¹ˆç”¨ a.clone_from(&amp;b) å¯ä»¥é¿å…å†…å­˜åˆ†é…ï¼Œæé«˜æ•ˆç‡ã€‚b.clone() æ˜¯ç­‰ä»·çš„ã€‚å…¶å®ä¸æ˜¯ï¼Œå¦‚æœ a å·²ç»å­˜åœ¨ï¼Œåœ¨ clone è¿‡ç¨‹ä¸­ä¼šåˆ†é…å†…å­˜ï¼Œé‚£ä¹ˆç”¨ a.clone_from(&amp;b) å¯ä»¥é¿å…å†…å­˜åˆ†é…ï¼Œæé«˜æ•ˆç‡ã€‚</p>
</div>
</details>
<details id="admonition-clone-trait-å¯ä»¥é€šè¿‡æ´¾ç”Ÿå®ç›´æ¥å®ç°è¿™æ ·èƒ½ç®€åŒ–ä¸å°‘ä»£ç " class="admonition info">
<summary class="admonition-title">
<p>Clone trait å¯ä»¥é€šè¿‡æ´¾ç”Ÿå®ç›´æ¥å®ç°ï¼Œè¿™æ ·èƒ½ç®€åŒ–ä¸å°‘ä»£ç </p>
<p><a class="admonition-anchor-link" href="#admonition-clone-trait-å¯ä»¥é€šè¿‡æ´¾ç”Ÿå®ç›´æ¥å®ç°è¿™æ ·èƒ½ç®€åŒ–ä¸å°‘ä»£ç "></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">#[derive(Clone, Debug)]
struct Developer {
  name: String,
  age: u8,
  lang: Language
}

#[allow(dead_code)]
#[derive(Clone, Debug)]
enum Language {
  Rust,
  TypeScript,
  Elixir,
  Haskell
}

fn main() {
    let dev = Developer {
        name: &quot;Tyr&quot;.to_string(),
        age: 18,
        lang: Language::Rust
    };
    let dev1 = dev.clone();
    println!(&quot;dev: {:?}, addr of dev name: {:p}&quot;, dev, dev.name.as_str());
    println!(&quot;dev1: {:?}, addr of dev1 name: {:p}&quot;, dev1, dev1.name.as_str())
}
</code></pre></pre>
<hr />
<p>å¦‚æœæ²¡æœ‰ä¸º Language å®ç° Clone çš„è¯ï¼ŒDeveloper çš„æ´¾ç”Ÿå® Clone å°†ä¼šç¼–è¯‘å‡ºé”™ã€‚è¿è¡Œè¿™æ®µä»£ç å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº nameï¼Œä¹Ÿå°±æ˜¯ String ç±»å‹çš„ Cloneï¼Œå…¶å †ä¸Šçš„å†…å­˜ä¹Ÿè¢« Clone äº†ä¸€ä»½ï¼Œæ‰€ä»¥ Clone æ˜¯æ·±åº¦æ‹·è´ï¼Œæ ˆå†…å­˜å’Œå †å†…å­˜ä¸€èµ·æ‹·è´ã€‚</p>
</div>
</details>
<details id="admonition-clone-æ–¹æ³•çš„æ¥å£æ˜¯-self" class="admonition info">
<summary class="admonition-title">
<p>clone æ–¹æ³•çš„æ¥å£æ˜¯ &amp;self</p>
<p><a class="admonition-anchor-link" href="#admonition-clone-æ–¹æ³•çš„æ¥å£æ˜¯-self"></a></p>
</summary>
<div>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œclone æ–¹æ³•çš„æ¥å£æ˜¯ &amp;selfï¼Œè¿™åœ¨ç»å¤§å¤šæ•°åœºåˆä¸‹éƒ½æ˜¯é€‚ç”¨çš„ï¼Œæˆ‘ä»¬åœ¨ clone ä¸€ä¸ªæ•°æ®æ—¶åªéœ€è¦æœ‰å·²æœ‰æ•°æ®çš„åªè¯»å¼•ç”¨ã€‚ä½†å¯¹ Rc è¿™æ ·åœ¨ clone() æ—¶ç»´æŠ¤å¼•ç”¨è®¡æ•°çš„æ•°æ®ç»“æ„ï¼Œclone() è¿‡ç¨‹ä¸­ä¼šæ”¹å˜è‡ªå·±ï¼Œæ‰€ä»¥è¦ç”¨ Cell è¿™æ ·æä¾›å†…éƒ¨å¯å˜æ€§çš„ç»“æ„æ¥è¿›è¡Œæ”¹å˜ï¼Œå¦‚æœä½ ä¹Ÿæœ‰ç±»ä¼¼çš„éœ€æ±‚ï¼Œå¯ä»¥å‚è€ƒ</p>
</div>
</details>
<h4 id="copy"><a class="header" href="#copy">Copy</a></h4>
<details id="admonition-ä¸å¯å˜å¼•ç”¨å®ç°äº†-copyè€Œå¯å˜å¼•ç”¨-mut-t-æ²¡æœ‰å®ç°-copy" class="admonition info">
<summary class="admonition-title">
<p>ä¸å¯å˜å¼•ç”¨å®ç°äº† Copyï¼Œè€Œå¯å˜å¼•ç”¨ &amp;mut T æ²¡æœ‰å®ç° Copy</p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸å¯å˜å¼•ç”¨å®ç°äº†-copyè€Œå¯å˜å¼•ç”¨-mut-t-æ²¡æœ‰å®ç°-copy"></a></p>
</summary>
<div>
<p>ä¸å¯å˜å¼•ç”¨å®ç°äº† Copyï¼Œè€Œå¯å˜å¼•ç”¨ &amp;mut T æ²¡æœ‰å®ç° Copyã€‚ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·ï¼Ÿå› ä¸ºå¦‚æœå¯å˜å¼•ç”¨å®ç°äº† Copy traitï¼Œé‚£ä¹ˆç”Ÿæˆä¸€ä¸ªå¯å˜å¼•ç”¨ç„¶åæŠŠå®ƒèµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œå°±ä¼šè¿èƒŒæ‰€æœ‰æƒè§„åˆ™ï¼š
åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ã€‚å¯è§ï¼ŒRust æ ‡å‡†åº“åœ¨å“ªäº›ç»“æ„å¯ä»¥ Copyã€å“ªäº›ä¸å¯ä»¥ Copy ä¸Šï¼Œæœ‰ç€ä»”ç»†çš„è€ƒé‡ã€‚</p>
</div>
</details>
<h4 id="drop"><a class="header" href="#drop">Drop</a></h4>
<details id="admonition-æœ‰ä¸¤ç§æƒ…å†µä½ å¯èƒ½éœ€è¦æ‰‹å·¥å®ç°-drop" class="admonition info">
<summary class="admonition-title">
<p>æœ‰ä¸¤ç§æƒ…å†µä½ å¯èƒ½éœ€è¦æ‰‹å·¥å®ç° Drop</p>
<p><a class="admonition-anchor-link" href="#admonition-æœ‰ä¸¤ç§æƒ…å†µä½ å¯èƒ½éœ€è¦æ‰‹å·¥å®ç°-drop"></a></p>
</summary>
<div>
<p>å¤§éƒ¨åˆ†åœºæ™¯æ— éœ€ä¸ºæ•°æ®ç»“æ„æä¾› Drop traitï¼Œç³»ç»Ÿé»˜è®¤ä¼šä¾æ¬¡å¯¹æ•°æ®ç»“æ„çš„æ¯ä¸ªåŸŸåš dropã€‚ä½†æœ‰ä¸¤ç§æƒ…å†µä½ å¯èƒ½éœ€è¦æ‰‹å·¥å®ç° Dropã€‚</p>
<ol>
<li>ç¬¬ä¸€ç§æ˜¯å¸Œæœ›åœ¨æ•°æ®ç»“æŸç”Ÿå‘½å‘¨æœŸçš„æ—¶å€™åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚è®°æ—¥å¿—ã€‚</li>
<li>ç¬¬äºŒç§æ˜¯éœ€è¦å¯¹èµ„æºå›æ”¶çš„åœºæ™¯ã€‚ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“ä½ é¢å¤–ä½¿ç”¨äº†å“ªäº›èµ„æºï¼Œä¹Ÿå°±æ— æ³•å¸®åŠ©ä½  drop å®ƒä»¬ã€‚æ¯”å¦‚è¯´é”èµ„æºçš„é‡Šæ”¾ï¼Œ</li>
<li>åœ¨ MutexGuard ä¸­å®ç°äº† Drop æ¥é‡Šæ”¾é”èµ„æºï¼š</li>
</ol>
<pre><pre class="playground"><code class="language-rust  editable">impl&lt;T: ?Sized&gt; Drop for MutexGuard&lt;'_, T&gt; {
    #[inline]
    fn drop(&amp;mut self) {
        unsafe {
            self.lock.poison.done(&amp;self.poison);
            self.lock.inner.raw_unlock();
        }
    }
}
</code></pre></pre>
</div>
</details>
<details id="admonition-copyä¸dropäº’æ–¥" class="admonition info">
<summary class="admonition-title">
<p>Copyä¸Dropäº’æ–¥</p>
<p><a class="admonition-anchor-link" href="#admonition-copyä¸dropäº’æ–¥"></a></p>
</summary>
<div>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCopy trait å’Œ Drop trait æ˜¯äº’æ–¥çš„ï¼Œä¸¤è€…ä¸èƒ½å…±å­˜ï¼Œå½“ä½ å°è¯•ä¸ºåŒä¸€ç§æ•°æ®ç±»å‹å®ç° Copy æ—¶ï¼Œä¹Ÿå®ç° Dropï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚</p>
<blockquote>
<p>è¿™å…¶å®å¾ˆå¥½ç†è§£ï¼š</p>
</blockquote>
<ul>
<li>Copy æ˜¯æŒ‰ä½åšæµ…æ‹·è´ï¼Œé‚£ä¹ˆå®ƒä¼šé»˜è®¤æ‹·è´çš„æ•°æ®æ²¡æœ‰éœ€è¦é‡Šæ”¾çš„èµ„æºï¼›</li>
<li>è€Œ Drop æ°æ°æ˜¯ä¸ºäº†é‡Šæ”¾é¢å¤–çš„èµ„æºè€Œç”Ÿçš„ã€‚</li>
</ul>
<hr />
<p>è¾…åŠ©ç†è§£ï¼Œåœ¨ä»£ç ä¸­ï¼Œå¼ºè¡Œç”¨ Box::into_raw è·å¾—å †å†…å­˜çš„æŒ‡é’ˆï¼Œæ”¾å…¥ RawBuffer ç»“æ„ä¸­ï¼Œè¿™æ ·å°±æ¥ç®¡äº†è¿™å—å †å†…å­˜çš„é‡Šæ”¾ã€‚
è™½ç„¶ RawBuffer å¯ä»¥å®ç° Copy traitï¼Œä½†è¿™æ ·ä¸€æ¥å°±æ— æ³•å®ç° Drop traitã€‚
å¦‚æœç¨‹åºéè¦è¿™ä¹ˆå†™ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºè¯¥é‡Šæ”¾çš„å †å†…å­˜æ²¡æœ‰é‡Šæ”¾ã€‚</p>
<pre><pre class="playground"><code class="language-rust  editable">
use std::{fmt, slice};

// æ³¨æ„è¿™é‡Œï¼Œæˆ‘ä»¬å®ç°äº† Copyï¼Œè¿™æ˜¯å› ä¸º *mut u8/usize éƒ½æ”¯æŒ Copy
#[derive(Clone, Copy)]
struct RawBuffer {
    // è£¸æŒ‡é’ˆç”¨ *const / *mut æ¥è¡¨è¿°ï¼Œè¿™å’Œå¼•ç”¨çš„ &amp; ä¸åŒ
    ptr: *mut u8,
    len: usize,
}

impl From&lt;Vec&lt;u8&gt;&gt; for RawBuffer {
    fn from(vec: Vec&lt;u8&gt;) -&gt; Self {
        let slice = vec.into_boxed_slice();
        Self {
            len: slice.len(),
            // into_raw ä¹‹åï¼ŒBox å°±ä¸ç®¡è¿™å—å†…å­˜çš„é‡Šæ”¾äº†ï¼ŒRawBuffer éœ€è¦å¤„ç†é‡Šæ”¾
            ptr: Box::into_raw(slice) as *mut u8,
        }
    }
}

// å¦‚æœ RawBuffer å®ç°äº† Drop traitï¼Œå°±å¯ä»¥åœ¨æ‰€æœ‰è€…é€€å‡ºæ—¶é‡Šæ”¾å †å†…å­˜
// ç„¶åï¼ŒDrop trait ä¼šè·Ÿ Copy trait å†²çªï¼Œè¦ä¹ˆä¸å®ç° Copyï¼Œè¦ä¹ˆä¸å®ç° Drop
// å¦‚æœä¸å®ç° Dropï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä½†å®ƒä¸ä¼šå¯¹æ­£ç¡®æ€§æœ‰ä»»ä½•ç ´å
// æ¯”å¦‚ä¸ä¼šå‡ºç° use after free è¿™æ ·çš„é—®é¢˜ã€‚
// ä½ å¯ä»¥è¯•ç€æŠŠä¸‹é¢æ³¨é‡Šå»æ‰ï¼Œçœ‹çœ‹ä¼šå‡ºä»€ä¹ˆé—®é¢˜
// impl Drop for RawBuffer {
//     #[inline]
//     fn drop(&amp;mut self) {
//         let data = unsafe { Box::from_raw(slice::from_raw_parts_mut(self.ptr, self.len)) };
//         drop(data)
//     }
// }

impl fmt::Debug for RawBuffer {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {
        let data = self.as_ref();
        write!(f, &quot;{:p}: {:?}&quot;, self.ptr, data)
    }
}

impl AsRef&lt;[u8]&gt; for RawBuffer {
    fn as_ref(&amp;self) -&gt; &amp;[u8] {
        unsafe { slice::from_raw_parts(self.ptr, self.len) }
    }
}

fn main() {
    let data = vec![1, 2, 3, 4];

    let buf: RawBuffer = data.into();

    // å› ä¸º buf å…è®¸ Copyï¼Œæ‰€ä»¥è¿™é‡Œ Copy äº†ä¸€ä»½
    use_buffer(buf);

    // buf è¿˜èƒ½ç”¨
    println!(&quot;buf: {:?}&quot;, buf);
}

fn use_buffer(buf: RawBuffer) {
    println!(&quot;buf to die: {:?}&quot;, buf);

    // è¿™é‡Œä¸ç”¨ç‰¹æ„ dropï¼Œå†™å‡ºæ¥åªæ˜¯ä¸ºäº†è¯´æ˜ Copy å‡ºæ¥çš„ buf è¢« Drop äº†
    drop(buf)
}
</code></pre></pre>
<hr />
<p>ä½†æ˜¯è¿™ä¸ªæ“ä½œä¸ä¼šç ´å Rust çš„æ­£ç¡®æ€§ä¿è¯ï¼šå³ä¾¿ä½  Copy äº† N ä»½ RawBufferï¼Œç”±äºæ— æ³•å®ç° Drop traitï¼ŒRawBuffer æŒ‡å‘çš„é‚£åŒä¸€å—å †å†…å­˜ä¸ä¼šé‡Šæ”¾ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° use after free çš„å†…å­˜å®‰å…¨é—®é¢˜</p>
</div>
</details>
<details id="admonition-å¯¹äºä»£ç å®‰å…¨æ¥è¯´å†…å­˜æ³„æ¼å±å®³å¤§è¿˜æ˜¯-use-after-free-å±å®³å¤§å‘¢" class="admonition info">
<summary class="admonition-title">
<p>å¯¹äºä»£ç å®‰å…¨æ¥è¯´ï¼Œå†…å­˜æ³„æ¼å±å®³å¤§ï¼Ÿè¿˜æ˜¯ use after free å±å®³å¤§å‘¢ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-å¯¹äºä»£ç å®‰å…¨æ¥è¯´å†…å­˜æ³„æ¼å±å®³å¤§è¿˜æ˜¯-use-after-free-å±å®³å¤§å‘¢"></a></p>
</summary>
<div>
<p>å¯¹äºä»£ç å®‰å…¨æ¥è¯´ï¼Œå†…å­˜æ³„æ¼å±å®³å¤§ï¼Ÿè¿˜æ˜¯ use after free å±å®³å¤§å‘¢ï¼Ÿ</p>
<blockquote>
<p>è‚¯å®šæ˜¯åè€…ã€‚</p>
</blockquote>
<ul>
<li>Rust çš„åº•çº¿æ˜¯å†…å­˜å®‰å…¨ï¼Œæ‰€ä»¥ä¸¤å®³ç›¸æƒå–å…¶è½»ã€‚</li>
<li>å®é™…ä¸Šï¼Œä»»ä½•ç¼–ç¨‹è¯­è¨€éƒ½æ— æ³•ä¿è¯ä¸å‘ç”Ÿäººä¸ºçš„å†…å­˜æ³„æ¼</li>
<li>æ¯”å¦‚ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå¼€å‘è€…ç–å¿½äº†ï¼Œå¯¹å“ˆå¸Œè¡¨åªæ·»åŠ ä¸åˆ é™¤ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</li>
<li>ä½† Rust ä¼šä¿è¯å³ä½¿å¼€å‘è€…ç–å¿½äº†ï¼Œä¹Ÿä¸ä¼šå‡ºç°å†…å­˜å®‰å…¨é—®é¢˜ã€‚</li>
</ul>
</div>
</details>
<h3 id="æ ‡ç­¾trait"><a class="header" href="#æ ‡ç­¾trait">æ ‡ç­¾trait</a></h3>
<h4 id="sized"><a class="header" href="#sized">Sized</a></h4>
<details id="admonition-size-data-å’Œå¤„ç†-data-çš„å‡½æ•°-process_data" class="admonition info">
<summary class="admonition-title">
<p>Size: Data å’Œå¤„ç† Data çš„å‡½æ•° process_data</p>
<p><a class="admonition-anchor-link" href="#admonition-size-data-å’Œå¤„ç†-data-çš„å‡½æ•°-process_data"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
struct Data&lt;T&gt; {
    inner: T,
}

fn process_data&lt;T&gt;(data: Data&lt;T&gt;) {
    todo!();
}
</code></pre></pre>
<p>ç­‰ä»·äºï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
struct Data&lt;T: Sized&gt; {
    inner: T,
}

fn process_data&lt;T: Sized&gt;(data: Data&lt;T&gt;) {
    todo!();
}
</code></pre></pre>
<hr />
<p>å¤§éƒ¨åˆ†æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›èƒ½è‡ªåŠ¨æ·»åŠ è¿™æ ·çš„çº¦æŸï¼Œå› ä¸ºè¿™æ ·å®šä¹‰å‡ºçš„æ³›å‹ç»“æ„ï¼Œåœ¨ç¼–è¯‘æœŸï¼Œå¤§å°æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªçº¦æŸï¼ŒT æ˜¯å¤§å°ä¸å›ºå®šçš„ç±»å‹ï¼Œ process_data å‡½æ•°ä¼šæ— æ³•ç¼–è¯‘ã€‚</p>
</div>
</details>
<details id="admonition-sized-åœ¨å°‘æ•°æƒ…å†µä¸‹éœ€è¦-t-æ˜¯å¯å˜ç±»å‹çš„" class="admonition info">
<summary class="admonition-title">
<p>?Sized: åœ¨å°‘æ•°æƒ…å†µä¸‹ï¼Œéœ€è¦ T æ˜¯å¯å˜ç±»å‹çš„</p>
<p><a class="admonition-anchor-link" href="#admonition-sized-åœ¨å°‘æ•°æƒ…å†µä¸‹éœ€è¦-t-æ˜¯å¯å˜ç±»å‹çš„"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub enum Cow&lt;'a, B: ?Sized + 'a&gt; where B: ToOwned,
{
    // å€Ÿç”¨çš„æ•°æ®
    Borrowed(&amp;'a B),
    // æ‹¥æœ‰çš„æ•°æ®
    Owned(&lt;B as ToOwned&gt;::Owned),
}
</code></pre></pre>
<hr />
<p>è¿™æ · B å°±å¯ä»¥æ˜¯ [T] æˆ–è€… str ç±»å‹ï¼Œå¤§å°éƒ½æ˜¯ä¸å›ºå®šçš„ã€‚è¦æ³¨æ„ Borrowed(&amp;â€™a B) å¤§å°æ˜¯å›ºå®šçš„ï¼Œå› ä¸ºå®ƒå†…éƒ¨æ˜¯å¯¹ B çš„ä¸€ä¸ªå¼•ç”¨ï¼Œè€Œå¼•ç”¨çš„å¤§å°æ˜¯å›ºå®šçš„</p>
</div>
</details>
<h4 id="sendsync"><a class="header" href="#sendsync">Send/Sync</a></h4>
<details id="admonition-è¿™ä¸¤ä¸ª-trait-éƒ½æ˜¯-unsafe-auto-trait" class="admonition info">
<summary class="admonition-title">
<p>è¿™ä¸¤ä¸ª trait éƒ½æ˜¯ unsafe auto trait</p>
<p><a class="admonition-anchor-link" href="#admonition-è¿™ä¸¤ä¸ª-trait-éƒ½æ˜¯-unsafe-auto-trait"></a></p>
</summary>
<div>
<p>è¿™ä¸¤ä¸ª trait éƒ½æ˜¯ unsafe auto trait:</p>
<ul>
<li>auto æ„å‘³ç€ç¼–è¯‘å™¨ä¼šåœ¨åˆé€‚çš„åœºåˆï¼Œè‡ªåŠ¨ä¸ºæ•°æ®ç»“æ„æ·»åŠ å®ƒä»¬çš„å®ç°</li>
<li>è€Œ unsafe ä»£è¡¨å®ç°çš„è¿™ä¸ª trait å¯èƒ½ä¼šè¿èƒŒ Rust çš„å†…å­˜å®‰å…¨å‡†åˆ™</li>
<li>å¦‚æœå¼€å‘è€…æ‰‹å·¥å®ç°è¿™ä¸¤ä¸ª trait ï¼Œè¦è‡ªå·±ä¸ºå®ƒä»¬çš„å®‰å…¨æ€§è´Ÿè´£ã€‚</li>
</ul>
</div>
</details>
<details id="admonition-sendsync-æ˜¯-rust-å¹¶å‘å®‰å…¨çš„åŸºç¡€" class="admonition info">
<summary class="admonition-title">
<p>Send/Sync æ˜¯ Rust å¹¶å‘å®‰å…¨çš„åŸºç¡€</p>
<p><a class="admonition-anchor-link" href="#admonition-sendsync-æ˜¯-rust-å¹¶å‘å®‰å…¨çš„åŸºç¡€"></a></p>
</summary>
<div>
<p>Send/Sync æ˜¯ Rust å¹¶å‘å®‰å…¨çš„åŸºç¡€ï¼š</p>
<ul>
<li>å¦‚æœä¸€ä¸ªç±»å‹ T å®ç°äº† Send traitï¼Œæ„å‘³ç€ T å¯ä»¥å®‰å…¨åœ°ä»ä¸€ä¸ªçº¿ç¨‹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æƒå¯ä»¥åœ¨çº¿ç¨‹é—´ç§»åŠ¨ã€‚</li>
<li>å¦‚æœä¸€ä¸ªç±»å‹ T å®ç°äº† Sync traitï¼Œåˆ™æ„å‘³ç€ &amp;T å¯ä»¥å®‰å…¨åœ°åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«ã€‚ä¸€ä¸ªç±»å‹ T æ»¡è¶³ Sync traitï¼Œå½“ä¸”ä»…å½“ &amp;T æ»¡è¶³ Send traitã€‚</li>
</ul>
</div>
</details>
<details id="admonition-sendsync-åœ¨çº¿ç¨‹å®‰å…¨ä¸­çš„ä½œç”¨" class="admonition info">
<summary class="admonition-title">
<p>Send/Sync åœ¨çº¿ç¨‹å®‰å…¨ä¸­çš„ä½œç”¨</p>
<p><a class="admonition-anchor-link" href="#admonition-sendsync-åœ¨çº¿ç¨‹å®‰å…¨ä¸­çš„ä½œç”¨"></a></p>
</summary>
<div>
<p>å¯¹äº Send/Sync åœ¨çº¿ç¨‹å®‰å…¨ä¸­çš„ä½œç”¨ï¼Œå¯ä»¥è¿™ä¹ˆçœ‹:</p>
<ol>
<li>å¦‚æœä¸€ä¸ªç±»å‹ T: Sendï¼Œé‚£ä¹ˆ T åœ¨æŸä¸ªçº¿ç¨‹ä¸­çš„ç‹¬å è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›</li>
<li>å¦‚æœä¸€ä¸ªç±»å‹ T: Syncï¼Œé‚£ä¹ˆ T åœ¨çº¿ç¨‹é—´çš„åªè¯»å…±äº«æ˜¯å®‰å…¨çš„ã€‚</li>
</ol>
</div>
</details>
<details id="admonition-ç»å¤§å¤šæ•°è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„éƒ½æ˜¯æ»¡è¶³-send--sync-çš„æ ‡å‡†åº“ä¸­ä¸æ”¯æŒ-send--sync-çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰" class="admonition info">
<summary class="admonition-title">
<p>ç»å¤§å¤šæ•°è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„éƒ½æ˜¯æ»¡è¶³ Send / Sync çš„ã€‚æ ‡å‡†åº“ä¸­ï¼Œä¸æ”¯æŒ Send / Sync çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰</p>
<p><a class="admonition-anchor-link" href="#admonition-ç»å¤§å¤šæ•°è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„éƒ½æ˜¯æ»¡è¶³-send--sync-çš„æ ‡å‡†åº“ä¸­ä¸æ”¯æŒ-send--sync-çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰"></a></p>
</summary>
<div>
<ol>
<li>è£¸æŒ‡é’ˆ *const T / *mut Tã€‚
å®ƒä»¬æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æ—¢ä¸æ˜¯ Send ä¹Ÿä¸æ˜¯ Syncã€‚</li>
<li>UnsafeCell ä¸æ”¯æŒ Syncã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•ä½¿ç”¨äº† Cell æˆ–è€… RefCell çš„æ•°æ®ç»“æ„ä¸æ”¯æŒ Syncã€‚</li>
<li>å¼•ç”¨è®¡æ•° Rc ä¸æ”¯æŒ Send ä¹Ÿä¸æ”¯æŒ Syncã€‚æ‰€ä»¥ Rc æ— æ³•è·¨çº¿ç¨‹ã€‚</li>
</ol>
</div>
</details>
<details id="admonition-å°è¯•è·¨çº¿ç¨‹ä½¿ç”¨-rc--refcellä¼šå‘ç”Ÿä»€ä¹ˆ" class="admonition info">
<summary class="admonition-title">
<p>å°è¯•è·¨çº¿ç¨‹ä½¿ç”¨ Rc / RefCellï¼Œä¼šå‘ç”Ÿä»€ä¹ˆ</p>
<p><a class="admonition-anchor-link" href="#admonition-å°è¯•è·¨çº¿ç¨‹ä½¿ç”¨-rc--refcellä¼šå‘ç”Ÿä»€ä¹ˆ"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">use std::{
    cell::RefCell,
    rc::Rc,
    sync::{Arc, Mutex},
    thread,
};

// Rc æ—¢ä¸æ˜¯ Sendï¼Œä¹Ÿä¸æ˜¯ Sync
#[allow(dead_code, unused_variables)]
fn rc_is_not_send_and_sync() {
    let a = Rc::new(1);
    let b = a.clone();
    let c = a.clone();

    println!(&quot;{:?} {:?} {:?}&quot;, a, b, c);

    // æ— æ³•ç¼–è¯‘é€šè¿‡
    // thread::spawn(move || {
    //     println!(&quot;c= {:?}&quot;, c);
    // });
}

#[allow(dead_code)]
fn refcell_is_send() {
    let a = RefCell::new(1);
    thread::spawn(move || {
        println!(&quot;a= {:?}&quot;, a);
    });
}

// RefCell ç°åœ¨æœ‰å¤šä¸ª Arc æŒæœ‰å®ƒï¼Œè™½ç„¶ Arc æ˜¯ Send/Syncï¼Œä½† RefCell ä¸æ˜¯ Sync
#[allow(dead_code, unused_variables)]
fn refcell_is_not_sync() {
    let a = Arc::new(RefCell::new(1));
    let b = a.clone();
    let c = a.clone();

    println!(&quot;{:?} {:?} {:?}&quot;, a, b, c);

    // æ— æ³•ç¼–è¯‘é€šè¿‡
    // thread::spawn(move || {
    //     println!(&quot;c= {:?}&quot;, c);
    // });
}

// Arc&lt;Mutext&lt;T&gt;&gt; å¯ä»¥å¤šçº¿ç¨‹å…±äº«ä¸”ä¿®æ”¹æ•°æ®
#[allow(dead_code)]
fn arc_mutext_is_send_sync() {
    let a = Arc::new(Mutex::new(1));
    let b = a.clone();
    let c = a.clone();
    let handle = thread::spawn(move || {
        let mut g = c.lock().unwrap();
        *g += 1;
    });

    {
        let mut g = b.lock().unwrap();
        *g += 1;
    }

    handle.join().unwrap();
    println!(&quot;a= {:?}&quot;, a);
}

// æ— æ³•ç¼–è¯‘é€šè¿‡
// fn mutex_guard_is_not_send() {
//     let mutex = Mutex::new(1);
//     let guard = mutex.lock().unwrap();
//     thread::spawn(|| {
//         println!(&quot;data= {:?}&quot;, guard);
//     });

//     thread::spawn(move || {
//         println!(&quot;data= {:?}&quot;, guard);
//     });
// }

fn main() {}
</code></pre></pre>
</div>
</details>
<details id="admonition-ç”¨åˆ°çš„stdthreadspawn" class="admonition info">
<summary class="admonition-title">
<p>ç”¨åˆ°çš„std::thread::spawn</p>
<p><a class="admonition-anchor-link" href="#admonition-ç”¨åˆ°çš„stdthreadspawn"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub fn spawn&lt;F, T&gt;(f: F) -&gt; JoinHandle&lt;T&gt; 
where
    F: FnOnce() -&gt; T,
    F: Send + 'static,
    T: Send + 'static,
</code></pre></pre>
<hr />
<p>å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè¿™ä¸ªé—­åŒ…éœ€è¦ Send + â€™staticï¼š</p>
<ol>
<li>â€™static æ„æ€æ˜¯é—­åŒ…æ•è·çš„è‡ªç”±å˜é‡å¿…é¡»æ˜¯ä¸€ä¸ªæ‹¥æœ‰æ‰€æœ‰æƒçš„ç±»å‹ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ‹¥æœ‰é™æ€ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ï¼›</li>
<li>Send æ„æ€æ˜¯ï¼Œè¿™äº›è¢«æ•è·è‡ªç”±å˜é‡çš„æ‰€æœ‰æƒå¯ä»¥ä»ä¸€ä¸ªçº¿ç¨‹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ã€‚</li>
</ol>
<blockquote>
<p>ä»è¿™ä¸ªæ¥å£ä¸Šï¼Œå¯ä»¥å¾—å‡ºç»“è®ºï¼šå¦‚æœåœ¨çº¿ç¨‹é—´ä¼ é€’ Rcï¼Œæ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„</p>
</blockquote>
</div>
</details>
<details id="admonition-rcä¸æ”¯æŒsendå’Œsync" class="admonition info">
<summary class="admonition-title">
<p>Rcä¸æ”¯æŒSendå’ŒSync</p>
<p><a class="admonition-anchor-link" href="#admonition-rcä¸æ”¯æŒsendå’Œsync"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
// Rc æ—¢ä¸æ˜¯ Sendï¼Œä¹Ÿä¸æ˜¯ Sync
fn rc_is_not_send_and_sync() {
    let a = Rc::new(1);
    let b = a.clone();
    let c = a.clone();
    thread::spawn(move || {
        println!(&quot;c= {:?}&quot;, c);
    });
}
</code></pre></pre>
<hr />
<h2 id="-3"><a class="header" href="#-3"><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/14%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9A%E6%9C%89%E5%93%AA%E4%BA%9B%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1%E7%9A%84trait%EF%BC%9F-4694742.jpg" alt="Rcä¸æ”¯æŒSend/Sync" /></a></h2>
<p><a href="https://doc.rust-lang.org/std/rc/struct.Rc.html#impl-Send">Rc çš„å®ç°ä¸æ”¯æŒ Send å’Œ Sync</a></p>
</div>
</details>
<details id="admonition-refcell-å¯ä»¥åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒä¹ˆ" class="admonition info">
<summary class="admonition-title">
<p>RefCell å¯ä»¥åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒä¹ˆï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-refcell-å¯ä»¥åœ¨çº¿ç¨‹é—´è½¬ç§»æ‰€æœ‰æƒä¹ˆ"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">fn refcell_is_send() {
    let a = RefCell::new(1);
    thread::spawn(move || {
        println!(&quot;a= {:?}&quot;, a);
    });
}
</code></pre></pre>
<hr />
<blockquote>
<p><a href="https://doc.rust-lang.org/std/cell/struct.RefCell.html#impl-Send">RefCell å®ç°äº† Sendï¼Œä½†æ²¡æœ‰å®ç° Sync</a></p>
</blockquote>
</div>
</details>
<details id="admonition-arcæ”¯æŒsendsync" class="admonition info">
<summary class="admonition-title">
<p>Arcæ”¯æŒSend/Sync</p>
<p><a class="admonition-anchor-link" href="#admonition-arcæ”¯æŒsendsync"></a></p>
</summary>
<div>
<blockquote>
<p><a href="https://doc.rust-lang.org/std/sync/struct.Arc.html#impl-Send">Arcæ”¯æŒSend/Sync</a></p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">
// RefCell ç°åœ¨æœ‰å¤šä¸ª Arc æŒæœ‰å®ƒï¼Œè™½ç„¶ Arc æ˜¯ Send/Syncï¼Œä½† RefCell ä¸æ˜¯ Sync
fn refcell_is_not_sync() {
    let a = Arc::new(RefCell::new(1));
    let b = a.clone();
    let c = a.clone();
    thread::spawn(move || {
        println!(&quot;c= {:?}&quot;, c);
    });
}

</code></pre></pre>
<hr />
<p>å› ä¸º Arc å†…éƒ¨çš„æ•°æ®æ˜¯å…±äº«çš„ï¼Œéœ€è¦æ”¯æŒ Sync çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯ RefCell ä¸æ˜¯ Syncï¼Œç¼–è¯‘å¤±è´¥ã€‚</p>
</div>
</details>
<details id="admonition-åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹æˆ‘ä»¬åªèƒ½ä½¿ç”¨æ”¯æŒ-sendsync-çš„-arc-å’Œ-mutex-ä¸€èµ·æ„é€ ä¸€ä¸ªå¯ä»¥åœ¨å¤šçº¿ç¨‹é—´å…±äº«ä¸”å¯ä»¥ä¿®æ”¹çš„ç±»å‹" class="admonition info">
<summary class="admonition-title">
<p>åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨æ”¯æŒ Send/Sync çš„ Arc ï¼Œå’Œ Mutex ä¸€èµ·ï¼Œæ„é€ ä¸€ä¸ªå¯ä»¥åœ¨å¤šçº¿ç¨‹é—´å…±äº«ä¸”å¯ä»¥ä¿®æ”¹çš„ç±»å‹</p>
<p><a class="admonition-anchor-link" href="#admonition-åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹æˆ‘ä»¬åªèƒ½ä½¿ç”¨æ”¯æŒ-sendsync-çš„-arc-å’Œ-mutex-ä¸€èµ·æ„é€ ä¸€ä¸ªå¯ä»¥åœ¨å¤šçº¿ç¨‹é—´å…±äº«ä¸”å¯ä»¥ä¿®æ”¹çš„ç±»å‹"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
use std::{
    sync::{Arc, Mutex},
    thread,
};

// Arc&lt;Mutex&lt;T&gt;&gt; å¯ä»¥å¤šçº¿ç¨‹å…±äº«ä¸”ä¿®æ”¹æ•°æ®
fn arc_mutext_is_send_sync() {
    let a = Arc::new(Mutex::new(1));
    let b = a.clone();
    let c = a.clone();
    let handle = thread::spawn(move || {
        let mut g = c.lock().unwrap();
        *g += 1;
    });

    {
        let mut g = b.lock().unwrap();
        *g += 1;
    }

    handle.join().unwrap();
    println!(&quot;a= {:?}&quot;, a);
}

fn main() {
    arc_mutext_is_send_sync();
}
</code></pre></pre>
<hr />
<p>æœ€åä¸€ä¸ªæ ‡è®° trait Unpinï¼Œæ˜¯ç”¨äºè‡ªå¼•ç”¨ç±»å‹çš„ï¼Œå±äºFuture traitã€‚</p>
</div>
</details>
<h3 id="ç±»å‹è½¬æ¢"><a class="header" href="#ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</a></h3>
<details id="admonition-å¯¹æ¯”ä¸¤ç§è½¬åŒ–æ–¹å¼" class="admonition info">
<summary class="admonition-title">
<p>å¯¹æ¯”ä¸¤ç§è½¬åŒ–æ–¹å¼</p>
<p><a class="admonition-anchor-link" href="#admonition-å¯¹æ¯”ä¸¤ç§è½¬åŒ–æ–¹å¼"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
// ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä¸ºæ¯ä¸€ç§è½¬æ¢æä¾›ä¸€ä¸ªæ–¹æ³•
// æŠŠå­—ç¬¦ä¸² s è½¬æ¢æˆ Path
let v = s.to_path();
// æŠŠå­—ç¬¦ä¸² s è½¬æ¢æˆ u64
let v = s.to_u64();

// ç¬¬äºŒç§æ–¹æ³•ï¼Œä¸º s å’Œè¦è½¬æ¢çš„ç±»å‹ä¹‹é—´å®ç°ä¸€ä¸ª Into&lt;T&gt; trait
// v çš„ç±»å‹æ ¹æ®ä¸Šä¸‹æ–‡å¾—å‡º
let v = s.into();
// æˆ–è€…ä¹Ÿå¯ä»¥æ˜¾å¼åœ°æ ‡æ³¨ v çš„ç±»å‹
let v: u64 = s.into();
</code></pre></pre>
<hr />
<p>æ˜¾ç„¶ï¼Œç¬¬äºŒç§æ–¹æ³•è¦æ›´å¥½ï¼Œå› ä¸ºå®ƒç¬¦åˆè½¯ä»¶å¼€å‘çš„å¼€é—­åŸåˆ™ï¼ˆOpen-Close Principleï¼‰ï¼Œ</p>
<blockquote>
<p>â€œè½¯ä»¶ä¸­çš„å¯¹è±¡ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ç­‰ï¼‰å¯¹æ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œä½†æ˜¯å¯¹ä¿®æ”¹æ˜¯å°é—­çš„â€ã€‚</p>
</blockquote>
<ol>
<li>åœ¨ç¬¬ä¸€ç§æ–¹å¼ä¸‹ï¼Œæœªæ¥æ¯æ¬¡è¦æ·»åŠ å¯¹æ–°ç±»å‹çš„è½¬æ¢ï¼Œéƒ½è¦é‡æ–°ä¿®æ”¹ç±»å‹ T çš„å®ç°</li>
<li>è€Œç¬¬äºŒç§æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªå¯¹äºæ•°æ®è½¬æ¢ trait çš„æ–°å®ç°å³å¯ã€‚</li>
</ol>
</div>
</details>
<details id="admonition-rust-æä¾›äº†ä¸¤å¥—ä¸åŒçš„-trait" class="admonition info">
<summary class="admonition-title">
<p>Rust æä¾›äº†ä¸¤å¥—ä¸åŒçš„ trait</p>
<p><a class="admonition-anchor-link" href="#admonition-rust-æä¾›äº†ä¸¤å¥—ä¸åŒçš„-trait"></a></p>
</summary>
<div>
<ol>
<li>å€¼ç±»å‹åˆ°å€¼ç±»å‹çš„è½¬æ¢ï¼šFrom / Into / TryFrom / TryInto</li>
<li>å¼•ç”¨ç±»å‹åˆ°å¼•ç”¨ç±»å‹çš„è½¬æ¢ï¼šAsRef / AsMut</li>
</ol>
</div>
</details>
<h4 id="frominto-å€¼åˆ°å€¼"><a class="header" href="#frominto-å€¼åˆ°å€¼">From/Into: å€¼åˆ°å€¼</a></h4>
<details id="admonition-è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„æ€ä¹ˆé€‰å‘¢" class="admonition info">
<summary class="admonition-title">
<p>è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œæ€ä¹ˆé€‰å‘¢ï¼Ÿ</p>
<p><a class="admonition-anchor-link" href="#admonition-è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„æ€ä¹ˆé€‰å‘¢"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">let s = String::from(&quot;Hello world!&quot;);
let s: String = &quot;Hello world!&quot;.into();
</code></pre></pre>
<hr />
<p>è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œæ€ä¹ˆé€‰å‘¢ï¼Ÿ</p>
<ol>
<li>From å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡åšç±»å‹æ¨å¯¼ï¼Œä½¿ç”¨åœºæ™¯æ›´å¤šï¼›</li>
<li>è€Œä¸”å› ä¸ºå®ç°äº† From ä¼šè‡ªåŠ¨å®ç° Intoï¼Œåä¹‹ä¸ä¼šã€‚</li>
<li>æ‰€ä»¥éœ€è¦çš„æ—¶å€™ï¼Œä¸è¦å»å®ç° Intoï¼Œåªè¦å®ç° From å°±å¥½äº†ã€‚</li>
</ol>
</div>
</details>
<details id="admonition-from-å’Œ-into-è¿˜æ˜¯è‡ªåçš„" class="admonition info">
<summary class="admonition-title">
<p>From å’Œ Into è¿˜æ˜¯è‡ªåçš„</p>
<p><a class="admonition-anchor-link" href="#admonition-from-å’Œ-into-è¿˜æ˜¯è‡ªåçš„"></a></p>
</summary>
<div>
<p>æŠŠç±»å‹ T çš„å€¼è½¬æ¢æˆç±»å‹ Tï¼Œä¼šç›´æ¥è¿”å›ã€‚è¿™æ˜¯å› ä¸ºæ ‡å‡†åº“æœ‰å¦‚ä¸‹çš„å®ç°ï¼š</p>
<pre><pre class="playground"><code class="language-rust  editable">
// Fromï¼ˆä»¥åŠ Intoï¼‰æ˜¯è‡ªåçš„
impl&lt;T&gt; From&lt;T&gt; for T {
    fn from(t: T) -&gt; T {
        t
    }
}
</code></pre></pre>
</div>
</details>
<details id="admonition-æœ‰äº†-from-å’Œ-intoå¾ˆå¤šå‡½æ•°çš„æ¥å£å°±å¯ä»¥å˜å¾—çµæ´»" class="admonition info">
<summary class="admonition-title">
<p>æœ‰äº† From å’Œ Intoï¼Œå¾ˆå¤šå‡½æ•°çš„æ¥å£å°±å¯ä»¥å˜å¾—çµæ´»</p>
<p><a class="admonition-anchor-link" href="#admonition-æœ‰äº†-from-å’Œ-intoå¾ˆå¤šå‡½æ•°çš„æ¥å£å°±å¯ä»¥å˜å¾—çµæ´»"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
use std::net::{IpAddr, Ipv4Addr, Ipv6Addr};

fn print(v: impl Into&lt;IpAddr&gt;) {
    println!(&quot;{:?}&quot;, v.into());
}

fn main() {
    let v4: Ipv4Addr = &quot;2.2.2.2&quot;.parse().unwrap();
    let v6: Ipv6Addr = &quot;::1&quot;.parse().unwrap();
    
    // IPAddr å®ç°äº† From&lt;[u8; 4]ï¼Œè½¬æ¢ IPv4 åœ°å€
    print([1, 1, 1, 1]);
    // IPAddr å®ç°äº† From&lt;[u16; 8]ï¼Œè½¬æ¢ IPv6 åœ°å€
    print([0xfe80, 0, 0, 0, 0xaede, 0x48ff, 0xfe00, 0x1122]);
    // IPAddr å®ç°äº† From&lt;Ipv4Addr&gt;
    print(v4);
    // IPAddr å®ç°äº† From&lt;Ipv6Addr&gt;
    print(v6);
}
</code></pre></pre>
<hr />
<p>å‡½æ•°å¦‚æœæ¥å—ä¸€ä¸ª IpAddr ä¸ºå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Into è®©æ›´å¤šçš„ç±»å‹å¯ä»¥è¢«è¿™ä¸ªå‡½æ•°ä½¿ç”¨
æ‰€ä»¥ï¼Œåˆç†åœ°ä½¿ç”¨ From / Intoï¼Œå¯ä»¥è®©ä»£ç å˜å¾—ç®€æ´ï¼Œç¬¦åˆ Rust å¯è¯»æ€§å¼ºçš„é£æ ¼ï¼Œæ›´ç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p>
</div>
</details>
<h4 id="tryfromtryinto-å€¼åˆ°å€¼å¯èƒ½å‡ºç°é”™è¯¯"><a class="header" href="#tryfromtryinto-å€¼åˆ°å€¼å¯èƒ½å‡ºç°é”™è¯¯">TryFrom/TryInto: å€¼åˆ°å€¼ï¼Œå¯èƒ½å‡ºç°é”™è¯¯</a></h4>
<p>æ³¨æ„ï¼Œå¦‚æœä½ çš„æ•°æ®ç±»å‹åœ¨è½¬æ¢è¿‡ç¨‹ä¸­æœ‰å¯èƒ½å‡ºç°é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨ TryFrom å’Œ TryIntoï¼Œå®ƒä»¬çš„ç”¨æ³•å’Œ From / Into ä¸€æ ·ï¼Œåªæ˜¯ trait å†…å¤šäº†ä¸€ä¸ªå…³è”ç±»å‹ Errorï¼Œä¸”è¿”å›çš„ç»“æœæ˜¯ Resultã€‚</p>
<h4 id="asrefasmut-å¼•ç”¨åˆ°å¼•ç”¨"><a class="header" href="#asrefasmut-å¼•ç”¨åˆ°å¼•ç”¨">AsRef/AsMut: å¼•ç”¨åˆ°å¼•ç”¨</a></h4>
<details id="admonition-asrefasmutå®šä¹‰" class="admonition info">
<summary class="admonition-title">
<p>AsRef/AsMutå®šä¹‰</p>
<p><a class="admonition-anchor-link" href="#admonition-asrefasmutå®šä¹‰"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub trait AsRef&lt;T&gt; where T: ?Sized {
    fn as_ref(&amp;self) -&gt; &amp;T;
}

pub trait AsMut&lt;T&gt; where T: ?Sized {
    fn as_mut(&amp;mut self) -&gt; &amp;mut T;
}
</code></pre></pre>
<hr />
<p>åœ¨ trait çš„å®šä¹‰ä¸Šï¼Œéƒ½å…è®¸ T ä½¿ç”¨å¤§å°å¯å˜çš„ç±»å‹ï¼Œå¦‚ strã€[u8] ç­‰ã€‚
AsMut é™¤äº†ä½¿ç”¨å¯å˜å¼•ç”¨ç”Ÿæˆå¯å˜å¼•ç”¨å¤–ï¼Œå…¶å®ƒéƒ½å’Œ AsRef ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹çœ‹ AsRef</p>
</div>
</details>
<details id="admonition-ä½“éªŒä¸€ä¸‹-asref-çš„ä½¿ç”¨å’Œå®ç°" class="admonition info">
<summary class="admonition-title">
<p>ä½“éªŒä¸€ä¸‹ AsRef çš„ä½¿ç”¨å’Œå®ç°</p>
<p><a class="admonition-anchor-link" href="#admonition-ä½“éªŒä¸€ä¸‹-asref-çš„ä½¿ç”¨å’Œå®ç°"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
#[allow(dead_code)]
enum Language {
    Rust,
    TypeScript,
    Elixir,
    Haskell,
}

impl AsRef&lt;str&gt; for Language {
    fn as_ref(&amp;self) -&gt; &amp;str {
        match self {
            Language::Rust =&gt; &quot;Rust&quot;,
            Language::TypeScript =&gt; &quot;TypeScript&quot;,
            Language::Elixir =&gt; &quot;Elixir&quot;,
            Language::Haskell =&gt; &quot;Haskell&quot;,
        }
    }
}

fn print_ref(v: impl AsRef&lt;str&gt;) {
    println!(&quot;{}&quot;, v.as_ref());
}

fn main() {
    let lang = Language::Rust;
    // &amp;str å®ç°äº† AsRef&lt;str&gt;
    print_ref(&quot;Hello world!&quot;);
    // String å®ç°äº† AsRef&lt;str&gt;
    print_ref(&quot;Hello world!&quot;.to_string());
    // æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ enum ä¹Ÿå®ç°äº† AsRef&lt;str&gt;
    print_ref(lang);
}
</code></pre></pre>
<hr />
</div>
</details>
<details id="admonition-vas_refclone" class="admonition info">
<summary class="admonition-title">
<p>v.as_ref().clone()</p>
<p><a class="admonition-anchor-link" href="#admonition-vas_refclone"></a></p>
</summary>
<div>
<p>é¢å¤–è¯´æ˜ä¸€ä¸‹çš„æ˜¯:
å¦‚æœä»£ç å‡ºç° v.as_ref().clone() è¿™æ ·çš„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ è¦å¯¹ v è¿›è¡Œå¼•ç”¨è½¬æ¢ï¼Œç„¶ååˆå¾—åˆ°äº†æ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼ï¼Œé‚£ä¹ˆåº”è¯¥å®ç° Fromï¼Œç„¶ååš v.into()ã€‚</p>
</div>
</details>
<h3 id="æ“ä½œç¬¦ç›¸å…³-derefderefmut"><a class="header" href="#æ“ä½œç¬¦ç›¸å…³-derefderefmut">æ“ä½œç¬¦ç›¸å…³: Deref/DerefMut</a></h3>
<details id="admonition-derefderefmutå®šä¹‰åŠè¯´æ˜" class="admonition info">
<summary class="admonition-title">
<p>Deref/DerefMutå®šä¹‰åŠè¯´æ˜</p>
<p><a class="admonition-anchor-link" href="#admonition-derefderefmutå®šä¹‰åŠè¯´æ˜"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub trait Deref {
    // è§£å¼•ç”¨å‡ºæ¥çš„ç»“æœç±»å‹
    type Target: ?Sized;
    fn deref(&amp;self) -&gt; &amp;Self::Target;
}

pub trait DerefMut: Deref {
    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target;
}
</code></pre></pre>
<hr />
<p>å¯ä»¥çœ‹åˆ°ï¼ŒDerefMut â€œç»§æ‰¿â€äº† Derefï¼Œåªæ˜¯å®ƒé¢å¤–æä¾›äº†ä¸€ä¸ª deref_mut æ–¹æ³•ï¼Œç”¨æ¥è·å–å¯å˜çš„è§£å¼•ç”¨ã€‚æ‰€ä»¥è¿™é‡Œé‡ç‚¹å­¦ä¹  Derefã€‚</p>
</div>
</details>
<details id="admonition-å¯¹äºæ™®é€šçš„å¼•ç”¨è§£å¼•ç”¨å¾ˆç›´è§‚" class="admonition info">
<summary class="admonition-title">
<p>å¯¹äºæ™®é€šçš„å¼•ç”¨ï¼Œè§£å¼•ç”¨å¾ˆç›´è§‚</p>
<p><a class="admonition-anchor-link" href="#admonition-å¯¹äºæ™®é€šçš„å¼•ç”¨è§£å¼•ç”¨å¾ˆç›´è§‚"></a></p>
</summary>
<div>
<blockquote>
<p>å¯¹äºæ™®é€šçš„å¼•ç”¨ï¼Œè§£å¼•ç”¨å¾ˆç›´è§‚ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªæŒ‡å‘å€¼çš„åœ°å€ï¼Œä»è¿™ä¸ªåœ°å€å¯ä»¥è·å–åˆ°æ‰€éœ€è¦çš„å€¼</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">
let mut x = 42;
let y = &amp;mut x;
// è§£å¼•ç”¨ï¼Œå†…éƒ¨è°ƒç”¨ DerefMutï¼ˆå…¶å®ç°å°±æ˜¯ *selfï¼‰
*y += 1;
</code></pre></pre>
</div>
</details>
<details id="admonition-æ™ºèƒ½æŒ‡é’ˆæ¥è¯´æ‹¿ä»€ä¹ˆåŸŸæ¥è§£å¼•ç”¨å°±ä¸é‚£ä¹ˆç›´è§‚-çœ‹çœ‹rcå¦‚ä½•å®ç°deref" class="admonition info">
<summary class="admonition-title">
<p>æ™ºèƒ½æŒ‡é’ˆæ¥è¯´ï¼Œæ‹¿ä»€ä¹ˆåŸŸæ¥è§£å¼•ç”¨å°±ä¸é‚£ä¹ˆç›´è§‚, çœ‹çœ‹Rcå¦‚ä½•å®ç°Deref</p>
<p><a class="admonition-anchor-link" href="#admonition-æ™ºèƒ½æŒ‡é’ˆæ¥è¯´æ‹¿ä»€ä¹ˆåŸŸæ¥è§£å¼•ç”¨å°±ä¸é‚£ä¹ˆç›´è§‚-çœ‹çœ‹rcå¦‚ä½•å®ç°deref"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
impl&lt;T: ?Sized&gt; Deref for Rc&lt;T&gt; {
    type Target = T;

    fn deref(&amp;self) -&gt; &amp;T {
        &amp;self.inner().value
    }
}
</code></pre></pre>
<hr />
<h2 id="å¯ä»¥çœ‹åˆ°å®ƒæœ€ç»ˆæŒ‡å‘äº†å †ä¸Šçš„-rcbox-å†…éƒ¨çš„-value-çš„åœ°å€ç„¶åå¦‚æœå¯¹å…¶è§£å¼•ç”¨çš„è¯å¾—åˆ°äº†-value-å¯¹åº”çš„å€¼ä»¥ä¸‹å›¾ä¸ºä¾‹æœ€ç»ˆæ‰“å°å‡º-v--1"><a class="header" href="#å¯ä»¥çœ‹åˆ°å®ƒæœ€ç»ˆæŒ‡å‘äº†å †ä¸Šçš„-rcbox-å†…éƒ¨çš„-value-çš„åœ°å€ç„¶åå¦‚æœå¯¹å…¶è§£å¼•ç”¨çš„è¯å¾—åˆ°äº†-value-å¯¹åº”çš„å€¼ä»¥ä¸‹å›¾ä¸ºä¾‹æœ€ç»ˆæ‰“å°å‡º-v--1">å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæœ€ç»ˆæŒ‡å‘äº†å †ä¸Šçš„ RcBox å†…éƒ¨çš„ value çš„åœ°å€ï¼Œç„¶åå¦‚æœå¯¹å…¶è§£å¼•ç”¨çš„è¯ï¼Œå¾—åˆ°äº† value å¯¹åº”çš„å€¼ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œæœ€ç»ˆæ‰“å°å‡º v = 1ã€‚</a></h2>
<p>ä»å›¾ä¸­è¿˜å¯ä»¥çœ‹åˆ°ï¼ŒDeref å’Œ DerefMut æ˜¯è‡ªåŠ¨è°ƒç”¨çš„ï¼Œ*b ä¼šè¢«å±•å¼€ä¸º *(b.deref())ã€‚</p>
<p><img src="https://raw.githubusercontent.com/KuanHsiaoKuo/writing_materials/main/imgs/14%EF%BD%9C%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%EF%BC%9A%E6%9C%89%E5%93%AA%E4%BA%9B%E5%BF%85%E9%A1%BB%E6%8E%8C%E6%8F%A1%E7%9A%84trait%EF%BC%9F-4696029.jpg" alt="RcBoxè§£å¼•ç”¨" /></p>
</div>
</details>
<details id="admonition-åœ¨-rust-é‡Œç»å¤§å¤šæ•°æ™ºèƒ½æŒ‡é’ˆéƒ½å®ç°äº†-derefæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºè‡ªå·±çš„æ•°æ®ç»“æ„å®ç°-deref" class="admonition info">
<summary class="admonition-title">
<p>åœ¨ Rust é‡Œï¼Œç»å¤§å¤šæ•°æ™ºèƒ½æŒ‡é’ˆéƒ½å®ç°äº† Derefï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºè‡ªå·±çš„æ•°æ®ç»“æ„å®ç° Deref</p>
<p><a class="admonition-anchor-link" href="#admonition-åœ¨-rust-é‡Œç»å¤§å¤šæ•°æ™ºèƒ½æŒ‡é’ˆéƒ½å®ç°äº†-derefæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºè‡ªå·±çš„æ•°æ®ç»“æ„å®ç°-deref"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
use std::ops::{Deref, DerefMut};

#[derive(Debug)]
struct Buffer&lt;T&gt;(Vec&lt;T&gt;);

impl&lt;T&gt; Buffer&lt;T&gt; {
    pub fn new(v: impl Into&lt;Vec&lt;T&gt;&gt;) -&gt; Self {
        Self(v.into())
    }
}

impl&lt;T&gt; Deref for Buffer&lt;T&gt; {
    type Target = [T];

    fn deref(&amp;self) -&gt; &amp;Self::Target {
        &amp;self.0
    }
}

impl&lt;T&gt; DerefMut for Buffer&lt;T&gt; {
    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {
        &amp;mut self.0
    }
}

fn main() {
    let mut buf = Buffer::new([1, 3, 2, 4]);
    // å› ä¸ºå®ç°äº† Deref å’Œ DerefMutï¼Œè¿™é‡Œ buf å¯ä»¥ç›´æ¥è®¿é—® Vec&lt;T&gt; çš„æ–¹æ³•
    // ä¸‹é¢è¿™å¥ç›¸å½“äºï¼š(&amp;mut buf).deref_mut().sort()ï¼Œä¹Ÿå°±æ˜¯ (&amp;mut buf.0).sort()
    buf.sort();
    println!(&quot;buf: {:?}&quot;, buf);
}
</code></pre></pre>
<hr />
<p>ä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæ•°æ®ç»“æ„ Buffer åŒ…è£¹ä½äº† Vecï¼Œä½†è¿™æ ·ä¸€æ¥ï¼ŒåŸæœ¬ Vec å®ç°äº†çš„å¾ˆå¤šæ–¹æ³•ï¼Œç°åœ¨ä½¿ç”¨èµ·æ¥å°±å¾ˆä¸æ–¹ä¾¿ï¼Œéœ€è¦ç”¨ buf.0 æ¥è®¿é—®ã€‚æ€ä¹ˆåŠï¼Ÿ
å¯ä»¥å®ç° Deref å’Œ DerefMutï¼Œè¿™æ ·åœ¨è§£å¼•ç”¨çš„æ—¶å€™ï¼Œç›´æ¥è®¿é—®åˆ° buf.0ï¼Œçœå»äº†ä»£ç çš„å•°å—¦å’Œæ•°æ®ç»“æ„å†…éƒ¨å­—æ®µçš„éšè—ã€‚</p>
</div>
</details>
<details id="admonition-ç¼–è¯‘å™¨é»˜è®¤å¼ºåˆ¶åšè§£å¼•ç”¨" class="admonition info">
<summary class="admonition-title">
<p>ç¼–è¯‘å™¨é»˜è®¤å¼ºåˆ¶åšè§£å¼•ç”¨</p>
<p><a class="admonition-anchor-link" href="#admonition-ç¼–è¯‘å™¨é»˜è®¤å¼ºåˆ¶åšè§£å¼•ç”¨"></a></p>
</summary>
<div>
<p>åœ¨ä¸Šé¢ä»£ç é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼š
å†™ buf.sort() çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰åšè§£å¼•ç”¨çš„æ“ä½œï¼Œä¸ºä»€ä¹ˆä¼šç›¸å½“äºè®¿é—®äº† buf.0.sort() å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º sort() æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ &amp;mut selfï¼Œæ­¤æ—¶ Rust ç¼–è¯‘å™¨ä¼šå¼ºåˆ¶åš Deref/DerefMut çš„è§£å¼•ç”¨ï¼Œæ‰€ä»¥è¿™ç›¸å½“äº (*(&amp;mut buf)).sort()ã€‚</p>
</div>
</details>
<h3 id="å…¶ä»–debugdisplaydefault"><a class="header" href="#å…¶ä»–debugdisplaydefault">å…¶ä»–ï¼šDebug/Display/Default</a></h3>
<details id="admonition-debugdisplaydefalutå®šä¹‰" class="admonition info">
<summary class="admonition-title">
<p>Debug/Display/Defalutå®šä¹‰</p>
<p><a class="admonition-anchor-link" href="#admonition-debugdisplaydefalutå®šä¹‰"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
pub trait Debug {
    fn fmt(&amp;self, f: &amp;mut Formatter&lt;'_&gt;) -&gt; Result&lt;(), Error&gt;;
}

pub trait Display {
    fn fmt(&amp;self, f: &amp;mut Formatter&lt;'_&gt;) -&gt; Result&lt;(), Error&gt;;
}
</code></pre></pre>
<hr />
<p>å¯ä»¥çœ‹åˆ°ï¼ŒDebug å’Œ Display ä¸¤ä¸ª trait çš„ç­¾åä¸€æ ·ï¼Œéƒ½æ¥å—ä¸€ä¸ª &amp;self å’Œä¸€ä¸ª &amp;mut Formatterã€‚é‚£ä¸ºä»€ä¹ˆè¦æœ‰ä¸¤ä¸ªä¸€æ ·çš„ trait å‘¢ï¼Ÿ</p>
<h2 id="è¿™æ˜¯å› ä¸º-debug-æ˜¯ä¸ºå¼€å‘è€…è°ƒè¯•æ‰“å°æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„è€Œ-display-æ˜¯ç»™ç”¨æˆ·æ˜¾ç¤ºæ•°æ®ç»“æ„æ‰€è®¾è®¡çš„è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ-debug-trait-çš„å®ç°å¯ä»¥é€šè¿‡æ´¾ç”Ÿå®ç›´æ¥ç”Ÿæˆè€Œ-display-å¿…é¡»æ‰‹å·¥å®ç°åœ¨ä½¿ç”¨çš„æ—¶å€™debug-ç”¨--æ¥æ‰“å°display-ç”¨--æ‰“å°"><a class="header" href="#è¿™æ˜¯å› ä¸º-debug-æ˜¯ä¸ºå¼€å‘è€…è°ƒè¯•æ‰“å°æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„è€Œ-display-æ˜¯ç»™ç”¨æˆ·æ˜¾ç¤ºæ•°æ®ç»“æ„æ‰€è®¾è®¡çš„è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ-debug-trait-çš„å®ç°å¯ä»¥é€šè¿‡æ´¾ç”Ÿå®ç›´æ¥ç”Ÿæˆè€Œ-display-å¿…é¡»æ‰‹å·¥å®ç°åœ¨ä½¿ç”¨çš„æ—¶å€™debug-ç”¨--æ¥æ‰“å°display-ç”¨--æ‰“å°">è¿™æ˜¯å› ä¸º Debug æ˜¯ä¸ºå¼€å‘è€…è°ƒè¯•æ‰“å°æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ï¼Œè€Œ Display æ˜¯ç»™ç”¨æˆ·æ˜¾ç¤ºæ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Debug trait çš„å®ç°å¯ä»¥é€šè¿‡æ´¾ç”Ÿå®ç›´æ¥ç”Ÿæˆï¼Œè€Œ Display å¿…é¡»æ‰‹å·¥å®ç°ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼ŒDebug ç”¨ {:?} æ¥æ‰“å°ï¼ŒDisplay ç”¨ {} æ‰“å°ã€‚</a></h2>
<pre><pre class="playground"><code class="language-rust  editable">
pub trait Default {
    fn default() -&gt; Self;
}
---
Default trait ç”¨äºä¸ºç±»å‹æä¾›ç¼ºçœå€¼ã€‚å®ƒä¹Ÿå¯ä»¥é€šè¿‡ derive å® #[derive(Default)] æ¥ç”Ÿæˆå®ç°ï¼Œå‰ææ˜¯ç±»å‹ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½å®ç°äº† Default traitã€‚åœ¨åˆå§‹åŒ–ä¸€ä¸ªæ•°æ®ç»“æ„æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨åˆ†åˆå§‹åŒ–ï¼Œç„¶åå‰©ä½™çš„éƒ¨åˆ†ä½¿ç”¨ Default::default()ã€‚
</code></pre></pre>
</div>
</details>
<details id="admonition-debugdisplaydefaultç»Ÿä¸€ä½¿ç”¨ä¾‹å­" class="admonition info">
<summary class="admonition-title">
<p>Debug/Display/Defaultç»Ÿä¸€ä½¿ç”¨ä¾‹å­</p>
<p><a class="admonition-anchor-link" href="#admonition-debugdisplaydefaultç»Ÿä¸€ä½¿ç”¨ä¾‹å­"></a></p>
</summary>
<div>
<pre><pre class="playground"><code class="language-rust  editable">
use std::fmt;
// struct å¯ä»¥ derive Defaultï¼Œä½†æˆ‘ä»¬éœ€è¦æ‰€æœ‰å­—æ®µéƒ½å®ç°äº† Default
#[derive(Clone, Debug, Default)]
struct Developer {
    name: String,
    age: u8,
    lang: Language,
}

// enum ä¸èƒ½ derive Default
#[allow(dead_code)]
#[derive(Clone, Debug)]
enum Language {
    Rust,
    TypeScript,
    Elixir,
    Haskell,
}

// æ‰‹å·¥å®ç° Default
impl Default for Language {
    fn default() -&gt; Self {
        Language::Rust
    }
}

impl Developer {
    pub fn new(name: &amp;str) -&gt; Self {
        // ç”¨ ..Default::default() ä¸ºå‰©ä½™å­—æ®µä½¿ç”¨ç¼ºçœå€¼
        Self {
            name: name.to_owned(),
            ..Default::default()
        }
    }
}

impl fmt::Display for Developer {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {
        write!(
            f,
            &quot;{}({} years old): {:?} developer&quot;,
            self.name, self.age, self.lang
        )
    }
}

fn main() {
    // ä½¿ç”¨ T::default()
    let dev1 = Developer::default();
    // ä½¿ç”¨ Default::default()ï¼Œä½†æ­¤æ—¶ç±»å‹æ— æ³•é€šè¿‡ä¸Šä¸‹æ–‡æ¨æ–­ï¼Œéœ€è¦æä¾›ç±»å‹
    let dev2: Developer = Default::default();
    // ä½¿ç”¨ T::new
    let dev3 = Developer::new(&quot;Tyr&quot;);
    println!(&quot;dev1: {}\\ndev2: {}\\ndev3: {:?}&quot;, dev1, dev2, dev3);
}
</code></pre></pre>
</div>
</details>
<h2 id="è®¾è®¡æ¶æ„"><a class="header" href="#è®¾è®¡æ¶æ„">è®¾è®¡æ¶æ„</a></h2>
<h3 id="é¡ºæ‰‹è‡ªç„¶"><a class="header" href="#é¡ºæ‰‹è‡ªç„¶">é¡ºæ‰‹è‡ªç„¶</a></h3>
<h3 id="æ¡¥æ¥"><a class="header" href="#æ¡¥æ¥">æ¡¥æ¥</a></h3>
<h3 id="æ§åˆ¶åè½¬"><a class="header" href="#æ§åˆ¶åè½¬">æ§åˆ¶åè½¬</a></h3>
<h3 id="solidåŸåˆ™"><a class="header" href="#solidåŸåˆ™">SOLIDåŸåˆ™</a></h3>

            </main>

            <!--            <script src="https://utteranc.es/client.js"-->
            <!--                    repo="RustMagazine/rust_magazine_2022"-->
            <!--                    issue-term="title"-->
            <!--                    theme="github-light"-->
            <!--                    crossorigin="anonymous"-->
            <!--                    async></script>-->

            <nav class="nav-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->
                    <a rel="prev" href="1_stack_heap_ownership_lifetime_memory.html" class="mobile-nav-chapters previous"
                       title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="3_data_structure.html" class="mobile-nav-chapters next"
                       title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                <div style="clear: both"></div>
            </nav>
        </div>
    </div>

    <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="1_stack_heap_ownership_lifetime_memory.html" class="nav-chapters previous" title="Previous chapter"
               aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="3_data_structure.html" class="nav-chapters next" title="Next chapter"
               aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
    </nav>

</div>



    <script type="text/javascript">
        window.playground_line_numbers = true;
    </script>

    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

<script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="highlight.js" type="text/javascript" charset="utf-8"></script>
<script src="book.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JS scripts -->
    <script type="text/javascript" src="assets/mermaid/mermaid.min.js"></script>
    <script type="text/javascript" src="assets/mermaid/mermaid-init.js"></script>
    <script type="text/javascript" src="assets/smart-anchor.js"></script>
    <script type="text/javascript" src="assets/pagetoc/sidebar.js"></script>

</body>
</html>
