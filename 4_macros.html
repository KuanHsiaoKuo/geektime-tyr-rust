<!DOCTYPE HTML>
<html lang="cn" class="sidebar-visible no-js rust">
<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>IV. å®ç¼–ç¨‹ - Anatomy In First Rust Programming Class ğŸ¦€</title>


    <!-- Custom HTML head -->
    
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="ä»¥rustç¼–ç¨‹ç¬¬ä¸€è¯¾çš„ä»£ç ä¸ºä¾‹è¿›è¡ŒåŸºç¡€ä»£ç åˆ†æ">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff"/>

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="md-favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="assets/pagetoc/pagetoc_style.css">
        <link rel="stylesheet" href="assets/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async type="text/javascript"
                src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<!-- Provide site root to javascript -->
<script type="text/javascript">
    var path_to_root = "";
    var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
</script>

<!-- Work around some values being stored in localStorage wrapped in quotes -->
<script type="text/javascript">
    try {
        var theme = localStorage.getItem('mdbook-theme');
        var sidebar = localStorage.getItem('mdbook-sidebar');

        if (theme.startsWith('"') && theme.endsWith('"')) {
            localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
        }

        if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
            localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
        }
    } catch (e) {
    }
</script>

<!-- Set the theme before any content is loaded, prevents flash -->
<script type="text/javascript">
    var theme;
    try {
        theme = localStorage.getItem('mdbook-theme');
    } catch (e) {
    }
    if (theme === null || theme === undefined) {
        theme = default_theme;
    }
    var html = document.querySelector('html');
    html.classList.remove('no-js')
    html.classList.remove('rust')
    html.classList.add(theme);
    html.classList.add('js');
</script>

<!-- Hide / unhide sidebar before it is displayed -->
<script type="text/javascript">
    var html = document.querySelector('html');
    var sidebar = 'hidden';
    if (document.body.clientWidth >= 1080) {
        try {
            sidebar = localStorage.getItem('mdbook-sidebar');
        } catch (e) {
        }
        sidebar = sidebar || 'visible';
    }
    html.classList.remove('sidebar-visible');
    html.classList.add("sidebar-" + sidebar);
</script>

<nav id="sidebar" class="sidebar" aria-label="Table of contents">
    <div class="sidebar-scrollbox">
        <ol class="chapter"><li class="chapter-item expanded "><a href="anatomy_logic.html"><strong aria-hidden="true">1.</strong> æºç é˜…è¯»é€»è¾‘</a></li><li class="chapter-item expanded "><a href="intro_gdb_lldb.html"><strong aria-hidden="true">2.</strong> gdb/lldbè°ƒè¯•æˆ–æŸ¥çœ‹å†…å­˜ç»“æ„</a></li><li class="chapter-item expanded "><a href="get_hands_dirty.html"><strong aria-hidden="true">3.</strong> get hands dirty</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="httpie.html"><strong aria-hidden="true">3.1.</strong> httpie</a></li><li class="chapter-item expanded "><a href="rgrep.html"><strong aria-hidden="true">3.2.</strong> rgrep</a></li><li class="chapter-item expanded "><a href="thumbor.html"><strong aria-hidden="true">3.3.</strong> thumbor</a></li><li class="chapter-item expanded "><a href="queryer.html"><strong aria-hidden="true">3.4.</strong> queryer</a></li></ol></li><li class="chapter-item expanded "><a href="rust_cores.html"><strong aria-hidden="true">4.</strong> Rustæ ¸å¿ƒæ·±å…¥</a><a class="toggle"><div>â±</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="1_stack_heap_ownership_lifetime_memory.html"><strong aria-hidden="true">4.1.</strong> I. ä»æ ˆå †ã€æ‰€æœ‰æƒã€ç”Ÿå‘½å‘¨æœŸå¼€å§‹å†…å­˜ç®¡ç†</a></li><li class="chapter-item expanded "><a href="2_type_system.html"><strong aria-hidden="true">4.2.</strong> II. ç±»å‹ç³»ç»Ÿ</a></li><li class="chapter-item expanded "><a href="3_data_structure.html"><strong aria-hidden="true">4.3.</strong> III. æ•°æ®ç»“æ„</a></li><li class="chapter-item expanded "><a href="4_macros.html" class="active"><strong aria-hidden="true">4.4.</strong> IV. å®ç¼–ç¨‹</a></li><li class="chapter-item expanded "><a href="5_concurrency_async.html"><strong aria-hidden="true">4.5.</strong> V. å¹¶å‘ä¸å¼‚æ­¥</a></li><li class="chapter-item expanded "><a href="6_unsafe_ffi.html"><strong aria-hidden="true">4.6.</strong> VI. æ··åˆç¼–ç¨‹</a></li></ol></li><li class="chapter-item expanded "><a href="kv_server_design.html"><strong aria-hidden="true">5.</strong> kv serverè®¾è®¡ä¸å®ç°</a></li><li class="chapter-item expanded "><a href="custom_axum_async_web_framework.html"><strong aria-hidden="true">6.</strong> æ„å»ºè‡ªå·±çš„ç±»axumå¼‚æ­¥Webæ¡†æ¶</a></li><li class="chapter-item expanded affix "><a href="checklist.html">Checklist</a></li></ol>
    </div>
    <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
</nav>

<div id="page-wrapper" class="page-wrapper">

    <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
        <div id="menu-bar" class="menu-bar sticky bordered">
            <div class="left-buttons">
                <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </button>
                <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                    <i class="fa fa-paint-brush"></i>
                </button>
                <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                    <li role="none">
                        <button role="menuitem" class="theme" id="light">Light</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="rust">Rust (default)</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="coal">Coal</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="navy">Navy</button>
                    </li>
                    <li role="none">
                        <button role="menuitem" class="theme" id="ayu">Ayu</button>
                    </li>
                </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                            aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                            aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
            </div>

            <h1 class="menu-title">Anatomy In First Rust Programming Class ğŸ¦€</h1>
            <h4 class="menu-bar"><a href="https://kuanhsiaokuo.github.io/think-tool-kit/">ä¿æŒæ‰¹åˆ¤ï¼Œæœ‰æ‰€å–èˆï¼ŒçŸ¥è¡Œåˆä¸€, æ–¹è§çœŸæˆ‘</a> -- ç»ƒæ­¦ä¸ç»ƒåŠŸ
                åˆ°å¤´ä¸€åœºç©º -- ã€Šèµ›åšè‹±é›„ä¼ ã€‹ </h4>
            <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    <a href="https://github.com/KuanHsiaoKuo/geektime-tyr-rust.git" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-rust"></i>
                    </a>
            </div>
        </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                           placeholder="Search this book ..." aria-controls="searchresults-outer"
                           aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>

        <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
        <script type="text/javascript">
            document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
            document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
            Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
            });
        </script>

        <div id="content" class="content">
            <main>

                <!-- Page table of contents -->
                <div class="sidetoc">
                    <nav class="pagetoc"></nav>
                </div>
                <style>.extended-markdown-table {
    display: grid;
}

.extended-markdown-table > div {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 3px 20px;
    border-bottom: 1px solid var(--table-border-color);
    border-right: 1px solid var(--table-border-color);
}

.extended-markdown-table > div.extended-markdown-left-border {
    border-left: 1px solid var(--table-border-color);
}

.extended-markdown-table > div.extended-markdown-header {
    text-align: center;
    background: var(--table-header-bg);
    border-bottom: 1px solid var(--table-header-bg);
    border-right: 1px solid var(--table-header-bg);
    font-weight: bold;
}

.extended-markdown-table > div.extended-markdown-header.extended-markdown-left-border {
    border-left: 1px solid var(--table-header-bg);
}
</style>
<h1 id="iv-å®ç¼–ç¨‹"><a class="header" href="#iv-å®ç¼–ç¨‹">IV å®ç¼–ç¨‹</a></h1>
<!--ts-->
<ul>
<li><a href="#iv-%E5%AE%8F%E7%BC%96%E7%A8%8B">IV å®ç¼–ç¨‹</a>
<ul>
<li><a href="#%E8%B5%84%E6%96%99">èµ„æ–™</a></li>
<li><a href="#%E5%AE%8F%E7%9A%84%E5%88%86%E7%B1%BB">å®çš„åˆ†ç±»</a></li>
<li><a href="#%E8%A1%A8%E6%A0%BC">è¡¨æ ¼</a>
<ul>
<li><a href="#%E5%A3%B0%E6%98%8E%E5%AE%8F%E7%9A%84%E7%BC%BA%E9%99%B7%E8%80%8C%E5%90%8E%E6%9C%89%E4%BA%86%E8%BF%87%E7%A8%8B%E5%AE%8F">å£°æ˜å®çš„ç¼ºé™·ï¼Œè€Œåæœ‰äº†è¿‡ç¨‹å®</a></li>
<li><a href="#%E5%A3%B0%E6%98%8E%E5%AE%8Fdeclarative-macros-macro_rulesbang">å£°æ˜å®(declarative macros): macro_rules!(bang)</a></li>
<li><a href="#%E8%BF%87%E7%A8%8B%E5%AE%8F%E6%B7%B1%E5%BA%A6%E5%AE%9A%E5%88%B6%E4%B8%8E%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81">è¿‡ç¨‹å®ï¼šæ·±åº¦å®šåˆ¶ä¸ç”Ÿæˆä»£ç </a>
<ul>
<li><a href="#%E5%87%BD%E6%95%B0%E5%AE%8F">å‡½æ•°å®</a></li>
<li><a href="#%E5%B1%9E%E6%80%A7%E5%AE%8F">å±æ€§å®</a></li>
<li><a href="#%E6%B4%BE%E7%94%9F%E5%AE%8F">æ´¾ç”Ÿå®</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%A3%B0%E6%98%8E%E5%AE%8F">å£°æ˜å®</a>
<ul>
<li><a href="#rust%E5%B8%B8%E7%94%A8%E5%A3%B0%E6%98%8E%E5%AE%8F">Rustå¸¸ç”¨å£°æ˜å®</a>
<ul>
<li><a href="#println">println!</a></li>
<li><a href="#writeln">writeln!</a></li>
<li><a href="#eprintln">eprintln!</a></li>
</ul>
</li>
<li><a href="#%E7%A4%BA%E4%BE%8B">ç¤ºä¾‹</a>
<ul>
<li><a href="#%E5%A3%B0%E6%98%8E%E5%AE%8F%E7%A4%BA%E6%84%8F%E5%9B%BE">å£°æ˜å®ç¤ºæ„å›¾</a></li>
<li><a href="#macro_rules%E5%AE%9A%E4%B9%89">macro_rules!å®šä¹‰</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8">ä½¿ç”¨</a></li>
</ul>
</li>
<li><a href="#%E5%A3%B0%E6%98%8E%E5%AE%8F%E7%94%A8%E5%88%B0%E7%9A%84%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B">å£°æ˜å®ç”¨åˆ°çš„å‚æ•°ç±»å‹</a></li>
</ul>
</li>
<li><a href="#%E8%BF%87%E7%A8%8B%E5%AE%8F%E6%89%8B%E5%B7%A5%E5%AE%9A%E4%B9%89%E5%9B%BE">è¿‡ç¨‹å®æ‰‹å·¥å®šä¹‰å›¾</a>
<ul>
<li><a href="#cargotoml%E6%B7%BB%E5%8A%A0proc-macro%E5%A3%B0%E6%98%8E">Cargo.tomlæ·»åŠ proc-macroå£°æ˜</a></li>
</ul>
</li>
<li>[è¿‡ç¨‹å‡½æ•°å®: #[proc_macro]](#è¿‡ç¨‹å‡½æ•°å®-proc_macro)
<ul>
<li><a href="#srclibrs%E5%AE%9A%E4%B9%89%E8%BF%87%E7%A8%8B%E5%87%BD%E6%95%B0%E5%AE%8F">src/lib.rs:å®šä¹‰è¿‡ç¨‹å‡½æ•°å®</a></li>
<li><a href="#examplesqueryrs%E4%BD%BF%E7%94%A8">examples/query.rs:ä½¿ç”¨</a></li>
</ul>
</li>
<li>[è¿‡ç¨‹æ´¾ç”Ÿå®: /#[proc_macro_devive(DeriveMacroName)]](#è¿‡ç¨‹æ´¾ç”Ÿå®-proc_macro_devivederivemacroname)
<ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E6%B4%BE%E7%94%9F%E5%AE%8F">å¸¸ç”¨æ´¾ç”Ÿå®</a>
<ul>
<li>[#[derive(Debug)]](#derivedebug)</li>
</ul>
</li>
<li><a href="#%E5%8E%9F%E5%A7%8B%E5%AE%9E%E7%8E%B0builder%E6%A8%A1%E5%BC%8F">åŸå§‹å®ç°builderæ¨¡å¼</a>
<ul>
<li><a href="#%E6%83%B3%E5%88%B0%E8%BE%BE%E5%88%B0%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E7%9A%84%E6%95%88%E6%9E%9C">æƒ³åˆ°è¾¾åˆ°é“¾å¼è°ƒç”¨çš„æ•ˆæœ</a></li>
<li><a href="#%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E5%AE%9A%E4%B9%89">å¯ä»¥è¿™æ ·å®šä¹‰</a></li>
<li><a href="#%E4%BD%86%E6%98%AF%E6%9C%89%E7%82%B9%E7%B9%81%E7%90%90%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E6%B4%BE%E7%94%9F%E5%AE%8F%E6%B4%BE%E7%94%9F%E5%87%BA%E8%BF%99%E4%BA%9B%E4%BB%A3%E7%A0%81">ä½†æ˜¯æœ‰ç‚¹ç¹çï¼Œå¯ä»¥ä½¿ç”¨æ´¾ç”Ÿå®æ´¾ç”Ÿå‡ºè¿™äº›ä»£ç </a></li>
</ul>
</li>
<li><a href="#%E6%B4%BE%E7%94%9F%E5%AE%8F%E6%80%9D%E8%B7%AF">æ´¾ç”Ÿå®æ€è·¯</a>
<ul>
<li><a href="#%E8%A6%81%E7%94%9F%E6%88%90%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E7%89%88">è¦ç”Ÿæˆçš„ä»£ç æ¨¡ç‰ˆ</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E5%AF%B9%E5%BA%94%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ„å»ºå¯¹åº”æ•°æ®ç»“æ„</a></li>
<li><a href="#srclibrs-%E4%BD%BF%E7%94%A8%E6%B4%BE%E7%94%9F%E5%AE%8F%E4%BB%8Etokenstream%E6%8A%BD%E5%8F%96%E5%87%BA%E6%83%B3%E8%A6%81%E7%9A%84%E4%BF%A1%E6%81%AF">src/lib.rs: ä½¿ç”¨æ´¾ç”Ÿå®ä»TokenStreamæŠ½å–å‡ºæƒ³è¦çš„ä¿¡æ¯</a></li>
<li><a href="#examplesraw_commandrs-%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E6%B4%BE%E7%94%9F%E5%AE%8F%E6%8A%BD%E5%8F%96">examples/raw_command.rs: ä½¿ç”¨è¿™ä¸ªæ´¾ç”Ÿå®æŠ½å–</a></li>
<li><a href="#%E8%BF%90%E8%A1%8C%E6%9F%A5%E7%9C%8B%E8%8E%B7%E5%8F%96%E7%9A%84tokenstream">è¿è¡Œï¼ŒæŸ¥çœ‹è·å–çš„TokenStream</a></li>
<li><a href="#srcraw_builderrs-%E4%BD%BF%E7%94%A8anyhow%E4%B8%8Easkama%E6%8A%BD%E5%8F%96tokenstream%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF">src/raw_builder.rs: ä½¿ç”¨anyhowä¸askamaæŠ½å–TokenStreamä¸­çš„ä¿¡æ¯</a></li>
<li><a href="#templatesbuilderj2-%E4%B8%8A%E9%9D%A2askama%E7%94%A8%E5%88%B0%E7%9A%84jinja2%E6%A8%A1%E7%89%88">templates/builder.j2: ä¸Šé¢askamaç”¨åˆ°çš„jinja2æ¨¡ç‰ˆ</a></li>
<li><a href="#srcraw_builderrs-%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%BA%94%E6%8A%BD%E5%8F%96%E6%96%B9%E6%B3%95">src/raw_builder.rs: å®ç°å¯¹åº”æŠ½å–æ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#%E4%BD%BF%E7%94%A8synquote%E5%8F%AF%E4%BB%A5%E4%B8%8D%E7%94%A8%E8%87%AA%E5%B7%B1%E5%AE%9A%E4%B9%89%E6%A8%A1%E7%89%88">ä½¿ç”¨syn/quoteå¯ä»¥ä¸ç”¨è‡ªå·±å®šä¹‰æ¨¡ç‰ˆ</a></li>
</ul>
</li>
<li><a href="#%E8%BF%87%E7%A8%8B%E5%B1%9E%E6%80%A7%E5%AE%8F-proc_macro_derivemacro_name-attributesattr_name">è¿‡ç¨‹å±æ€§å®: proc_macro_derive(macro_name, attributes(attr_name))</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8synquote%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7%E5%AE%8F">ä½¿ç”¨syn/quoteå®šä¹‰å±æ€§å®</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: runner, at: Sun Sep 25 06:10:09 UTC 2022 -->
<!--te-->
<h2 id="èµ„æ–™"><a class="header" href="#èµ„æ–™">èµ„æ–™</a></h2>
<ul>
<li><a href="https://kaisery.github.io/trpl-zh-cn/ch19-06-macros.html">å® - Rust ç¨‹åºè®¾è®¡è¯­è¨€ ç®€ä½“ä¸­æ–‡ç‰ˆ</a></li>
<li><a href="https://doc.rust-lang.org/book/ch19-06-macros.html">Macros - The Rust Programming Language</a></li>
<li><a href="https://doc.rust-lang.org/reference/macros-by-example.html">Macros By Example - The Rust Reference</a></li>
</ul>
<h2 id="å®çš„åˆ†ç±»"><a class="header" href="#å®çš„åˆ†ç±»">å®çš„åˆ†ç±»</a></h2>
<h2 id="è¡¨æ ¼"><a class="header" href="#è¡¨æ ¼">è¡¨æ ¼</a></h2>
<div class="extended-markdown-table"><div class="extended-markdown-header extended-markdown-left-border" style="grid-column-start: 1; grid-column-end: 2; grid-row-start: 1; grid-row-end: 2">Macros</div><div class="extended-markdown-header" style="grid-column-start: 2; grid-column-end: 3; grid-row-start: 1; grid-row-end: 2">Define</div><div class="extended-markdown-header" style="grid-column-start: 3; grid-column-end: 4; grid-row-start: 1; grid-row-end: 2">Usage</div><div class="extended-markdown-header" style="grid-column-start: 4; grid-column-end: 5; grid-row-start: 1; grid-row-end: 2">note</div><div class="extended-markdown-header" style="grid-column-start: 5; grid-column-end: 6; grid-row-start: 1; grid-row-end: 2">Example</div><div class="extended-markdown-left-border" style="grid-column-start: 1; grid-column-end: 2; grid-row-start: 2; grid-row-end: 3">Declarative Macro</div><div class="" style="grid-column-start: 2; grid-column-end: 3; grid-row-start: 2; grid-row-end: 3">#[macro_export]/macro_rules! macro_name{}</div><div class="" style="grid-column-start: 3; grid-column-end: 4; grid-row-start: 2; grid-row-end: 3">macro_name!()</div><div class="" style="grid-column-start: 4; grid-column-end: 5; grid-row-start: 2; grid-row-end: 3"></div><div class="" style="grid-column-start: 5; grid-column-end: 6; grid-row-start: 2; grid-row-end: 3">println!</div><div class="extended-markdown-left-border" style="grid-column-start: 1; grid-column-end: 2; grid-row-start: 3; grid-row-end: 4">Function Macro</div><div class="" style="grid-column-start: 2; grid-column-end: 3; grid-row-start: 3; grid-row-end: 4">#[proc_macros]/pub fn macro_name</div><div class="" style="grid-column-start: 3; grid-column-end: 4; grid-row-start: 3; grid-row-end: 4">macro_name!()</div><div class="" style="grid-column-start: 4; grid-column-end: 5; grid-row-start: 3; grid-row-end: 4">advanced declarative macro</div><div class="" style="grid-column-start: 5; grid-column-end: 6; grid-row-start: 3; grid-row-end: 4"></div><div class="extended-markdown-left-border" style="grid-column-start: 1; grid-column-end: 2; grid-row-start: 4; grid-row-end: 5">Derive Macro</div><div class="" style="grid-column-start: 2; grid-column-end: 3; grid-row-start: 4; grid-row-end: 5">#[proc_macros_derive(DeriveMacroName)]/pub  fn other_fn_name</div><div class="" style="grid-column-start: 3; grid-column-end: 4; grid-row-start: 4; grid-row-end: 5">DeriveMacroName!()</div><div class="" style="grid-column-start: 4; grid-column-end: 5; grid-row-start: 4; grid-row-end: 5"></div><div class="" style="grid-column-start: 5; grid-column-end: 6; grid-row-start: 4; grid-row-end: 5">#[derive(Debug)]</div><div class="extended-markdown-left-border" style="grid-column-start: 1; grid-column-end: 2; grid-row-start: 5; grid-row-end: 6">Attritubte Macro</div><div class="" style="grid-column-start: 2; grid-column-end: 3; grid-row-start: 5; grid-row-end: 6">#[proc_macros_derive(AttributeMacroName, attributes(attr_name))]/pub  fn other_fn_name</div><div class="" style="grid-column-start: 3; grid-column-end: 4; grid-row-start: 5; grid-row-end: 6">Only Diff with DeriveMacro when define struct</div><div class="" style="grid-column-start: 4; grid-column-end: 5; grid-row-start: 5; grid-row-end: 6"></div><div class="" style="grid-column-start: 5; grid-column-end: 6; grid-row-start: 5; grid-row-end: 6"></div></div>
<h3 id="å£°æ˜å®çš„ç¼ºé™·è€Œåæœ‰äº†è¿‡ç¨‹å®"><a class="header" href="#å£°æ˜å®çš„ç¼ºé™·è€Œåæœ‰äº†è¿‡ç¨‹å®">å£°æ˜å®çš„ç¼ºé™·ï¼Œè€Œåæœ‰äº†è¿‡ç¨‹å®</a></h3>
<ul>
<li><a href="https://blog.logrocket.com/macros-in-rust-a-tutorial-with-examples/#limitationsofdeclarativemacros">Macros in Rust: A tutorial with examples - LogRocket Blog</a></li>
</ul>
<div id="admonition-ä¸ºä»€ä¹ˆè¿‡ç¨‹å®å’Œå£°æ˜å®é‚£ä¹ˆåƒ" class="admonition tip">
<div class="admonition-title">
<p>ä¸ºä»€ä¹ˆè¿‡ç¨‹å®å’Œå£°æ˜å®é‚£ä¹ˆåƒ</p>
<p><a class="admonition-anchor-link" href="#admonition-ä¸ºä»€ä¹ˆè¿‡ç¨‹å®å’Œå£°æ˜å®é‚£ä¹ˆåƒ"></a></p>
</div>
<div>
<blockquote>
<p>è¿‡ç¨‹å®çš„ç¼ºé™·</p>
</blockquote>
<ol>
<li>ç¼ºä¹å¯¹å®è‡ªåŠ¨å®Œæˆå’Œæ‰©å±•çš„æ”¯æŒ </li>
<li>è°ƒè¯•å£°æ˜æ€§å®å¾ˆå›°éš¾ </li>
<li>ä¿®æ”¹èƒ½åŠ›æœ‰é™ </li>
<li>è¾ƒå¤§çš„äºŒè¿›åˆ¶æ–‡ä»¶ </li>
<li>æ›´é•¿çš„ç¼–è¯‘æ—¶é—´ï¼ˆè¿™é€‚ç”¨äºå£°æ˜æ€§å®å’Œè¿‡ç¨‹å®ï¼‰</li>
</ol>
<blockquote>
<p>è¿‡ç¨‹å®æ˜¯è¯­æ³•æ ‘çº§åˆ«çš„è½¬æ¢
è¿‡ç¨‹å®æ˜¯å®çš„æ›´é«˜çº§ç‰ˆæœ¬ã€‚è¿‡ç¨‹å®å…è®¸ä½ æ‰©å±•ç°æœ‰çš„ Rust è¯­æ³•ã€‚å®ƒæ¥å—ä»»æ„è¾“å…¥å¹¶è¿”å›æœ‰æ•ˆçš„ Rust ä»£ç ã€‚ 
è¿‡ç¨‹å®æ˜¯å°† TokenStream ä½œä¸ºè¾“å…¥å¹¶è¿”å›å¦ä¸€ä¸ª Token Stream çš„å‡½æ•°ã€‚è¿‡ç¨‹å®æ“ä½œè¾“å…¥ TokenStream ä»¥äº§ç”Ÿè¾“å‡ºæµã€‚</p>
</blockquote>
</div>
</div>
<h3 id="å£°æ˜å®declarative-macros-macro_rulesbang"><a class="header" href="#å£°æ˜å®declarative-macros-macro_rulesbang">å£°æ˜å®(declarative macros): macro_rules!(bang)</a></h3>
<blockquote>
<p>å¯¹ä»£ç æ¨¡ç‰ˆåšç®€å•æ›¿æ¢
å£°æ˜å®å¯ä»¥ç”¨ macro_rules! æ¥æè¿°, å¦‚æœé‡å¤æ€§çš„ä»£ç æ— æ³•ç”¨å‡½æ•°æ¥å°è£…ï¼Œé‚£ä¹ˆå£°æ˜å®å°±æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©</p>
</blockquote>
<h3 id="è¿‡ç¨‹å®æ·±åº¦å®šåˆ¶ä¸ç”Ÿæˆä»£ç "><a class="header" href="#è¿‡ç¨‹å®æ·±åº¦å®šåˆ¶ä¸ç”Ÿæˆä»£ç ">è¿‡ç¨‹å®ï¼šæ·±åº¦å®šåˆ¶ä¸ç”Ÿæˆä»£ç </a></h3>
<ul>
<li><a href="https://www.bilibili.com/video/BV1Za411q7LQ">Rust è¿‡ç¨‹å®(1): å¦‚ä½•ç¡¬ç”Ÿç”Ÿè§£æå’Œæ‰‹å†™è¿‡ç¨‹å®</a></li>
</ul>
<blockquote>
<p>ä¸»è¦ä»¥å¦‚ä½•ä½¿ç”¨ function-like macro åœ¨ä¸ä¾èµ–äº syn / quote çš„æƒ…å†µä¸‹ï¼ŒæŠŠ Json Schema åœ¨ç¼–è¯‘æœŸè½¬æ¢æˆ Rust structã€‚ä¸»è¦ç›®çš„æ˜¯è®©å¤§å®¶ç†Ÿæ‚‰åŸºæœ¬çš„å¤„ç† TokenStream çš„æ€è·¯</p>
</blockquote>
<ul>
<li><a href="https://www.bilibili.com/video/BV1Fu411m7W7">Rust è¿‡ç¨‹å®(2): ä½¿ç”¨ syn/quote æ’°å†™è¿‡ç¨‹å®</a></li>
</ul>
<blockquote>
<p>ä¸»è¦é€šè¿‡ä¸€ä¸ª derive Builder å®ï¼Œæ¥å±•ç¤ºä½¿ç”¨ syn/quote å¦‚ä½•å¼€å‘è¿‡ç¨‹å®ã€‚</p>
</blockquote>
<ul>
<li><a href="https://www.bilibili.com/video/BV1dr4y1v74n">Rust è¿‡ç¨‹å®(3): ä½¿ç”¨ darling å¤„ç† attributes</a></li>
</ul>
<blockquote>
<p>åšä¸ªæ”¶å°¾ï¼Œå¯¹ä¸Šä¸€è®²çš„ derive macro æ”¯æŒ attributesã€‚ æˆ‘ä»¬å¯ä»¥ç›´æ¥è§£æ attributes ç›¸å…³çš„ TokenStreamï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ darling è¿™ä¸ªå¾ˆæ–¹ä¾¿çš„åº“ï¼Œç›´æ¥æŠŠ attributes åƒ
Clap/Structopts é‚£æ ·æ”¶é›†åˆ°ä¸€ä¸ªæ•°æ®ç»“æ„ä¸­ï¼Œç„¶åå†è¿›ä¸€æ­¥å¤„ç†ã€‚</p>
</blockquote>
<div id="admonition-æ€»ç»“" class="admonition info">
<div class="admonition-title">
<p>æ€»ç»“</p>
<p><a class="admonition-anchor-link" href="#admonition-æ€»ç»“"></a></p>
</div>
<div>
<p>è¿™ä¸‰è®²çš„å†…å®¹è™½ç„¶ç®€å•ï¼Œä½†è¶³ä»¥åº”ä»˜å¤§å®¶ç»å¤§å¤šæ•°å®ç¼–ç¨‹çš„éœ€æ±‚ã€‚
å…¶å®æˆ‘ä»¬ç°åœ¨å¯¹ syn åº“çš„ä½¿ç”¨è¿˜åªæ˜¯ä¸€ä¸ªçš®æ¯›ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ·±å…¥
å»æ’°å†™è‡ªå·±çš„æ•°æ®ç»“æ„å»å®ç° Parse traitï¼Œåƒ DeriveInput 
é‚£æ ·å¯ä»¥ç›´æ¥æŠŠ TokenStream è½¬æ¢æˆæˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚</p>
<p>å¤§å®¶æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è‡ªè¡Œå»çœ‹ syn åº“çš„æ–‡æ¡£ã€‚</p>
</div>
</div>
<h4 id="å‡½æ•°å®"><a class="header" href="#å‡½æ•°å®">å‡½æ•°å®</a></h4>
<p>çœ‹èµ·æ¥åƒå‡½æ•°çš„å®ï¼Œä½†åœ¨ç¼–è¯‘æœŸè¿›è¡Œå¤„ç†.</p>
<blockquote>
<p>sqlx ç”¨å‡½æ•°å®æ¥å¤„ç†SQL queryã€tokioä½¿ç”¨å±æ€§å® #[tokio::main] æ¥å¼•å…¥ runtimeã€‚
å®ƒä»¬å¯ä»¥å¸®åŠ©ç›®æ ‡ä»£ç çš„å®ç°é€»è¾‘å˜å¾—æ›´åŠ ç®€å•ï¼Œ ä½†ä¸€èˆ¬é™¤éç‰¹åˆ«å¿…è¦ï¼Œå¦åˆ™å¹¶ä¸æ¨èå†™ã€‚
å¹¶æ²¡æœ‰ç‰¹å®šçš„ä½¿ç”¨åœºæ™¯</p>
</blockquote>
<h4 id="å±æ€§å®"><a class="header" href="#å±æ€§å®">å±æ€§å®</a></h4>
<p>å¯ä»¥åœ¨å…¶ä»–ä»£ç å—ä¸Šæ·»åŠ å±æ€§ï¼Œä¸ºä»£ç å—æä¾›æ›´å¤šåŠŸèƒ½ã€‚</p>
<h4 id="æ´¾ç”Ÿå®"><a class="header" href="#æ´¾ç”Ÿå®">æ´¾ç”Ÿå®</a></h4>
<p>ä¸º deriveå±æ€§æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚è¿™æ˜¯æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨æœ€å¤šçš„å®ï¼Œæ¯”å¦‚ #[derive(Debug)].</p>
<blockquote>
<p>å¦‚æœä½ å®šä¹‰çš„ trait åˆ«äººå®ç°èµ·æ¥æœ‰å›ºå®šçš„æ¨¡å¼å¯å¾ªï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä¸ºå…¶æ„å»ºæ´¾ç”Ÿå®</p>
</blockquote>
<h2 id="å£°æ˜å®"><a class="header" href="#å£°æ˜å®">å£°æ˜å®</a></h2>
<h3 id="rustå¸¸ç”¨å£°æ˜å®"><a class="header" href="#rustå¸¸ç”¨å£°æ˜å®">Rustå¸¸ç”¨å£°æ˜å®</a></h3>
<h4 id="println"><a class="header" href="#println">println!</a></h4>
<ul>
<li><a href="https://doc.rust-lang.org/std/macro.println.html">println in std - Rust</a></li>
<li><a href="https://blog.csdn.net/jiangjkd/article/details/120994956">Rustå£°æ˜å®printlnå‰–æ_ä¸€çº¿coderçš„åšå®¢-CSDNåšå®¢_rust å£°æ˜å®</a></li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[macro_export]
#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]
#[allow_internal_unstable(print_internals, format_args_nl)]
macro_rules! println {
    () =&gt; ($crate::print!(&quot;\n&quot;));
    ($($arg:tt)*) =&gt; ({
        $crate::io::_print($crate::format_args_nl!($($arg)*));
    })
}
<span class="boring">}
</span></code></pre></pre>
<h4 id="writeln"><a class="header" href="#writeln">writeln!</a></h4>
<blockquote>
<p>å¯ä»¥å°†å†…å®¹è¾“å…¥åˆ°æŒ‡å®šæ–‡ä»¶</p>
</blockquote>
<ul>
<li><a href="https://doc.rust-lang.org/std/macro.writeln.html">writeln in std - Rust</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/148945862">rustå…¥é—¨ç¬”è®°â€”ç¿»è¯‘rust writeï¼å® - çŸ¥ä¹</a></li>
</ul>
<pre><code class="language-shell">cargo run --example raw_command &gt; examples/raw_command_output.txt
</code></pre>
<h4 id="eprintln"><a class="header" href="#eprintln">eprintln!</a></h4>
<ul>
<li><a href="https://doc.rust-lang.org/std/macro.eprintln.html">eprintln in std - Rust</a></li>
</ul>
<h3 id="ç¤ºä¾‹"><a class="header" href="#ç¤ºä¾‹">ç¤ºä¾‹</a></h3>
<h4 id="å£°æ˜å®ç¤ºæ„å›¾"><a class="header" href="#å£°æ˜å®ç¤ºæ„å›¾">å£°æ˜å®ç¤ºæ„å›¾</a></h4>
<figure><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="633px" preserveAspectRatio="none" style="width:474px;height:633px;background:#FFFFFF;" version="1.1" viewBox="0 0 474 633" width="474px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="136" x="167.5" y="15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="126" x="172.5" y="32.9951">å£°æ˜å®å®šä¹‰ä½¿ç”¨æµç¨‹</text><ellipse cx="51" cy="57.2969" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><path d="M101,77.2969 L101,389.9531 L462,389.9531 L462,87.2969 L452,77.2969 L101,77.2969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M452,77.2969 L452,87.2969 L462,87.2969 L452,77.2969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="107" y="94.3638">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="123" y="94.3638">[macro_export]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="107" y="109.4966">macro_rules! my_vec {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="123" y="124.6294">// æ²¡å¸¦ä»»ä½•å‚æ•°çš„ my_vecï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºçš„ vec</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="123" y="139.7622">// æ³¨æ„ï¼Œç”±äºå®è¦åœ¨è°ƒç”¨çš„åœ°æ–¹å±•å¼€ï¼Œæˆ‘ä»¬æ— æ³•é¢„æµ‹è°ƒç”¨</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="123" y="154.895">// è€…çš„ç¯å¢ƒæ˜¯å¦å·²ç» åšäº†ç›¸å…³çš„ useï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨çš„</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="123" y="170.0278">// ä»£ç æœ€å¥½å¸¦ç€å®Œæ•´çš„å‘½åç©ºé—´ã€‚</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="123" y="185.1606">() =&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="139" y="200.2935">std::vec::Vec::new()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="123" y="215.4263">};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="123" y="230.5591">// å¤„ç† my_vec![1, 2, 3, 4]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="123" y="245.6919">($($el:expr),*) =&gt; ({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="139" y="260.8247">let mut v = std::vec::Vec::new();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="139" y="275.9575">$(v.push($el);)*</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="139" y="291.0903">v</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="123" y="306.2231">});</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="123" y="321.356">// å¤„ç† my_vec![0; 10]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="123" y="336.4888">($el:expr; $n:expr) =&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="139" y="351.6216">std::vec::from_elem($el, $n)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="123" y="366.7544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="107" y="381.8872">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="11" y="216.6406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="21" y="237.7793">å®šä¹‰å£°æ˜å®</text><path d="M101,399.9531 L101,621.8125 L318,621.8125 L318,409.9531 L308,399.9531 L101,399.9531 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M308,399.9531 L308,409.9531 L318,409.9531 L308,399.9531 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="107" y="417.02">fn main() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="123" y="432.1528">let mut v = my_vec![];</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="123" y="447.2856">v.push(1);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="123" y="462.4185">// è°ƒç”¨æ—¶å¯ä»¥ä½¿ç”¨ [], (), {}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="123" y="477.5513">let _v = my_vec!(1, 2, 3, 4);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="123" y="492.6841">let _v = my_vec![1, 2, 3, 4];</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="123" y="507.8169">let v = my_vec! {1, 2, 3, 4};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="123" y="522.9497">println!("{:?}", v);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="107" y="538.0825">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="123" y="553.2153">println!("{:?}", v);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="123" y="568.3481">//</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="123" y="583.481">let v = my_vec![1; 10];</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="123" y="598.6138">println!("{:?}", v);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="107" y="613.7466">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="11" y="493.8984"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="21" y="515.0371">ä½¿ç”¨å£°æ˜å®</text><line style="stroke:#181818;stroke-width:1.0;" x1="51" x2="51" y1="67.2969" y2="216.6406"/><polygon fill="#181818" points="47,206.6406,51,216.6406,55,206.6406,51,210.6406" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="51" x2="51" y1="250.6094" y2="493.8984"/><polygon fill="#181818" points="47,483.8984,51,493.8984,55,483.8984,51,487.8984" style="stroke:#181818;stroke-width:1.0;"/></g></svg></figure>
<h4 id="macro_ruleså®šä¹‰"><a class="header" href="#macro_ruleså®šä¹‰">macro_rules!å®šä¹‰</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">#[macro_export]
macro_rules! my_vec {
    // æ²¡å¸¦ä»»ä½•å‚æ•°çš„ my_vecï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºçš„ vec
    // æ³¨æ„ï¼Œç”±äºå®è¦åœ¨è°ƒç”¨çš„åœ°æ–¹å±•å¼€ï¼Œæˆ‘ä»¬æ— æ³•é¢„æµ‹è°ƒç”¨
    // è€…çš„ç¯å¢ƒæ˜¯å¦å·²ç» åšäº†ç›¸å…³çš„ useï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨çš„
    // ä»£ç æœ€å¥½å¸¦ç€å®Œæ•´çš„å‘½åç©ºé—´ã€‚
    () =&gt; {
        std::vec::Vec::new()
    };
    // å¤„ç† my_vec![1, 2, 3, 4]
    ($($el:expr),*) =&gt; ({
        let mut v = std::vec::Vec::new();
        $(v.push($el);)*
        v
    });
    // å¤„ç† my_vec![0; 10]
    ($el:expr; $n:expr) =&gt; {
        std::vec::from_elem($el, $n)
    }
}
</code></pre></pre>
<div id="admonition-elexpr-" class="admonition info">
<div class="admonition-title">
<p>$($el:expr), *)</p>
<p><a class="admonition-anchor-link" href="#admonition-elexpr-"></a></p>
</div>
<div>
<ol>
<li>åœ¨å£°æ˜å®ä¸­ï¼Œæ¡ä»¶æ•è·çš„å‚æ•°ä½¿ç”¨ $ å¼€å¤´çš„æ ‡è¯†ç¬¦æ¥å£°æ˜ã€‚</li>
<li>æ¯ä¸ªå‚æ•°éƒ½éœ€è¦æä¾›ç±»å‹ï¼Œè¿™é‡Œ<code>expr</code>ä»£è¡¨è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ $el:expr æ˜¯è¯´æŠŠåŒ¹é…åˆ°çš„è¡¨è¾¾å¼å‘½åä¸º $elã€‚</li>
<li>$(â€¦),* å‘Šè¯‰ç¼–è¯‘å™¨å¯ä»¥åŒ¹é…ä»»æ„å¤šä¸ªä»¥é€—å·åˆ†éš”çš„è¡¨è¾¾å¼ï¼Œç„¶åæ•è·åˆ°çš„æ¯ä¸€ä¸ªè¡¨è¾¾å¼å¯ä»¥ç”¨ $el æ¥è®¿é—®ã€‚</li>
<li>ç”±äºåŒ¹é…çš„æ—¶å€™åŒ¹é…åˆ°ä¸€ä¸ª $(â€¦)* ï¼ˆæˆ‘ä»¬å¯ä»¥ä¸ç®¡åˆ†éš”ç¬¦ï¼‰ï¼Œåœ¨æ‰§è¡Œçš„ä»£ç å—ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç›¸åº”åœ°ä½¿ç”¨ $(â€¦)* å±•å¼€ã€‚</li>
<li>æ‰€ä»¥è¿™å¥ $(v.push($el);)* ç›¸å½“äºåŒ¹é…å‡ºå¤šå°‘ä¸ª $elå°±å±•å¼€å¤šå°‘å¥ push è¯­å¥ã€‚</li>
</ol>
</div>
</div>
<h4 id="ä½¿ç”¨"><a class="header" href="#ä½¿ç”¨">ä½¿ç”¨</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">fn main() {
    let mut v = my_vec![];
    v.push(1);
    // è°ƒç”¨æ—¶å¯ä»¥ä½¿ç”¨ [], (), {}
    let _v = my_vec!(1, 2, 3, 4);
    let _v = my_vec![1, 2, 3, 4];
    let v = my_vec! {1, 2, 3, 4};
    println!(&quot;{:?}&quot;, v);

    println!(&quot;{:?}&quot;, v);
    //
    let v = my_vec![1; 10];
    println!(&quot;{:?}&quot;, v);
}
</code></pre></pre>
<h3 id="å£°æ˜å®ç”¨åˆ°çš„å‚æ•°ç±»å‹"><a class="header" href="#å£°æ˜å®ç”¨åˆ°çš„å‚æ•°ç±»å‹">å£°æ˜å®ç”¨åˆ°çš„å‚æ•°ç±»å‹</a></h3>
<div id="admonition-ç±»å‹åˆ—è¡¨" class="admonition info">
<div class="admonition-title">
<p>ç±»å‹åˆ—è¡¨</p>
<p><a class="admonition-anchor-link" href="#admonition-ç±»å‹åˆ—è¡¨"></a></p>
</div>
<div>
<ol>
<li>itemï¼Œæ¯”å¦‚ä¸€ä¸ªå‡½æ•°ã€ç»“æ„ä½“ã€æ¨¡å—ç­‰ã€‚ </li>
<li>blockï¼Œä»£ç å—ã€‚æ¯”å¦‚ä¸€ç³»åˆ—ç”±èŠ±æ‹¬å·åŒ…è£¹çš„è¡¨è¾¾å¼å’Œè¯­å¥ã€‚ </li>
<li>stmtï¼Œè¯­å¥ã€‚æ¯”å¦‚ä¸€ä¸ªèµ‹å€¼è¯­å¥ã€‚ </li>
<li>patï¼Œæ¨¡å¼ã€‚ </li>
<li>exprï¼Œè¡¨è¾¾å¼ã€‚åˆšæ‰çš„ä¾‹å­ä½¿ç”¨è¿‡äº†ã€‚ </li>
<li>tyï¼Œç±»å‹ã€‚æ¯”å¦‚ Vecã€‚ </li>
<li>identï¼Œæ ‡è¯†ç¬¦ã€‚æ¯”å¦‚ä¸€ä¸ªå˜é‡åã€‚ </li>
<li>pathï¼Œè·¯å¾„ã€‚æ¯”å¦‚ï¼šfooã€::std::mem::replaceã€transmute::&lt;_, int&gt;ã€‚ </li>
<li>metaï¼Œå…ƒæ•°æ®ã€‚ä¸€èˆ¬æ˜¯åœ¨ #[â€¦] å’Œ #![â€¦] å±æ€§å†…éƒ¨çš„æ•°æ®ã€‚ </li>
<li>ttï¼Œå•ä¸ªçš„ token æ ‘ã€‚ </li>
<li>visï¼Œå¯èƒ½ä¸ºç©ºçš„ä¸€ä¸ª Visibility ä¿®é¥°ç¬¦ã€‚æ¯”å¦‚ pubã€pub(crate)</li>
</ol>
</div>
</div>
<h2 id="è¿‡ç¨‹å®æ‰‹å·¥å®šä¹‰å›¾"><a class="header" href="#è¿‡ç¨‹å®æ‰‹å·¥å®šä¹‰å›¾">è¿‡ç¨‹å®æ‰‹å·¥å®šä¹‰å›¾</a></h2>
<blockquote>
<p>è¿‡ç¨‹å®è¦æ¯”å£°æ˜å®è¦å¤æ‚å¾ˆå¤šï¼Œä¸è¿‡æ— è®ºæ˜¯å“ªä¸€ç§è¿‡ç¨‹å®ï¼Œæœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ¶‰åŠè¦æŠŠ <code>è¾“å…¥çš„ TokenStream</code> å¤„ç†æˆ<code>è¾“å‡ºçš„ TokenStream</code>ã€‚</p>
</blockquote>
<div id="admonition-å‡½æ•°å®ä¸æ´¾ç”Ÿå®å®šä¹‰ä½¿ç”¨åŒºåˆ«" class="admonition info">
<div class="admonition-title">
<p>å‡½æ•°å®ä¸æ´¾ç”Ÿå®å®šä¹‰ä½¿ç”¨åŒºåˆ«</p>
<p><a class="admonition-anchor-link" href="#admonition-å‡½æ•°å®ä¸æ´¾ç”Ÿå®å®šä¹‰ä½¿ç”¨åŒºåˆ«"></a></p>
</div>
<div>
<figure><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="528px" preserveAspectRatio="none" style="width:1956px;height:528px;background:#FFFFFF;" version="1.1" viewBox="0 0 1956 528" width="1956px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="136" x="908.5" y="15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="126" x="913.5" y="32.9951">è¿‡ç¨‹å®å®šä¹‰ä½¿ç”¨æµç¨‹</text><ellipse cx="210" cy="85.9951" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><path d="M20,112.8467 L20,153.1123 L160,153.1123 L160,122.8467 L150,112.8467 L20,112.8467 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M150,112.8467 L150,122.8467 L160,122.8467 L150,112.8467 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="26" y="129.9136">[lib]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="26" y="145.0464">proc-macro = true</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="170" y="115.9951"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="180" y="137.1338">æ‰“å¼€è¿‡ç¨‹å®</text><line style="stroke:#000000;stroke-width:1.5;" x1="15" x2="15" y1="50.042" y2="516.0732"/><path d="M350,163.1123 L350,294.1748 L709,294.1748 L709,173.1123 L699,163.1123 L350,163.1123 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M699,163.1123 L699,173.1123 L709,173.1123 L699,163.1123 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="356" y="180.1792">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="372" y="180.1792">[proc_macro]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338" x="356" y="195.312">pub fn query(input: TokenStream) -&gt; TokenStream {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="372" y="210.4448">// åªæœ‰ä¿®æ”¹ä»£ç ä¹‹åå†æ¬¡ç¼–è¯‘æ‰ä¼šæ‰§è¡Œ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="372" y="225.5776">println!("{:#?}", input);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="372" y="240.7104">"fn hello() { println!(\"Hello world!\"); }"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="388" y="255.8433">.parse()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="388" y="270.9761">.unwrap()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="356" y="286.1089">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="260" y="211.6592"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="270" y="232.7979">å®šä¹‰è¿‡ç¨‹å®</text><line style="stroke:#000000;stroke-width:1.5;" x1="254" x2="254" y1="50.042" y2="516.0732"/><path d="M719,304.1748 L719,420.1045 L1278,420.1045 L1278,314.1748 L1268,304.1748 L719,304.1748 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1268,304.1748 L1268,314.1748 L1278,314.1748 L1268,304.1748 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="725" y="321.2417">use macros::query;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="725" y="336.3745">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="725" y="351.5073">fn main() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="741" y="366.6401">// query!(SELECT * FROM users WHERE age &gt; 10);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="522" x="741" y="381.7729">query!(SELECT * FROM users u JOIN (SELECT * from profiles p) WHERE u.id = p.id);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="741" y="396.9058">hello()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="725" y="412.0386">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="80" x="1288" y="345.1553"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="1298" y="366.2939">ä½¿ç”¨è¿‡ç¨‹å®</text><line style="stroke:#000000;stroke-width:1.5;" x1="714" x2="714" y1="50.042" y2="516.0732"/><path d="M1377,444.5225 L1377,469.6553 L1759,469.6553 L1759,454.5225 L1749,444.5225 L1377,444.5225 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1749,444.5225 L1749,454.5225 L1759,454.5225 L1749,444.5225 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="361" x="1383" y="461.5894">cargo run --example query &gt; examples/query_output.txt</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="1769" y="440.1045"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="1779" y="461.2432">æŸ¥çœ‹æ‰“å°çš„TokenStream</text><ellipse cx="1850.5" cy="505.0732" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="1850.5" cy="505.0732" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1372" x2="1372" y1="50.042" y2="516.0732"/><line style="stroke:#000000;stroke-width:1.5;" x1="1936" x2="1936" y1="50.042" y2="516.0732"/><line style="stroke:#181818;stroke-width:1.0;" x1="210" x2="210" y1="95.9951" y2="115.9951"/><polygon fill="#181818" points="206,105.9951,210,115.9951,214,105.9951,210,109.9951" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1850.5" x2="1850.5" y1="474.0732" y2="494.0732"/><polygon fill="#181818" points="1846.5,484.0732,1850.5,494.0732,1854.5,484.0732,1850.5,488.0732" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="210" x2="210" y1="149.9639" y2="168.3115"/><line style="stroke:#181818;stroke-width:1.0;" x1="210" x2="300" y1="168.3115" y2="168.3115"/><line style="stroke:#181818;stroke-width:1.0;" x1="300" x2="300" y1="168.3115" y2="211.6592"/><polygon fill="#181818" points="296,201.6592,300,211.6592,304,201.6592,300,205.6592" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="300" x2="300" y1="245.6279" y2="299.1748"/><line style="stroke:#181818;stroke-width:1.0;" x1="300" x2="1328" y1="299.1748" y2="299.1748"/><line style="stroke:#181818;stroke-width:1.0;" x1="1328" x2="1328" y1="299.1748" y2="345.1553"/><polygon fill="#181818" points="1324,335.1553,1328,345.1553,1332,335.1553,1328,339.1553" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1328" x2="1328" y1="379.124" y2="417.1143"/><line style="stroke:#181818;stroke-width:1.0;" x1="1328" x2="1850.5" y1="417.1143" y2="417.1143"/><line style="stroke:#181818;stroke-width:1.0;" x1="1850.5" x2="1850.5" y1="417.1143" y2="440.1045"/><polygon fill="#181818" points="1846.5,430.1045,1850.5,440.1045,1854.5,430.1045,1850.5,434.1045" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="99" x="85" y="66.75">Cargo.toml</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="74" x="447" y="66.75">src/lib.rs</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="162" x="962" y="66.75">examples/è°ƒç”¨ä»£ç </text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="79" x="1614.5" y="66.75">Terminal</text></g></svg></figure>
<hr />
<figure><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="5521px" preserveAspectRatio="none" style="width:3555px;height:5521px;background:#FFFFFF;" version="1.1" viewBox="0 0 3555 5521" width="3555px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="192" x="1680.25" y="15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="182" x="1685.25" y="32.9951">è¿‡ç¨‹æ´¾ç”Ÿå®ä¸¤ç§å®šä¹‰ä½¿ç”¨æµç¨‹</text><ellipse cx="222" cy="85.9951" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="215" x="114.5" y="115.9951"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="191" x="128.5" y="137.1338">æ‰‹å·¥æŠ½å–TokenStreamå®šä¹‰æ´¾ç”Ÿå®</text><path d="M20,166.8154 L20,207.0811 L160,207.0811 L160,176.8154 L150,166.8154 L20,166.8154 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M150,166.8154 L150,176.8154 L160,176.8154 L150,166.8154 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="26" y="183.8823">[lib]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="26" y="199.0151">proc-macro = true</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="180" y="169.9639"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="194" y="191.1025">æ‰“å¼€è¿‡ç¨‹å®</text><ellipse cx="222" cy="1667.6436" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="336" x="54" y="1697.6436"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="312" x="68" y="1718.7822">syn/quoteæŠ½å–TokenStreamä¸ºDeriveInputå®šä¹‰æ´¾ç”Ÿå®</text><path d="M20,1748.4639 L20,1788.7295 L160,1788.7295 L160,1758.4639 L150,1748.4639 L20,1748.4639 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M150,1748.4639 L150,1758.4639 L160,1758.4639 L150,1748.4639 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="26" y="1765.5308">[lib]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="26" y="1780.6636">proc-macro = true</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="180" y="1751.6123"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="194" y="1772.751">æ‰“å¼€è¿‡ç¨‹å®</text><ellipse cx="222" cy="3513.1123" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="336" x="54" y="3543.1123"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="312" x="68" y="3564.251">syn/quoteæŠ½å–TokenStreamä¸ºDeriveInputå®šä¹‰å±æ€§å®</text><path d="M20,3593.9326 L20,3634.1982 L160,3634.1982 L160,3603.9326 L150,3593.9326 L20,3593.9326 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M150,3593.9326 L150,3603.9326 L160,3603.9326 L150,3593.9326 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="26" y="3610.9995">[lib]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="26" y="3626.1323">proc-macro = true</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="180" y="3597.0811"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="194" y="3618.2197">æ‰“å¼€è¿‡ç¨‹å®</text><line style="stroke:#000000;stroke-width:1.5;" x1="15" x2="15" y1="50.042" y2="5509.6436"/><path d="M588.5,217.0811 L588.5,544.8701 L1090.5,544.8701 L1090.5,227.0811 L1080.5,217.0811 L588.5,217.0811 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1080.5,217.0811 L1080.5,227.0811 L1090.5,227.0811 L1080.5,217.0811 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="594.5" y="234.1479">use anyhow::Result;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="594.5" y="249.2808">use askama::Template;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="331" x="594.5" y="264.4136">use proc_macro::{Ident, TokenStream, TokenTree};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="594.5" y="279.5464">use std::collections::VecDeque;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="594.5" y="294.6792">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="481" x="594.5" y="309.812">/// å¤„ç† jinja æ¨¡æ¿çš„æ•°æ®ç»“æ„ï¼Œåœ¨æ¨¡æ¿ä¸­æˆ‘ä»¬ä½¿ç”¨äº† name / builder_name / fields</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="594.5" y="324.9448">/#[derive(Template)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="594.5" y="340.0776">/#[template(path = "builder.j2", escape = "none")]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="594.5" y="355.2104">pub struct BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="610.5" y="370.3433">name: String,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="610.5" y="385.4761">builder_name: String,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="610.5" y="400.6089">fields: Vec&lt;Fd&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="594.5" y="415.7417">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="594.5" y="430.8745">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="594.5" y="446.0073">/// æè¿° struct çš„æ¯ä¸ª field</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="594.5" y="461.1401">/#[derive(Debug, Default)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="594.5" y="476.2729">struct Fd {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="610.5" y="491.4058">name: String,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="610.5" y="506.5386">ty: String,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="610.5" y="521.6714">optional: bool,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="594.5" y="536.8042">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="307" x="1110.5" y="363.9912"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="287" x="1120.5" y="385.1299">ä½¿ç”¨anyhowä¸askamaæŠ½å–TokenStreamä¸­çš„ä¿¡æ¯</text><path d="M740,608.8389 L740,906.3623 L1186,906.3623 L1186,618.8389 L1176,608.8389 L740,608.8389 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1176,608.8389 L1176,618.8389 L1186,618.8389 L1176,608.8389 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="746" y="625.9058">impl Fd {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="762" y="641.0386">/// name å’Œ field éƒ½æ˜¯é€šè¿‡å†’å· Punct åˆ‡åˆ†å‡ºæ¥çš„ TokenTree åˆ‡ç‰‡</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="386" x="762" y="656.1714">pub fn new(name: &amp;[TokenTree], ty: &amp;[TokenTree]) -&gt; Self {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="762" y="671.3042">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="746" y="686.437">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="746" y="701.5698">impl BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325" x="762" y="716.7026">/// ä» TokenStream ä¸­æå–ä¿¡æ¯ï¼Œæ„å»º BuilderContext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="762" y="731.8354">fn new(input: TokenStream) -&gt; Self {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="762" y="746.9683">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="762" y="762.1011">/// æŠŠæ¨¡æ¿æ¸²æŸ“æˆå­—ç¬¦ä¸²ä»£ç </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="357" x="762" y="777.2339">pub fn render(input: TokenStream) -&gt; Result&lt;String&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="762" y="792.3667">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="746" y="807.4995">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="425" x="746" y="822.6323">// æŠŠ TokenStream åˆ†å‡º struct çš„åå­—ï¼Œå’ŒåŒ…å« fields çš„ TokenStream</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="746" y="837.7651">fn split(input: TokenStream) -&gt; (Ident, TokenStream) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="746" y="852.8979">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="746" y="868.0308">/// ä»åŒ…å« fields çš„ TokenStream ä¸­åˆ‡å‡ºæ¥ä¸€ä¸ªä¸ª Fd</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="746" y="883.1636">fn get_struct_fields(input: TokenStream) -&gt; Vec&lt;Fd&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="746" y="898.2964">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="116" x="1206" y="740.6162"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="96" x="1216" y="761.7549">å®ç°å¯¹åº”æŠ½å–æ–¹æ³•</text><path d="M510.5,1798.7295 L510.5,2111.3857 L1109.5,2111.3857 L1109.5,1808.7295 L1099.5,1798.7295 L510.5,1798.7295 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1099.5,1798.7295 L1099.5,1808.7295 L1109.5,1808.7295 L1099.5,1798.7295 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="516.5" y="1815.7964">use proc_macro2::{Ident, TokenStream};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="516.5" y="1830.9292">use quote::quote;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="516.5" y="1846.062">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="516.5" y="1861.1948">use syn::{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="562" x="532.5" y="1876.3276">Data, DataStruct, DeriveInput, Field, Fields, FieldsNamed, GenericArgument, Path, Type,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="532.5" y="1891.4604">TypePath,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="516.5" y="1906.5933">};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="516.5" y="1921.7261">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="516.5" y="1936.8589">/// æˆ‘ä»¬éœ€è¦çš„æè¿°ä¸€ä¸ªå­—æ®µçš„æ‰€æœ‰ä¿¡æ¯</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="516.5" y="1951.9917">struct Fd {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="532.5" y="1967.1245">name: Ident,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="532.5" y="1982.2573">ty: Type,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="532.5" y="1997.3901">optional: bool,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="516.5" y="2012.5229">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="516.5" y="2027.6558">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="516.5" y="2042.7886">/// æˆ‘ä»¬éœ€è¦çš„æè¿°ä¸€ä¸ª struct çš„æ‰€æœ‰ä¿¡æ¯</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="516.5" y="2057.9214">pub struct BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="532.5" y="2073.0542">name: Ident,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="532.5" y="2088.187">fields: Vec&lt;Fd&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="516.5" y="2103.3198">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="269" x="1129.5" y="1938.0732"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="249" x="1139.5" y="1959.2119">ä½¿ç”¨synä¸quoteæŠ½å–TokenStreamä¸­çš„ä¿¡æ¯</text><path d="M399,2121.3857 L399,2782.0967 L1114,2782.0967 L1114,2131.3857 L1104,2121.3857 L399,2121.3857 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1104,2121.3857 L1104,2131.3857 L1114,2131.3857 L1104,2121.3857 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="405" y="2138.4526">/// æŠŠä¸€ä¸ª Field è½¬æ¢æˆ Fd</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="405" y="2153.5854">impl From&lt;Field&gt; for Fd {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="421" y="2168.7183">fn from(f: Field) -&gt; Self {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="421" y="2183.8511">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="2198.9839">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="2214.1167">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="2229.2495">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="405" y="2244.3823">/// æŠŠ DeriveInput è½¬æ¢æˆ BuilderContext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="405" y="2259.5151">impl From&lt;DeriveInput&gt; for BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="421" y="2274.6479">fn from(input: DeriveInput) -&gt; Self {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="437" y="2289.7808">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="2304.9136">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="2320.0464">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="2335.1792">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="405" y="2350.312">impl BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="421" y="2365.4448">pub fn render(&amp;self) -&gt; TokenStream {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="453" y="2380.5776">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="437" y="2395.7104">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="2410.8433">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="2425.9761">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="421" y="2441.1089">// ä¸º XXXBuilder ç”Ÿæˆ Option&lt;T&gt; å­—æ®µ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="421" y="2456.2417">// æ¯”å¦‚ï¼šexecutable: String -&gt; executable: Option&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="421" y="2471.3745">fn gen_optionized_fields(&amp;self) -&gt; Vec&lt;TokenStream&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="437" y="2486.5073">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="2501.6401">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="2516.7729">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="421" y="2531.9058">// ä¸º XXXBuilder ç”Ÿæˆå¤„ç†å‡½æ•°</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="678" x="421" y="2547.0386">// æ¯”å¦‚ï¼šmethods: fn executable(mut self, v: impl Into&lt;String&gt;) -&gt; Self { self.executable = Some(v); self }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315" x="421" y="2562.1714">fn gen_methods(&amp;self) -&gt; Vec&lt;TokenStream&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="437" y="2577.3042">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="2592.437">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="2607.5698">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="482" x="421" y="2622.7026">// ä¸º XXXBuilder ç”Ÿæˆç›¸åº”çš„èµ‹å€¼è¯­å¥ï¼ŒæŠŠ XXXBuilder æ¯ä¸ªå­—æ®µèµ‹å€¼ç»™ XXX çš„å­—æ®µ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="475" x="421" y="2637.8354">// æ¯”å¦‚ï¼š#field_name: self.#field_name.take().ok_or(" xxx need to be set!")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="421" y="2652.9683">fn gen_assigns(&amp;self) -&gt; Vec&lt;TokenStream&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="437" y="2668.1011">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="2683.2339">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="2698.3667">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="2713.4995">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="405" y="2728.6323">// å¦‚æœæ˜¯ T = Option&lt;Inner&gt;ï¼Œè¿”å› (true, Inner)ï¼›å¦åˆ™è¿”å› (false, T)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="405" y="2743.7651">fn get_option_inner(ty: &amp;Type) -&gt; (bool, &amp;Type) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="421" y="2758.8979">...</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="2774.0308">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="260" x="1134" y="2434.7568"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="240" x="1144" y="2455.8955">ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨å®šä¹‰æŠ½å–æ¨¡ç‰ˆï¼Œç›´æ¥å®ç°æ–¹æ³•</text><path d="M510.5,3644.1982 L510.5,4077.917 L1109.5,4077.917 L1109.5,3654.1982 L1099.5,3644.1982 L510.5,3644.1982 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1099.5,3644.1982 L1099.5,3654.1982 L1109.5,3654.1982 L1099.5,3644.1982 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="516.5" y="3661.2651">use darling::FromField;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="516.5" y="3676.3979">use proc_macro2::{Ident, TokenStream};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="516.5" y="3691.5308">use quote::quote;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="516.5" y="3706.6636">use syn::{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="562" x="532.5" y="3721.7964">Data, DataStruct, DeriveInput, Field, Fields, FieldsNamed, GenericArgument, Path, Type,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="532.5" y="3736.9292">TypePath,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="516.5" y="3752.062">};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="516.5" y="3767.1948">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="516.5" y="3782.3276">/// ç”¨äºæ•è·æ¯ä¸ªå­—æ®µçš„ attributes çš„ç»“æ„</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="516.5" y="3797.4604">/#[derive(Debug, Default, FromField)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="516.5" y="3812.5933">/#[darling(default, attributes(builder))]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="516.5" y="3827.7261">struct Opts {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="532.5" y="3842.8589">each: Option&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="532.5" y="3857.9917">default: Option&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="516.5" y="3873.1245">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="516.5" y="3888.2573">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="516.5" y="3903.3901">/// æˆ‘ä»¬éœ€è¦çš„æè¿°ä¸€ä¸ªå­—æ®µçš„æ‰€æœ‰ä¿¡æ¯</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="516.5" y="3918.5229">struct Fd {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="532.5" y="3933.6558">name: Ident,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="532.5" y="3948.7886">ty: Type,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="532.5" y="3963.9214">optional: bool,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="532.5" y="3979.0542">opts: Opts,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="516.5" y="3994.187">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="516.5" y="4009.3198">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="516.5" y="4024.4526">/// æˆ‘ä»¬éœ€è¦çš„æè¿°ä¸€ä¸ª struct çš„æ‰€æœ‰ä¿¡æ¯</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="516.5" y="4039.5854">pub struct BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="532.5" y="4054.7183">name: Ident,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="532.5" y="4069.8511">fields: Vec&lt;Fd&gt;,</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="269" x="1129.5" y="3844.0732"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="249" x="1139.5" y="3865.2119">ä½¿ç”¨synä¸quoteæŠ½å–TokenStreamä¸­çš„ä¿¡æ¯</text><path d="M399,4087.917 L399,4748.6279 L1114,4748.6279 L1114,4097.917 L1104,4087.917 L399,4087.917 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1104,4087.917 L1104,4097.917 L1114,4097.917 L1104,4087.917 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="405" y="4104.9839">/// æŠŠä¸€ä¸ª Field è½¬æ¢æˆ Fd</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="405" y="4120.1167">impl From&lt;Field&gt; for Fd {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="421" y="4135.2495">fn from(f: Field) -&gt; Self {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="4150.3823">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="4165.5151">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4180.6479">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="405" y="4195.7808">/// æŠŠ DeriveInput è½¬æ¢æˆ BuilderContext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="405" y="4210.9136">impl From&lt;DeriveInput&gt; for BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="421" y="4226.0464">fn from(input: DeriveInput) -&gt; Self {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="4241.1792">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4256.312">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="405" y="4271.4448">impl BuilderContext {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="421" y="4286.5776">pub fn render(&amp;self) -&gt; TokenStream {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="4301.7104">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4316.8433">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="421" y="4331.9761">// ä¸º XXXBuilder ç”Ÿæˆ Option&lt;T&gt; å­—æ®µ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="421" y="4347.1089">// æ¯”å¦‚ï¼šexecutable: String -&gt; executable: Option&lt;String&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364" x="421" y="4362.2417">fn gen_optionized_fields(&amp;self) -&gt; Vec&lt;TokenStream&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="4377.3745">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4392.5073">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="421" y="4407.6401">// ä¸º XXXBuilder ç”Ÿæˆå¤„ç†å‡½æ•°</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="678" x="421" y="4422.7729">// æ¯”å¦‚ï¼šmethods: fn executable(mut self, v: impl Into&lt;String&gt;) -&gt; Self { self.executable = Some(v); self }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315" x="421" y="4437.9058">fn gen_methods(&amp;self) -&gt; Vec&lt;TokenStream&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="4453.0386">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4468.1714">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="482" x="421" y="4483.3042">// ä¸º XXXBuilder ç”Ÿæˆç›¸åº”çš„èµ‹å€¼è¯­å¥ï¼ŒæŠŠ XXXBuilder æ¯ä¸ªå­—æ®µèµ‹å€¼ç»™ XXX çš„å­—æ®µ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="475" x="421" y="4498.437">// æ¯”å¦‚ï¼š#field_name: self.#field_name.take().ok_or(" xxx need to be set!")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="421" y="4513.5698">fn gen_assigns(&amp;self) -&gt; Vec&lt;TokenStream&gt; {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="421" y="4528.7026">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="4543.8354">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4558.9683">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="405" y="4574.1011">// å¦‚æœæ˜¯ T = Option&lt;Inner&gt;ï¼Œè¿”å› (true, Inner)ï¼›å¦åˆ™è¿”å› (false, T)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="405" y="4589.2339">fn get_option_inner(ty: &amp;Type) -&gt; (bool, &amp;Type) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="421" y="4604.3667">get_type_inner(ty, "Option")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="4619.4995">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4634.6323">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="405" y="4649.7651">// å¦‚æœæ˜¯ T = Vec&lt;Inner&gt;ï¼Œè¿”å› (true, Inner)ï¼›å¦åˆ™è¿”å› (false, T)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="405" y="4664.8979">fn get_vec_inner(ty: &amp;Type) -&gt; (bool, &amp;Type) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="421" y="4680.0308">get_type_inner(ty, "Vec")</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="4695.1636">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="405" y="4710.2964">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="448" x="405" y="4725.4292">fn get_type_inner&lt;'a&gt;(ty: &amp;'a Type, name: &amp;str) -&gt; (bool, &amp;'a Type) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="405" y="4740.562">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="260" x="1134" y="4401.2881"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="240" x="1144" y="4422.4268">ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨å®šä¹‰æŠ½å–æ¨¡ç‰ˆï¼Œç›´æ¥å®ç°æ–¹æ³•</text><line style="stroke:#000000;stroke-width:1.5;" x1="394" x2="394" y1="50.042" y2="5509.6436"/><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="229" x="1427.5" y="564.8701"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="209" x="1437.5" y="586.0088">ç¼–å†™ä¸tokenstreamå¯¹åº”çš„jinja2æ¨¡ç‰ˆ</text><line style="stroke:#000000;stroke-width:1.5;" x1="1421.5" x2="1421.5" y1="50.042" y2="5509.6436"/><path d="M1790.5,916.3623 L1790.5,1062.5576 L2231.5,1062.5576 L2231.5,926.3623 L2221.5,916.3623 L1790.5,916.3623 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2221.5,916.3623 L2221.5,926.3623 L2231.5,926.3623 L2221.5,916.3623 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="1796.5" y="933.4292">mod raw_builder;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="1796.5" y="948.562">use raw_builder::BuilderContext;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1796.5" y="963.6948">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="1796.5" y="978.8276">/#[proc_macro_derive(RawBuilder)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="1796.5" y="993.9604">pub fn derive_raw_builder(input: TokenStream) -&gt; TokenStream {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="1812.5" y="1009.0933">// åªæœ‰ä¿®æ”¹ä»£ç ä¹‹åå†æ¬¡ç¼–è¯‘æ‰ä¼šæ‰§è¡Œ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1812.5" y="1024.2261">println!("{:#?}", input);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356" x="1812.5" y="1039.3589">BuilderContext::render(input).unwrap().parse().unwrap()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1796.5" y="1054.4917">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="1666.5" y="972.4756"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="1676.5" y="993.6143">å®šä¹‰è¿‡ç¨‹æ´¾ç”Ÿå®</text><path d="M1790.5,2792.0967 L1790.5,2923.1592 L2202.5,2923.1592 L2202.5,2802.0967 L2192.5,2792.0967 L1790.5,2792.0967 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2192.5,2792.0967 L2192.5,2802.0967 L2202.5,2802.0967 L2192.5,2792.0967 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="1796.5" y="2809.1636">use syn::{parse_macro_input, DeriveInput};</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1796.5" y="2824.2964">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="1796.5" y="2839.4292">/#[proc_macro_derive(Builder)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="1796.5" y="2854.562">pub fn derive_builder(input: TokenStream) -&gt; TokenStream {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="1812.5" y="2869.6948">let input = parse_macro_input!(input as DeriveInput);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1812.5" y="2884.8276">println!("{:#?}", input);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="1812.5" y="2899.9604">builder::BuilderContext::from(input).render().into()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1796.5" y="2915.0933">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="1666.5" y="2840.6436"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="1676.5" y="2861.7822">å®šä¹‰è¿‡ç¨‹æ´¾ç”Ÿå®</text><path d="M1780.5,4768.6279 L1780.5,4929.9561 L2254.5,4929.9561 L2254.5,4778.6279 L2244.5,4768.6279 L1780.5,4768.6279 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2244.5,4768.6279 L2244.5,4778.6279 L2254.5,4778.6279 L2244.5,4768.6279 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="1786.5" y="4785.6948">mod builder_with_attr;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1786.5" y="4800.8276">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="1786.5" y="4815.9604">/#[proc_macro_derive(BuilderWithAttr, attributes(builder))]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="453" x="1786.5" y="4831.0933">pub fn derive_builder_with_attr(input: TokenStream) -&gt; TokenStream {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="1802.5" y="4846.2261">let input = parse_macro_input!(input as DeriveInput);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1802.5" y="4861.3589">println!("{:#?}", input);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="1802.5" y="4876.4917">builder_with_attr::BuilderContext::from(input)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="1818.5" y="4891.6245">.render()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="1818.5" y="4906.7573">.into()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1786.5" y="4921.8901">}</text><path d="M1835,4949.9561 L1835,5005.3545 L2200,5005.3545 L2200,4959.9561 L2190,4949.9561 L1835,4949.9561 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2190,4949.9561 L2190,4959.9561 L2200,4959.9561 L2190,4949.9561 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="1841" y="4967.0229">å’Œä¹‹å‰ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œå¤šäº†ä¸€ä¸ª attributes(builder) å±æ€§ï¼Œ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="1841" y="4982.1558">è¿™æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¯·å…è®¸ä»£ç  ä¸­å‡ºç°çš„ #[builder(...)]ï¼Œ</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="1841" y="4997.2886">å®ƒæ˜¯æˆ‘è¿™ä¸ªå®è®¤è¯†å¹¶è¦å¤„ç†çš„ã€‚</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="1666.5" y="4870.0068"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="1676.5" y="4891.1455">å®šä¹‰è¿‡ç¨‹æ´¾ç”Ÿå®</text><line style="stroke:#000000;stroke-width:1.5;" x1="1660.5" x2="1660.5" y1="50.042" y2="5509.6436"/><path d="M2274.5,1072.5576 L2274.5,1551.6748 L2671.5,1551.6748 L2671.5,1082.5576 L2661.5,1072.5576 L2274.5,1072.5576 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2661.5,1072.5576 L2661.5,1082.5576 L2671.5,1082.5576 L2661.5,1072.5576 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2280.5" y="1089.6245">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="2280.5" y="1104.7573">use macros::RawBuilder;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2280.5" y="1119.8901">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="2280.5" y="1135.0229">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="2296.5" y="1135.0229">[allow(dead_code)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="2280.5" y="1150.1558">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="2296.5" y="1150.1558">[derive(Debug, RawBuilder)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="2280.5" y="1165.2886">pub struct Command {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="2296.5" y="1180.4214">executable: String,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="2296.5" y="1195.5542">args: Vec&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="2296.5" y="1210.687">env: Vec&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="2296.5" y="1225.8198">current_dir: Option&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2280.5" y="1240.9526">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2280.5" y="1256.0854">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="2280.5" y="1271.2183">fn main() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="2296.5" y="1286.3511">let command = Command::builder()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="2312.5" y="1301.4839">.executable("cargo".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="2312.5" y="1316.6167">.args(vec!["build".to_owned(), "--release".to_owned()])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="2312.5" y="1331.7495">.env(vec![])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="2312.5" y="1346.8823">.build()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="2312.5" y="1362.0151">.unwrap();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="2296.5" y="1377.1479">assert!(command.current_dir.is_none());</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2280.5" y="1392.2808">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="2296.5" y="1407.4136">let command = Command::builder()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="2312.5" y="1422.5464">.executable("cargo".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="2312.5" y="1437.6792">.args(vec!["build".to_owned(), "--release".to_owned()])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="2312.5" y="1452.812">.env(vec![])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="2312.5" y="1467.9448">.current_dir("..".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="2312.5" y="1483.0776">.build()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="2312.5" y="1498.2104">.unwrap();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="2296.5" y="1513.3433">assert!(command.current_dir.is_some());</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="2296.5" y="1528.4761">println!("{:?}", command);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2280.5" y="1543.6089">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2681.5" y="1295.1318"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="2691.5" y="1316.2705">ä½¿ç”¨æ´¾ç”Ÿå®æŠ½å–</text><path d="M2274.5,2933.1592 L2274.5,3397.1436 L2671.5,3397.1436 L2671.5,2943.1592 L2661.5,2933.1592 L2274.5,2933.1592 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2661.5,2933.1592 L2661.5,2943.1592 L2671.5,2943.1592 L2661.5,2933.1592 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="2280.5" y="2950.2261">use macros::Builder;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2280.5" y="2965.3589">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="2280.5" y="2980.4917">/#[allow(dead_code)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="2280.5" y="2995.6245">/#[derive(Debug, Builder)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="2280.5" y="3010.7573">pub struct Command {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="2296.5" y="3025.8901">executable: String,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="2296.5" y="3041.0229">args: Vec&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="2296.5" y="3056.1558">env: Vec&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="2296.5" y="3071.2886">current_dir: Option&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2280.5" y="3086.4214">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2280.5" y="3101.5542">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="2280.5" y="3116.687">fn main() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="2296.5" y="3131.8198">let command = Command::builder()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="2312.5" y="3146.9526">.executable("cargo".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="2312.5" y="3162.0854">.args(vec!["build".to_owned(), "--release".to_owned()])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="2312.5" y="3177.2183">.env(vec![])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="2312.5" y="3192.3511">.build()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="2312.5" y="3207.4839">.unwrap();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="2296.5" y="3222.6167">assert!(command.current_dir.is_none());</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2280.5" y="3237.7495">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="2296.5" y="3252.8823">let command = Command::builder()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="2312.5" y="3268.0151">.executable("cargo".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="2312.5" y="3283.1479">.args(vec!["build".to_owned(), "--release".to_owned()])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="2312.5" y="3298.2808">.env(vec![])</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="2312.5" y="3313.4136">.current_dir("..".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="2312.5" y="3328.5464">.build()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="2312.5" y="3343.6792">.unwrap();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="2296.5" y="3358.812">assert!(command.current_dir.is_some());</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="2296.5" y="3373.9448">println!("{:?}", command);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2280.5" y="3389.0776">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2681.5" y="3148.167"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="2691.5" y="3169.3057">ä½¿ç”¨æ´¾ç”Ÿå®æŠ½å–</text><path d="M2295.5,5025.3545 L2295.5,5413.6748 L2671.5,5413.6748 L2671.5,5035.3545 L2661.5,5025.3545 L2295.5,5025.3545 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2661.5,5025.3545 L2661.5,5035.3545 L2671.5,5035.3545 L2661.5,5025.3545 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="2301.5" y="5042.4214">use macros::BuilderWithAttr;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2301.5" y="5057.5542">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="2301.5" y="5072.687">/#[allow(dead_code)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="2301.5" y="5087.8198">/#[derive(Debug, BuilderWithAttr)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="2301.5" y="5102.9526">pub struct Command {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="2317.5" y="5118.0854">executable: String,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="2317.5" y="5133.2183">#[builder(each = "arg")]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="2317.5" y="5148.3511">args: Vec&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="2317.5" y="5163.4839">#[builder(each = "env", default = "vec![]")]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="2317.5" y="5178.6167">env: Vec&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="2317.5" y="5193.7495">current_dir: Option&lt;String&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2301.5" y="5208.8823">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2301.5" y="5224.0151">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="2301.5" y="5239.1479">fn main() {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="2317.5" y="5254.2808">let command = Command::builder()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="2333.5" y="5269.4136">.executable("cargo".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="2333.5" y="5284.5464">.arg("build".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="2333.5" y="5299.6792">.arg("--release".to_owned())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="2333.5" y="5314.812">.build()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="2333.5" y="5329.9448">.unwrap();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="2301.5" y="5345.0776">Â </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="2317.5" y="5360.2104">assert_eq!(command.executable, "cargo");</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339" x="2317.5" y="5375.3433">assert_eq!(command.args, vec!["build", "--release"]);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="2317.5" y="5390.4761">println!("{:?}", command);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2301.5" y="5405.6089">}</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="104" x="2681.5" y="5202.5303"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="84" x="2691.5" y="5223.6689">ä½¿ç”¨æ´¾ç”Ÿå®æŠ½å–</text><line style="stroke:#000000;stroke-width:1.5;" x1="2269.5" x2="2269.5" y1="50.042" y2="5509.6436"/><path d="M2854.5,1576.0928 L2854.5,1601.2256 L3352.5,1601.2256 L3352.5,1586.0928 L3342.5,1576.0928 L2854.5,1576.0928 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3342.5,1576.0928 L3342.5,1586.0928 L3352.5,1586.0928 L3342.5,1576.0928 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="477" x="2860.5" y="1593.1597">cargo run --example raw_command &gt; examples/raw_command_output.txt</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="163" x="3368.5" y="1571.6748"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="143" x="3378.5" y="1592.8135">æŸ¥çœ‹æ‰“å°çš„TokenStream</text><ellipse cx="3450" cy="1636.6436" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="3450" cy="1636.6436" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><path d="M2918.5,3421.5615 L2918.5,3446.6943 L3358.5,3446.6943 L3358.5,3431.5615 L3348.5,3421.5615 L2918.5,3421.5615 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3348.5,3421.5615 L3348.5,3431.5615 L3358.5,3431.5615 L3348.5,3421.5615 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="419" x="2924.5" y="3438.6284">cargo run --example command &gt; examples/command_output.txt</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="3374.5" y="3417.1436"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="3384.5" y="3438.2822">æŸ¥çœ‹æ‰“å°çš„DeriveInput</text><ellipse cx="3450" cy="3482.1123" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="3450" cy="3482.1123" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><path d="M2794.5,5438.0928 L2794.5,5463.2256 L3358.5,5463.2256 L3358.5,5448.0928 L3348.5,5438.0928 L2794.5,5438.0928 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M3348.5,5438.0928 L3348.5,5448.0928 L3358.5,5448.0928 L3348.5,5438.0928 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="543" x="2800.5" y="5455.1597">cargo run --example command_with_attr &gt; examples/command_with_attr_output.txt</text><rect fill="#F1F1F1" height="33.9688" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="3374.5" y="5433.6748"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="131" x="3384.5" y="5454.8135">æŸ¥çœ‹æ‰“å°çš„DeriveInput</text><ellipse cx="3450" cy="5498.6436" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="3450" cy="5498.6436" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.5;" x1="2789.5" x2="2789.5" y1="50.042" y2="5509.6436"/><line style="stroke:#000000;stroke-width:1.5;" x1="3535.5" x2="3535.5" y1="50.042" y2="5509.6436"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="95.9951" y2="115.9951"/><polygon fill="#181818" points="218,105.9951,222,115.9951,226,105.9951,222,109.9951" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="149.9639" y2="169.9639"/><polygon fill="#181818" points="218,159.9639,222,169.9639,226,159.9639,222,163.9639" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="1677.6436" y2="1697.6436"/><polygon fill="#181818" points="218,1687.6436,222,1697.6436,226,1687.6436,222,1691.6436" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="1731.6123" y2="1751.6123"/><polygon fill="#181818" points="218,1741.6123,222,1751.6123,226,1741.6123,222,1745.6123" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="3523.1123" y2="3543.1123"/><polygon fill="#181818" points="218,3533.1123,222,3543.1123,226,3533.1123,222,3537.1123" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="3577.0811" y2="3597.0811"/><polygon fill="#181818" points="218,3587.0811,222,3597.0811,226,3587.0811,222,3591.0811" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="1972.042" y2="2434.7568"/><polygon fill="#181818" points="1260,2424.7568,1264,2434.7568,1268,2424.7568,1264,2428.7568" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="3878.042" y2="4401.2881"/><polygon fill="#181818" points="1260,4391.2881,1264,4401.2881,1268,4391.2881,1264,4395.2881" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="3450" x2="3450" y1="1605.6436" y2="1625.6436"/><polygon fill="#181818" points="3446,1615.6436,3450,1625.6436,3454,1615.6436,3450,1619.6436" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="3450" x2="3450" y1="3451.1123" y2="3471.1123"/><polygon fill="#181818" points="3446,3461.1123,3450,3471.1123,3454,3461.1123,3450,3465.1123" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="3450" x2="3450" y1="5467.6436" y2="5487.6436"/><polygon fill="#181818" points="3446,5477.6436,3450,5487.6436,3454,5477.6436,3450,5481.6436" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="203.9326" y2="271.4619"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="1264" y1="271.4619" y2="271.4619"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="271.4619" y2="363.9912"/><polygon fill="#181818" points="1260,353.9912,1264,363.9912,1268,353.9912,1264,357.9912" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="397.96" y2="488.915"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1542" y1="488.915" y2="488.915"/><line style="stroke:#181818;stroke-width:1.0;" x1="1542" x2="1542" y1="488.915" y2="564.8701"/><polygon fill="#181818" points="1538,554.8701,1542,564.8701,1546,554.8701,1542,558.8701" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1542" x2="1542" y1="598.8389" y2="657.2275"/><line style="stroke:#181818;stroke-width:1.0;" x1="1542" x2="1264" y1="657.2275" y2="657.2275"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="657.2275" y2="740.6162"/><polygon fill="#181818" points="1260,730.6162,1264,740.6162,1268,730.6162,1264,734.6162" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="774.585" y2="886.0303"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1718.5" y1="886.0303" y2="886.0303"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="1718.5" y1="886.0303" y2="972.4756"/><polygon fill="#181818" points="1714.5,962.4756,1718.5,972.4756,1722.5,962.4756,1718.5,966.4756" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="1718.5" y1="1006.4443" y2="1138.2881"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="2733.5" y1="1138.2881" y2="1138.2881"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="2733.5" y1="1138.2881" y2="1295.1318"/><polygon fill="#181818" points="2729.5,1285.1318,2733.5,1295.1318,2737.5,1285.1318,2733.5,1289.1318" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="2733.5" y1="1329.1006" y2="1457.8877"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="3450" y1="1457.8877" y2="1457.8877"/><line style="stroke:#181818;stroke-width:1.0;" x1="3450" x2="3450" y1="1457.8877" y2="1571.6748"/><polygon fill="#181818" points="3446,1561.6748,3450,1571.6748,3454,1561.6748,3450,1565.6748" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="1785.5811" y2="1849.3271"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="1264" y1="1849.3271" y2="1849.3271"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="1849.3271" y2="1938.0732"/><polygon fill="#181818" points="1260,1928.0732,1264,1938.0732,1268,1928.0732,1264,1932.0732" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="2468.7256" y2="2667.1846"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1718.5" y1="2667.1846" y2="2667.1846"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="1718.5" y1="2667.1846" y2="2840.6436"/><polygon fill="#181818" points="1714.5,2830.6436,1718.5,2840.6436,1722.5,2830.6436,1718.5,2834.6436" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="1718.5" y1="2874.6123" y2="2998.8896"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="2733.5" y1="2998.8896" y2="2998.8896"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="2733.5" y1="2998.8896" y2="3148.167"/><polygon fill="#181818" points="2729.5,3138.167,2733.5,3148.167,2737.5,3138.167,2733.5,3142.167" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="2733.5" y1="3182.1357" y2="3307.1396"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="3450" y1="3307.1396" y2="3307.1396"/><line style="stroke:#181818;stroke-width:1.0;" x1="3450" x2="3450" y1="3307.1396" y2="3417.1436"/><polygon fill="#181818" points="3446,3407.1436,3450,3417.1436,3454,3407.1436,3450,3411.1436" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="222" y1="3631.0498" y2="3725.0615"/><line style="stroke:#181818;stroke-width:1.0;" x1="222" x2="1264" y1="3725.0615" y2="3725.0615"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="3725.0615" y2="3844.0732"/><polygon fill="#181818" points="1260,3834.0732,1264,3844.0732,1268,3834.0732,1264,3838.0732" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1264" y1="4435.2568" y2="4665.1318"/><line style="stroke:#181818;stroke-width:1.0;" x1="1264" x2="1718.5" y1="4665.1318" y2="4665.1318"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="1718.5" y1="4665.1318" y2="4870.0068"/><polygon fill="#181818" points="1714.5,4860.0068,1718.5,4870.0068,1722.5,4860.0068,1718.5,4864.0068" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="1718.5" y1="4903.9756" y2="5040.7529"/><line style="stroke:#181818;stroke-width:1.0;" x1="1718.5" x2="2733.5" y1="5040.7529" y2="5040.7529"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="2733.5" y1="5040.7529" y2="5202.5303"/><polygon fill="#181818" points="2729.5,5192.5303,2733.5,5202.5303,2737.5,5192.5303,2733.5,5196.5303" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="2733.5" y1="5236.499" y2="5342.5869"/><line style="stroke:#181818;stroke-width:1.0;" x1="2733.5" x2="3450" y1="5342.5869" y2="5342.5869"/><line style="stroke:#181818;stroke-width:1.0;" x1="3450" x2="3450" y1="5342.5869" y2="5433.6748"/><polygon fill="#181818" points="3446,5423.6748,3450,5433.6748,3454,5423.6748,3450,5427.6748" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="99" x="155" y="66.75">Cargo.toml</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="281" x="767.25" y="66.75">src/&lt;å¯¹åº”æŠ½å–å­—æ®µä¸æ–¹æ³•å®šä¹‰&gt;.rs</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="177" x="1452.5" y="66.75">templates/builder.j2</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="74" x="1928" y="66.75">src/lib.rs</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="162" x="2448.5" y="66.75">examples/è°ƒç”¨ä»£ç </text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="79" x="3123" y="66.75">Terminal</text></g></svg></figure>
</div>
</div>
<h3 id="cargotomlæ·»åŠ proc-macroå£°æ˜"><a class="header" href="#cargotomlæ·»åŠ proc-macroå£°æ˜">Cargo.tomlæ·»åŠ proc-macroå£°æ˜</a></h3>
<blockquote>
<p>è¿™æ ·ï¼Œç¼–è¯‘å™¨æ‰å…è®¸ä½ ä½¿ç”¨ #[proc_macro] ç›¸å…³çš„å®ã€‚</p>
</blockquote>
<pre><code class="language-toml  editable">[lib]
proc-macro = true
</code></pre>
<h2 id="è¿‡ç¨‹å‡½æ•°å®-proc_macro"><a class="header" href="#è¿‡ç¨‹å‡½æ•°å®-proc_macro">è¿‡ç¨‹å‡½æ•°å®: #[proc_macro]</a></h2>
<blockquote>
<p>å’Œmacro_rules! åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ›´ä¸ºå¼ºå¤§ã€‚</p>
</blockquote>
<h3 id="srclibrså®šä¹‰è¿‡ç¨‹å‡½æ•°å®"><a class="header" href="#srclibrså®šä¹‰è¿‡ç¨‹å‡½æ•°å®">src/lib.rs:å®šä¹‰è¿‡ç¨‹å‡½æ•°å®</a></h3>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œéƒ½æ˜¯å¤„ç†TokenStream</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">mod builder;
mod builder_with_attr;
mod raw_builder;

use proc_macro::TokenStream;
use raw_builder::BuilderContext;
use syn::{parse_macro_input, DeriveInput};

#[proc_macro]
pub fn query(input: TokenStream) -&gt; TokenStream {
    // åªæœ‰ä¿®æ”¹ä»£ç ä¹‹åå†æ¬¡ç¼–è¯‘æ‰ä¼šæ‰§è¡Œ
    println!(&quot;{:#?}&quot;, input);
    &quot;fn hello() { println!(\&quot;Hello world!\&quot;); }&quot;
        .parse()
        .unwrap()
}

#[proc_macro_derive(RawBuilder)]
pub fn derive_raw_builder(input: TokenStream) -&gt; TokenStream {
    // åªæœ‰ä¿®æ”¹ä»£ç ä¹‹åå†æ¬¡ç¼–è¯‘æ‰ä¼šæ‰§è¡Œ
    println!(&quot;{:#?}&quot;, input);
    BuilderContext::render(input).unwrap().parse().unwrap()
}

#[proc_macro_derive(Builder)]
pub fn derive_builder(input: TokenStream) -&gt; TokenStream {
    let input = parse_macro_input!(input as DeriveInput);
    println!(&quot;{:#?}&quot;, input);
    builder::BuilderContext::from(input).render().into()
}

#[proc_macro_derive(BuilderWithAttr, attributes(builder))]
pub fn derive_builder_with_attr(input: TokenStream) -&gt; TokenStream {
    let input = parse_macro_input!(input as DeriveInput);
    println!(&quot;{:#?}&quot;, input);
    builder_with_attr::BuilderContext::from(input)
        .render()
        .into()
}
</code></pre></pre>
<div id="admonition-tokenstream" class="admonition info">
<div class="admonition-title">
<p>TokenStream</p>
<p><a class="admonition-anchor-link" href="#admonition-tokenstream"></a></p>
</div>
<div>
<p>ä½¿ç”¨è€…å¯ä»¥é€šè¿‡ query!(â€¦) æ¥è°ƒç”¨ã€‚æˆ‘ä»¬æ‰“å°ä¼ å…¥çš„ TokenStreamï¼Œ
ç„¶åæŠŠä¸€æ®µåŒ…å«åœ¨å­—ç¬¦ä¸²ä¸­çš„ä»£ç è§£ææˆ TokenStream è¿”å›ã€‚</p>
<p>è¿™é‡Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ç”¨å­—ç¬¦ä¸²çš„ parse() æ–¹æ³•æ¥è·å¾— TokenStreamï¼Œ
æ˜¯å› ä¸º TokenStream å®ç°äº†  FromStr traitã€‚</p>
</div>
</div>
<h3 id="examplesqueryrsä½¿ç”¨"><a class="header" href="#examplesqueryrsä½¿ç”¨">examples/query.rs:ä½¿ç”¨</a></h3>
<pre><pre class="playground"><code class="language-rust  editable">use macros::query;

fn main() {
    // query!(SELECT * FROM users WHERE age &gt; 10);
    query!(SELECT * FROM users u JOIN (SELECT * from profiles p) WHERE u.id = p.id);
    hello()
}
</code></pre></pre>
<ol>
<li>.parse().unwrap(): å­—ç¬¦ä¸²è‡ªåŠ¨è½¬ä¸ºTokenStreamç±»å‹</li>
</ol>
<pre><code class="language-shell">cargo run --example query &gt; examples/query_output.txt
</code></pre>
<pre><code class="language-shell">TokenStream [
    Ident {
        ident: &quot;SELECT&quot;,
        span: #0 bytes(94..100),
    },
    Punct {
        ch: '*',
        spacing: Alone,
        span: #0 bytes(101..102),
    },
    Ident {
        ident: &quot;FROM&quot;,
        span: #0 bytes(103..107),
    },
    Ident {
        ident: &quot;users&quot;,
        span: #0 bytes(108..113),
    },
    Ident {
        ident: &quot;u&quot;,
        span: #0 bytes(114..115),
    },
    Ident {
        ident: &quot;JOIN&quot;,
        span: #0 bytes(116..120),
    },
    Group {
        delimiter: Parenthesis,
        stream: TokenStream [
            Ident {
                ident: &quot;SELECT&quot;,
                span: #0 bytes(122..128),
            },
            Punct {
                ch: '*',
                spacing: Alone,
                span: #0 bytes(129..130),
            },
            Ident {
                ident: &quot;from&quot;,
                span: #0 bytes(131..135),
            },
            Ident {
                ident: &quot;profiles&quot;,
                span: #0 bytes(136..144),
            },
            Ident {
                ident: &quot;p&quot;,
                span: #0 bytes(145..146),
            },
        ],
        span: #0 bytes(121..147),
    },
    Ident {
        ident: &quot;WHERE&quot;,
        span: #0 bytes(148..153),
    },
    Ident {
        ident: &quot;u&quot;,
        span: #0 bytes(154..155),
    },
    Punct {
        ch: '.',
        spacing: Alone,
        span: #0 bytes(155..156),
    },
    Ident {
        ident: &quot;id&quot;,
        span: #0 bytes(156..158),
    },
    Punct {
        ch: '=',
        spacing: Alone,
        span: #0 bytes(159..160),
    },
    Ident {
        ident: &quot;p&quot;,
        span: #0 bytes(161..162),
    },
    Punct {
        ch: '.',
        spacing: Alone,
        span: #0 bytes(162..163),
    },
    Ident {
        ident: &quot;id&quot;,
        span: #0 bytes(163..165),
    },
]
Hello world!
</code></pre>
<div id="admonition-tokenstreamæ˜¯ä¸€ä¸ªiteratoré‡Œé¢åŒ…å«ä¸€ç³»åˆ—çš„tokentree" class="admonition tip">
<div class="admonition-title">
<p>TokenStreamæ˜¯ä¸€ä¸ªIteratorï¼Œé‡Œé¢åŒ…å«ä¸€ç³»åˆ—çš„TokenTree</p>
<p><a class="admonition-anchor-link" href="#admonition-tokenstreamæ˜¯ä¸€ä¸ªiteratoré‡Œé¢åŒ…å«ä¸€ç³»åˆ—çš„tokentree"></a></p>
</div>
<div>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub enum TokenTree {
    // ç»„ï¼Œå¦‚æœä»£ç ä¸­åŒ…å«æ‹¬å·ï¼Œæ¯”å¦‚{} [] &lt;&gt; () ï¼Œé‚£ä¹ˆå†…éƒ¨çš„å†…å®¹ä¼šè¢«åˆ†ææˆä¸€ä¸ªGroupï¼ˆç»„ï¼‰
    Group(Group), 
    // æ ‡è¯†ç¬¦
    Ident(Ident),
    // æ ‡ç‚¹ç¬¦å· 
    Punct(Punct),
    // å­—é¢é‡ 
    Literal(Literal), 
}
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
<div id="admonition-group-example" class="admonition info">
<div class="admonition-title">
<p>Group Example</p>
<p><a class="admonition-anchor-link" href="#admonition-group-example"></a></p>
</div>
<div>
<pre><pre class="playground"><code class="language-rust">use macros::query;

fn main() {
    // query!(SELECT * FROM users WHERE age &gt; 10);
    query!(SELECT * FROM users u JOIN (SELECT * from profiles p) WHERE u.id = p.id);
    hello()
}
</code></pre></pre>
</div>
</div>
<h2 id="è¿‡ç¨‹æ´¾ç”Ÿå®-proc_macro_devivederivemacroname"><a class="header" href="#è¿‡ç¨‹æ´¾ç”Ÿå®-proc_macro_devivederivemacroname">è¿‡ç¨‹æ´¾ç”Ÿå®: /#[proc_macro_devive(DeriveMacroName)]</a></h2>
<blockquote>
<p>ç”¨äºç»“æ„ä½“ï¼ˆstructï¼‰ã€æšä¸¾ï¼ˆenumï¼‰ã€è”åˆï¼ˆunionï¼‰ç±»å‹ï¼Œå¯ä¸ºå…¶å®ç°å‡½æ•°æˆ–ç‰¹å¾ï¼ˆTraitï¼‰</p>
</blockquote>
<h3 id="å¸¸ç”¨æ´¾ç”Ÿå®"><a class="header" href="#å¸¸ç”¨æ´¾ç”Ÿå®">å¸¸ç”¨æ´¾ç”Ÿå®</a></h3>
<h4 id="derivedebug"><a class="header" href="#derivedebug">#[derive(Debug)]</a></h4>
<h3 id="åŸå§‹å®ç°builderæ¨¡å¼"><a class="header" href="#åŸå§‹å®ç°builderæ¨¡å¼">åŸå§‹å®ç°builderæ¨¡å¼</a></h3>
<h4 id="æƒ³åˆ°è¾¾åˆ°é“¾å¼è°ƒç”¨çš„æ•ˆæœ"><a class="header" href="#æƒ³åˆ°è¾¾åˆ°é“¾å¼è°ƒç”¨çš„æ•ˆæœ">æƒ³åˆ°è¾¾åˆ°é“¾å¼è°ƒç”¨çš„æ•ˆæœ</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">fn main() {
    let command = Command::builder()
        .executable(&quot;cargo&quot;.to_owned())
        .args(vec![&quot;build&quot;.to_owned(), &quot;--release&quot;.to_owned()])
        .env(vec![])
        .build()
        .unwrap();
    assert!(command.current_dir.is_none());

    let command = Command::builder()
        .executable(&quot;cargo&quot;.to_owned())
        .args(vec![&quot;build&quot;.to_owned(), &quot;--release&quot;.to_owned()])
        .env(vec![])
        .current_dir(&quot;..&quot;.to_owned())
        .build()
        .unwrap();
    assert!(command.current_dir.is_some());
    println!(&quot;{:?}&quot;, command);
}
</code></pre></pre>
<h4 id="å¯ä»¥è¿™æ ·å®šä¹‰"><a class="header" href="#å¯ä»¥è¿™æ ·å®šä¹‰">å¯ä»¥è¿™æ ·å®šä¹‰</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">/// è¿™æ˜¯command.rsçš„æ´¾ç”Ÿå®å®ç°çš„ä»£ç æ ·å­
#[allow(dead_code)]
#[derive(Debug)]
pub struct Command {
    executable: String,
    args: Vec&lt;String&gt;,
    env: Vec&lt;String&gt;,
    current_dir: Option&lt;String&gt;,
}

#[derive(Debug, Default)]
pub struct CommandBuilder {
    executable: Option&lt;String&gt;,
    args: Option&lt;Vec&lt;String&gt;&gt;,
    env: Option&lt;Vec&lt;String&gt;&gt;,
    current_dir: Option&lt;String&gt;,
}

impl Command {
    pub fn builder() -&gt; CommandBuilder {
        Default::default()
    }
}

impl CommandBuilder {
    pub fn executable(mut self, v: String) -&gt; Self {
        self.executable = Some(v.to_owned());
        self
    }

    pub fn args(mut self, v: Vec&lt;String&gt;) -&gt; Self {
        self.args = Some(v.to_owned());
        self
    }

    pub fn env(mut self, v: Vec&lt;String&gt;) -&gt; Self {
        self.env = Some(v.to_owned());
        self
    }

    pub fn current_dir(mut self, v: String) -&gt; Self {
        self.current_dir = Some(v.to_owned());
        self
    }

    pub fn build(mut self) -&gt; Result&lt;Command, &amp;'static str&gt; {
        Ok(Command {
            executable: self.executable.take().ok_or(&quot;executable must be set&quot;)?,
            args: self.args.take().ok_or(&quot;args must be set&quot;)?,
            env: self.env.take().ok_or(&quot;env must be set&quot;)?,
            current_dir: self.current_dir.take(),
        })
    }
</code></pre></pre>
<h4 id="ä½†æ˜¯æœ‰ç‚¹ç¹çå¯ä»¥ä½¿ç”¨æ´¾ç”Ÿå®æ´¾ç”Ÿå‡ºè¿™äº›ä»£ç "><a class="header" href="#ä½†æ˜¯æœ‰ç‚¹ç¹çå¯ä»¥ä½¿ç”¨æ´¾ç”Ÿå®æ´¾ç”Ÿå‡ºè¿™äº›ä»£ç ">ä½†æ˜¯æœ‰ç‚¹ç¹çï¼Œå¯ä»¥ä½¿ç”¨æ´¾ç”Ÿå®æ´¾ç”Ÿå‡ºè¿™äº›ä»£ç </a></h4>
<h3 id="æ´¾ç”Ÿå®æ€è·¯"><a class="header" href="#æ´¾ç”Ÿå®æ€è·¯">æ´¾ç”Ÿå®æ€è·¯</a></h3>
<h4 id="è¦ç”Ÿæˆçš„ä»£ç æ¨¡ç‰ˆ"><a class="header" href="#è¦ç”Ÿæˆçš„ä»£ç æ¨¡ç‰ˆ">è¦ç”Ÿæˆçš„ä»£ç æ¨¡ç‰ˆ</a></h4>
<p>æŠŠè¾“å…¥çš„ TokenStream æŠ½å–å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯æŠŠåœ¨ struct çš„å®šä¹‰å†…éƒ¨ï¼Œæ¯ä¸ªåŸŸçš„åå­—åŠå…¶ç±»å‹éƒ½æŠ½å‡ºæ¥ï¼Œç„¶åç”Ÿæˆå¯¹åº”çš„æ–¹æ³•ä»£ç ã€‚</p>
<pre><pre class="playground"><code class="language-rust  editable">impl {{ name }} {
    pub fn builder() -&gt; {{ builder_name }} {
        Default::default()
    }
}

#[derive(Debug, Default)]
pub struct {{ builder_name }} {
    {% for field in fields %}
        {{ field.name }}: Option&lt;{{ field.ty }}&gt;,
    {% endfor %}
}

impl {{ builder_name }} {
    {% for field in fields %}
    pub fn {{ field.name }}(mut self, v: impl Into&lt;{{ field.ty }}&gt;) -&gt; {{ builder_name }} {
        self.{{ field.name }} = Some(v.into());
        self
    }
    {% endfor %}

    pub fn build(self) -&gt; Result&lt;{{ name }}, &amp;'static str&gt; {
        Ok({{ name }} {
            {% for field in fields %}
                {% if field.optional %}
                {{ field.name }}: self.{{ field.name }},
                {% else %}
                {{ field.name }}: self.{{ field.name }}.ok_or(&quot;Build failed: missing {{ field.name }}&quot;)?,
                {% endif %}
            {% endfor %}
        })
    }
}
</code></pre></pre>
<ol>
<li>7-12: è¿™é‡Œçš„ fileds / builder_name æ˜¯æˆ‘ä»¬è¦ä¼ å…¥çš„å‚æ•°ï¼Œæ¯ä¸ª field è¿˜éœ€è¦ name å’Œ ty ä¸¤ä¸ª å±æ€§ï¼Œåˆ†åˆ«å¯¹åº” field çš„åå­—å’Œç±»å‹</li>
<li>25-26: å¯¹äºåŸæœ¬æ˜¯ Option<T> ç±»å‹çš„åŸŸï¼Œè¦é¿å…ç”Ÿæˆ Option<Option>ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ˜¯å¦æ˜¯ Option å•ç‹¬æŠ½å–å‡ºæ¥ï¼Œå¦‚æœæ˜¯ Option<T>ï¼Œé‚£ä¹ˆ ty å°±æ˜¯ Tã€‚æ‰€ä»¥ï¼Œfield è¿˜éœ€è¦ä¸€ä¸ªå± æ€§
optionalã€‚</li>
</ol>
<h4 id="æ„å»ºå¯¹åº”æ•°æ®ç»“æ„"><a class="header" href="#æ„å»ºå¯¹åº”æ•°æ®ç»“æ„">æ„å»ºå¯¹åº”æ•°æ®ç»“æ„</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">/// å¤„ç† jinja æ¨¡æ¿çš„æ•°æ®ç»“æ„ï¼Œåœ¨æ¨¡æ¿ä¸­æˆ‘ä»¬ä½¿ç”¨äº† name / builder_name / fields
#[derive(Template)]
#[template(path = &quot;builder.j2&quot;, escape = &quot;none&quot;)]
pub struct BuilderContext {
    name: String,
    builder_name: String,
    fields: Vec&lt;Fd&gt;,
}
</code></pre></pre>
<h4 id="srclibrs-ä½¿ç”¨æ´¾ç”Ÿå®ä»tokenstreamæŠ½å–å‡ºæƒ³è¦çš„ä¿¡æ¯"><a class="header" href="#srclibrs-ä½¿ç”¨æ´¾ç”Ÿå®ä»tokenstreamæŠ½å–å‡ºæƒ³è¦çš„ä¿¡æ¯">src/lib.rs: ä½¿ç”¨æ´¾ç”Ÿå®ä»TokenStreamæŠ½å–å‡ºæƒ³è¦çš„ä¿¡æ¯</a></h4>
<blockquote>
<p>å¯¹äº derive macroï¼Œè¦ä½¿ç”¨ proce_macro_derive è¿™ä¸ªå®ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ª derive macro å‘½åä¸º Builderã€‚</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">#[proc_macro_derive(RawBuilder)]
pub fn derive_raw_builder(input: TokenStream) -&gt; TokenStream {
    // åªæœ‰ä¿®æ”¹ä»£ç ä¹‹åå†æ¬¡ç¼–è¯‘æ‰ä¼šæ‰§è¡Œ
    println!(&quot;{:#?}&quot;, input);
    BuilderContext::render(input).unwrap().parse().unwrap()
}
</code></pre></pre>
<h4 id="examplesraw_commandrs-ä½¿ç”¨è¿™ä¸ªæ´¾ç”Ÿå®æŠ½å–"><a class="header" href="#examplesraw_commandrs-ä½¿ç”¨è¿™ä¸ªæ´¾ç”Ÿå®æŠ½å–">examples/raw_command.rs: ä½¿ç”¨è¿™ä¸ªæ´¾ç”Ÿå®æŠ½å–</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">use macros::RawBuilder;

#[allow(dead_code)]
#[derive(Debug, RawBuilder)]
pub struct Command {
    executable: String,
    args: Vec&lt;String&gt;,
    env: Vec&lt;String&gt;,
    current_dir: Option&lt;String&gt;,
}

fn main() {
    let command = Command::builder()
        .executable(&quot;cargo&quot;.to_owned())
        .args(vec![&quot;build&quot;.to_owned(), &quot;--release&quot;.to_owned()])
        .env(vec![])
        .build()
        .unwrap();
    assert!(command.current_dir.is_none());

    let command = Command::builder()
        .executable(&quot;cargo&quot;.to_owned())
        .args(vec![&quot;build&quot;.to_owned(), &quot;--release&quot;.to_owned()])
        .env(vec![])
        .current_dir(&quot;..&quot;.to_owned())
        .build()
        .unwrap();
    assert!(command.current_dir.is_some());
    println!(&quot;{:?}&quot;, command);
}
</code></pre></pre>
<h4 id="è¿è¡ŒæŸ¥çœ‹è·å–çš„tokenstream"><a class="header" href="#è¿è¡ŒæŸ¥çœ‹è·å–çš„tokenstream">è¿è¡Œï¼ŒæŸ¥çœ‹è·å–çš„TokenStream</a></h4>
<pre><code class="language-shell">cargo run --example raw_command &gt; examples/raw_command_output.txt
</code></pre>
<pre><code class="language-shell">TokenStream [
    Punct {
        ch: '#',
        spacing: Alone,
        span: #0 bytes(25..26),
    },
    Group {
        delimiter: Bracket,
        stream: TokenStream [
            Ident {
                ident: &quot;allow&quot;,
                span: #0 bytes(27..32),
            },
            Group {
                delimiter: Parenthesis,
                stream: TokenStream [
                    Ident {
                        ident: &quot;dead_code&quot;,
                        span: #0 bytes(33..42),
                    },
                ],
                span: #0 bytes(32..43),
            },
        ],
        span: #0 bytes(26..44),
    },
    Ident {
        ident: &quot;pub&quot;,
        span: #0 bytes(74..77),
    },
    Ident {
        ident: &quot;struct&quot;,
        span: #0 bytes(78..84),
    },
    Ident {
        ident: &quot;Command&quot;,
        span: #0 bytes(85..92),
    },
    Group {
        delimiter: Brace,
        stream: TokenStream [
            Ident {
                ident: &quot;executable&quot;,
                span: #0 bytes(99..109),
            },
            Punct {
                ch: ':',
                spacing: Alone,
                span: #0 bytes(109..110),
            },
            Ident {
                ident: &quot;String&quot;,
                span: #0 bytes(111..117),
            },
            Punct {
                ch: ',',
                spacing: Alone,
                span: #0 bytes(117..118),
            },
            Ident {
                ident: &quot;args&quot;,
                span: #0 bytes(123..127),
            },
            Punct {
                ch: ':',
                spacing: Alone,
                span: #0 bytes(127..128),
            },
            Ident {
                ident: &quot;Vec&quot;,
                span: #0 bytes(129..132),
            },
            Punct {
                ch: '&lt;',
                spacing: Alone,
                span: #0 bytes(132..133),
            },
            Ident {
                ident: &quot;String&quot;,
                span: #0 bytes(133..139),
            },
            Punct {
                ch: '&gt;',
                spacing: Joint,
                span: #0 bytes(139..140),
            },
            Punct {
                ch: ',',
                spacing: Alone,
                span: #0 bytes(140..141),
            },
            Ident {
                ident: &quot;env&quot;,
                span: #0 bytes(146..149),
            },
            Punct {
                ch: ':',
                spacing: Alone,
                span: #0 bytes(149..150),
            },
            Ident {
                ident: &quot;Vec&quot;,
                span: #0 bytes(151..154),
            },
            Punct {
                ch: '&lt;',
                spacing: Alone,
                span: #0 bytes(154..155),
            },
            Ident {
                ident: &quot;String&quot;,
                span: #0 bytes(155..161),
            },
            Punct {
                ch: '&gt;',
                spacing: Joint,
                span: #0 bytes(161..162),
            },
            Punct {
                ch: ',',
                spacing: Alone,
                span: #0 bytes(162..163),
            },
            Ident {
                ident: &quot;current_dir&quot;,
                span: #0 bytes(168..179),
            },
            Punct {
                ch: ':',
                spacing: Alone,
                span: #0 bytes(179..180),
            },
            Ident {
                ident: &quot;Option&quot;,
                span: #0 bytes(181..187),
            },
            Punct {
                ch: '&lt;',
                spacing: Alone,
                span: #0 bytes(187..188),
            },
            Ident {
                ident: &quot;String&quot;,
                span: #0 bytes(188..194),
            },
            Punct {
                ch: '&gt;',
                spacing: Joint,
                span: #0 bytes(194..195),
            },
            Punct {
                ch: ',',
                spacing: Alone,
                span: #0 bytes(195..196),
            },
        ],
        span: #0 bytes(93..198),
    },
]
Command { executable: &quot;cargo&quot;, args: [&quot;build&quot;, &quot;--release&quot;], env: [], current_dir: Some(&quot;..&quot;) }
</code></pre>
<div id="admonition-æ‰“å°ä¿¡æ¯è¯´æ˜" class="admonition info">
<div class="admonition-title">
<p>æ‰“å°ä¿¡æ¯è¯´æ˜</p>
<p><a class="admonition-anchor-link" href="#admonition-æ‰“å°ä¿¡æ¯è¯´æ˜"></a></p>
</div>
<div>
<ol>
<li>
<p>é¦–å…ˆæœ‰ä¸€ä¸ª Groupï¼ŒåŒ…å«äº† #[allow(dead_code)] å±æ€§çš„ä¿¡æ¯ã€‚å› ä¸ºæˆ‘ä»¬ç°åœ¨æ‹¿åˆ° çš„ derive ä¸‹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æ‰€æœ‰ä¸å±äº #[derive(â€¦)] çš„å±æ€§ï¼Œéƒ½ä¼šè¢«æ”¾å…¥ TokenStream ä¸­ã€‚</p>
</li>
<li>
<p>ä¹‹åæ˜¯ pub / struct / Command ä¸‰ä¸ª identã€‚</p>
</li>
<li>
<p>éšååˆæ˜¯ä¸€ä¸ª Groupï¼ŒåŒ…å«äº†æ¯ä¸ª field çš„ä¿¡æ¯ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œfield ä¹‹é—´ç”¨é€—å·è¿™ä¸ª Punct åˆ†éš”ï¼Œfield çš„åå­—å’Œç±»å‹åˆæ˜¯é€šè¿‡å†’å·è¿™ä¸ª Punct åˆ†éš”ã€‚è€Œç±»å‹ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ª Identï¼Œå¦‚ Stringï¼Œæˆ–è€…ä¸€ç³»åˆ— Ident / Punctï¼Œå¦‚ Vec / &lt; / String / &gt;ã€‚</p>
</li>
</ol>
</div>
</div>
<h4 id="srcraw_builderrs-ä½¿ç”¨anyhowä¸askamaæŠ½å–tokenstreamä¸­çš„ä¿¡æ¯"><a class="header" href="#srcraw_builderrs-ä½¿ç”¨anyhowä¸askamaæŠ½å–tokenstreamä¸­çš„ä¿¡æ¯">src/raw_builder.rs: ä½¿ç”¨anyhowä¸askamaæŠ½å–TokenStreamä¸­çš„ä¿¡æ¯</a></h4>
<blockquote>
<p>æˆ‘ä»¬è¦åšçš„å°±æ˜¯ï¼ŒæŠŠè¿™ä¸ª TokenStream ä¸­çš„ struct åå­—ï¼Œä»¥åŠæ¯ä¸ª field çš„åå­—å’Œç±»å‹æ‹¿å‡ºæ¥ã€‚
å¦‚æœç±»å‹æ˜¯ Option<T>ï¼Œé‚£ä¹ˆæŠŠ T æ‹¿å‡ºæ¥ï¼ŒæŠŠ optional è®¾ç½®ä¸º trueã€‚</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust  editable">use anyhow::Result;
use askama::Template;
use proc_macro::{Ident, TokenStream, TokenTree};
use std::collections::VecDeque;

/// å¤„ç† jinja æ¨¡æ¿çš„æ•°æ®ç»“æ„ï¼Œåœ¨æ¨¡æ¿ä¸­æˆ‘ä»¬ä½¿ç”¨äº† name / builder_name / fields
#[derive(Template)]
#[template(path = &quot;builder.j2&quot;, escape = &quot;none&quot;)]
pub struct BuilderContext {
    name: String,
    builder_name: String,
    fields: Vec&lt;Fd&gt;,
}

/// æè¿° struct çš„æ¯ä¸ª field
#[derive(Debug, Default)]
struct Fd {
    name: String,
    ty: String,
    optional: bool,
}
</code></pre></pre>
<h4 id="templatesbuilderj2-ä¸Šé¢askamaç”¨åˆ°çš„jinja2æ¨¡ç‰ˆ"><a class="header" href="#templatesbuilderj2-ä¸Šé¢askamaç”¨åˆ°çš„jinja2æ¨¡ç‰ˆ">templates/builder.j2: ä¸Šé¢askamaç”¨åˆ°çš„jinja2æ¨¡ç‰ˆ</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">impl {{ name }} {
    pub fn builder() -&gt; {{ builder_name }} {
        Default::default()
    }
}

#[derive(Debug, Default)]
pub struct {{ builder_name }} {
    {% for field in fields %}
        {{ field.name }}: Option&lt;{{ field.ty }}&gt;,
    {% endfor %}
}

impl {{ builder_name }} {
    {% for field in fields %}
    pub fn {{ field.name }}(mut self, v: impl Into&lt;{{ field.ty }}&gt;) -&gt; {{ builder_name }} {
        self.{{ field.name }} = Some(v.into());
        self
    }
    {% endfor %}

    pub fn build(self) -&gt; Result&lt;{{ name }}, &amp;'static str&gt; {
        Ok({{ name }} {
            {% for field in fields %}
                {% if field.optional %}
                {{ field.name }}: self.{{ field.name }},
                {% else %}
                {{ field.name }}: self.{{ field.name }}.ok_or(&quot;Build failed: missing {{ field.name }}&quot;)?,
                {% endif %}
            {% endfor %}
        })
    }
}
</code></pre></pre>
<h4 id="srcraw_builderrs-å®ç°å¯¹åº”æŠ½å–æ–¹æ³•"><a class="header" href="#srcraw_builderrs-å®ç°å¯¹åº”æŠ½å–æ–¹æ³•">src/raw_builder.rs: å®ç°å¯¹åº”æŠ½å–æ–¹æ³•</a></h4>
<pre><pre class="playground"><code class="language-rust  editable">impl Fd {
    /// name å’Œ field éƒ½æ˜¯é€šè¿‡å†’å· Punct åˆ‡åˆ†å‡ºæ¥çš„ TokenTree åˆ‡ç‰‡
    pub fn new(name: &amp;[TokenTree], ty: &amp;[TokenTree]) -&gt; Self {
        // æŠŠç±»ä¼¼ Ident(&quot;Option&quot;), Punct('&lt;'), Ident(&quot;String&quot;), Punct('&gt;) çš„ ty
        // æ”¶é›†æˆä¸€ä¸ª String åˆ—è¡¨ï¼Œå¦‚ vec![&quot;Option&quot;, &quot;&lt;&quot;, &quot;String&quot;, &quot;&gt;&quot;]
        let ty = ty
            .iter()
            .map(|v| match v {
                TokenTree::Ident(n) =&gt; n.to_string(),
                TokenTree::Punct(p) =&gt; p.as_char().to_string(),
                e =&gt; panic!(&quot;Expect ident, got {:?}&quot;, e),
            })
            .collect::&lt;Vec&lt;_&gt;&gt;();
        // å†’å·å‰æœ€åä¸€ä¸ª TokenTree æ˜¯ field çš„åå­—
        // æ¯”å¦‚ï¼šexecutable: String,
        // æ³¨æ„è¿™é‡Œä¸åº”è¯¥ç”¨ name[0]ï¼Œå› ä¸ºæœ‰å¯èƒ½æ˜¯ pub executable: String
        // ç”šè‡³ï¼Œå¸¦ attributes çš„ fieldï¼Œ
        // æ¯”å¦‚ï¼š#[builder(hello = world)] pub executable: String
        match name.last() {
            Some(TokenTree::Ident(name)) =&gt; {
                // å¦‚æœ ty ç¬¬ 0 é¡¹æ˜¯ Optionï¼Œé‚£ä¹ˆä»ç¬¬äºŒé¡¹å–åˆ°å€’æ•°ç¬¬ä¸€é¡¹
                // å–å®Œåä¸Šé¢çš„ä¾‹å­ä¸­çš„ ty ä¼šå˜æˆ [&quot;String&quot;]ï¼Œoptiona = true
                let (ty, optional) = if ty[0].as_str() == &quot;Option&quot; {
                    (&amp;ty[2..ty.len() - 1], true)
                } else {
                    (&amp;ty[..], false)
                };
                Self {
                    name: name.to_string(),
                    ty: ty.join(&quot;&quot;), // æŠŠ ty join æˆå­—ç¬¦ä¸²
                    optional,
                }
            }
            e =&gt; panic!(&quot;Expect ident, got {:?}&quot;, e),
        }
    }
}

impl BuilderContext {
    /// ä» TokenStream ä¸­æå–ä¿¡æ¯ï¼Œæ„å»º BuilderContext
    fn new(input: TokenStream) -&gt; Self {
        let (name, input) = split(input);
        let fields = get_struct_fields(input);
        Self {
            builder_name: format!(&quot;{}Builder&quot;, name),
            name: name.to_string(),
            fields,
        }
    }

    /// æŠŠæ¨¡æ¿æ¸²æŸ“æˆå­—ç¬¦ä¸²ä»£ç 
    pub fn render(input: TokenStream) -&gt; Result&lt;String&gt; {
        let template = Self::new(input);
        Ok(template.render()?)
    }
}

/// æŠŠ TokenStream åˆ†å‡º struct çš„åå­—ï¼Œå’ŒåŒ…å« fields çš„ TokenStream
fn split(input: TokenStream) -&gt; (Ident, TokenStream) {
    let mut input = input.into_iter().collect::&lt;VecDeque&lt;_&gt;&gt;();
    // ä¸€ç›´å¾€åæ‰¾ï¼Œæ‰¾åˆ° struct åœä¸‹æ¥
    while let Some(item) = input.pop_front() {
        if let TokenTree::Ident(v) = item {
            if v.to_string() == &quot;struct&quot; {
                break;
            }
        }
    }

    // struct åé¢ï¼Œåº”è¯¥æ˜¯ struct name
    let ident;
    if let Some(TokenTree::Ident(v)) = input.pop_front() {
        ident = v;
    } else {
        panic!(&quot;Didn't find struct name&quot;);
    }

    // struct åé¢å¯èƒ½è¿˜æœ‰è‹¥å¹² TokenTreeï¼Œæˆ‘ä»¬ä¸ç®¡ï¼Œä¸€è·¯æ‰¾åˆ°ç¬¬ä¸€ä¸ª Group
    let mut group = None;
    for item in input {
        if let TokenTree::Group(g) = item {
            group = Some(g);
            break;
        }
    }

    (ident, group.expect(&quot;Didn't find field group&quot;).stream())
}

/// ä»åŒ…å« fields çš„ TokenStream ä¸­åˆ‡å‡ºæ¥ä¸€ä¸ªä¸ª Fd
fn get_struct_fields(input: TokenStream) -&gt; Vec&lt;Fd&gt; {
    let input = input.into_iter().collect::&lt;Vec&lt;_&gt;&gt;();
    input
        .split(|v| match v {
            // å…ˆç”¨ ',' åˆ‡å‡ºæ¥ä¸€ä¸ªä¸ªåŒ…å« field æ‰€æœ‰ä¿¡æ¯çš„ &amp;[TokenTree]
            TokenTree::Punct(p) =&gt; p.as_char() == ',',
            _ =&gt; false,
        })
        .map(|tokens| {
            tokens
                .split(|v| match v {
                    // å†ç”¨ ':' æŠŠ &amp;[TokenTree] åˆ‡æˆ [&amp;[TokenTree], &amp;[TokenTree]]
                    // å®ƒä»¬åˆ†åˆ«å¯¹åº”åå­—å’Œç±»å‹
                    TokenTree::Punct(p) =&gt; p.as_char() == ':',
                    _ =&gt; false,
                })
                .collect::&lt;Vec&lt;_&gt;&gt;()
        })
        // æ­£å¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥å¾—åˆ° [&amp;[TokenTree], &amp;[TokenTree]]ï¼Œå¯¹äºåˆ‡å‡ºæ¥é•¿åº¦ä¸ä¸º 2 çš„ç»Ÿç»Ÿè¿‡æ»¤æ‰
        .filter(|tokens| tokens.len() == 2)
        // ä½¿ç”¨ Fd::new åˆ›å»ºå‡ºæ¯ä¸ª Fd
        .map(|tokens| Fd::new(tokens[0], tokens[1]))
        .collect()
}
</code></pre></pre>
<div id="admonition-tip" class="admonition tip">
<div class="admonition-title">
<p>Tip</p>
<p><a class="admonition-anchor-link" href="#admonition-tip"></a></p>
</div>
<div>
<p>å¯ä»¥å¯¹ç€æ‰“å°å‡ºæ¥çš„ TokenStream å’Œåˆšæ‰çš„åˆ†æè¿›è¡Œç†è§£ã€‚
æ ¸å¿ƒçš„å°±æ˜¯ get_struct_fields() æ–¹æ³•ï¼Œå¦‚æœè§‰å¾—éš¾æ‡‚ï¼Œ
å¯ä»¥æƒ³æƒ³å¦‚æœè¦æŠŠä¸€ä¸ª a=1,b=2 çš„å­—ç¬¦ä¸²åˆ‡æˆ [[a, 1], [b, 2]] è¯¥æ€ä¹ˆåšï¼Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p>
</div>
</div>
<h3 id="ä½¿ç”¨synquoteå¯ä»¥ä¸ç”¨è‡ªå·±å®šä¹‰æ¨¡ç‰ˆ"><a class="header" href="#ä½¿ç”¨synquoteå¯ä»¥ä¸ç”¨è‡ªå·±å®šä¹‰æ¨¡ç‰ˆ">ä½¿ç”¨syn/quoteå¯ä»¥ä¸ç”¨è‡ªå·±å®šä¹‰æ¨¡ç‰ˆ</a></h3>
<blockquote>
<p>è¯¦è§ä¸Šæ–¹å¯¹æ¯”å›¾</p>
</blockquote>
<h2 id="è¿‡ç¨‹å±æ€§å®-proc_macro_derivemacro_name-attributesattr_name"><a class="header" href="#è¿‡ç¨‹å±æ€§å®-proc_macro_derivemacro_name-attributesattr_name">è¿‡ç¨‹å±æ€§å®: proc_macro_derive(macro_name, attributes(attr_name))</a></h2>
<blockquote>
<p>ç”¨äºå±æ€§å®ï¼Œ ç”¨åœ¨ç»“æ„ä½“ã€å­—æ®µã€å‡½æ•°ç­‰åœ°æ–¹ï¼Œä¸ºå…¶æŒ‡å®šå±æ€§ç­‰åŠŸèƒ½, ç±»ä¼¼pythonçš„è®¡ç®—å±æ€§</p>
</blockquote>
<div id="admonition-å®šä¹‰ç»“æ„ä½“æ—¶åœ¨æŸä¸ªå­—æ®µä¸Šæ–¹ä½¿ç”¨å¯¹åº”attr_name" class="admonition tip">
<div class="admonition-title">
<p>å®šä¹‰ç»“æ„ä½“æ—¶åœ¨æŸä¸ªå­—æ®µä¸Šæ–¹ä½¿ç”¨å¯¹åº”attr_name</p>
<p><a class="admonition-anchor-link" href="#admonition-å®šä¹‰ç»“æ„ä½“æ—¶åœ¨æŸä¸ªå­—æ®µä¸Šæ–¹ä½¿ç”¨å¯¹åº”attr_name"></a></p>
</div>
<div>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[allow(dead_code)]
#[derive(Debug, BuilderWithAttr)]
pub struct Command {
    executable: String,
    #[builder(each = &quot;arg&quot;)]
    args: Vec&lt;String&gt;,
    #[builder(each = &quot;env&quot;, default = &quot;vec![]&quot;)]
    env: Vec&lt;String&gt;,
    current_dir: Option&lt;String&gt;,
}
<span class="boring">}
</span></code></pre></pre>
</div>
</div>
<h3 id="ä½¿ç”¨synquoteå®šä¹‰å±æ€§å®"><a class="header" href="#ä½¿ç”¨synquoteå®šä¹‰å±æ€§å®">ä½¿ç”¨syn/quoteå®šä¹‰å±æ€§å®</a></h3>
<blockquote>
<p>è¯¦è§ä¸Šæ–¹å¯¹æ¯”å›¾</p>
</blockquote>

            </main>

            <!--            <script src="https://utteranc.es/client.js"-->
            <!--                    repo="RustMagazine/rust_magazine_2022"-->
            <!--                    issue-term="title"-->
            <!--                    theme="github-light"-->
            <!--                    crossorigin="anonymous"-->
            <!--                    async></script>-->

            <nav class="nav-wrapper" aria-label="Page navigation">
                <!-- Mobile navigation buttons -->
                    <a rel="prev" href="3_data_structure.html" class="mobile-nav-chapters previous"
                       title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="5_concurrency_async.html" class="mobile-nav-chapters next"
                       title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>

                <div style="clear: both"></div>
            </nav>
        </div>
    </div>

    <nav class="nav-wide-wrapper" aria-label="Page navigation">
            <a rel="prev" href="3_data_structure.html" class="nav-chapters previous" title="Previous chapter"
               aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>

            <a rel="next" href="5_concurrency_async.html" class="nav-chapters next" title="Next chapter"
               aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
    </nav>

</div>



    <script type="text/javascript">
        window.playground_line_numbers = true;
    </script>

    <script type="text/javascript">
        window.playground_copyable = true;
    </script>

    <script src="ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="editor.js" type="text/javascript" charset="utf-8"></script>
    <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
    <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>

    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

<script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="highlight.js" type="text/javascript" charset="utf-8"></script>
<script src="book.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JS scripts -->
    <script type="text/javascript" src="assets/mermaid/mermaid.min.js"></script>
    <script type="text/javascript" src="assets/mermaid/mermaid-init.js"></script>
    <script type="text/javascript" src="assets/smart-anchor.js"></script>
    <script type="text/javascript" src="assets/pagetoc/sidebar.js"></script>

</body>
</html>
